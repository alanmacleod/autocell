var _Mathatan2=Math.atan,_Mathacos=Math.acos,_Mathabs=Math.abs,_Mathceil=Math.ceil,_Mathround=Math.round,_MathLN=Math.LN2,_Mathlog=Math.log,_Mathsign=Math.sign,_NumberEPSILON=Number.EPSILON,_Mathtan=Math.tan,_Mathpow=Math.pow,_Mathcos=Math.cos,_Mathmin=Math.min,_Mathsin=Math.sin,_Mathmax=Math.max,_Mathasin=Math.asin,_MathPI=Math.PI,_Mathatan=Math.atan2,_Mathfloor=Math.floor,_Mathsqrt=Math.sqrt;(function(E){function M(L){if(S[L])return S[L].exports;var A=S[L]={exports:{},id:L,loaded:!1};return E[L].call(A.exports,A,A.exports,M),A.loaded=!0,A.exports}var S={};return M.m=E,M.c=S,M.p='/',M(0)})([function(E,M,S){'use strict';function L(H){return H&&H.__esModule?H:{default:H}}function A(){G.render(),window.requestAnimationFrame(A)}var R=S(1),C=L(R),I=S(9),U=L(I),G=new C.default({size:2500,spread:800,render:'content',type:U.default,scale:10});window.requestAnimationFrame(A),window.setInterval(function(){G.evolve()},1e3/45)},function(E,M,S){'use strict';function L(X){return X&&X.__esModule?X:{default:X}}function A(X,Y){if(!(X instanceof Y))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(M,'__esModule',{value:!0});var R=function(){function X(Y,Z){for(var K=0,J;K<Z.length;K++)J=Z[K],J.enumerable=J.enumerable||!1,J.configurable=!0,'value'in J&&(J.writable=!0),Object.defineProperty(Y,J.key,J)}return function(Y,Z,K){return Z&&X(Y.prototype,Z),K&&X(Y,K),Y}}(),C=S(2),I=L(C),U=S(3),D=L(U),F=S(4),O=L(F),G=S(7),H=L(G),W=function(){function X(Y){var Z=this;A(this,X),this.size=Y.size,this.data=null,this.scale=Y.scale||1,this.pause=!1;this.size/2;this.bounds={minx:0,maxx:this.size-1,miny:0,maxy:this.size-1,minz:0,maxz:this.size-1},this.grid=new H.default(this.bounds,10,!1,'position'),this.element=document.getElementById(Y.render),document.onkeyup=function(J){'Space'==J.code&&(Z.pause=!Z.pause)},this.mouse=new I.default(0,0),this.element.onmousemove=function(J){Z.mouse.set(J.clientX,J.clientY)},this.maxObj=this.init(Y.type,Y.spread),this.renderer=new O.default(Object.assign(Y,{maxParticles:this.maxObj,worldWidth:this.size,worldHeight:this.size,worldDepth:this.size,skyBox:'./img/cloudySea.jpg'}))}return R(X,[{key:'init',value:function(Z,K){this.data=[],this.graphics=[];for(var J=0,Q;J<K;J++)Q=new Z(new D.default(),this.bounds),this.data.push(Q),this.grid.add(Q);return this.data.length}},{key:'render',value:function(){this.renderer.render(this.data,'position','velocity')}},{key:'wrap',value:function(Z){return 0>Z?Z+this.size:Z>this.size-1?Z-this.size:Z}},{key:'array2d',value:function(Z){for(var K=[];K.length<Z;K.push([]));return K}},{key:'evolve',value:function(){if(!this.pause)for(var Z={centroid:this.centroid(),number:this.data.length,mouse:this.mouse.div(this.scale),all:this.data},K=0,J=this.data.length;K<J;K++){Z.neighbours=this.grid.query(this.data[K],250);var Q=this.data[K].position.x,$=this.data[K].position.y,ee=this.data[K].position.z;this.data[K].mutate(Z),this.grid.move(this.data[K],Q,$,ee,this.data[K].position.x,this.data[K].position.y,this.data[K].position.z)}}},{key:'neighbourhoodBruteForce',value:function(Z,K){for(var Q=[],$=this.data[Z].position,ee=0,oe=this.data.length;ee<oe;ee++)if(ee!=Z){var ie=this.data[ee].position.distsq($);ie<=K*K&&Q.push(this.data[ee])}return Q}},{key:'centroid',value:function(){for(var Z=0,K=0,J=0,Q=0,$=this.data.length;Q<$;Q++)Z+=this.data[Q].position.x,K+=this.data[Q].position.y,J+=this.data[Q].position.z;return new D.default(Z/this.data.length,K/this.data.length,J/this.data.length)}}]),X}();M.default=W},function(E,M){'use strict';function S(R,C){if(!(R instanceof C))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(M,'__esModule',{value:!0});var L=function(){function R(C,I){for(var U=0,D;U<I.length;U++)D=I[U],D.enumerable=D.enumerable||!1,D.configurable=!0,'value'in D&&(D.writable=!0),Object.defineProperty(C,D.key,D)}return function(C,I,U){return I&&R(C.prototype,I),U&&R(C,U),C}}(),A=function(){function R(){var C=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,I=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;S(this,R),this.x=C,this.y=I}return L(R,[{key:'set',value:function(I,U){var D=[I,U];return this.x=D[0],this.y=D[1],this}},{key:'sub',value:function(I){return new R(this.x-I.x,this.y-I.y)}},{key:'add',value:function(I){return new R(I.x+this.x,I.y+this.y)}},{key:'mul',value:function(I){return new R(this.x*I,this.y*I)}},{key:'div',value:function(I){return new R(this.x/I,this.y/I)}},{key:'tsub',value:function(I){this.x-=I.x,this.y-=I.y}},{key:'tadd',value:function(I){this.x+=I.x,this.y+=I.y}},{key:'tmul',value:function(I){this.x*=I,this.y*=I}},{key:'tdiv',value:function(I){this.x/=I,this.y/=I}},{key:'tnorm',value:function(){var I=this.mag();return I?this.tdiv(I):this}},{key:'norm',value:function(){var I=this.mag();return I?this.div(I):new R(this.x,this.y)}},{key:'mag',value:function(){return _Mathsqrt(this.x*this.x+this.y*this.y)}},{key:'dist',value:function(I){var U=I.x-this.x,D=I.y-this.y;return _Mathsqrt(U*U+D*D)}},{key:'distsq',value:function(I){var U=I.x-this.x,D=I.y-this.y;return U*U+D*D}}]),R}();M.default=A},function(E,M){'use strict';function S(R,C){if(!(R instanceof C))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(M,'__esModule',{value:!0});var L=function(){function R(C,I){for(var U=0,D;U<I.length;U++)D=I[U],D.enumerable=D.enumerable||!1,D.configurable=!0,'value'in D&&(D.writable=!0),Object.defineProperty(C,D.key,D)}return function(C,I,U){return I&&R(C.prototype,I),U&&R(C,U),C}}(),A=function(){function R(){var C=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,I=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,U=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;S(this,R),this.x=C,this.y=I,this.z=U}return L(R,[{key:'set',value:function(I,U,D){var F=[I,U,D];return this.x=F[0],this.y=F[1],this.z=F[2],this}},{key:'sub',value:function(I){return new R(this.x-I.x,this.y-I.y,this.z-I.z)}},{key:'add',value:function(I){return new R(I.x+this.x,I.y+this.y,I.z+this.z)}},{key:'mul',value:function(I){return new R(this.x*I,this.y*I,this.z*I)}},{key:'div',value:function(I){return new Vector2(this.x/I,this.y/I,this.z/I)}},{key:'tsub',value:function(I){this.x-=I.x,this.y-=I.y,this.z-=I.z}},{key:'tadd',value:function(I){this.x+=I.x,this.y+=I.y,this.z+=I.z}},{key:'tmul',value:function(I){this.x*=I,this.y*=I,this.z*=I}},{key:'tdiv',value:function(I){this.x/=I,this.y/=I,this.z/=I}},{key:'tnorm',value:function(){var I=this.mag();return I?this.tdiv(I):this}},{key:'norm',value:function(){var I=this.mag();return I?this.div(I):new R(this.x,this.y,this.z)}},{key:'mag',value:function(){return _Mathsqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:'dist',value:function(I){var U=I.x-this.x,D=I.y-this.y,F=I.z-this.z;return _Mathsqrt(U*U+D*D+F*F)}},{key:'distsq',value:function(I){var U=I.x-this.x,D=I.y-this.y,F=I.z-this.z;return U*U+D*D+F*F}}]),R}();M.default=A},function(E,M,S){'use strict';function A(G,H){if(!(G instanceof H))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(M,'__esModule',{value:!0});var R=function(){function G(H,V){for(var W=0,X;W<V.length;W++)X=V[W],X.enumerable=X.enumerable||!1,X.configurable=!0,'value'in X&&(X.writable=!0),Object.defineProperty(H,X.key,X)}return function(H,V,W){return V&&G(H.prototype,V),W&&G(H,W),H}}(),C=S(5),I=function(G){if(G&&G.__esModule)return G;var H={};if(null!=G)for(var V in G)Object.prototype.hasOwnProperty.call(G,V)&&(H[V]=G[V]);return H.default=G,H}(C),U=S(6),D=U.BirdSimple,F={FOLLOW:0,MOUSELOOK:1},O=function(){function G(H){A(this,G),this.renderElement='string'==typeof H.render?document.getElementById(H.render):H.render,this.worldWidth=H.worldWidth||1,this.worldHeight=H.worldHeight||1,this.worldDepth=H.worldDepth||1,this.mode=F.FOLLOW,this.followTarget=0;var V=[0,0];this.width=V[0],this.height=V[1],this.maxParticles=H.maxParticles||1e3,this.models=[],this.textures=[],this.init(H)}return R(G,[{key:'init',value:function(V){this.initSystem(V),this.initMeshes(D),this.initTextures(V.skyBox)}},{key:'initSystem',value:function(){var W=this,X=[this.renderElement.clientWidth,this.renderElement.clientHeight];this.width=X[0],this.height=X[1],this.camera=new I.PerspectiveCamera(75,this.width/this.height,1,5e3),this.camera.position.set(0,-50,0),this.camera.lookAt(new I.Vector3(0,2500,0)),this.scene=new I.Scene,this.directionalLight=new I.DirectionalLight(16711680),this.directionalLight.position.set(1,1,-0.5).normalize(),this.scene.add(this.directionalLight),this.scene.fog=new I.FogExp2(16777215,4e-4),this.renderer=new I.WebGLRenderer,this.renderer.setClearColor(15790320),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderElement.appendChild(this.renderer.domElement),this.controls=new I.OrbitControls(this.camera),this.clock=new I.Clock,this.controls.enabled=this.mode==F.MOUSELOOK,document.addEventListener('keydown',this.keyDown.bind(this),!1),document.addEventListener('keyup',this.keyUp,!1),this._allowChangeFollow=!0,window.setInterval(function(){W.followTarget=_Mathfloor(Math.random()*W.maxParticles)},30000)}},{key:'initTextures',value:function(V){for(var W=this,X=0;6>X;X++)this.textures.push(new I.Texture);if(V){var Y=new Image;Y.src=V,Y.onload=function(){for(var Z=_Mathfloor(Y.width/4),K=_Mathfloor(Y.height/3),J=[[1,0],[0,1],[1,1],[2,1],[3,1],[1,2]],Q=0;Q<J.length;Q++){var $=document.createElement('canvas'),ee=$.getContext('2d');$.width=Z,$.height=K;var oe=J[Q],ie=oe[0]*Z,ne=oe[1]*K;ee.drawImage(Y,ie,ne,Z,K,0,0,Z,K),W.textures[Q].image=$,W.textures[Q].needsUpdate=!0}for(var se=[],le=0;6>le;le++)se.push(new I.MeshBasicMaterial({map:W.textures[le]}));for(var pe=[3,1,0,5,2,4],ue=[],fe=0;fe<pe.length;fe++)ue.push(se[pe[fe]]);W.skyBox=new I.Mesh(new I.CubeGeometry(2500,2500,2500),new I.MultiMaterial(ue)),W.skyBox.applyMatrix(new I.Matrix4().makeScale(1,1,-1)),W.scene.add(W.skyBox)}}}},{key:'initMeshes',value:function(V){for(var W=5+5*Math.random(),X=0,Y;X<this.maxParticles;X++){Y=new I.Geometry;for(var Z=0;Z<V.vertices.length;Z++)Y.vertices.push(new I.Vector3(V.vertices[Z][0],V.vertices[Z][1],V.vertices[Z][2]));for(var K=0;K<V.faces.length;K++)Y.faces.push(new I.Face3(V.faces[K][0],V.faces[K][1],V.faces[K][2]));var J=new I.Mesh(Y,new I.MeshBasicMaterial({color:0.9>Math.random()?3158064:13684944,side:I.DoubleSide}));J.scale.set(W,W,W),J.phase=_Mathfloor(62*Math.random()),this.models.push(J),this.scene.add(J)}}},{key:'keyDown',value:function(V){'Enter'==V.code&&(this.mode=this.mode==F.FOLLOW?F.MOUSELOOK:F.FOLLOW)}},{key:'keyUp',value:function(){}},{key:'resize',value:function(){}},{key:'render',value:function(V,W){if(V.length!=this.maxParticles){throw Error('Mismatching dataset size data='+V.length+', max='+this.maxParticles)}var Y=this.worldWidth/2,Z=this.worldHeight/2,K=this.worldDepth/2;if(this.mode==F.FOLLOW){this.controls.enabled=!1;var J=W?V[this.followTarget][W]:V[this.followTarget];this.camera.lookAt(new I.Vector3(J.x-Y,J.y-Z,J.z-K))}else this.controls.enabled=!0,this.controls.update(this.clock.getDelta());for(var Q=0,$;Q<V.length;Q++){$=V[Q],W&&($=V[Q][W]);var ee=V[Q].velocity,oe=this.models[Q],ie=(180*_Mathatan(-ee.z,ee.x)/_MathPI+360+90)%360;oe.rotation.y=ie*_MathPI/180,oe.rotation.z=_Mathasin(ee.y/ee.mag()),oe.phase=(oe.phase+_Mathmax(0,oe.rotation.z))%10;var ne=_Mathsin(oe.phase);oe.geometry.vertices[0].y=3*ne,oe.geometry.vertices[2].y=3*ne,oe.geometry.verticesNeedUpdate=!0,oe.position.x=$.x-Y,oe.position.y=$.y-Z,oe.position.z=$.z-K}this.renderer.render(this.scene,this.camera)}}]),G}();M.default=O,I.FirstPersonControls=function(G,H){function V(Q){Q.preventDefault()}function W(Q,$){return function(){$.apply(Q,arguments)}}this.object=G,this.target=new I.Vector3(0,0,0),this.domElement=H===void 0?document:H,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=5e-3,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=_MathPI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute('tabindex',-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(Q){if(this.domElement!==document&&this.domElement.focus(),Q.preventDefault(),Q.stopPropagation(),this.activeLook)switch(Q.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;}this.mouseDragOn=!0},this.onMouseUp=function(Q){if(Q.preventDefault(),Q.stopPropagation(),this.activeLook)switch(Q.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;}this.mouseDragOn=!1},this.onMouseMove=function(Q){this.domElement===document?(this.mouseX=Q.pageX-this.viewHalfX,this.mouseY=Q.pageY-this.viewHalfY):(this.mouseX=Q.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=Q.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(Q){switch(Q.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;}},this.onKeyUp=function(Q){switch(Q.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1;}},this.update=function(Q){if(!1!==this.enabled){if(this.heightSpeed){var $=I.Math.clamp(this.object.position.y,this.heightMin,this.heightMax),ee=$-this.heightMin;this.autoSpeedFactor=Q*(ee*this.heightCoef)}else this.autoSpeedFactor=0;var oe=Q*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(oe+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(oe),this.moveLeft&&this.object.translateX(-oe),this.moveRight&&this.object.translateX(oe),this.moveUp&&this.object.translateY(oe),this.moveDown&&this.object.translateY(-oe);var ie=Q*this.lookSpeed;this.activeLook||(ie=0);var ne=1;this.constrainVertical&&(ne=_MathPI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*ie,this.lookVertical&&(this.lat-=this.mouseY*ie*ne),this.lat=_Mathmax(-85,_Mathmin(85,this.lat)),this.phi=I.Math.degToRad(90-this.lat),this.theta=I.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=I.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var se=this.target,le=this.object.position;se.x=le.x+100*_Mathsin(this.phi)*_Mathcos(this.theta),se.y=le.y+100*_Mathcos(this.phi),se.z=le.z+100*_Mathsin(this.phi)*_Mathsin(this.theta),this.object.lookAt(se)}},this.dispose=function(){this.domElement.removeEventListener('contextmenu',V,!1),this.domElement.removeEventListener('mousedown',Y,!1),this.domElement.removeEventListener('mousemove',X,!1),this.domElement.removeEventListener('mouseup',Z,!1),window.removeEventListener('keydown',K,!1),window.removeEventListener('keyup',J,!1)};var X=W(this,this.onMouseMove),Y=W(this,this.onMouseDown),Z=W(this,this.onMouseUp),K=W(this,this.onKeyDown),J=W(this,this.onKeyUp);this.domElement.addEventListener('contextmenu',V,!1),this.domElement.addEventListener('mousemove',X,!1),this.domElement.addEventListener('mousedown',Y,!1),this.domElement.addEventListener('mouseup',Z,!1),window.addEventListener('keydown',K,!1),window.addEventListener('keyup',J,!1),this.handleResize()},I.OrbitControls=function(G,H){function V(){return 2*_MathPI/60/60*Re.autoRotateSpeed}function W(){return _Mathpow(0.95,Re.zoomSpeed)}function X($e){Be.theta-=$e}function Y($e){Be.phi-=$e}function Z($e){Re.object instanceof I.PerspectiveCamera?Fe/=$e:Re.object instanceof I.OrthographicCamera?(Re.object.zoom=_Mathmax(Re.minZoom,_Mathmin(Re.maxZoom,Re.object.zoom*$e)),Re.object.updateProjectionMatrix(),Ge=!0):(void 0,Re.enableZoom=!1)}function K($e){Re.object instanceof I.PerspectiveCamera?Fe*=$e:Re.object instanceof I.OrthographicCamera?(Re.object.zoom=_Mathmax(Re.minZoom,_Mathmin(Re.maxZoom,Re.object.zoom/$e)),Re.object.updateProjectionMatrix(),Ge=!0):(void 0,Re.enableZoom=!1)}function J($e){He.set($e.clientX,$e.clientY)}function Q($e){Ye.set($e.clientX,$e.clientY)}function $($e){We.set($e.clientX,$e.clientY)}function ee($e){Ve.set($e.clientX,$e.clientY),ke.subVectors(Ve,He);var et=Re.domElement===document?Re.domElement.body:Re.domElement;X(2*_MathPI*ke.x/et.clientWidth*Re.rotateSpeed),Y(2*_MathPI*ke.y/et.clientHeight*Re.rotateSpeed),He.copy(Ve),Re.update()}function oe($e){qe.set($e.clientX,$e.clientY),Ze.subVectors(qe,Ye),0<Ze.y?Z(W()):0>Ze.y&&K(W()),Ye.copy(qe),Re.update()}function ie($e){je.set($e.clientX,$e.clientY),Xe.subVectors(je,We),Qe(Xe.x,Xe.y),We.copy(je),Re.update()}function ne(){}function se($e){0>$e.deltaY?K(W()):0<$e.deltaY&&Z(W()),Re.update()}function le($e){switch($e.keyCode){case Re.keys.UP:Qe(0,Re.keyPanSpeed),Re.update();break;case Re.keys.BOTTOM:Qe(0,-Re.keyPanSpeed),Re.update();break;case Re.keys.LEFT:Qe(Re.keyPanSpeed,0),Re.update();break;case Re.keys.RIGHT:Qe(-Re.keyPanSpeed,0),Re.update();}}function pe($e){He.set($e.touches[0].pageX,$e.touches[0].pageY)}function ue($e){var et=$e.touches[0].pageX-$e.touches[1].pageX,tt=$e.touches[0].pageY-$e.touches[1].pageY,rt=_Mathsqrt(et*et+tt*tt);Ye.set(0,rt)}function fe($e){We.set($e.touches[0].pageX,$e.touches[0].pageY)}function ge($e){Ve.set($e.touches[0].pageX,$e.touches[0].pageY),ke.subVectors(Ve,He);var et=Re.domElement===document?Re.domElement.body:Re.domElement;X(2*_MathPI*ke.x/et.clientWidth*Re.rotateSpeed),Y(2*_MathPI*ke.y/et.clientHeight*Re.rotateSpeed),He.copy(Ve),Re.update()}function he($e){var et=$e.touches[0].pageX-$e.touches[1].pageX,tt=$e.touches[0].pageY-$e.touches[1].pageY,rt=_Mathsqrt(et*et+tt*tt);qe.set(0,rt),Ze.subVectors(qe,Ye),0<Ze.y?K(W()):0>Ze.y&&Z(W()),Ye.copy(qe),Re.update()}function ye($e){je.set($e.touches[0].pageX,$e.touches[0].pageY),Xe.subVectors(je,We),Qe(Xe.x,Xe.y),We.copy(je),Re.update()}function xe(){}function ve($e){if(!1!==Re.enabled){switch($e.preventDefault(),$e.button){case Re.mouseButtons.ORBIT:if(!1===Re.enableRotate)return;J($e),De=Ue.ROTATE;break;case Re.mouseButtons.ZOOM:if(!1===Re.enableZoom)return;Q($e),De=Ue.DOLLY;break;case Re.mouseButtons.PAN:if(!1===Re.enablePan)return;$($e),De=Ue.PAN;}De!==Ue.NONE&&(document.addEventListener('mousemove',_e,!1),document.addEventListener('mouseup',Ee,!1),Re.dispatchEvent(Ce))}}function _e($e){if(!1!==Re.enabled)switch($e.preventDefault(),De){case Ue.ROTATE:if(!1===Re.enableRotate)return;ee($e);break;case Ue.DOLLY:if(!1===Re.enableZoom)return;oe($e);break;case Ue.PAN:if(!1===Re.enablePan)return;ie($e);}}function Ee($e){!1===Re.enabled||(ne($e),document.removeEventListener('mousemove',_e,!1),document.removeEventListener('mouseup',Ee,!1),Re.dispatchEvent(Ie),De=Ue.NONE)}function Te($e){!1===Re.enabled||!1===Re.enableZoom||De!==Ue.NONE&&De!==Ue.ROTATE||($e.preventDefault(),$e.stopPropagation(),se($e),Re.dispatchEvent(Ce),Re.dispatchEvent(Ie))}function Me($e){!1===Re.enabled||!1===Re.enableKeys||!1===Re.enablePan||le($e)}function Se($e){if(!1!==Re.enabled){switch($e.touches.length){case 1:if(!1===Re.enableRotate)return;pe($e),De=Ue.TOUCH_ROTATE;break;case 2:if(!1===Re.enableZoom)return;ue($e),De=Ue.TOUCH_DOLLY;break;case 3:if(!1===Re.enablePan)return;fe($e),De=Ue.TOUCH_PAN;break;default:De=Ue.NONE;}De!==Ue.NONE&&Re.dispatchEvent(Ce)}}function Le($e){if(!1!==Re.enabled)switch($e.preventDefault(),$e.stopPropagation(),$e.touches.length){case 1:if(!1===Re.enableRotate)return;if(De!==Ue.TOUCH_ROTATE)return;ge($e);break;case 2:if(!1===Re.enableZoom)return;if(De!==Ue.TOUCH_DOLLY)return;he($e);break;case 3:if(!1===Re.enablePan)return;if(De!==Ue.TOUCH_PAN)return;ye($e);break;default:De=Ue.NONE;}}function we($e){!1===Re.enabled||(xe($e),Re.dispatchEvent(Ie),De=Ue.NONE)}function Ae($e){$e.preventDefault()}this.object=G,this.domElement=H===void 0?document:H,this.enabled=!0,this.target=new I.Vector3,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=_MathPI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=0.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:I.MOUSE.LEFT,ZOOM:I.MOUSE.MIDDLE,PAN:I.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return Ne.phi},this.getAzimuthalAngle=function(){return Ne.theta},this.saveState=function(){Re.target0.copy(Re.target),Re.position0.copy(Re.object.position),Re.zoom0=Re.object.zoom},this.reset=function(){Re.target.copy(Re.target0),Re.object.position.copy(Re.position0),Re.object.zoom=Re.zoom0,Re.object.updateProjectionMatrix(),Re.dispatchEvent(Pe),Re.update(),De=Ue.NONE},this.update=function(){var $e=new I.Vector3,et=new I.Quaternion().setFromUnitVectors(G.up,new I.Vector3(0,1,0)),tt=et.clone().inverse(),rt=new I.Vector3,at=new I.Quaternion;return function(){var it=Re.object.position;return $e.copy(it).sub(Re.target),$e.applyQuaternion(et),Ne.setFromVector3($e),Re.autoRotate&&De===Ue.NONE&&X(V()),Ne.theta+=Be.theta,Ne.phi+=Be.phi,Ne.theta=_Mathmax(Re.minAzimuthAngle,_Mathmin(Re.maxAzimuthAngle,Ne.theta)),Ne.phi=_Mathmax(Re.minPolarAngle,_Mathmin(Re.maxPolarAngle,Ne.phi)),Ne.makeSafe(),Ne.radius*=Fe,Ne.radius=_Mathmax(Re.minDistance,_Mathmin(Re.maxDistance,Ne.radius)),Re.target.add(Oe),$e.setFromSpherical(Ne),$e.applyQuaternion(tt),it.copy(Re.target).add($e),Re.object.lookAt(Re.target),!0===Re.enableDamping?(Be.theta*=1-Re.dampingFactor,Be.phi*=1-Re.dampingFactor):Be.set(0,0,0),Fe=1,Oe.set(0,0,0),(Ge||rt.distanceToSquared(Re.object.position)>ze||8*(1-at.dot(Re.object.quaternion))>ze)&&(Re.dispatchEvent(Pe),rt.copy(Re.object.position),at.copy(Re.object.quaternion),Ge=!1,!0)}}(),this.dispose=function(){Re.domElement.removeEventListener('contextmenu',Ae,!1),Re.domElement.removeEventListener('mousedown',ve,!1),Re.domElement.removeEventListener('wheel',Te,!1),Re.domElement.removeEventListener('touchstart',Se,!1),Re.domElement.removeEventListener('touchend',we,!1),Re.domElement.removeEventListener('touchmove',Le,!1),document.removeEventListener('mousemove',_e,!1),document.removeEventListener('mouseup',Ee,!1),window.removeEventListener('keydown',Me,!1)};var Re=this,Pe={type:'change'},Ce={type:'start'},Ie={type:'end'},Ue={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},De=Ue.NONE,ze=1e-6,Ne=new I.Spherical,Be=new I.Spherical,Fe=1,Oe=new I.Vector3,Ge=!1,He=new I.Vector2,Ve=new I.Vector2,ke=new I.Vector2,We=new I.Vector2,je=new I.Vector2,Xe=new I.Vector2,Ye=new I.Vector2,qe=new I.Vector2,Ze=new I.Vector2,Ke=function(){var $e=new I.Vector3;return function(tt,rt){$e.setFromMatrixColumn(rt,0),$e.multiplyScalar(-tt),Oe.add($e)}}(),Je=function(){var $e=new I.Vector3;return function(tt,rt){$e.setFromMatrixColumn(rt,1),$e.multiplyScalar(tt),Oe.add($e)}}(),Qe=function(){var $e=new I.Vector3;return function(tt,rt){var at=Re.domElement===document?Re.domElement.body:Re.domElement;if(Re.object instanceof I.PerspectiveCamera){var ot=Re.object.position;$e.copy(ot).sub(Re.target);var it=$e.length();it*=_Mathtan(Re.object.fov/2*_MathPI/180),Ke(2*tt*it/at.clientHeight,Re.object.matrix),Je(2*rt*it/at.clientHeight,Re.object.matrix)}else Re.object instanceof I.OrthographicCamera?(Ke(tt*(Re.object.right-Re.object.left)/Re.object.zoom/at.clientWidth,Re.object.matrix),Je(rt*(Re.object.top-Re.object.bottom)/Re.object.zoom/at.clientHeight,Re.object.matrix)):(Re.enablePan=!1)}}();Re.domElement.addEventListener('contextmenu',Ae,!1),Re.domElement.addEventListener('mousedown',ve,!1),Re.domElement.addEventListener('wheel',Te,!1),Re.domElement.addEventListener('touchstart',Se,!1),Re.domElement.addEventListener('touchend',we,!1),Re.domElement.addEventListener('touchmove',Le,!1),window.addEventListener('keydown',Me,!1),this.update()},I.OrbitControls.prototype=Object.create(I.EventDispatcher.prototype),I.OrbitControls.prototype.constructor=I.OrbitControls,Object.defineProperties(I.OrbitControls.prototype,{center:{get:function(){return this.target}},noZoom:{get:function(){return!this.enableZoom},set:function(H){void 0,this.enableZoom=!H}},noRotate:{get:function(){return!this.enableRotate},set:function(H){void 0,this.enableRotate=!H}},noPan:{get:function(){return!this.enablePan},set:function(H){void 0,this.enablePan=!H}},noKeys:{get:function(){return!this.enableKeys},set:function(H){void 0,this.enableKeys=!H}},staticMoving:{get:function(){return!this.enableDamping},set:function(H){void 0,this.enableDamping=!H}},dynamicDampingFactor:{get:function(){return this.dampingFactor},set:function(H){void 0,this.dampingFactor=H}}})},function(E,M){(function(L,A){A(M)})(this,function(L){'use strict';function A(){}function R(gc,hc){this.x=gc||0,this.y=hc||0}function C(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc,Sc){Object.defineProperty(this,'id',{value:_l++}),this.uuid=xl.generateUUID(),this.name='',this.image=gc===void 0?C.DEFAULT_IMAGE:gc,this.mipmaps=[],this.mapping=hc===void 0?C.DEFAULT_MAPPING:hc,this.wrapS=yc===void 0?es:yc,this.wrapT=xc===void 0?es:xc,this.magFilter=vc===void 0?ns:vc,this.minFilter=_c===void 0?ls:_c,this.anisotropy=Mc===void 0?1:Mc,this.format=Ec===void 0?Ss:Ec,this.type=Tc===void 0?ds:Tc,this.offset=new R(0,0),this.repeat=new R(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=Sc===void 0?Qs:Sc,this.version=0,this.onUpdate=null}function I(gc,hc,yc,xc){this.x=gc||0,this.y=hc||0,this.z=yc||0,this.w=xc===void 0?1:xc}function U(gc,hc,yc){this.uuid=xl.generateUUID(),this.width=gc,this.height=hc,this.scissor=new I(0,0,gc,hc),this.scissorTest=!1,this.viewport=new I(0,0,gc,hc),yc=yc||{},yc.minFilter===void 0&&(yc.minFilter=ns),this.texture=new C(void 0,void 0,yc.wrapS,yc.wrapT,yc.magFilter,yc.minFilter,yc.format,yc.type,yc.anisotropy,yc.encoding),this.depthBuffer=!(yc.depthBuffer!==void 0)||yc.depthBuffer,this.stencilBuffer=!(yc.stencilBuffer!==void 0)||yc.stencilBuffer,this.depthTexture=yc.depthTexture===void 0?null:yc.depthTexture}function D(gc,hc,yc){U.call(this,gc,hc,yc),this.activeCubeFace=0,this.activeMipMapLevel=0}function F(gc,hc,yc,xc){this._x=gc||0,this._y=hc||0,this._z=yc||0,this._w=xc===void 0?1:xc}function O(gc,hc,yc){this.x=gc||0,this.y=hc||0,this.z=yc||0}function G(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),0<arguments.length&&void 0}function H(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc,Sc){gc=gc===void 0?[]:gc,hc=hc===void 0?Xn:hc,C.call(this,gc,hc,yc,xc,vc,_c,Ec,Tc,Mc,Sc),this.flipY=!1}function V(){this.seq=[],this.map={}}function W(gc,hc,yc){var xc=gc[0];if(0>=xc||0<xc)return gc;var vc=hc*yc,_c=Ml[vc];if(void 0===_c&&(_c=new Float32Array(vc),Ml[vc]=_c),0!==hc){xc.toArray(_c,0);for(var Ec=1,Tc=0;Ec!==hc;++Ec)Tc+=yc,gc[Ec].toArray(_c,Tc)}return _c}function X(gc,hc){var yc=Sl[hc];yc===void 0&&(yc=new Int32Array(hc),Sl[hc]=yc);for(var xc=0;xc!==hc;++xc)yc[xc]=gc.allocTextureUnit();return yc}function Y(gc,hc){gc.uniform1f(this.addr,hc)}function Z(gc,hc){gc.uniform1i(this.addr,hc)}function K(gc,hc){hc.x===void 0?gc.uniform2fv(this.addr,hc):gc.uniform2f(this.addr,hc.x,hc.y)}function J(gc,hc){hc.x===void 0?hc.r===void 0?gc.uniform3fv(this.addr,hc):gc.uniform3f(this.addr,hc.r,hc.g,hc.b):gc.uniform3f(this.addr,hc.x,hc.y,hc.z)}function Q(gc,hc){hc.x===void 0?gc.uniform4fv(this.addr,hc):gc.uniform4f(this.addr,hc.x,hc.y,hc.z,hc.w)}function $(gc,hc){gc.uniformMatrix2fv(this.addr,!1,hc.elements||hc)}function ee(gc,hc){gc.uniformMatrix3fv(this.addr,!1,hc.elements||hc)}function oe(gc,hc){gc.uniformMatrix4fv(this.addr,!1,hc.elements||hc)}function ie(gc,hc,yc){var xc=yc.allocTextureUnit();gc.uniform1i(this.addr,xc),yc.setTexture2D(hc||El,xc)}function ne(gc,hc,yc){var xc=yc.allocTextureUnit();gc.uniform1i(this.addr,xc),yc.setTextureCube(hc||Tl,xc)}function se(gc,hc){gc.uniform2iv(this.addr,hc)}function le(gc,hc){gc.uniform3iv(this.addr,hc)}function pe(gc,hc){gc.uniform4iv(this.addr,hc)}function ue(gc){return 5126===gc?Y:35664===gc?K:35665===gc?J:35666===gc?Q:35674===gc?$:35675===gc?ee:35676===gc?oe:35678===gc?ie:35680===gc?ne:5124===gc||35670===gc?Z:35667===gc||35671===gc?se:35668===gc||35672===gc?le:35669===gc||35673===gc?pe:void 0}function fe(gc,hc){gc.uniform1fv(this.addr,hc)}function ge(gc,hc){gc.uniform1iv(this.addr,hc)}function he(gc,hc){gc.uniform2fv(this.addr,W(hc,this.size,2))}function ye(gc,hc){gc.uniform3fv(this.addr,W(hc,this.size,3))}function xe(gc,hc){gc.uniform4fv(this.addr,W(hc,this.size,4))}function ve(gc,hc){gc.uniformMatrix2fv(this.addr,!1,W(hc,this.size,4))}function _e(gc,hc){gc.uniformMatrix3fv(this.addr,!1,W(hc,this.size,9))}function Ee(gc,hc){gc.uniformMatrix4fv(this.addr,!1,W(hc,this.size,16))}function Te(gc,hc,yc){var xc=hc.length,vc=X(yc,xc);gc.uniform1iv(this.addr,vc);for(var _c=0;_c!==xc;++_c)yc.setTexture2D(hc[_c]||El,vc[_c])}function Me(gc,hc,yc){var xc=hc.length,vc=X(yc,xc);gc.uniform1iv(this.addr,vc);for(var _c=0;_c!==xc;++_c)yc.setTextureCube(hc[_c]||Tl,vc[_c])}function Se(gc){return 5126===gc?fe:35664===gc?he:35665===gc?ye:35666===gc?xe:35674===gc?ve:35675===gc?_e:35676===gc?Ee:35678===gc?Te:35680===gc?Me:5124===gc||35670===gc?ge:35667===gc||35671===gc?se:35668===gc||35672===gc?le:35669===gc||35673===gc?pe:void 0}function Le(gc,hc,yc){this.id=gc,this.addr=yc,this.setValue=ue(hc.type)}function we(gc,hc,yc){this.id=gc,this.addr=yc,this.size=hc.size,this.setValue=Se(hc.type)}function Ae(gc){this.id=gc,V.call(this)}function Re(gc,hc){gc.seq.push(hc),gc.map[hc.id]=hc}function Pe(gc,hc,yc){var xc=gc.name,vc=xc.length;for(Ll.lastIndex=0;;){var _c=Ll.exec(xc),Ec=Ll.lastIndex,Tc=_c[1],Mc=']'===_c[2],Sc=_c[3];if(Mc&&(Tc|=0),void 0===Sc||'['===Sc&&Ec+2===vc){Re(yc,void 0===Sc?new Le(Tc,gc,hc):new we(Tc,gc,hc));break}else{var Lc=yc.map,wc=Lc[Tc];void 0===wc&&(wc=new Ae(Tc),Re(yc,wc)),yc=wc}}}function Ce(gc,hc,yc){V.call(this),this.renderer=yc;for(var xc=gc.getProgramParameter(hc,gc.ACTIVE_UNIFORMS),vc=0;vc<xc;++vc){var _c=gc.getActiveUniform(hc,vc),Ec=_c.name,Tc=gc.getUniformLocation(hc,Ec);Pe(_c,Tc,this)}}function Ie(gc,hc,yc){return void 0===hc&&void 0===yc?this.set(gc):this.setRGB(gc,hc,yc)}function Ue(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc,Sc,Lc,wc){C.call(this,null,_c,Ec,Tc,Mc,Sc,xc,vc,Lc,wc),this.image={data:gc,width:hc,height:yc},this.magFilter=Mc===void 0?as:Mc,this.minFilter=Sc===void 0?as:Sc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function De(gc,hc){this.min=gc===void 0?new R(+Infinity,+Infinity):gc,this.max=hc===void 0?new R(-Infinity,-Infinity):hc}function ze(gc,hc){function yc(){var Pc=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),Cc=new Uint16Array([0,1,2,0,2,3]);Ec=vc.createBuffer(),Tc=vc.createBuffer(),vc.bindBuffer(vc.ARRAY_BUFFER,Ec),vc.bufferData(vc.ARRAY_BUFFER,Pc,vc.STATIC_DRAW),vc.bindBuffer(vc.ELEMENT_ARRAY_BUFFER,Tc),vc.bufferData(vc.ELEMENT_ARRAY_BUFFER,Cc,vc.STATIC_DRAW),Ac=vc.createTexture(),Rc=vc.createTexture(),_c.bindTexture(vc.TEXTURE_2D,Ac),vc.texImage2D(vc.TEXTURE_2D,0,vc.RGB,16,16,0,vc.RGB,vc.UNSIGNED_BYTE,null),vc.texParameteri(vc.TEXTURE_2D,vc.TEXTURE_WRAP_S,vc.CLAMP_TO_EDGE),vc.texParameteri(vc.TEXTURE_2D,vc.TEXTURE_WRAP_T,vc.CLAMP_TO_EDGE),vc.texParameteri(vc.TEXTURE_2D,vc.TEXTURE_MAG_FILTER,vc.NEAREST),vc.texParameteri(vc.TEXTURE_2D,vc.TEXTURE_MIN_FILTER,vc.NEAREST),_c.bindTexture(vc.TEXTURE_2D,Rc),vc.texImage2D(vc.TEXTURE_2D,0,vc.RGBA,16,16,0,vc.RGBA,vc.UNSIGNED_BYTE,null),vc.texParameteri(vc.TEXTURE_2D,vc.TEXTURE_WRAP_S,vc.CLAMP_TO_EDGE),vc.texParameteri(vc.TEXTURE_2D,vc.TEXTURE_WRAP_T,vc.CLAMP_TO_EDGE),vc.texParameteri(vc.TEXTURE_2D,vc.TEXTURE_MAG_FILTER,vc.NEAREST),vc.texParameteri(vc.TEXTURE_2D,vc.TEXTURE_MIN_FILTER,vc.NEAREST),Mc={vertexShader:['uniform lowp int renderType;','uniform vec3 screenPosition;','uniform vec2 scale;','uniform float rotation;','uniform sampler2D occlusionMap;','attribute vec2 position;','attribute vec2 uv;','varying vec2 vUV;','varying float vVisibility;','void main() {','vUV = uv;','vec2 pos = position;','if ( renderType == 2 ) {','vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );','visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );','visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );','visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );','visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );','visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );','visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );','visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );','visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );','vVisibility =        visibility.r / 9.0;','vVisibility *= 1.0 - visibility.g / 9.0;','vVisibility *=       visibility.b / 9.0;','vVisibility *= 1.0 - visibility.a / 9.0;','pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;','pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;','}','gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );','}'].join('\n'),fragmentShader:['uniform lowp int renderType;','uniform sampler2D map;','uniform float opacity;','uniform vec3 color;','varying vec2 vUV;','varying float vVisibility;','void main() {','if ( renderType == 0 ) {','gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );','} else if ( renderType == 1 ) {','gl_FragColor = texture2D( map, vUV );','} else {','vec4 texture = texture2D( map, vUV );','texture.a *= opacity * vVisibility;','gl_FragColor = texture;','gl_FragColor.rgb *= color;','}','}'].join('\n')},Sc=xc(Mc),Lc={vertex:vc.getAttribLocation(Sc,'position'),uv:vc.getAttribLocation(Sc,'uv')},wc={renderType:vc.getUniformLocation(Sc,'renderType'),map:vc.getUniformLocation(Sc,'map'),occlusionMap:vc.getUniformLocation(Sc,'occlusionMap'),opacity:vc.getUniformLocation(Sc,'opacity'),color:vc.getUniformLocation(Sc,'color'),scale:vc.getUniformLocation(Sc,'scale'),rotation:vc.getUniformLocation(Sc,'rotation'),screenPosition:vc.getUniformLocation(Sc,'screenPosition')}}function xc(Pc){var Cc=vc.createProgram(),Ic=vc.createShader(vc.FRAGMENT_SHADER),Uc=vc.createShader(vc.VERTEX_SHADER),Dc='precision '+gc.getPrecision()+' float;\n';return vc.shaderSource(Ic,Dc+Pc.fragmentShader),vc.shaderSource(Uc,Dc+Pc.vertexShader),vc.compileShader(Ic),vc.compileShader(Uc),vc.attachShader(Cc,Ic),vc.attachShader(Cc,Uc),vc.linkProgram(Cc),Cc}var vc=gc.context,_c=gc.state,Ec,Tc,Mc,Sc,Lc,wc,Ac,Rc;this.render=function(Pc,Cc,Ic){if(0!==hc.length){var Uc=new O,Dc=Ic.w/Ic.z,zc=0.5*Ic.z,Nc=0.5*Ic.w,Bc=16/Ic.w,Fc=new R(Bc*Dc,Bc),Oc=new O(1,1,0),Gc=new R(1,1),Hc=new De;Hc.min.set(Ic.x,Ic.y),Hc.max.set(Ic.x+(Ic.z-16),Ic.y+(Ic.w-16)),void 0===Sc&&yc(),vc.useProgram(Sc),_c.initAttributes(),_c.enableAttribute(Lc.vertex),_c.enableAttribute(Lc.uv),_c.disableUnusedAttributes(),vc.uniform1i(wc.occlusionMap,0),vc.uniform1i(wc.map,1),vc.bindBuffer(vc.ARRAY_BUFFER,Ec),vc.vertexAttribPointer(Lc.vertex,2,vc.FLOAT,!1,16,0),vc.vertexAttribPointer(Lc.uv,2,vc.FLOAT,!1,16,8),vc.bindBuffer(vc.ELEMENT_ARRAY_BUFFER,Tc),_c.disable(vc.CULL_FACE),_c.setDepthWrite(!1);for(var Vc=0,kc=hc.length;Vc<kc;Vc++){Bc=16/Ic.w,Fc.set(Bc*Dc,Bc);var Wc=hc[Vc];if(Uc.set(Wc.matrixWorld.elements[12],Wc.matrixWorld.elements[13],Wc.matrixWorld.elements[14]),Uc.applyMatrix4(Cc.matrixWorldInverse),Uc.applyMatrix4(Cc.projectionMatrix),Oc.copy(Uc),Gc.x=Ic.x+Oc.x*zc+zc-8,Gc.y=Ic.y+Oc.y*Nc+Nc-8,!0===Hc.containsPoint(Gc)){_c.activeTexture(vc.TEXTURE0),_c.bindTexture(vc.TEXTURE_2D,null),_c.activeTexture(vc.TEXTURE1),_c.bindTexture(vc.TEXTURE_2D,Ac),vc.copyTexImage2D(vc.TEXTURE_2D,0,vc.RGB,Gc.x,Gc.y,16,16,0),vc.uniform1i(wc.renderType,0),vc.uniform2f(wc.scale,Fc.x,Fc.y),vc.uniform3f(wc.screenPosition,Oc.x,Oc.y,Oc.z),_c.disable(vc.BLEND),_c.enable(vc.DEPTH_TEST),vc.drawElements(vc.TRIANGLES,6,vc.UNSIGNED_SHORT,0),_c.activeTexture(vc.TEXTURE0),_c.bindTexture(vc.TEXTURE_2D,Rc),vc.copyTexImage2D(vc.TEXTURE_2D,0,vc.RGBA,Gc.x,Gc.y,16,16,0),vc.uniform1i(wc.renderType,1),_c.disable(vc.DEPTH_TEST),_c.activeTexture(vc.TEXTURE1),_c.bindTexture(vc.TEXTURE_2D,Ac),vc.drawElements(vc.TRIANGLES,6,vc.UNSIGNED_SHORT,0),Wc.positionScreen.copy(Oc),Wc.customUpdateCallback?Wc.customUpdateCallback(Wc):Wc.updateLensFlares(),vc.uniform1i(wc.renderType,2),_c.enable(vc.BLEND);for(var jc=0,Xc=Wc.lensFlares.length,Yc;jc<Xc;jc++)Yc=Wc.lensFlares[jc],1e-3<Yc.opacity&&1e-3<Yc.scale&&(Oc.x=Yc.x,Oc.y=Yc.y,Oc.z=Yc.z,Bc=Yc.size*Yc.scale/Ic.w,Fc.x=Bc*Dc,Fc.y=Bc,vc.uniform3f(wc.screenPosition,Oc.x,Oc.y,Oc.z),vc.uniform2f(wc.scale,Fc.x,Fc.y),vc.uniform1f(wc.rotation,Yc.rotation),vc.uniform1f(wc.opacity,Yc.opacity),vc.uniform3f(wc.color,Yc.color.r,Yc.color.g,Yc.color.b),_c.setBlending(Yc.blending,Yc.blendEquation,Yc.blendSrc,Yc.blendDst),gc.setTexture2D(Yc.texture,1),vc.drawElements(vc.TRIANGLES,6,vc.UNSIGNED_SHORT,0))}}_c.enable(vc.CULL_FACE),_c.enable(vc.DEPTH_TEST),_c.setDepthWrite(!0),gc.resetGLState()}}}function Ne(gc,hc){function yc(){var Ic=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]),Uc=new Uint16Array([0,1,2,0,2,3]);Tc=_c.createBuffer(),Mc=_c.createBuffer(),_c.bindBuffer(_c.ARRAY_BUFFER,Tc),_c.bufferData(_c.ARRAY_BUFFER,Ic,_c.STATIC_DRAW),_c.bindBuffer(_c.ELEMENT_ARRAY_BUFFER,Mc),_c.bufferData(_c.ELEMENT_ARRAY_BUFFER,Uc,_c.STATIC_DRAW),Sc=xc(),Lc={position:_c.getAttribLocation(Sc,'position'),uv:_c.getAttribLocation(Sc,'uv')},wc={uvOffset:_c.getUniformLocation(Sc,'uvOffset'),uvScale:_c.getUniformLocation(Sc,'uvScale'),rotation:_c.getUniformLocation(Sc,'rotation'),scale:_c.getUniformLocation(Sc,'scale'),color:_c.getUniformLocation(Sc,'color'),map:_c.getUniformLocation(Sc,'map'),opacity:_c.getUniformLocation(Sc,'opacity'),modelViewMatrix:_c.getUniformLocation(Sc,'modelViewMatrix'),projectionMatrix:_c.getUniformLocation(Sc,'projectionMatrix'),fogType:_c.getUniformLocation(Sc,'fogType'),fogDensity:_c.getUniformLocation(Sc,'fogDensity'),fogNear:_c.getUniformLocation(Sc,'fogNear'),fogFar:_c.getUniformLocation(Sc,'fogFar'),fogColor:_c.getUniformLocation(Sc,'fogColor'),alphaTest:_c.getUniformLocation(Sc,'alphaTest')};var Dc=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');Dc.width=8,Dc.height=8;var zc=Dc.getContext('2d');zc.fillStyle='white',zc.fillRect(0,0,8,8),Ac=new C(Dc),Ac.needsUpdate=!0}function xc(){var Ic=_c.createProgram(),Uc=_c.createShader(_c.VERTEX_SHADER),Dc=_c.createShader(_c.FRAGMENT_SHADER);return _c.shaderSource(Uc,['precision '+gc.getPrecision()+' float;','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;','uniform float rotation;','uniform vec2 scale;','uniform vec2 uvOffset;','uniform vec2 uvScale;','attribute vec2 position;','attribute vec2 uv;','varying vec2 vUV;','void main() {','vUV = uvOffset + uv * uvScale;','vec2 alignedPosition = position * scale;','vec2 rotatedPosition;','rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;','rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;','vec4 finalPosition;','finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );','finalPosition.xy += rotatedPosition;','finalPosition = projectionMatrix * finalPosition;','gl_Position = finalPosition;','}'].join('\n')),_c.shaderSource(Dc,['precision '+gc.getPrecision()+' float;','uniform vec3 color;','uniform sampler2D map;','uniform float opacity;','uniform int fogType;','uniform vec3 fogColor;','uniform float fogDensity;','uniform float fogNear;','uniform float fogFar;','uniform float alphaTest;','varying vec2 vUV;','void main() {','vec4 texture = texture2D( map, vUV );','if ( texture.a < alphaTest ) discard;','gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );','if ( fogType > 0 ) {','float depth = gl_FragCoord.z / gl_FragCoord.w;','float fogFactor = 0.0;','if ( fogType == 1 ) {','fogFactor = smoothstep( fogNear, fogFar, depth );','} else {','const float LOG2 = 1.442695;','fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );','fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );','}','gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );','}','}'].join('\n')),_c.compileShader(Uc),_c.compileShader(Dc),_c.attachShader(Ic,Uc),_c.attachShader(Ic,Dc),_c.linkProgram(Ic),Ic}function vc(Ic,Uc){return Ic.renderOrder===Uc.renderOrder?Ic.z===Uc.z?Uc.id-Ic.id:Uc.z-Ic.z:Ic.renderOrder-Uc.renderOrder}var _c=gc.context,Ec=gc.state,Tc,Mc,Sc,Lc,wc,Ac,Rc=new O,Pc=new F,Cc=new O;this.render=function(Ic,Uc){if(0!==hc.length){void 0===Sc&&yc(),_c.useProgram(Sc),Ec.initAttributes(),Ec.enableAttribute(Lc.position),Ec.enableAttribute(Lc.uv),Ec.disableUnusedAttributes(),Ec.disable(_c.CULL_FACE),Ec.enable(_c.BLEND),_c.bindBuffer(_c.ARRAY_BUFFER,Tc),_c.vertexAttribPointer(Lc.position,2,_c.FLOAT,!1,16,0),_c.vertexAttribPointer(Lc.uv,2,_c.FLOAT,!1,16,8),_c.bindBuffer(_c.ELEMENT_ARRAY_BUFFER,Mc),_c.uniformMatrix4fv(wc.projectionMatrix,!1,Uc.projectionMatrix.elements),Ec.activeTexture(_c.TEXTURE0),_c.uniform1i(wc.map,0);var Dc=0,zc=0,Nc=Ic.fog;Nc?(_c.uniform3f(wc.fogColor,Nc.color.r,Nc.color.g,Nc.color.b),Nc.isFog?(_c.uniform1f(wc.fogNear,Nc.near),_c.uniform1f(wc.fogFar,Nc.far),_c.uniform1i(wc.fogType,1),Dc=1,zc=1):Nc.isFogExp2&&(_c.uniform1f(wc.fogDensity,Nc.density),_c.uniform1i(wc.fogType,2),Dc=2,zc=2)):(_c.uniform1i(wc.fogType,0),Dc=0,zc=0);for(var Bc=0,Fc=hc.length,Oc;Bc<Fc;Bc++)Oc=hc[Bc],Oc.modelViewMatrix.multiplyMatrices(Uc.matrixWorldInverse,Oc.matrixWorld),Oc.z=-Oc.modelViewMatrix.elements[14];hc.sort(vc);for(var Gc=[],Bc=0,Fc=hc.length;Bc<Fc;Bc++){var Oc=hc[Bc],Hc=Oc.material;if(!1!==Hc.visible){_c.uniform1f(wc.alphaTest,Hc.alphaTest),_c.uniformMatrix4fv(wc.modelViewMatrix,!1,Oc.modelViewMatrix.elements),Oc.matrixWorld.decompose(Rc,Pc,Cc),Gc[0]=Cc.x,Gc[1]=Cc.y;var Vc=0;Ic.fog&&Hc.fog&&(Vc=zc),Dc!=Vc&&(_c.uniform1i(wc.fogType,Vc),Dc=Vc),null===Hc.map?(_c.uniform2f(wc.uvOffset,0,0),_c.uniform2f(wc.uvScale,1,1)):(_c.uniform2f(wc.uvOffset,Hc.map.offset.x,Hc.map.offset.y),_c.uniform2f(wc.uvScale,Hc.map.repeat.x,Hc.map.repeat.y)),_c.uniform1f(wc.opacity,Hc.opacity),_c.uniform3f(wc.color,Hc.color.r,Hc.color.g,Hc.color.b),_c.uniform1f(wc.rotation,Hc.rotation),_c.uniform2fv(wc.scale,Gc),Ec.setBlending(Hc.blending,Hc.blendEquation,Hc.blendSrc,Hc.blendDst),Ec.setDepthTest(Hc.depthTest),Ec.setDepthWrite(Hc.depthWrite),Hc.map?gc.setTexture2D(Hc.map,0):gc.setTexture2D(Ac,0),_c.drawElements(_c.TRIANGLES,6,_c.UNSIGNED_SHORT,0)}}Ec.enable(_c.CULL_FACE),gc.resetGLState()}}}function Be(){Object.defineProperty(this,'id',{value:kp++}),this.uuid=xl.generateUUID(),this.name='',this.type='Material',this.fog=!0,this.lights=!0,this.blending=sn,this.side=Ji,this.shading=tn,this.vertexColors=rn,this.opacity=1,this.transparent=!1,this.blendSrc=En,this.blendDst=Tn,this.blendEquation=un,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=In,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0}function Fe(gc){Be.call(this),this.type='ShaderMaterial',this.defines={},this.uniforms={},this.vertexShader='void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}',this.fragmentShader='void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}',this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,gc!==void 0&&(gc.attributes!==void 0&&void 0,this.setValues(gc))}function Oe(gc){Be.call(this),this.type='MeshDepthMaterial',this.depthPacking=ul,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(gc)}function Ge(gc,hc){this.min=gc===void 0?new O(+Infinity,+Infinity,+Infinity):gc,this.max=hc===void 0?new O(-Infinity,-Infinity,-Infinity):hc}function He(gc,hc){this.center=gc===void 0?new O:gc,this.radius=hc===void 0?0:hc}function Ve(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),0<arguments.length&&void 0}function ke(gc,hc){this.normal=gc===void 0?new O(1,0,0):gc,this.constant=hc===void 0?0:hc}function We(gc,hc,yc,xc,vc,_c){this.planes=[gc===void 0?new ke:gc,hc===void 0?new ke:hc,yc===void 0?new ke:yc,xc===void 0?new ke:xc,vc===void 0?new ke:vc,_c===void 0?new ke:_c]}function je(gc,hc,yc,xc){function vc(Kc,Jc,Qc,$c){var eu=Kc.geometry,tu=null,ru=zc,au=Kc.customDepthMaterial;if(Qc&&(ru=Nc,au=Kc.customDistanceMaterial),!au){var ou=!1;Jc.morphTargets&&(eu&&eu.isBufferGeometry?ou=eu.morphAttributes&&eu.morphAttributes.position&&0<eu.morphAttributes.position.length:eu&&eu.isGeometry&&(ou=eu.morphTargets&&0<eu.morphTargets.length));var iu=Kc.isSkinnedMesh&&Jc.skinning,nu=0;ou&&(nu|=Ic),iu&&(nu|=Uc),tu=ru[nu]}else tu=au;if(gc.localClippingEnabled&&!0===Jc.clipShadows&&0!==Jc.clippingPlanes.length){var lu=tu.uuid,du=Jc.uuid,pu=Bc[lu];void 0===pu&&(pu={},Bc[lu]=pu);var uu=pu[du];void 0===uu&&(uu=tu.clone(),pu[du]=uu),tu=uu}tu.visible=Jc.visible,tu.wireframe=Jc.wireframe;var mu=Jc.side;return Zc.renderSingleSided&&mu==$i&&(mu=Ji),Zc.renderReverseSided&&(mu===Ji?mu=Qi:mu===Qi&&(mu=Ji)),tu.side=mu,tu.clipShadows=Jc.clipShadows,tu.clippingPlanes=Jc.clippingPlanes,tu.wireframeLinewidth=Jc.wireframeLinewidth,tu.linewidth=Jc.linewidth,Qc&&void 0!==tu.uniforms.lightPos&&tu.uniforms.lightPos.value.copy($c),tu}function _c(Kc,Jc,Qc){if(!1!==Kc.visible){var $c=0!=(Kc.layers.mask&Jc.layers.mask);if($c&&(Kc.isMesh||Kc.isLine||Kc.isPoints)&&Kc.castShadow&&(!1===Kc.frustumCulled||!0===Mc.intersectsObject(Kc))){var eu=Kc.material;!0===eu.visible&&(Kc.modelViewMatrix.multiplyMatrices(Qc.matrixWorldInverse,Kc.matrixWorld),Cc.push(Kc))}for(var tu=Kc.children,ru=0,au=tu.length;ru<au;ru++)_c(tu[ru],Jc,Qc)}}var Ec=gc.context,Tc=gc.state,Mc=new We,Sc=new G,Lc=hc.shadows,wc=new R,Ac=new R(xc.maxTextureSize,xc.maxTextureSize),Rc=new O,Pc=new O,Cc=[],Ic=1,Uc=2,zc=[,,,,],Nc=[,,,,],Bc={},Fc=[new O(1,0,0),new O(-1,0,0),new O(0,0,1),new O(0,0,-1),new O(0,1,0),new O(0,-1,0)],Oc=[new O(0,1,0),new O(0,1,0),new O(0,1,0),new O(0,1,0),new O(0,0,1),new O(0,0,-1)],Gc=[new I,new I,new I,new I,new I,new I],Hc=new Oe;Hc.depthPacking=yl,Hc.clipping=!0;for(var Vc=Vp.distanceRGBA,kc=wl.clone(Vc.uniforms),Wc=0;Wc!==(Ic|Uc)+1;++Wc){var jc=0!=(Wc&Ic),Xc=0!=(Wc&Uc),Yc=Hc.clone();Yc.morphTargets=jc,Yc.skinning=Xc,zc[Wc]=Yc;var qc=new Fe({defines:{USE_SHADOWMAP:''},uniforms:kc,vertexShader:Vc.vertexShader,fragmentShader:Vc.fragmentShader,morphTargets:jc,skinning:Xc,clipping:!0});Nc[Wc]=qc}var Zc=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Zi,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(Kc,Jc){if(!1!==Zc.enabled&&(!1!==Zc.autoUpdate||!1!==Zc.needsUpdate)&&0!==Lc.length){Tc.buffers.color.setClear(1,1,1,1),Tc.disable(Ec.BLEND),Tc.setDepthTest(!0),Tc.setScissorTest(!1);for(var eu=0,tu=Lc.length,Qc,$c;eu<tu;eu++){var ru=Lc[eu],au=ru.shadow;if(void 0!==au){var ou=au.camera;if(wc.copy(au.mapSize),wc.min(Ac),ru&&ru.isPointLight){Qc=6,$c=!0;var iu=wc.x,nu=wc.y;Gc[0].set(2*iu,nu,iu,nu),Gc[1].set(0,nu,iu,nu),Gc[2].set(3*iu,nu,iu,nu),Gc[3].set(iu,nu,iu,nu),Gc[4].set(3*iu,0,iu,nu),Gc[5].set(iu,0,iu,nu),wc.x*=4,wc.y*=2}else Qc=1,$c=!1;if(null===au.map){au.map=new U(wc.x,wc.y,{minFilter:as,magFilter:as,format:Ss}),ou.updateProjectionMatrix()}au.isSpotLightShadow&&au.update(ru),au&&au.isRectAreaLightShadow&&au.update(ru);var du=au.map,pu=au.matrix;Pc.setFromMatrixPosition(ru.matrixWorld),ou.position.copy(Pc),gc.setRenderTarget(du),gc.clear();for(var uu=0;uu<Qc;uu++){if($c){Rc.copy(ou.position),Rc.add(Fc[uu]),ou.up.copy(Oc[uu]),ou.lookAt(Rc);var mu=Gc[uu];Tc.viewport(mu)}else Rc.setFromMatrixPosition(ru.target.matrixWorld),ou.lookAt(Rc);ou.updateMatrixWorld(),ou.matrixWorldInverse.getInverse(ou.matrixWorld),pu.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1),pu.multiply(ou.projectionMatrix),pu.multiply(ou.matrixWorldInverse),Sc.multiplyMatrices(ou.projectionMatrix,ou.matrixWorldInverse),Mc.setFromMatrix(Sc),Cc.length=0,_c(Kc,Jc,ou);for(var fu=0,gu=Cc.length;fu<gu;fu++){var hu=Cc[fu],yu=yc.update(hu),xu=hu.material;if(xu&&xu.isMultiMaterial)for(var vu=yu.groups,_u=xu.materials,bu=0,Eu=vu.length;bu<Eu;bu++){var Tu=vu[bu],Mu=_u[Tu.materialIndex];if(!0===Mu.visible){var Su=vc(hu,Mu,$c,Pc);gc.renderBufferDirect(ou,null,yu,Su,hu,Tu)}}else{var Su=vc(hu,xu,$c,Pc);gc.renderBufferDirect(ou,null,yu,Su,hu,null)}}}}}var Lu=gc.getClearColor(),wu=gc.getClearAlpha();gc.setClearColor(Lu,wu),Zc.needsUpdate=!1}}}function Xe(gc,hc){this.origin=gc===void 0?new O:gc,this.direction=hc===void 0?new O:hc}function Ye(gc,hc,yc,xc){this._x=gc||0,this._y=hc||0,this._z=yc||0,this._order=xc||Ye.DefaultOrder}function qe(){this.mask=1}function Ze(){Object.defineProperty(this,'id',{value:Wp++}),this.uuid=xl.generateUUID(),this.name='',this.type='Object3D',this.parent=null,this.children=[],this.up=Ze.DefaultUp.clone();var yc=new O,xc=new Ye,vc=new F,_c=new O(1,1,1);xc.onChange(function(){vc.setFromEuler(xc,!1)}),vc.onChange(function(){xc.setFromQuaternion(vc,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:yc},rotation:{enumerable:!0,value:xc},quaternion:{enumerable:!0,value:vc},scale:{enumerable:!0,value:_c},modelViewMatrix:{value:new G},normalMatrix:{value:new Ve}}),this.matrix=new G,this.matrixWorld=new G,this.matrixAutoUpdate=Ze.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new qe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={},this.onBeforeRender=function(){},this.onAfterRender=function(){}}function Ke(gc,hc){this.start=gc===void 0?new O:gc,this.end=hc===void 0?new O:hc}function Je(gc,hc,yc){this.a=gc===void 0?new O:gc,this.b=hc===void 0?new O:hc,this.c=yc===void 0?new O:yc}function Qe(gc,hc,yc,xc,vc,_c){this.a=gc,this.b=hc,this.c=yc,this.normal=xc&&xc.isVector3?xc:new O,this.vertexNormals=Array.isArray(xc)?xc:[],this.color=vc&&vc.isColor?vc:new Ie,this.vertexColors=Array.isArray(vc)?vc:[],this.materialIndex=_c===void 0?0:_c}function $e(gc){Be.call(this),this.type='MeshBasicMaterial',this.color=new Ie(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Bn,this.reflectivity=1,this.refractionRatio=0.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(gc)}function et(gc,hc,yc){if(Array.isArray(gc))throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');this.uuid=xl.generateUUID(),this.array=gc,this.itemSize=hc,this.count=gc===void 0?0:gc.length/hc,this.normalized=!0===yc,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function tt(gc,hc){et.call(this,new Int8Array(gc),hc)}function rt(gc,hc){et.call(this,new Uint8Array(gc),hc)}function at(gc,hc){et.call(this,new Uint8ClampedArray(gc),hc)}function ot(gc,hc){et.call(this,new Int16Array(gc),hc)}function it(gc,hc){et.call(this,new Uint16Array(gc),hc)}function nt(gc,hc){et.call(this,new Int32Array(gc),hc)}function st(gc,hc){et.call(this,new Uint32Array(gc),hc)}function lt(gc,hc){et.call(this,new Float32Array(gc),hc)}function dt(gc,hc){et.call(this,new Float64Array(gc),hc)}function ct(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function ut(gc){for(var hc=gc.length,yc=-Infinity;hc--;)gc[hc]>yc&&(yc=gc[hc]);return yc}function mt(){return jp++}function ft(){Object.defineProperty(this,'id',{value:mt()}),this.uuid=xl.generateUUID(),this.name='',this.type='Geometry',this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function gt(){Object.defineProperty(this,'id',{value:mt()}),this.uuid=xl.generateUUID(),this.name='',this.type='BufferGeometry',this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:Infinity}}function ht(gc,hc){Ze.call(this),this.type='Mesh',this.geometry=gc===void 0?new gt:gc,this.material=hc===void 0?new $e({color:16777215*Math.random()}):hc,this.drawMode=Zs,this.updateMorphTargets()}function yt(gc,hc,yc,xc,vc,_c){ft.call(this),this.type='BoxGeometry',this.parameters={width:gc,height:hc,depth:yc,widthSegments:xc,heightSegments:vc,depthSegments:_c},this.fromBufferGeometry(new xt(gc,hc,yc,xc,vc,_c)),this.mergeVertices()}function xt(gc,hc,yc,xc,vc,_c){function Ec(Pc,Cc,Ic,Uc,Dc,zc,Nc,Bc,Fc,Oc,Gc){var Xc=Fc+1,qc=0,Zc=0,Kc,Jc,Qc=new O;for(Jc=0;Jc<Oc+1;Jc++){var $c=Jc*(Nc/Oc)-Nc/2;for(Kc=0;Kc<Xc;Kc++){var eu=Kc*(zc/Fc)-zc/2;Qc[Pc]=eu*Uc,Qc[Cc]=$c*Dc,Qc[Ic]=Bc/2,Sc.push(Qc.x,Qc.y,Qc.z),Qc[Pc]=0,Qc[Cc]=0,Qc[Ic]=0<Bc?1:-1,Lc.push(Qc.x,Qc.y,Qc.z),wc.push(Kc/Fc),wc.push(1-Jc/Oc),qc+=1}}for(Jc=0;Jc<Oc;Jc++)for(Kc=0;Kc<Fc;Kc++){var tu=Ac+Kc+Xc*Jc,ru=Ac+Kc+Xc*(Jc+1),au=Ac+(Kc+1)+Xc*(Jc+1),ou=Ac+(Kc+1)+Xc*Jc;Mc.push(tu,ru,ou),Mc.push(ru,au,ou),Zc+=6}Tc.addGroup(Rc,Zc,Gc),Rc+=Zc,Ac+=qc}gt.call(this),this.type='BoxBufferGeometry',this.parameters={width:gc,height:hc,depth:yc,widthSegments:xc,heightSegments:vc,depthSegments:_c};var Tc=this;xc=_Mathfloor(xc)||1,vc=_Mathfloor(vc)||1,_c=_Mathfloor(_c)||1;var Mc=[],Sc=[],Lc=[],wc=[],Ac=0,Rc=0;Ec('z','y','x',-1,-1,yc,hc,gc,_c,vc,0),Ec('z','y','x',1,-1,yc,hc,-gc,_c,vc,1),Ec('x','z','y',1,1,gc,yc,hc,xc,_c,2),Ec('x','z','y',1,-1,gc,yc,-hc,xc,_c,3),Ec('x','y','z',1,-1,gc,hc,yc,xc,vc,4),Ec('x','y','z',-1,-1,gc,hc,-yc,xc,vc,5),this.setIndex(Mc),this.addAttribute('position',new lt(Sc,3)),this.addAttribute('normal',new lt(Lc,3)),this.addAttribute('uv',new lt(wc,2))}function vt(gc,hc,yc,xc){ft.call(this),this.type='PlaneGeometry',this.parameters={width:gc,height:hc,widthSegments:yc,heightSegments:xc},this.fromBufferGeometry(new bt(gc,hc,yc,xc))}function bt(gc,hc,yc,xc){gt.call(this),this.type='PlaneBufferGeometry',this.parameters={width:gc,height:hc,widthSegments:yc,heightSegments:xc};var Ec=_Mathfloor(yc)||1,Tc=_Mathfloor(xc)||1,Mc=Ec+1,Ac,Rc,Pc=[],Cc=[],Ic=[],Uc=[];for(Rc=0;Rc<Tc+1;Rc++){var Dc=Rc*(hc/Tc)-hc/2;for(Ac=0;Ac<Mc;Ac++){var zc=Ac*(gc/Ec)-gc/2;Cc.push(zc,-Dc,0),Ic.push(0,0,1),Uc.push(Ac/Ec),Uc.push(1-Rc/Tc)}}for(Rc=0;Rc<Tc;Rc++)for(Ac=0;Ac<Ec;Ac++){var Nc=Ac+Mc*Rc,Bc=Ac+Mc*(Rc+1),Fc=Ac+1+Mc*(Rc+1),Oc=Ac+1+Mc*Rc;Pc.push(Nc,Bc,Oc),Pc.push(Bc,Fc,Oc)}this.setIndex(Pc),this.addAttribute('position',new lt(Cc,3)),this.addAttribute('normal',new lt(Ic,3)),this.addAttribute('uv',new lt(Uc,2))}function Et(){Ze.call(this),this.type='Camera',this.matrixWorldInverse=new G,this.projectionMatrix=new G}function Tt(gc,hc,yc,xc){Et.call(this),this.type='PerspectiveCamera',this.fov=gc===void 0?50:gc,this.zoom=1,this.near=yc===void 0?0.1:yc,this.far=xc===void 0?2e3:xc,this.focus=10,this.aspect=hc===void 0?1:hc,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Mt(gc,hc,yc,xc,vc,_c){Et.call(this),this.type='OrthographicCamera',this.zoom=1,this.view=null,this.left=gc,this.right=hc,this.top=yc,this.bottom=xc,this.near=vc===void 0?0.1:vc,this.far=_c===void 0?2e3:_c,this.updateProjectionMatrix()}function St(gc,hc,yc){var Tc,Mc,Sc;return{setMode:function(Lc){Tc=Lc},setIndex:function(Lc){Lc.array instanceof Uint32Array&&hc.get('OES_element_index_uint')?(Mc=gc.UNSIGNED_INT,Sc=4):Lc.array instanceof Uint16Array?(Mc=gc.UNSIGNED_SHORT,Sc=2):(Mc=gc.UNSIGNED_BYTE,Sc=1)},render:function(Lc,wc){gc.drawElements(Tc,wc,Mc,Lc*Sc),yc.calls++,yc.vertices+=wc,Tc===gc.TRIANGLES&&(yc.faces+=wc/3)},renderInstances:function(Lc,wc,Ac){var Rc=hc.get('ANGLE_instanced_arrays');null===Rc||(Rc.drawElementsInstancedANGLE(Tc,Ac,Mc,wc*Sc,Lc.maxInstancedCount),yc.calls++,yc.vertices+=Ac*Lc.maxInstancedCount,Tc===gc.TRIANGLES&&(yc.faces+=Lc.maxInstancedCount*Ac/3))}}}function Lt(gc,hc,yc){var Ec;return{setMode:function(Tc){Ec=Tc},render:function(Tc,Mc){gc.drawArrays(Ec,Tc,Mc),yc.calls++,yc.vertices+=Mc,Ec===gc.TRIANGLES&&(yc.faces+=Mc/3)},renderInstances:function(Tc){var Mc=hc.get('ANGLE_instanced_arrays');if(null!==Mc){var Sc=Tc.attributes.position,Lc=0;Sc.isInterleavedBufferAttribute?(Lc=Sc.data.count,Mc.drawArraysInstancedANGLE(Ec,0,Lc,Tc.maxInstancedCount)):(Lc=Sc.count,Mc.drawArraysInstancedANGLE(Ec,0,Lc,Tc.maxInstancedCount)),yc.calls++,yc.vertices+=Lc*Tc.maxInstancedCount,Ec===gc.TRIANGLES&&(yc.faces+=Tc.maxInstancedCount*Lc/3)}}}}function wt(){var gc={};return{get:function(hc){if(void 0!==gc[hc.id])return gc[hc.id];var yc;switch(hc.type){case'DirectionalLight':yc={direction:new O,color:new Ie,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new R};break;case'SpotLight':yc={position:new O,direction:new O,color:new Ie,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new R};break;case'PointLight':yc={position:new O,color:new Ie,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new R};break;case'HemisphereLight':yc={direction:new O,skyColor:new Ie,groundColor:new Ie};break;case'RectAreaLight':yc={color:new Ie,position:new O,halfWidth:new O,halfHeight:new O};}return gc[hc.id]=yc,yc}}}function Rt(gc,hc,yc){var xc=gc.createShader(hc);return gc.shaderSource(xc,yc),gc.compileShader(xc),!1===gc.getShaderParameter(xc,gc.COMPILE_STATUS)&&void 0,''!==gc.getShaderInfoLog(xc)&&void 0,xc}function Pt(gc){switch(gc){case Qs:return['Linear','( value )'];case $s:return['sRGB','( value )'];case rl:return['RGBE','( value )'];case nl:return['RGBM','( value, 7.0 )'];case dl:return['RGBM','( value, 16.0 )'];case cl:return['RGBD','( value, 256.0 )'];case el:return['Gamma','( value, float( GAMMA_FACTOR ) )'];default:throw new Error('unsupported encoding: '+gc);}}function Ct(gc,hc){var yc=Pt(hc);return'vec4 '+gc+'( vec4 value ) { return '+yc[0]+'ToLinear'+yc[1]+'; }'}function It(gc,hc){var yc=Pt(hc);return'vec4 '+gc+'( vec4 value ) { return LinearTo'+yc[0]+yc[1]+'; }'}function Ut(gc,hc){var yc;switch(hc){case Hn:yc='Linear';break;case Vn:yc='Reinhard';break;case kn:yc='Uncharted2';break;case Wn:yc='OptimizedCineon';break;default:throw new Error('unsupported toneMapping: '+hc);}return'vec3 '+gc+'( vec3 color ) { return '+yc+'ToneMapping( color ); }'}function Dt(gc,hc,yc){gc=gc||{};var xc=[gc.derivatives||hc.envMapCubeUV||hc.bumpMap||hc.normalMap||hc.flatShading?'#extension GL_OES_standard_derivatives : enable':'',(gc.fragDepth||hc.logarithmicDepthBuffer)&&yc.get('EXT_frag_depth')?'#extension GL_EXT_frag_depth : enable':'',gc.drawBuffers&&yc.get('WEBGL_draw_buffers')?'#extension GL_EXT_draw_buffers : require':'',(gc.shaderTextureLOD||hc.envMap)&&yc.get('EXT_shader_texture_lod')?'#extension GL_EXT_shader_texture_lod : enable':''];return xc.filter(Bt).join('\n')}function zt(gc){var hc=[];for(var yc in gc){var xc=gc[yc];!1===xc||hc.push('#define '+yc+' '+xc)}return hc.join('\n')}function Nt(gc,hc){for(var xc={},vc=gc.getProgramParameter(hc,gc.ACTIVE_ATTRIBUTES),_c=0;_c<vc;_c++){var Ec=gc.getActiveAttrib(hc,_c),Tc=Ec.name;xc[Tc]=gc.getAttribLocation(hc,Tc)}return xc}function Bt(gc){return''!==gc}function Ft(gc,hc){return gc.replace(/NUM_DIR_LIGHTS/g,hc.numDirLights).replace(/NUM_SPOT_LIGHTS/g,hc.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,hc.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,hc.numPointLights).replace(/NUM_HEMI_LIGHTS/g,hc.numHemiLights)}function Ot(gc){var yc=/#include +<([\w\d.]+)>/g;return gc.replace(yc,function(xc,vc){var _c=Op[vc];if(_c===void 0)throw new Error('Can not resolve #include <'+vc+'>');return Ot(_c)})}function Gt(gc){var yc=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return gc.replace(yc,function(xc,vc,_c,Ec){for(var Tc='',Mc=parseInt(vc);Mc<parseInt(_c);Mc++)Tc+=Ec.replace(/\[ i \]/g,'[ '+Mc+' ]');return Tc})}function Ht(gc,hc,yc,xc){var vc=gc.context,_c=yc.extensions,Ec=yc.defines,Tc=yc.__webglShader.vertexShader,Mc=yc.__webglShader.fragmentShader,Sc='SHADOWMAP_TYPE_BASIC';xc.shadowMapType===Zi?Sc='SHADOWMAP_TYPE_PCF':xc.shadowMapType===Ki&&(Sc='SHADOWMAP_TYPE_PCF_SOFT');var Lc='ENVMAP_TYPE_CUBE',wc='ENVMAP_MODE_REFLECTION',Ac='ENVMAP_BLENDING_MULTIPLY';if(xc.envMap){switch(yc.envMap.mapping){case Xn:case Yn:Lc='ENVMAP_TYPE_CUBE';break;case Jn:case Qn:Lc='ENVMAP_TYPE_CUBE_UV';break;case qn:case Zn:Lc='ENVMAP_TYPE_EQUIREC';break;case Kn:Lc='ENVMAP_TYPE_SPHERE';}switch(yc.envMap.mapping){case Yn:case Zn:wc='ENVMAP_MODE_REFRACTION';}switch(yc.combine){case Bn:Ac='ENVMAP_BLENDING_MULTIPLY';break;case Fn:Ac='ENVMAP_BLENDING_MIX';break;case On:Ac='ENVMAP_BLENDING_ADD';}}var Rc=0<gc.gammaFactor?gc.gammaFactor:1,Pc=Dt(_c,xc,gc.extensions),Cc=zt(Ec),Ic=vc.createProgram(),Uc,Dc;yc.isRawShaderMaterial?(Uc=[Cc,'\n'].filter(Bt).join('\n'),Dc=[Pc,Cc,'\n'].filter(Bt).join('\n')):(Uc=['precision '+xc.precision+' float;','precision '+xc.precision+' int;','#define SHADER_NAME '+yc.__webglShader.name,Cc,xc.supportsVertexTextures?'#define VERTEX_TEXTURES':'','#define GAMMA_FACTOR '+Rc,'#define MAX_BONES '+xc.maxBones,xc.useFog&&xc.fog?'#define USE_FOG':'',xc.useFog&&xc.fogExp?'#define FOG_EXP2':'',xc.map?'#define USE_MAP':'',xc.envMap?'#define USE_ENVMAP':'',xc.envMap?'#define '+wc:'',xc.lightMap?'#define USE_LIGHTMAP':'',xc.aoMap?'#define USE_AOMAP':'',xc.emissiveMap?'#define USE_EMISSIVEMAP':'',xc.bumpMap?'#define USE_BUMPMAP':'',xc.normalMap?'#define USE_NORMALMAP':'',xc.displacementMap&&xc.supportsVertexTextures?'#define USE_DISPLACEMENTMAP':'',xc.specularMap?'#define USE_SPECULARMAP':'',xc.roughnessMap?'#define USE_ROUGHNESSMAP':'',xc.metalnessMap?'#define USE_METALNESSMAP':'',xc.alphaMap?'#define USE_ALPHAMAP':'',xc.vertexColors?'#define USE_COLOR':'',xc.flatShading?'#define FLAT_SHADED':'',xc.skinning?'#define USE_SKINNING':'',xc.useVertexTexture?'#define BONE_TEXTURE':'',xc.morphTargets?'#define USE_MORPHTARGETS':'',xc.morphNormals&&!1===xc.flatShading?'#define USE_MORPHNORMALS':'',xc.doubleSided?'#define DOUBLE_SIDED':'',xc.flipSided?'#define FLIP_SIDED':'','#define NUM_CLIPPING_PLANES '+xc.numClippingPlanes,xc.shadowMapEnabled?'#define USE_SHADOWMAP':'',xc.shadowMapEnabled?'#define '+Sc:'',xc.sizeAttenuation?'#define USE_SIZEATTENUATION':'',xc.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',xc.logarithmicDepthBuffer&&gc.extensions.get('EXT_frag_depth')?'#define USE_LOGDEPTHBUF_EXT':'','uniform mat4 modelMatrix;','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;','uniform mat4 viewMatrix;','uniform mat3 normalMatrix;','uniform vec3 cameraPosition;','attribute vec3 position;','attribute vec3 normal;','attribute vec2 uv;','#ifdef USE_COLOR','\tattribute vec3 color;','#endif','#ifdef USE_MORPHTARGETS','\tattribute vec3 morphTarget0;','\tattribute vec3 morphTarget1;','\tattribute vec3 morphTarget2;','\tattribute vec3 morphTarget3;','\t#ifdef USE_MORPHNORMALS','\t\tattribute vec3 morphNormal0;','\t\tattribute vec3 morphNormal1;','\t\tattribute vec3 morphNormal2;','\t\tattribute vec3 morphNormal3;','\t#else','\t\tattribute vec3 morphTarget4;','\t\tattribute vec3 morphTarget5;','\t\tattribute vec3 morphTarget6;','\t\tattribute vec3 morphTarget7;','\t#endif','#endif','#ifdef USE_SKINNING','\tattribute vec4 skinIndex;','\tattribute vec4 skinWeight;','#endif','\n'].filter(Bt).join('\n'),Dc=[Pc,'precision '+xc.precision+' float;','precision '+xc.precision+' int;','#define SHADER_NAME '+yc.__webglShader.name,Cc,xc.alphaTest?'#define ALPHATEST '+xc.alphaTest:'','#define GAMMA_FACTOR '+Rc,xc.useFog&&xc.fog?'#define USE_FOG':'',xc.useFog&&xc.fogExp?'#define FOG_EXP2':'',xc.map?'#define USE_MAP':'',xc.envMap?'#define USE_ENVMAP':'',xc.envMap?'#define '+Lc:'',xc.envMap?'#define '+wc:'',xc.envMap?'#define '+Ac:'',xc.lightMap?'#define USE_LIGHTMAP':'',xc.aoMap?'#define USE_AOMAP':'',xc.emissiveMap?'#define USE_EMISSIVEMAP':'',xc.bumpMap?'#define USE_BUMPMAP':'',xc.normalMap?'#define USE_NORMALMAP':'',xc.specularMap?'#define USE_SPECULARMAP':'',xc.roughnessMap?'#define USE_ROUGHNESSMAP':'',xc.metalnessMap?'#define USE_METALNESSMAP':'',xc.alphaMap?'#define USE_ALPHAMAP':'',xc.vertexColors?'#define USE_COLOR':'',xc.gradientMap?'#define USE_GRADIENTMAP':'',xc.flatShading?'#define FLAT_SHADED':'',xc.doubleSided?'#define DOUBLE_SIDED':'',xc.flipSided?'#define FLIP_SIDED':'','#define NUM_CLIPPING_PLANES '+xc.numClippingPlanes,'#define UNION_CLIPPING_PLANES '+(xc.numClippingPlanes-xc.numClipIntersection),xc.shadowMapEnabled?'#define USE_SHADOWMAP':'',xc.shadowMapEnabled?'#define '+Sc:'',xc.premultipliedAlpha?'#define PREMULTIPLIED_ALPHA':'',xc.physicallyCorrectLights?'#define PHYSICALLY_CORRECT_LIGHTS':'',xc.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',xc.logarithmicDepthBuffer&&gc.extensions.get('EXT_frag_depth')?'#define USE_LOGDEPTHBUF_EXT':'',xc.envMap&&gc.extensions.get('EXT_shader_texture_lod')?'#define TEXTURE_LOD_EXT':'','uniform mat4 viewMatrix;','uniform vec3 cameraPosition;',xc.toneMapping===Gn?'':'#define TONE_MAPPING',xc.toneMapping===Gn?'':Op.tonemapping_pars_fragment,xc.toneMapping===Gn?'':Ut('toneMapping',xc.toneMapping),xc.outputEncoding||xc.mapEncoding||xc.envMapEncoding||xc.emissiveMapEncoding?Op.encodings_pars_fragment:'',xc.mapEncoding?Ct('mapTexelToLinear',xc.mapEncoding):'',xc.envMapEncoding?Ct('envMapTexelToLinear',xc.envMapEncoding):'',xc.emissiveMapEncoding?Ct('emissiveMapTexelToLinear',xc.emissiveMapEncoding):'',xc.outputEncoding?It('linearToOutputTexel',xc.outputEncoding):'',xc.depthPacking?'#define DEPTH_PACKING '+yc.depthPacking:'','\n'].filter(Bt).join('\n')),Tc=Ot(Tc,xc),Tc=Ft(Tc,xc),Mc=Ot(Mc,xc),Mc=Ft(Mc,xc),yc.isShaderMaterial||(Tc=Gt(Tc),Mc=Gt(Mc));var zc=Uc+Tc,Nc=Dc+Mc,Bc=Rt(vc,vc.VERTEX_SHADER,zc),Fc=Rt(vc,vc.FRAGMENT_SHADER,Nc);vc.attachShader(Ic,Bc),vc.attachShader(Ic,Fc),void 0===yc.index0AttributeName?!0===xc.morphTargets&&vc.bindAttribLocation(Ic,0,'position'):vc.bindAttribLocation(Ic,0,yc.index0AttributeName),vc.linkProgram(Ic);var Oc=vc.getProgramInfoLog(Ic),Gc=vc.getShaderInfoLog(Bc),Hc=vc.getShaderInfoLog(Fc),Vc=!0,kc=!0;!1===vc.getProgramParameter(Ic,vc.LINK_STATUS)?(Vc=!1,void 0):''===Oc?(''===Gc||''===Hc)&&(kc=!1):void 0,kc&&(this.diagnostics={runnable:Vc,material:yc,programLog:Oc,vertexShader:{log:Gc,prefix:Uc},fragmentShader:{log:Hc,prefix:Dc}}),vc.deleteShader(Bc),vc.deleteShader(Fc);var Wc;this.getUniforms=function(){return void 0==Wc&&(Wc=new Ce(vc,Ic,gc)),Wc};var jc;return this.getAttributes=function(){return void 0==jc&&(jc=Nt(vc,Ic)),jc},this.destroy=function(){vc.deleteProgram(Ic),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return this.getUniforms()}},attributes:{get:function(){return this.getAttributes()}}}),this.id=Xp++,this.code=hc,this.usedTimes=1,this.program=Ic,this.vertexShader=Bc,this.fragmentShader=Fc,this}function Vt(gc,hc){function yc(Tc){if(hc.floatVertexTextures&&Tc&&Tc.skeleton&&Tc.skeleton.useVertexTexture)return 1024;var Mc=hc.maxVertexUniforms,Sc=_Mathfloor((Mc-20)/4),Lc=Sc;return void 0!==Tc&&Tc&&Tc.isSkinnedMesh&&(Lc=_Mathmin(Tc.skeleton.bones.length,Lc),Lc<Tc.skeleton.bones.length&&void 0),Lc}function xc(Tc,Mc){var Sc;return Tc?Tc.isTexture?Sc=Tc.encoding:Tc.isWebGLRenderTarget&&(Sc=Tc.texture.encoding):Sc=Qs,Sc===Qs&&Mc&&(Sc=el),Sc}var vc=[],_c={MeshDepthMaterial:'depth',MeshNormalMaterial:'normal',MeshBasicMaterial:'basic',MeshLambertMaterial:'lambert',MeshPhongMaterial:'phong',MeshToonMaterial:'phong',MeshStandardMaterial:'physical',MeshPhysicalMaterial:'physical',LineBasicMaterial:'basic',LineDashedMaterial:'dashed',PointsMaterial:'points'},Ec=['precision','supportsVertexTextures','map','mapEncoding','envMap','envMapMode','envMapEncoding','lightMap','aoMap','emissiveMap','emissiveMapEncoding','bumpMap','normalMap','displacementMap','specularMap','roughnessMap','metalnessMap','gradientMap','alphaMap','combine','vertexColors','fog','useFog','fogExp','flatShading','sizeAttenuation','logarithmicDepthBuffer','skinning','maxBones','useVertexTexture','morphTargets','morphNormals','maxMorphTargets','maxMorphNormals','premultipliedAlpha','numDirLights','numPointLights','numSpotLights','numHemiLights','numRectAreaLights','shadowMapEnabled','shadowMapType','toneMapping','physicallyCorrectLights','alphaTest','doubleSided','flipSided','numClippingPlanes','numClipIntersection','depthPacking'];this.getParameters=function(Tc,Mc,Sc,Lc,wc,Ac){var Rc=_c[Tc.type],Pc=yc(Ac),Cc=gc.getPrecision();null!==Tc.precision&&(Cc=hc.getMaxPrecision(Tc.precision),Cc!==Tc.precision&&void 0);var Ic=gc.getCurrentRenderTarget(),Uc={shaderID:Rc,precision:Cc,supportsVertexTextures:hc.vertexTextures,outputEncoding:xc(Ic?Ic.texture:null,gc.gammaOutput),map:!!Tc.map,mapEncoding:xc(Tc.map,gc.gammaInput),envMap:!!Tc.envMap,envMapMode:Tc.envMap&&Tc.envMap.mapping,envMapEncoding:xc(Tc.envMap,gc.gammaInput),envMapCubeUV:!!Tc.envMap&&(Tc.envMap.mapping===Jn||Tc.envMap.mapping===Qn),lightMap:!!Tc.lightMap,aoMap:!!Tc.aoMap,emissiveMap:!!Tc.emissiveMap,emissiveMapEncoding:xc(Tc.emissiveMap,gc.gammaInput),bumpMap:!!Tc.bumpMap,normalMap:!!Tc.normalMap,displacementMap:!!Tc.displacementMap,roughnessMap:!!Tc.roughnessMap,metalnessMap:!!Tc.metalnessMap,specularMap:!!Tc.specularMap,alphaMap:!!Tc.alphaMap,gradientMap:!!Tc.gradientMap,combine:Tc.combine,vertexColors:Tc.vertexColors,fog:!!Sc,useFog:Tc.fog,fogExp:Sc&&Sc.isFogExp2,flatShading:Tc.shading===en,sizeAttenuation:Tc.sizeAttenuation,logarithmicDepthBuffer:hc.logarithmicDepthBuffer,skinning:Tc.skinning,maxBones:Pc,useVertexTexture:hc.floatVertexTextures&&Ac&&Ac.skeleton&&Ac.skeleton.useVertexTexture,morphTargets:Tc.morphTargets,morphNormals:Tc.morphNormals,maxMorphTargets:gc.maxMorphTargets,maxMorphNormals:gc.maxMorphNormals,numDirLights:Mc.directional.length,numPointLights:Mc.point.length,numSpotLights:Mc.spot.length,numRectAreaLights:Mc.rectArea.length,numHemiLights:Mc.hemi.length,numClippingPlanes:Lc,numClipIntersection:wc,shadowMapEnabled:gc.shadowMap.enabled&&Ac.receiveShadow&&0<Mc.shadows.length,shadowMapType:gc.shadowMap.type,toneMapping:gc.toneMapping,physicallyCorrectLights:gc.physicallyCorrectLights,premultipliedAlpha:Tc.premultipliedAlpha,alphaTest:Tc.alphaTest,doubleSided:Tc.side===$i,flipSided:Tc.side===Qi,depthPacking:Tc.depthPacking!==void 0&&Tc.depthPacking};return Uc},this.getProgramCode=function(Tc,Mc){var Sc=[];if(Mc.shaderID?Sc.push(Mc.shaderID):(Sc.push(Tc.fragmentShader),Sc.push(Tc.vertexShader)),void 0!==Tc.defines)for(var Lc in Tc.defines)Sc.push(Lc),Sc.push(Tc.defines[Lc]);for(var wc=0;wc<Ec.length;wc++)Sc.push(Mc[Ec[wc]]);return Sc.join()},this.acquireProgram=function(Tc,Mc,Sc){for(var wc=0,Ac=vc.length,Lc,Rc;wc<Ac;wc++)if(Rc=vc[wc],Rc.code===Sc){Lc=Rc,++Lc.usedTimes;break}return void 0===Lc&&(Lc=new Ht(gc,Sc,Tc,Mc),vc.push(Lc)),Lc},this.releaseProgram=function(Tc){if(0==--Tc.usedTimes){var Mc=vc.indexOf(Tc);vc[Mc]=vc[vc.length-1],vc.pop(),Tc.destroy()}},this.programs=vc}function kt(gc,hc,yc){function xc(Sc){var Lc=Sc.target,wc=Mc[Lc.id];null!==wc.index&&_c(wc.index),Ec(wc.attributes),Lc.removeEventListener('dispose',xc),delete Mc[Lc.id];var Ac=hc.get(Lc);Ac.wireframe&&_c(Ac.wireframe),hc.delete(Lc);var Rc=hc.get(wc);Rc.wireframe&&_c(Rc.wireframe),hc.delete(wc),yc.memory.geometries--}function vc(Sc){return Sc.isInterleavedBufferAttribute?hc.get(Sc.data).__webglBuffer:hc.get(Sc).__webglBuffer}function _c(Sc){var Lc=vc(Sc);Lc!==void 0&&(gc.deleteBuffer(Lc),Tc(Sc))}function Ec(Sc){for(var Lc in Sc)_c(Sc[Lc])}function Tc(Sc){Sc.isInterleavedBufferAttribute?hc.delete(Sc.data):hc.delete(Sc)}var Mc={};return{get:function(Sc){var Lc=Sc.geometry;if(void 0!==Mc[Lc.id])return Mc[Lc.id];Lc.addEventListener('dispose',xc);var wc;return Lc.isBufferGeometry?wc=Lc:Lc.isGeometry&&(void 0===Lc._bufferGeometry&&(Lc._bufferGeometry=new gt().setFromObject(Sc)),wc=Lc._bufferGeometry),Mc[Lc.id]=wc,yc.memory.geometries++,wc}}}function Wt(gc,hc,yc){function vc(wc,Ac){var Rc=wc.isInterleavedBufferAttribute?wc.data:wc,Pc=hc.get(Rc);Pc.__webglBuffer===void 0?_c(Pc,Rc,Ac):Pc.version!==Rc.version&&Ec(Pc,Rc,Ac)}function _c(wc,Ac,Rc){wc.__webglBuffer=gc.createBuffer(),gc.bindBuffer(Rc,wc.__webglBuffer);var Pc=Ac.dynamic?gc.DYNAMIC_DRAW:gc.STATIC_DRAW;gc.bufferData(Rc,Ac.array,Pc);var Cc=gc.FLOAT,Ic=Ac.array;Ic instanceof Float32Array?Cc=gc.FLOAT:Ic instanceof Float64Array?void 0:Ic instanceof Uint16Array?Cc=gc.UNSIGNED_SHORT:Ic instanceof Int16Array?Cc=gc.SHORT:Ic instanceof Uint32Array?Cc=gc.UNSIGNED_INT:Ic instanceof Int32Array?Cc=gc.INT:Ic instanceof Int8Array?Cc=gc.BYTE:Ic instanceof Uint8Array&&(Cc=gc.UNSIGNED_BYTE),wc.bytesPerElement=Ic.BYTES_PER_ELEMENT,wc.type=Cc,wc.version=Ac.version,Ac.onUploadCallback()}function Ec(wc,Ac,Rc){gc.bindBuffer(Rc,wc.__webglBuffer),!1===Ac.dynamic?gc.bufferData(Rc,Ac.array,gc.STATIC_DRAW):-1===Ac.updateRange.count?gc.bufferSubData(Rc,0,Ac.array):0===Ac.updateRange.count?void 0:(gc.bufferSubData(Rc,Ac.updateRange.offset*Ac.array.BYTES_PER_ELEMENT,Ac.array.subarray(Ac.updateRange.offset,Ac.updateRange.offset+Ac.updateRange.count)),Ac.updateRange.count=0),wc.version=Ac.version}var Lc=new kt(gc,hc,yc);return{getAttributeBuffer:function(wc){return wc.isInterleavedBufferAttribute?hc.get(wc.data).__webglBuffer:hc.get(wc).__webglBuffer},getAttributeProperties:function(wc){return wc.isInterleavedBufferAttribute?hc.get(wc.data):hc.get(wc)},getWireframeAttribute:function(wc){var Ac=hc.get(wc);if(void 0!==Ac.wireframe)return Ac.wireframe;var Rc=[],Pc=wc.index,Cc=wc.attributes;if(null!==Pc)for(var Ic=Pc.array,Uc=0,Dc=Ic.length;Uc<Dc;Uc+=3){var zc=Ic[Uc+0],Nc=Ic[Uc+1],Bc=Ic[Uc+2];Rc.push(zc,Nc,Nc,Bc,Bc,zc)}else for(var Ic=Cc.position.array,Uc=0,Dc=Ic.length/3-1;Uc<Dc;Uc+=3){var zc=Uc+0,Nc=Uc+1,Bc=Uc+2;Rc.push(zc,Nc,Nc,Bc,Bc,zc)}var Fc=new(65535<ut(Rc)?st:it)(Rc,1);return vc(Fc,gc.ELEMENT_ARRAY_BUFFER),Ac.wireframe=Fc,Fc},update:function(wc){var Ac=Lc.get(wc);wc.geometry.isGeometry&&Ac.updateFromObject(wc);var Rc=Ac.index,Pc=Ac.attributes;for(var Cc in null!==Rc&&vc(Rc,gc.ELEMENT_ARRAY_BUFFER),Pc)vc(Pc[Cc],gc.ARRAY_BUFFER);var Ic=Ac.morphAttributes;for(var Cc in Ic)for(var Uc=Ic[Cc],Dc=0,zc=Uc.length;Dc<zc;Dc++)vc(Uc[Dc],gc.ARRAY_BUFFER);return Ac}}}function jt(gc,hc,yc,xc,vc,_c,Ec){function Tc(jc,Xc){if(jc.width>Xc||jc.height>Xc){var Yc=Xc/_Mathmax(jc.width,jc.height),qc=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');qc.width=_Mathfloor(jc.width*Yc),qc.height=_Mathfloor(jc.height*Yc);var Zc=qc.getContext('2d');return Zc.drawImage(jc,0,0,jc.width,jc.height,0,0,qc.width,qc.height),qc}return jc}function Mc(jc){return xl.isPowerOfTwo(jc.width)&&xl.isPowerOfTwo(jc.height)}function Sc(jc){if(jc instanceof HTMLImageElement||jc instanceof HTMLCanvasElement){var Xc=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');Xc.width=xl.nearestPowerOfTwo(jc.width),Xc.height=xl.nearestPowerOfTwo(jc.height);var Yc=Xc.getContext('2d');return Yc.drawImage(jc,0,0,Xc.width,Xc.height),Xc}return jc}function Lc(jc){return jc.wrapS!==es||jc.wrapT!==es||jc.minFilter!==as&&jc.minFilter!==ns}function wc(jc){return jc===as||jc===os||jc===is?gc.NEAREST:gc.LINEAR}function Ac(jc){var Xc=jc.target;Xc.removeEventListener('dispose',Ac),Pc(Xc),kc.textures--}function Rc(jc){var Xc=jc.target;Xc.removeEventListener('dispose',Rc),Cc(Xc),kc.textures--}function Pc(jc){var Xc=xc.get(jc);if(jc.image&&Xc.__image__webglTextureCube)gc.deleteTexture(Xc.__image__webglTextureCube);else{if(Xc.__webglInit===void 0)return;gc.deleteTexture(Xc.__webglTexture)}xc.delete(jc)}function Cc(jc){var Xc=xc.get(jc),Yc=xc.get(jc.texture);if(jc){if(void 0!==Yc.__webglTexture&&gc.deleteTexture(Yc.__webglTexture),jc.depthTexture&&jc.depthTexture.dispose(),jc.isWebGLRenderTargetCube)for(var qc=0;6>qc;qc++)gc.deleteFramebuffer(Xc.__webglFramebuffer[qc]),Xc.__webglDepthbuffer&&gc.deleteRenderbuffer(Xc.__webglDepthbuffer[qc]);else gc.deleteFramebuffer(Xc.__webglFramebuffer),Xc.__webglDepthbuffer&&gc.deleteRenderbuffer(Xc.__webglDepthbuffer);xc.delete(jc.texture),xc.delete(jc)}}function Ic(jc,Xc){var Yc=xc.get(jc);if(0<jc.version&&Yc.__version!==jc.version){var qc=jc.image;if(qc===void 0);else if(!1===qc.complete);else return void Nc(Yc,jc,Xc)}yc.activeTexture(gc.TEXTURE0+Xc),yc.bindTexture(gc.TEXTURE_2D,Yc.__webglTexture)}function zc(jc,Xc,Yc){var qc;if(Yc?(gc.texParameteri(jc,gc.TEXTURE_WRAP_S,_c(Xc.wrapS)),gc.texParameteri(jc,gc.TEXTURE_WRAP_T,_c(Xc.wrapT)),gc.texParameteri(jc,gc.TEXTURE_MAG_FILTER,_c(Xc.magFilter)),gc.texParameteri(jc,gc.TEXTURE_MIN_FILTER,_c(Xc.minFilter))):(gc.texParameteri(jc,gc.TEXTURE_WRAP_S,gc.CLAMP_TO_EDGE),gc.texParameteri(jc,gc.TEXTURE_WRAP_T,gc.CLAMP_TO_EDGE),(Xc.wrapS!==es||Xc.wrapT!==es)&&void 0,gc.texParameteri(jc,gc.TEXTURE_MAG_FILTER,wc(Xc.magFilter)),gc.texParameteri(jc,gc.TEXTURE_MIN_FILTER,wc(Xc.minFilter)),Xc.minFilter!==as&&Xc.minFilter!==ns&&void 0),qc=hc.get('EXT_texture_filter_anisotropic'),qc){if(Xc.type===hs&&null===hc.get('OES_texture_float_linear'))return;if(Xc.type===ys&&null===hc.get('OES_texture_half_float_linear'))return;(1<Xc.anisotropy||xc.get(Xc).__currentAnisotropy)&&(gc.texParameterf(jc,qc.TEXTURE_MAX_ANISOTROPY_EXT,_Mathmin(Xc.anisotropy,vc.getMaxAnisotropy())),xc.get(Xc).__currentAnisotropy=Xc.anisotropy)}}function Nc(jc,Xc,Yc){jc.__webglInit===void 0&&(jc.__webglInit=!0,Xc.addEventListener('dispose',Ac),jc.__webglTexture=gc.createTexture(),kc.textures++),yc.activeTexture(gc.TEXTURE0+Yc),yc.bindTexture(gc.TEXTURE_2D,jc.__webglTexture),gc.pixelStorei(gc.UNPACK_FLIP_Y_WEBGL,Xc.flipY),gc.pixelStorei(gc.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Xc.premultiplyAlpha),gc.pixelStorei(gc.UNPACK_ALIGNMENT,Xc.unpackAlignment);var qc=Tc(Xc.image,vc.maxTextureSize);Lc(Xc)&&!1===Mc(qc)&&(qc=Sc(qc));var Zc=Mc(qc),Kc=_c(Xc.format),Jc=_c(Xc.type);zc(gc.TEXTURE_2D,Xc,Zc);var $c=Xc.mipmaps,Qc;if(Xc.isDepthTexture){var eu=gc.DEPTH_COMPONENT;if(Xc.type===hs){if(!Wc)throw new Error('Float Depth Texture only supported in WebGL2.0');eu=gc.DEPTH_COMPONENT32F}else Wc&&(eu=gc.DEPTH_COMPONENT16);Xc.format===Rs&&eu===gc.DEPTH_COMPONENT&&Xc.type!==ms&&Xc.type!==gs&&(void 0,Xc.type=ms,Jc=_c(Xc.type)),Xc.format===Ps&&(eu=gc.DEPTH_STENCIL,Xc.type!==Es&&(void 0,Xc.type=Es,Jc=_c(Xc.type))),yc.texImage2D(gc.TEXTURE_2D,0,eu,qc.width,qc.height,0,Kc,Jc,null)}else if(Xc.isDataTexture){if(0<$c.length&&Zc){for(var tu=0,ru=$c.length;tu<ru;tu++)Qc=$c[tu],yc.texImage2D(gc.TEXTURE_2D,tu,Kc,Qc.width,Qc.height,0,Kc,Jc,Qc.data);Xc.generateMipmaps=!1}else yc.texImage2D(gc.TEXTURE_2D,0,Kc,qc.width,qc.height,0,Kc,Jc,qc.data);}else if(Xc.isCompressedTexture)for(var tu=0,ru=$c.length;tu<ru;tu++)Qc=$c[tu],Xc.format!==Ss&&Xc.format!==Ms?-1<yc.getCompressedTextureFormats().indexOf(Kc)?yc.compressedTexImage2D(gc.TEXTURE_2D,tu,Kc,Qc.width,Qc.height,0,Qc.data):void 0:yc.texImage2D(gc.TEXTURE_2D,tu,Kc,Qc.width,Qc.height,0,Kc,Jc,Qc.data);else if(0<$c.length&&Zc){for(var tu=0,ru=$c.length;tu<ru;tu++)Qc=$c[tu],yc.texImage2D(gc.TEXTURE_2D,tu,Kc,Kc,Jc,Qc);Xc.generateMipmaps=!1}else yc.texImage2D(gc.TEXTURE_2D,0,Kc,Kc,Jc,qc);Xc.generateMipmaps&&Zc&&gc.generateMipmap(gc.TEXTURE_2D),jc.__version=Xc.version,Xc.onUpdate&&Xc.onUpdate(Xc)}function Bc(jc,Xc,Yc,qc){var Zc=_c(Xc.texture.format),Kc=_c(Xc.texture.type);yc.texImage2D(qc,0,Zc,Xc.width,Xc.height,0,Zc,Kc,null),gc.bindFramebuffer(gc.FRAMEBUFFER,jc),gc.framebufferTexture2D(gc.FRAMEBUFFER,Yc,qc,xc.get(Xc.texture).__webglTexture,0),gc.bindFramebuffer(gc.FRAMEBUFFER,null)}function Fc(jc,Xc){gc.bindRenderbuffer(gc.RENDERBUFFER,jc),Xc.depthBuffer&&!Xc.stencilBuffer?(gc.renderbufferStorage(gc.RENDERBUFFER,gc.DEPTH_COMPONENT16,Xc.width,Xc.height),gc.framebufferRenderbuffer(gc.FRAMEBUFFER,gc.DEPTH_ATTACHMENT,gc.RENDERBUFFER,jc)):Xc.depthBuffer&&Xc.stencilBuffer?(gc.renderbufferStorage(gc.RENDERBUFFER,gc.DEPTH_STENCIL,Xc.width,Xc.height),gc.framebufferRenderbuffer(gc.FRAMEBUFFER,gc.DEPTH_STENCIL_ATTACHMENT,gc.RENDERBUFFER,jc)):gc.renderbufferStorage(gc.RENDERBUFFER,gc.RGBA4,Xc.width,Xc.height),gc.bindRenderbuffer(gc.RENDERBUFFER,null)}function Oc(jc,Xc){var Yc=Xc&&Xc.isWebGLRenderTargetCube;if(Yc)throw new Error('Depth Texture with cube render targets is not supported!');if(gc.bindFramebuffer(gc.FRAMEBUFFER,jc),!(Xc.depthTexture&&Xc.depthTexture.isDepthTexture))throw new Error('renderTarget.depthTexture must be an instance of THREE.DepthTexture');xc.get(Xc.depthTexture).__webglTexture&&Xc.depthTexture.image.width===Xc.width&&Xc.depthTexture.image.height===Xc.height||(Xc.depthTexture.image.width=Xc.width,Xc.depthTexture.image.height=Xc.height,Xc.depthTexture.needsUpdate=!0),Ic(Xc.depthTexture,0);var qc=xc.get(Xc.depthTexture).__webglTexture;if(Xc.depthTexture.format===Rs)gc.framebufferTexture2D(gc.FRAMEBUFFER,gc.DEPTH_ATTACHMENT,gc.TEXTURE_2D,qc,0);else if(Xc.depthTexture.format===Ps)gc.framebufferTexture2D(gc.FRAMEBUFFER,gc.DEPTH_STENCIL_ATTACHMENT,gc.TEXTURE_2D,qc,0);else throw new Error('Unknown depthTexture format')}function Gc(jc){var Xc=xc.get(jc),Yc=!0===jc.isWebGLRenderTargetCube;if(jc.depthTexture){if(Yc)throw new Error('target.depthTexture not supported in Cube render targets');Oc(Xc.__webglFramebuffer,jc)}else if(Yc){Xc.__webglDepthbuffer=[];for(var qc=0;6>qc;qc++)gc.bindFramebuffer(gc.FRAMEBUFFER,Xc.__webglFramebuffer[qc]),Xc.__webglDepthbuffer[qc]=gc.createRenderbuffer(),Fc(Xc.__webglDepthbuffer[qc],jc)}else gc.bindFramebuffer(gc.FRAMEBUFFER,Xc.__webglFramebuffer),Xc.__webglDepthbuffer=gc.createRenderbuffer(),Fc(Xc.__webglDepthbuffer,jc);gc.bindFramebuffer(gc.FRAMEBUFFER,null)}var kc=Ec.memory,Wc='undefined'!=typeof WebGL2RenderingContext&&gc instanceof WebGL2RenderingContext;this.setTexture2D=Ic,this.setTextureCube=function(jc,Xc){var Yc=xc.get(jc);if(6===jc.image.length)if(0<jc.version&&Yc.__version!==jc.version){Yc.__image__webglTextureCube||(jc.addEventListener('dispose',Ac),Yc.__image__webglTextureCube=gc.createTexture(),kc.textures++),yc.activeTexture(gc.TEXTURE0+Xc),yc.bindTexture(gc.TEXTURE_CUBE_MAP,Yc.__image__webglTextureCube),gc.pixelStorei(gc.UNPACK_FLIP_Y_WEBGL,jc.flipY);for(var qc=jc&&jc.isCompressedTexture,Zc=jc.image[0]&&jc.image[0].isDataTexture,Kc=[],Jc=0;6>Jc;Jc++)Kc[Jc]=qc||Zc?Zc?jc.image[Jc].image:jc.image[Jc]:Tc(jc.image[Jc],vc.maxCubemapSize);var Qc=Kc[0],$c=Mc(Qc),eu=_c(jc.format),tu=_c(jc.type);zc(gc.TEXTURE_CUBE_MAP,jc,$c);for(var Jc=0;6>Jc;Jc++)if(!qc)Zc?yc.texImage2D(gc.TEXTURE_CUBE_MAP_POSITIVE_X+Jc,0,eu,Kc[Jc].width,Kc[Jc].height,0,eu,tu,Kc[Jc].data):yc.texImage2D(gc.TEXTURE_CUBE_MAP_POSITIVE_X+Jc,0,eu,eu,tu,Kc[Jc]);else for(var au=Kc[Jc].mipmaps,ou=0,iu=au.length,ru;ou<iu;ou++)ru=au[ou],jc.format!==Ss&&jc.format!==Ms?-1<yc.getCompressedTextureFormats().indexOf(eu)?yc.compressedTexImage2D(gc.TEXTURE_CUBE_MAP_POSITIVE_X+Jc,ou,eu,ru.width,ru.height,0,ru.data):void 0:yc.texImage2D(gc.TEXTURE_CUBE_MAP_POSITIVE_X+Jc,ou,eu,ru.width,ru.height,0,eu,tu,ru.data);jc.generateMipmaps&&$c&&gc.generateMipmap(gc.TEXTURE_CUBE_MAP),Yc.__version=jc.version,jc.onUpdate&&jc.onUpdate(jc)}else yc.activeTexture(gc.TEXTURE0+Xc),yc.bindTexture(gc.TEXTURE_CUBE_MAP,Yc.__image__webglTextureCube)},this.setTextureCubeDynamic=function(jc,Xc){yc.activeTexture(gc.TEXTURE0+Xc),yc.bindTexture(gc.TEXTURE_CUBE_MAP,xc.get(jc).__webglTexture)},this.setupRenderTarget=function(jc){var Xc=xc.get(jc),Yc=xc.get(jc.texture);jc.addEventListener('dispose',Rc),Yc.__webglTexture=gc.createTexture(),kc.textures++;var qc=!0===jc.isWebGLRenderTargetCube,Zc=Mc(jc);if(qc){Xc.__webglFramebuffer=[];for(var Kc=0;6>Kc;Kc++)Xc.__webglFramebuffer[Kc]=gc.createFramebuffer()}else Xc.__webglFramebuffer=gc.createFramebuffer();if(qc){yc.bindTexture(gc.TEXTURE_CUBE_MAP,Yc.__webglTexture),zc(gc.TEXTURE_CUBE_MAP,jc.texture,Zc);for(var Kc=0;6>Kc;Kc++)Bc(Xc.__webglFramebuffer[Kc],jc,gc.COLOR_ATTACHMENT0,gc.TEXTURE_CUBE_MAP_POSITIVE_X+Kc);jc.texture.generateMipmaps&&Zc&&gc.generateMipmap(gc.TEXTURE_CUBE_MAP),yc.bindTexture(gc.TEXTURE_CUBE_MAP,null)}else yc.bindTexture(gc.TEXTURE_2D,Yc.__webglTexture),zc(gc.TEXTURE_2D,jc.texture,Zc),Bc(Xc.__webglFramebuffer,jc,gc.COLOR_ATTACHMENT0,gc.TEXTURE_2D),jc.texture.generateMipmaps&&Zc&&gc.generateMipmap(gc.TEXTURE_2D),yc.bindTexture(gc.TEXTURE_2D,null);jc.depthBuffer&&Gc(jc)},this.updateRenderTargetMipmap=function(jc){var Xc=jc.texture;if(Xc.generateMipmaps&&Mc(jc)&&Xc.minFilter!==as&&Xc.minFilter!==ns){var Yc=jc&&jc.isWebGLRenderTargetCube?gc.TEXTURE_CUBE_MAP:gc.TEXTURE_2D,qc=xc.get(Xc).__webglTexture;yc.bindTexture(Yc,qc),gc.generateMipmap(Yc),yc.bindTexture(Yc,null)}}}function Xt(){var gc={};return{get:function(hc){var yc=hc.uuid,xc=gc[yc];return void 0===xc&&(xc={},gc[yc]=xc),xc},delete:function(hc){delete gc[hc.uuid]},clear:function(){gc={}}}}function Yt(gc,hc,yc){function Ec(Iu,Uu,Du){var zu=new Uint8Array(4),Nu=gc.createTexture();gc.bindTexture(Iu,Nu),gc.texParameteri(Iu,gc.TEXTURE_MIN_FILTER,gc.NEAREST),gc.texParameteri(Iu,gc.TEXTURE_MAG_FILTER,gc.NEAREST);for(var Bu=0;Bu<Du;Bu++)gc.texImage2D(Uu+Bu,0,gc.RGBA,1,1,0,gc.RGBA,gc.UNSIGNED_BYTE,zu);return Nu}function Ac(Iu){!0!==nu[Iu]&&(gc.enable(Iu),nu[Iu]=!0)}function Rc(Iu){!1!==nu[Iu]&&(gc.disable(Iu),nu[Iu]=!1)}function Cc(Iu,Uu,Du,zu,Nu,Bu,Fu,Ou){Iu===nn?Rc(gc.BLEND):Ac(gc.BLEND),(Iu!==du||Ou!==yu)&&(Iu===ln?Ou?(gc.blendEquationSeparate(gc.FUNC_ADD,gc.FUNC_ADD),gc.blendFuncSeparate(gc.ONE,gc.ONE,gc.ONE,gc.ONE)):(gc.blendEquation(gc.FUNC_ADD),gc.blendFunc(gc.SRC_ALPHA,gc.ONE)):Iu===dn?Ou?(gc.blendEquationSeparate(gc.FUNC_ADD,gc.FUNC_ADD),gc.blendFuncSeparate(gc.ZERO,gc.ZERO,gc.ONE_MINUS_SRC_COLOR,gc.ONE_MINUS_SRC_ALPHA)):(gc.blendEquation(gc.FUNC_ADD),gc.blendFunc(gc.ZERO,gc.ONE_MINUS_SRC_COLOR)):Iu===pn?Ou?(gc.blendEquationSeparate(gc.FUNC_ADD,gc.FUNC_ADD),gc.blendFuncSeparate(gc.ZERO,gc.SRC_COLOR,gc.ZERO,gc.SRC_ALPHA)):(gc.blendEquation(gc.FUNC_ADD),gc.blendFunc(gc.ZERO,gc.SRC_COLOR)):Ou?(gc.blendEquationSeparate(gc.FUNC_ADD,gc.FUNC_ADD),gc.blendFuncSeparate(gc.ONE,gc.ONE_MINUS_SRC_ALPHA,gc.ONE,gc.ONE_MINUS_SRC_ALPHA)):(gc.blendEquationSeparate(gc.FUNC_ADD,gc.FUNC_ADD),gc.blendFuncSeparate(gc.SRC_ALPHA,gc.ONE_MINUS_SRC_ALPHA,gc.ONE,gc.ONE_MINUS_SRC_ALPHA)),du=Iu,yu=Ou),Iu===cn?(Nu=Nu||Uu,Bu=Bu||Du,Fu=Fu||zu,(Uu!==pu||Nu!==fu)&&(gc.blendEquationSeparate(yc(Uu),yc(Nu)),pu=Uu,fu=Nu),(Du!==uu||zu!==mu||Bu!==gu||Fu!==hu)&&(gc.blendFuncSeparate(yc(Du),yc(zu),yc(Bu),yc(Fu)),uu=Du,mu=zu,gu=Bu,hu=Fu)):(pu=null,uu=null,mu=null,fu=null,gu=null,hu=null)}function zc(Iu){eu.setFunc(Iu)}function Gc(Iu){xu!==Iu&&(Iu?gc.frontFace(gc.CW):gc.frontFace(gc.CCW),xu=Iu)}function Hc(Iu){Iu===Vi?Rc(gc.CULL_FACE):(Ac(gc.CULL_FACE),Iu!==vu&&(Iu===ki?gc.cullFace(gc.BACK):Iu===Wi?gc.cullFace(gc.FRONT):gc.cullFace(gc.FRONT_AND_BACK))),vu=Iu}function Xc(Iu){void 0===Iu&&(Iu=gc.TEXTURE0+Mu-1),wu!==Iu&&(gc.activeTexture(Iu),wu=Iu)}var $c=new function(){var Iu=!1,Uu=new I,Du=null,zu=new I;return{setMask:function(Nu){Du===Nu||Iu||(gc.colorMask(Nu,Nu,Nu,Nu),Du=Nu)},setLocked:function(Nu){Iu=Nu},setClear:function(Nu,Bu,Fu,Ou,Gu){!0===Gu&&(Nu*=Ou,Bu*=Ou,Fu*=Ou),Uu.set(Nu,Bu,Fu,Ou),!1===zu.equals(Uu)&&(gc.clearColor(Nu,Bu,Fu,Ou),zu.copy(Uu))},reset:function(){Iu=!1,Du=null,zu.set(0,0,0,1)}}},eu=new function(){var Iu=!1,Uu=null,Du=null,zu=null;return{setTest:function(Nu){Nu?Ac(gc.DEPTH_TEST):Rc(gc.DEPTH_TEST)},setMask:function(Nu){Uu===Nu||Iu||(gc.depthMask(Nu),Uu=Nu)},setFunc:function(Nu){Du!==Nu&&(Nu?Nu===Rn?gc.depthFunc(gc.NEVER):Nu===Pn?gc.depthFunc(gc.ALWAYS):Nu===Cn?gc.depthFunc(gc.LESS):Nu===In?gc.depthFunc(gc.LEQUAL):Nu===Un?gc.depthFunc(gc.EQUAL):Nu===Dn?gc.depthFunc(gc.GEQUAL):Nu===zn?gc.depthFunc(gc.GREATER):Nu===Nn?gc.depthFunc(gc.NOTEQUAL):gc.depthFunc(gc.LEQUAL):gc.depthFunc(gc.LEQUAL),Du=Nu)},setLocked:function(Nu){Iu=Nu},setClear:function(Nu){zu!==Nu&&(gc.clearDepth(Nu),zu=Nu)},reset:function(){Iu=!1,Uu=null,Du=null,zu=null}}},tu=new function(){var Iu=!1,Uu=null,Du=null,zu=null,Nu=null,Bu=null,Fu=null,Ou=null,Gu=null;return{setTest:function(Hu){Hu?Ac(gc.STENCIL_TEST):Rc(gc.STENCIL_TEST)},setMask:function(Hu){Uu===Hu||Iu||(gc.stencilMask(Hu),Uu=Hu)},setFunc:function(Hu,Vu,ku){(Du!==Hu||zu!==Vu||Nu!==ku)&&(gc.stencilFunc(Hu,Vu,ku),Du=Hu,zu=Vu,Nu=ku)},setOp:function(Hu,Vu,ku){(Bu!==Hu||Fu!==Vu||Ou!==ku)&&(gc.stencilOp(Hu,Vu,ku),Bu=Hu,Fu=Vu,Ou=ku)},setLocked:function(Hu){Iu=Hu},setClear:function(Hu){Gu!==Hu&&(gc.clearStencil(Hu),Gu=Hu)},reset:function(){Iu=!1,Uu=null,Du=null,zu=null,Nu=null,Bu=null,Fu=null,Ou=null,Gu=null}}},ru=gc.getParameter(gc.MAX_VERTEX_ATTRIBS),au=new Uint8Array(ru),ou=new Uint8Array(ru),iu=new Uint8Array(ru),nu={},lu=null,du=null,pu=null,uu=null,mu=null,fu=null,gu=null,hu=null,yu=!1,xu=null,vu=null,_u=null,bu=null,Eu=null,Tu=null,Mu=gc.getParameter(gc.MAX_TEXTURE_IMAGE_UNITS),Su=parseFloat(/^WebGL\ ([0-9])/.exec(gc.getParameter(gc.VERSION))[1]),Lu=1<=parseFloat(Su),wu=null,Au={},Ru=new I,Pu=new I,Cu={};return Cu[gc.TEXTURE_2D]=Ec(gc.TEXTURE_2D,gc.TEXTURE_2D,1),Cu[gc.TEXTURE_CUBE_MAP]=Ec(gc.TEXTURE_CUBE_MAP,gc.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:$c,depth:eu,stencil:tu},init:function(){$c.setClear(0,0,0,1),eu.setClear(1),tu.setClear(0),Ac(gc.DEPTH_TEST),zc(In),Gc(!1),Hc(ki),Ac(gc.CULL_FACE),Ac(gc.BLEND),Cc(sn)},initAttributes:function(){for(var Iu=0,Uu=au.length;Iu<Uu;Iu++)au[Iu]=0},enableAttribute:function(Iu){if(au[Iu]=1,0===ou[Iu]&&(gc.enableVertexAttribArray(Iu),ou[Iu]=1),0!==iu[Iu]){var Uu=hc.get('ANGLE_instanced_arrays');Uu.vertexAttribDivisorANGLE(Iu,0),iu[Iu]=0}},enableAttributeAndDivisor:function(Iu,Uu,Du){au[Iu]=1,0===ou[Iu]&&(gc.enableVertexAttribArray(Iu),ou[Iu]=1),iu[Iu]!==Uu&&(Du.vertexAttribDivisorANGLE(Iu,Uu),iu[Iu]=Uu)},disableUnusedAttributes:function(){for(var Iu=0,Uu=ou.length;Iu!==Uu;++Iu)ou[Iu]!==au[Iu]&&(gc.disableVertexAttribArray(Iu),ou[Iu]=0)},enable:Ac,disable:Rc,getCompressedTextureFormats:function(){if(null==lu&&(lu=[],hc.get('WEBGL_compressed_texture_pvrtc')||hc.get('WEBGL_compressed_texture_s3tc')||hc.get('WEBGL_compressed_texture_etc1')))for(var Iu=gc.getParameter(gc.COMPRESSED_TEXTURE_FORMATS),Uu=0;Uu<Iu.length;Uu++)lu.push(Iu[Uu]);return lu},setBlending:Cc,setColorWrite:function(Iu){$c.setMask(Iu)},setDepthTest:function(Iu){eu.setTest(Iu)},setDepthWrite:function(Iu){eu.setMask(Iu)},setDepthFunc:zc,setStencilTest:function(Iu){tu.setTest(Iu)},setStencilWrite:function(Iu){tu.setMask(Iu)},setStencilFunc:function(Iu,Uu,Du){tu.setFunc(Iu,Uu,Du)},setStencilOp:function(Iu,Uu,Du){tu.setOp(Iu,Uu,Du)},setFlipSided:Gc,setCullFace:Hc,setLineWidth:function(Iu){Iu!==_u&&(Lu&&gc.lineWidth(Iu),_u=Iu)},setPolygonOffset:function(Iu,Uu,Du){Iu?(Ac(gc.POLYGON_OFFSET_FILL),(bu!==Uu||Eu!==Du)&&(gc.polygonOffset(Uu,Du),bu=Uu,Eu=Du)):Rc(gc.POLYGON_OFFSET_FILL)},getScissorTest:function(){return Tu},setScissorTest:function(Iu){Tu=Iu,Iu?Ac(gc.SCISSOR_TEST):Rc(gc.SCISSOR_TEST)},activeTexture:Xc,bindTexture:function(Iu,Uu){null===wu&&Xc();var Du=Au[wu];void 0===Du&&(Du={type:void 0,texture:void 0},Au[wu]=Du),(Du.type!==Iu||Du.texture!==Uu)&&(gc.bindTexture(Iu,Uu||Cu[Iu]),Du.type=Iu,Du.texture=Uu)},compressedTexImage2D:function(){try{gc.compressedTexImage2D.apply(gc,arguments)}catch(Iu){}},texImage2D:function(){try{gc.texImage2D.apply(gc,arguments)}catch(Iu){}},scissor:function(Iu){!1===Ru.equals(Iu)&&(gc.scissor(Iu.x,Iu.y,Iu.z,Iu.w),Ru.copy(Iu))},viewport:function(Iu){!1===Pu.equals(Iu)&&(gc.viewport(Iu.x,Iu.y,Iu.z,Iu.w),Pu.copy(Iu))},reset:function(){for(var Iu=0;Iu<ou.length;Iu++)1===ou[Iu]&&(gc.disableVertexAttribArray(Iu),ou[Iu]=0);nu={},lu=null,wu=null,Au={},du=null,xu=null,vu=null,$c.reset(),eu.reset(),tu.reset()}}}function qt(gc,hc,yc){function vc(Nc){if('highp'===Nc){if(0<gc.getShaderPrecisionFormat(gc.VERTEX_SHADER,gc.HIGH_FLOAT).precision&&0<gc.getShaderPrecisionFormat(gc.FRAGMENT_SHADER,gc.HIGH_FLOAT).precision)return'highp';Nc='mediump'}return'mediump'===Nc&&0<gc.getShaderPrecisionFormat(gc.VERTEX_SHADER,gc.MEDIUM_FLOAT).precision&&0<gc.getShaderPrecisionFormat(gc.FRAGMENT_SHADER,gc.MEDIUM_FLOAT).precision?'mediump':'lowp'}var _c,Ec=yc.precision===void 0?'highp':yc.precision,Tc=vc(Ec);Tc!==Ec&&(void 0,Ec=Tc);var Mc=!0===yc.logarithmicDepthBuffer&&!!hc.get('EXT_frag_depth'),Sc=gc.getParameter(gc.MAX_TEXTURE_IMAGE_UNITS),Lc=gc.getParameter(gc.MAX_VERTEX_TEXTURE_IMAGE_UNITS),wc=gc.getParameter(gc.MAX_TEXTURE_SIZE),Ac=gc.getParameter(gc.MAX_CUBE_MAP_TEXTURE_SIZE),Rc=gc.getParameter(gc.MAX_VERTEX_ATTRIBS),Pc=gc.getParameter(gc.MAX_VERTEX_UNIFORM_VECTORS),Cc=gc.getParameter(gc.MAX_VARYING_VECTORS),Ic=gc.getParameter(gc.MAX_FRAGMENT_UNIFORM_VECTORS),Uc=0<Lc,Dc=!!hc.get('OES_texture_float');return{getMaxAnisotropy:function(){if(void 0!=_c)return _c;var Nc=hc.get('EXT_texture_filter_anisotropic');return _c=null===Nc?0:gc.getParameter(Nc.MAX_TEXTURE_MAX_ANISOTROPY_EXT),_c},getMaxPrecision:vc,precision:Ec,logarithmicDepthBuffer:Mc,maxTextures:Sc,maxVertexTextures:Lc,maxTextureSize:wc,maxCubemapSize:Ac,maxAttributes:Rc,maxVertexUniforms:Pc,maxVaryings:Cc,maxFragmentUniforms:Ic,vertexTextures:Uc,floatFragmentTextures:Dc,floatVertexTextures:Uc&&Dc}}function Zt(gc){var hc={};return{get:function(yc){if(void 0!==hc[yc])return hc[yc];var xc;return xc='WEBGL_depth_texture'===yc?gc.getExtension('WEBGL_depth_texture')||gc.getExtension('MOZ_WEBGL_depth_texture')||gc.getExtension('WEBKIT_WEBGL_depth_texture'):'EXT_texture_filter_anisotropic'===yc?gc.getExtension('EXT_texture_filter_anisotropic')||gc.getExtension('MOZ_EXT_texture_filter_anisotropic')||gc.getExtension('WEBKIT_EXT_texture_filter_anisotropic'):'WEBGL_compressed_texture_s3tc'===yc?gc.getExtension('WEBGL_compressed_texture_s3tc')||gc.getExtension('MOZ_WEBGL_compressed_texture_s3tc')||gc.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc'):'WEBGL_compressed_texture_pvrtc'===yc?gc.getExtension('WEBGL_compressed_texture_pvrtc')||gc.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc'):'WEBGL_compressed_texture_etc1'===yc?gc.getExtension('WEBGL_compressed_texture_etc1'):gc.getExtension(yc),hc[yc]=xc,xc}}}function Kt(){function gc(){Sc.value!==xc&&(Sc.value=xc,Sc.needsUpdate=0<vc),yc.numPlanes=vc,yc.numIntersection=0}function hc(Lc,wc,Ac,Rc){var Pc=null===Lc?0:Lc.length,Cc=null;if(0!==Pc){if(Cc=Sc.value,!0!==Rc||null===Cc){var Ic=Ac+4*Pc,Uc=wc.matrixWorldInverse;Mc.getNormalMatrix(Uc),(null===Cc||Cc.length<Ic)&&(Cc=new Float32Array(Ic));for(var Dc=0,zc=Ac;Dc!==Pc;++Dc,zc+=4)Tc.copy(Lc[Dc]).applyMatrix4(Uc,Mc),Tc.normal.toArray(Cc,zc),Cc[zc+3]=Tc.constant}Sc.value=Cc,Sc.needsUpdate=!0}return yc.numPlanes=Pc,Cc}var yc=this,xc=null,vc=0,_c=!1,Ec=!1,Tc=new ke,Mc=new Ve,Sc={value:null,needsUpdate:!1};this.uniform=Sc,this.numPlanes=0,this.numIntersection=0,this.init=function(Lc,wc,Ac){var Rc=0!==Lc.length||wc||0!=vc||_c;return _c=wc,xc=hc(Lc,Ac,0),vc=Lc.length,Rc},this.beginShadows=function(){Ec=!0,hc(null)},this.endShadows=function(){Ec=!1,gc()},this.setState=function(Lc,wc,Ac,Rc,Pc,Cc){if(!_c||null===Lc||0===Lc.length||Ec&&!Ac)Ec?hc(null):gc();else{var Ic=Ec?0:vc,Uc=4*Ic,Dc=Pc.clippingState||null;Sc.value=Dc,Dc=hc(Lc,Rc,Uc,Cc);for(var zc=0;zc!==Uc;++zc)Dc[zc]=xc[zc];Pc.clippingState=Dc,this.numIntersection=wc?this.numPlanes:0,this.numPlanes+=Ic}}}function Jt(gc){function hc(){return null==vu?Iu:1}function yc(){Ju.init(),Ju.scissor(Mu.copy(Uu).multiplyScalar(Iu)),Ju.viewport(Lu.copy(zu).multiplyScalar(Iu)),Ju.buffers.color.setClear(Au.r,Au.g,Au.b,Ru,iu)}function xc(){xu=null,Tu=null,Eu='',bu=-1,Ju.reset()}function vc(um){um.preventDefault(),xc(),yc(),Qu.clear()}function _c(um){var mm=um.target;mm.removeEventListener('dispose',_c),Ec(mm)}function Ec(um){Tc(um),Qu.delete(um)}function Tc(um){var mm=Qu.get(um).program;um.program=void 0,mm!==void 0&&tm.releaseProgram(mm)}function Mc(um,mm,fm,gm){var hm;if(!(fm&&fm.isInstancedBufferGeometry&&(hm=Zu.get('ANGLE_instanced_arrays'),null===hm))){void 0===gm&&(gm=0),Ju.initAttributes();var ym=fm.attributes,xm=mm.getAttributes(),vm=um.defaultAttributeValues;for(var _m in xm){var bm=xm[_m];if(0<=bm){var Em=ym[_m];if(void 0!==Em){var Tm=Em.normalized,Mm=Em.itemSize,Sm=em.getAttributeProperties(Em),Lm=Sm.__webglBuffer,wm=Sm.type,Am=Sm.bytesPerElement;if(Em.isInterleavedBufferAttribute){var Rm=Em.data,Pm=Rm.stride,Cm=Em.offset;Rm&&Rm.isInstancedInterleavedBuffer?(Ju.enableAttributeAndDivisor(bm,Rm.meshPerAttribute,hm),void 0===fm.maxInstancedCount&&(fm.maxInstancedCount=Rm.meshPerAttribute*Rm.count)):Ju.enableAttribute(bm),Yu.bindBuffer(Yu.ARRAY_BUFFER,Lm),Yu.vertexAttribPointer(bm,Mm,wm,Tm,Pm*Am,(gm*Pm+Cm)*Am)}else Em.isInstancedBufferAttribute?(Ju.enableAttributeAndDivisor(bm,Em.meshPerAttribute,hm),void 0===fm.maxInstancedCount&&(fm.maxInstancedCount=Em.meshPerAttribute*Em.count)):Ju.enableAttribute(bm),Yu.bindBuffer(Yu.ARRAY_BUFFER,Lm),Yu.vertexAttribPointer(bm,Mm,wm,Tm,0,gm*Mm*Am)}else if(void 0!==vm){var Im=vm[_m];if(void 0!==Im)switch(Im.length){case 2:Yu.vertexAttrib2fv(bm,Im);break;case 3:Yu.vertexAttrib3fv(bm,Im);break;case 4:Yu.vertexAttrib4fv(bm,Im);break;default:Yu.vertexAttrib1fv(bm,Im);}}}}Ju.disableUnusedAttributes()}}function Sc(um,mm){return _Mathabs(mm[0])-_Mathabs(um[0])}function Lc(um,mm){return um.object.renderOrder===mm.object.renderOrder?um.material.program&&mm.material.program&&um.material.program!==mm.material.program?um.material.program.id-mm.material.program.id:um.material.id===mm.material.id?um.z===mm.z?um.id-mm.id:um.z-mm.z:um.material.id-mm.material.id:um.object.renderOrder-mm.object.renderOrder}function wc(um,mm){return um.object.renderOrder===mm.object.renderOrder?um.z===mm.z?um.id-mm.id:mm.z-um.z:um.object.renderOrder-mm.object.renderOrder}function Ac(um,mm,fm,gm,hm){var ym,xm;fm.transparent?(ym=uu,xm=++mu):(ym=du,xm=++pu);var vm=ym[xm];vm===void 0?(vm={id:um.id,object:um,geometry:mm,material:fm,z:Vu.z,group:hm},ym.push(vm)):(vm.id=um.id,vm.object=um,vm.geometry=mm,vm.material=fm,vm.z=Vu.z,vm.group=hm)}function Rc(um){var mm=um.geometry;return null===mm.boundingSphere&&mm.computeBoundingSphere(),Gu.copy(mm.boundingSphere).applyMatrix4(um.matrixWorld),Cc(Gu)}function Pc(um){return Gu.center.set(0,0,0),Gu.radius=0.7071067811865476,Gu.applyMatrix4(um.matrixWorld),Cc(Gu)}function Cc(um){if(!Nu.intersectsSphere(um))return!1;var mm=Bu.numPlanes;if(0===mm)return!0;var fm=yu.clippingPlanes,gm=um.center,hm=-um.radius,ym=0;do if(fm[ym].distanceToPoint(gm)<hm)return!1;while(++ym!==mm);return!0}function Ic(um,mm){if(!1!==um.visible){var fm=0!=(um.layers.mask&mm.layers.mask);if(fm)if(um.isLight)lu.push(um);else if(um.isSprite)(!1===um.frustumCulled||!0===Pc(um))&&gu.push(um);else if(um.isLensFlare)hu.push(um);else if(um.isImmediateRenderObject)!0===yu.sortObjects&&(Vu.setFromMatrixPosition(um.matrixWorld),Vu.applyMatrix4(Hu)),Ac(um,null,um.material,Vu.z,null);else if((um.isMesh||um.isLine||um.isPoints)&&(um.isSkinnedMesh&&um.skeleton.update(),!1===um.frustumCulled||!0===Rc(um))){var gm=um.material;if(!0===gm.visible){!0===yu.sortObjects&&(Vu.setFromMatrixPosition(um.matrixWorld),Vu.applyMatrix4(Hu));var hm=em.update(um);if(gm.isMultiMaterial)for(var ym=hm.groups,xm=gm.materials,vm=0,_m=ym.length;vm<_m;vm++){var bm=ym[vm],Em=xm[bm.materialIndex];!0===Em.visible&&Ac(um,hm,Em,Vu.z,bm)}else Ac(um,hm,gm,Vu.z,null)}}for(var Tm=um.children,vm=0,_m=Tm.length;vm<_m;vm++)Ic(Tm[vm],mm)}}function Uc(um,mm,fm,gm){for(var hm=0,ym=um.length;hm<ym;hm++){var xm=um[hm],vm=xm.object,_m=xm.geometry,bm=void 0===gm?xm.material:gm,Em=xm.group;if(vm.modelViewMatrix.multiplyMatrices(fm.matrixWorldInverse,vm.matrixWorld),vm.normalMatrix.getNormalMatrix(vm.modelViewMatrix),vm.onBeforeRender(yu,mm,fm,_m,bm,Em),vm.isImmediateRenderObject){zc(bm);var Tm=Nc(fm,mm.fog,bm,vm);Eu='',vm.render(function(Mm){yu.renderBufferImmediate(Mm,Tm,bm)})}else yu.renderBufferDirect(fm,mm.fog,_m,bm,vm,Em);vm.onAfterRender(yu,mm,fm,_m,bm,Em)}}function Dc(um,mm,fm){var gm=Qu.get(um),hm=tm.getParameters(um,ju,mm,Bu.numPlanes,Bu.numIntersection,fm),ym=tm.getProgramCode(um,hm),xm=gm.program,vm=!0;if(xm===void 0)um.addEventListener('dispose',_c);else if(xm.code!==ym)Tc(um);else{if(hm.shaderID!==void 0)return;vm=!1}if(vm){if(hm.shaderID){var _m=Vp[hm.shaderID];gm.__webglShader={name:um.type,uniforms:wl.clone(_m.uniforms),vertexShader:_m.vertexShader,fragmentShader:_m.fragmentShader}}else gm.__webglShader={name:um.type,uniforms:um.uniforms,vertexShader:um.vertexShader,fragmentShader:um.fragmentShader};um.__webglShader=gm.__webglShader,xm=tm.acquireProgram(um,hm,ym),gm.program=xm,um.program=xm}var bm=xm.getAttributes();if(um.morphTargets){um.numSupportedMorphTargets=0;for(var Em=0;Em<yu.maxMorphTargets;Em++)0<=bm['morphTarget'+Em]&&um.numSupportedMorphTargets++}if(um.morphNormals){um.numSupportedMorphNormals=0;for(var Em=0;Em<yu.maxMorphNormals;Em++)0<=bm['morphNormal'+Em]&&um.numSupportedMorphNormals++}var Tm=gm.__webglShader.uniforms;(um.isShaderMaterial||um.isRawShaderMaterial)&&!0!==um.clipping||(gm.numClippingPlanes=Bu.numPlanes,gm.numIntersection=Bu.numIntersection,Tm.clippingPlanes=Bu.uniform),gm.fog=mm,gm.lightsHash=ju.hash,um.lights&&(Tm.ambientLightColor.value=ju.ambient,Tm.directionalLights.value=ju.directional,Tm.spotLights.value=ju.spot,Tm.rectAreaLights.value=ju.rectArea,Tm.pointLights.value=ju.point,Tm.hemisphereLights.value=ju.hemi,Tm.directionalShadowMap.value=ju.directionalShadowMap,Tm.directionalShadowMatrix.value=ju.directionalShadowMatrix,Tm.spotShadowMap.value=ju.spotShadowMap,Tm.spotShadowMatrix.value=ju.spotShadowMatrix,Tm.pointShadowMap.value=ju.pointShadowMap,Tm.pointShadowMatrix.value=ju.pointShadowMatrix);var Mm=gm.program.getUniforms(),Sm=Ce.seqWithValue(Mm.seq,Tm);gm.uniformsList=Sm}function zc(um){um.side===$i?Ju.disable(Yu.CULL_FACE):Ju.enable(Yu.CULL_FACE),Ju.setFlipSided(um.side===Qi),!0===um.transparent?Ju.setBlending(um.blending,um.blendEquation,um.blendSrc,um.blendDst,um.blendEquationAlpha,um.blendSrcAlpha,um.blendDstAlpha,um.premultipliedAlpha):Ju.setBlending(nn),Ju.setDepthFunc(um.depthFunc),Ju.setDepthTest(um.depthTest),Ju.setDepthWrite(um.depthWrite),Ju.setColorWrite(um.colorWrite),Ju.setPolygonOffset(um.polygonOffset,um.polygonOffsetFactor,um.polygonOffsetUnits)}function Nc(um,mm,fm,gm){wu=0;var hm=Qu.get(fm);if(Fu&&(Ou||um!==Tu)){var ym=um===Tu&&fm.id===bu;Bu.setState(fm.clippingPlanes,fm.clipIntersection,fm.clipShadows,um,hm,ym)}!1===fm.needsUpdate&&(void 0===hm.program?fm.needsUpdate=!0:fm.fog&&hm.fog!==mm?fm.needsUpdate=!0:fm.lights&&hm.lightsHash!==ju.hash?fm.needsUpdate=!0:void 0!==hm.numClippingPlanes&&(hm.numClippingPlanes!==Bu.numPlanes||hm.numIntersection!==Bu.numIntersection)&&(fm.needsUpdate=!0)),fm.needsUpdate&&(Dc(fm,mm,gm),fm.needsUpdate=!1);var xm=!1,vm=!1,_m=!1,bm=hm.program,Em=bm.getUniforms(),Tm=hm.__webglShader.uniforms;if(bm.id!==xu&&(Yu.useProgram(bm.program),xu=bm.id,xm=!0,vm=!0,_m=!0),fm.id!==bu&&(bu=fm.id,vm=!0),xm||um!==Tu){if(Em.set(Yu,um,'projectionMatrix'),Ku.logarithmicDepthBuffer&&Em.setValue(Yu,'logDepthBufFC',2/(_Mathlog(um.far+1)/_MathLN)),um!==Tu&&(Tu=um,vm=!0,_m=!0),fm.isShaderMaterial||fm.isMeshPhongMaterial||fm.isMeshStandardMaterial||fm.envMap){var Mm=Em.map.cameraPosition;void 0!==Mm&&Mm.setValue(Yu,Vu.setFromMatrixPosition(um.matrixWorld))}(fm.isMeshPhongMaterial||fm.isMeshLambertMaterial||fm.isMeshBasicMaterial||fm.isMeshStandardMaterial||fm.isShaderMaterial||fm.skinning)&&Em.setValue(Yu,'viewMatrix',um.matrixWorldInverse),Em.set(Yu,yu,'toneMappingExposure'),Em.set(Yu,yu,'toneMappingWhitePoint')}if(fm.skinning){Em.setOptional(Yu,gm,'bindMatrix'),Em.setOptional(Yu,gm,'bindMatrixInverse');var Sm=gm.skeleton;Sm&&(Ku.floatVertexTextures&&Sm.useVertexTexture?(Em.set(Yu,Sm,'boneTexture'),Em.set(Yu,Sm,'boneTextureWidth'),Em.set(Yu,Sm,'boneTextureHeight')):Em.setOptional(Yu,Sm,'boneMatrices'))}return vm&&(fm.lights&&qc(Tm,_m),mm&&fm.fog&&Hc(Tm,mm),(fm.isMeshBasicMaterial||fm.isMeshLambertMaterial||fm.isMeshPhongMaterial||fm.isMeshStandardMaterial||fm.isMeshNormalMaterial||fm.isMeshDepthMaterial)&&Bc(Tm,fm),fm.isLineBasicMaterial?Fc(Tm,fm):fm.isLineDashedMaterial?(Fc(Tm,fm),Oc(Tm,fm)):fm.isPointsMaterial?Gc(Tm,fm):fm.isMeshLambertMaterial?Vc(Tm,fm):fm.isMeshToonMaterial?Wc(Tm,fm):fm.isMeshPhongMaterial?kc(Tm,fm):fm.isMeshPhysicalMaterial?Xc(Tm,fm):fm.isMeshStandardMaterial?jc(Tm,fm):fm.isMeshDepthMaterial?fm.displacementMap&&(Tm.displacementMap.value=fm.displacementMap,Tm.displacementScale.value=fm.displacementScale,Tm.displacementBias.value=fm.displacementBias):fm.isMeshNormalMaterial&&Yc(Tm,fm),void 0!==Tm.ltcMat&&(Tm.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE),void 0!==Tm.ltcMag&&(Tm.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE),Ce.upload(Yu,hm.uniformsList,Tm,yu)),Em.set(Yu,gm,'modelViewMatrix'),Em.set(Yu,gm,'normalMatrix'),Em.setValue(Yu,'modelMatrix',gm.matrixWorld),bm}function Bc(um,mm){um.opacity.value=mm.opacity,um.diffuse.value=mm.color,mm.emissive&&um.emissive.value.copy(mm.emissive).multiplyScalar(mm.emissiveIntensity),um.map.value=mm.map,um.specularMap.value=mm.specularMap,um.alphaMap.value=mm.alphaMap,mm.lightMap&&(um.lightMap.value=mm.lightMap,um.lightMapIntensity.value=mm.lightMapIntensity),mm.aoMap&&(um.aoMap.value=mm.aoMap,um.aoMapIntensity.value=mm.aoMapIntensity);var fm;if(mm.map?fm=mm.map:mm.specularMap?fm=mm.specularMap:mm.displacementMap?fm=mm.displacementMap:mm.normalMap?fm=mm.normalMap:mm.bumpMap?fm=mm.bumpMap:mm.roughnessMap?fm=mm.roughnessMap:mm.metalnessMap?fm=mm.metalnessMap:mm.alphaMap?fm=mm.alphaMap:mm.emissiveMap&&(fm=mm.emissiveMap),void 0!==fm){fm.isWebGLRenderTarget&&(fm=fm.texture);var gm=fm.offset,hm=fm.repeat;um.offsetRepeat.value.set(gm.x,gm.y,hm.x,hm.y)}um.envMap.value=mm.envMap,um.flipEnvMap.value=mm.envMap&&mm.envMap.isCubeTexture?-1:1,um.reflectivity.value=mm.reflectivity,um.refractionRatio.value=mm.refractionRatio}function Fc(um,mm){um.diffuse.value=mm.color,um.opacity.value=mm.opacity}function Oc(um,mm){um.dashSize.value=mm.dashSize,um.totalSize.value=mm.dashSize+mm.gapSize,um.scale.value=mm.scale}function Gc(um,mm){if(um.diffuse.value=mm.color,um.opacity.value=mm.opacity,um.size.value=mm.size*Iu,um.scale.value=0.5*Cu,um.map.value=mm.map,null!==mm.map){var fm=mm.map.offset,gm=mm.map.repeat;um.offsetRepeat.value.set(fm.x,fm.y,gm.x,gm.y)}}function Hc(um,mm){um.fogColor.value=mm.color,mm.isFog?(um.fogNear.value=mm.near,um.fogFar.value=mm.far):mm.isFogExp2&&(um.fogDensity.value=mm.density)}function Vc(um,mm){mm.emissiveMap&&(um.emissiveMap.value=mm.emissiveMap)}function kc(um,mm){um.specular.value=mm.specular,um.shininess.value=_Mathmax(mm.shininess,1e-4),mm.emissiveMap&&(um.emissiveMap.value=mm.emissiveMap),mm.bumpMap&&(um.bumpMap.value=mm.bumpMap,um.bumpScale.value=mm.bumpScale),mm.normalMap&&(um.normalMap.value=mm.normalMap,um.normalScale.value.copy(mm.normalScale)),mm.displacementMap&&(um.displacementMap.value=mm.displacementMap,um.displacementScale.value=mm.displacementScale,um.displacementBias.value=mm.displacementBias)}function Wc(um,mm){kc(um,mm),mm.gradientMap&&(um.gradientMap.value=mm.gradientMap)}function jc(um,mm){um.roughness.value=mm.roughness,um.metalness.value=mm.metalness,mm.roughnessMap&&(um.roughnessMap.value=mm.roughnessMap),mm.metalnessMap&&(um.metalnessMap.value=mm.metalnessMap),mm.emissiveMap&&(um.emissiveMap.value=mm.emissiveMap),mm.bumpMap&&(um.bumpMap.value=mm.bumpMap,um.bumpScale.value=mm.bumpScale),mm.normalMap&&(um.normalMap.value=mm.normalMap,um.normalScale.value.copy(mm.normalScale)),mm.displacementMap&&(um.displacementMap.value=mm.displacementMap,um.displacementScale.value=mm.displacementScale,um.displacementBias.value=mm.displacementBias),mm.envMap&&(um.envMapIntensity.value=mm.envMapIntensity)}function Xc(um,mm){um.clearCoat.value=mm.clearCoat,um.clearCoatRoughness.value=mm.clearCoatRoughness,jc(um,mm)}function Yc(um,mm){mm.bumpMap&&(um.bumpMap.value=mm.bumpMap,um.bumpScale.value=mm.bumpScale),mm.normalMap&&(um.normalMap.value=mm.normalMap,um.normalScale.value.copy(mm.normalScale)),mm.displacementMap&&(um.displacementMap.value=mm.displacementMap,um.displacementScale.value=mm.displacementScale,um.displacementBias.value=mm.displacementBias)}function qc(um,mm){um.ambientLightColor.needsUpdate=mm,um.directionalLights.needsUpdate=mm,um.pointLights.needsUpdate=mm,um.spotLights.needsUpdate=mm,um.rectAreaLights.needsUpdate=mm,um.hemisphereLights.needsUpdate=mm}function Zc(um){for(var mm=0,fm=0,gm=um.length,hm;fm<gm;fm++)hm=um[fm],hm.castShadow&&(ju.shadows[mm++]=hm);ju.shadows.length=mm}function Kc(um,mm){var ym=0,xm=0,vm=0,Mm=mm.matrixWorldInverse,Sm=0,Lm=0,wm=0,Am=0,Rm=0,fm,gm,hm,_m,bm,Em,Tm;for(fm=0,gm=um.length;fm<gm;fm++)if(hm=um[fm],_m=hm.color,bm=hm.intensity,Em=hm.distance,Tm=hm.shadow&&hm.shadow.map?hm.shadow.map.texture:null,hm.isAmbientLight)ym+=_m.r*bm,xm+=_m.g*bm,vm+=_m.b*bm;else if(hm.isDirectionalLight){var Pm=rm.get(hm);Pm.color.copy(hm.color).multiplyScalar(hm.intensity),Pm.direction.setFromMatrixPosition(hm.matrixWorld),Vu.setFromMatrixPosition(hm.target.matrixWorld),Pm.direction.sub(Vu),Pm.direction.transformDirection(Mm),Pm.shadow=hm.castShadow,hm.castShadow&&(Pm.shadowBias=hm.shadow.bias,Pm.shadowRadius=hm.shadow.radius,Pm.shadowMapSize=hm.shadow.mapSize),ju.directionalShadowMap[Sm]=Tm,ju.directionalShadowMatrix[Sm]=hm.shadow.matrix,ju.directional[Sm++]=Pm}else if(hm.isSpotLight){var Pm=rm.get(hm);Pm.position.setFromMatrixPosition(hm.matrixWorld),Pm.position.applyMatrix4(Mm),Pm.color.copy(_m).multiplyScalar(bm),Pm.distance=Em,Pm.direction.setFromMatrixPosition(hm.matrixWorld),Vu.setFromMatrixPosition(hm.target.matrixWorld),Pm.direction.sub(Vu),Pm.direction.transformDirection(Mm),Pm.coneCos=_Mathcos(hm.angle),Pm.penumbraCos=_Mathcos(hm.angle*(1-hm.penumbra)),Pm.decay=0===hm.distance?0:hm.decay,Pm.shadow=hm.castShadow,hm.castShadow&&(Pm.shadowBias=hm.shadow.bias,Pm.shadowRadius=hm.shadow.radius,Pm.shadowMapSize=hm.shadow.mapSize),ju.spotShadowMap[wm]=Tm,ju.spotShadowMatrix[wm]=hm.shadow.matrix,ju.spot[wm++]=Pm}else if(hm.isRectAreaLight){var Pm=rm.get(hm);Pm.color.copy(_m).multiplyScalar(bm/(hm.width*hm.height)),Pm.position.setFromMatrixPosition(hm.matrixWorld),Pm.position.applyMatrix4(Mm),Wu.identity(),ku.copy(hm.matrixWorld),ku.premultiply(Mm),Wu.extractRotation(ku),Pm.halfWidth.set(0.5*hm.width,0,0),Pm.halfHeight.set(0,0.5*hm.height,0),Pm.halfWidth.applyMatrix4(Wu),Pm.halfHeight.applyMatrix4(Wu),ju.rectArea[Am++]=Pm}else if(hm.isPointLight){var Pm=rm.get(hm);Pm.position.setFromMatrixPosition(hm.matrixWorld),Pm.position.applyMatrix4(Mm),Pm.color.copy(hm.color).multiplyScalar(hm.intensity),Pm.distance=hm.distance,Pm.decay=0===hm.distance?0:hm.decay,Pm.shadow=hm.castShadow,hm.castShadow&&(Pm.shadowBias=hm.shadow.bias,Pm.shadowRadius=hm.shadow.radius,Pm.shadowMapSize=hm.shadow.mapSize),ju.pointShadowMap[Lm]=Tm,void 0===ju.pointShadowMatrix[Lm]&&(ju.pointShadowMatrix[Lm]=new G),Vu.setFromMatrixPosition(hm.matrixWorld).negate(),ju.pointShadowMatrix[Lm].identity().setPosition(Vu),ju.point[Lm++]=Pm}else if(hm.isHemisphereLight){var Pm=rm.get(hm);Pm.direction.setFromMatrixPosition(hm.matrixWorld),Pm.direction.transformDirection(Mm),Pm.direction.normalize(),Pm.skyColor.copy(hm.color).multiplyScalar(bm),Pm.groundColor.copy(hm.groundColor).multiplyScalar(bm),ju.hemi[Rm++]=Pm}ju.ambient[0]=ym,ju.ambient[1]=xm,ju.ambient[2]=vm,ju.directional.length=Sm,ju.spot.length=wm,ju.rectArea.length=Am,ju.point.length=Lm,ju.hemi.length=Rm,ju.hash=Sm+','+Lm+','+wm+','+Am+','+Rm+','+ju.shadows.length}function Qc(um){var mm;if(um===$n)return Yu.REPEAT;if(um===es)return Yu.CLAMP_TO_EDGE;if(um===ts)return Yu.MIRRORED_REPEAT;if(um===as)return Yu.NEAREST;if(um===os)return Yu.NEAREST_MIPMAP_NEAREST;if(um===is)return Yu.NEAREST_MIPMAP_LINEAR;if(um===ns)return Yu.LINEAR;if(um===ss)return Yu.LINEAR_MIPMAP_NEAREST;if(um===ls)return Yu.LINEAR_MIPMAP_LINEAR;if(um===ds)return Yu.UNSIGNED_BYTE;if(um===xs)return Yu.UNSIGNED_SHORT_4_4_4_4;if(um===vs)return Yu.UNSIGNED_SHORT_5_5_5_1;if(um===_s)return Yu.UNSIGNED_SHORT_5_6_5;if(um===ps)return Yu.BYTE;if(um===us)return Yu.SHORT;if(um===ms)return Yu.UNSIGNED_SHORT;if(um===fs)return Yu.INT;if(um===gs)return Yu.UNSIGNED_INT;if(um===hs)return Yu.FLOAT;if(um===ys&&(mm=Zu.get('OES_texture_half_float'),null!==mm))return mm.HALF_FLOAT_OES;if(um===Ts)return Yu.ALPHA;if(um===Ms)return Yu.RGB;if(um===Ss)return Yu.RGBA;if(um===Ls)return Yu.LUMINANCE;if(um===ws)return Yu.LUMINANCE_ALPHA;if(um===Rs)return Yu.DEPTH_COMPONENT;if(um===Ps)return Yu.DEPTH_STENCIL;if(um===un)return Yu.FUNC_ADD;if(um===mn)return Yu.FUNC_SUBTRACT;if(um===gn)return Yu.FUNC_REVERSE_SUBTRACT;if(um===xn)return Yu.ZERO;if(um===vn)return Yu.ONE;if(um===_n)return Yu.SRC_COLOR;if(um===bn)return Yu.ONE_MINUS_SRC_COLOR;if(um===En)return Yu.SRC_ALPHA;if(um===Tn)return Yu.ONE_MINUS_SRC_ALPHA;if(um===Mn)return Yu.DST_ALPHA;if(um===Sn)return Yu.ONE_MINUS_DST_ALPHA;if(um===Ln)return Yu.DST_COLOR;if(um===wn)return Yu.ONE_MINUS_DST_COLOR;if(um===An)return Yu.SRC_ALPHA_SATURATE;if((um===Cs||um===Is||um===Us||um===Ds)&&(mm=Zu.get('WEBGL_compressed_texture_s3tc'),null!==mm)){if(um===Cs)return mm.COMPRESSED_RGB_S3TC_DXT1_EXT;if(um===Is)return mm.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(um===Us)return mm.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(um===Ds)return mm.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((um===zs||um===Ns||um===Bs||um===Fs)&&(mm=Zu.get('WEBGL_compressed_texture_pvrtc'),null!==mm)){if(um===zs)return mm.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(um===Ns)return mm.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(um===Bs)return mm.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(um===Fs)return mm.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(um===Os&&(mm=Zu.get('WEBGL_compressed_texture_etc1'),null!==mm))return mm.COMPRESSED_RGB_ETC1_WEBGL;if((um===hn||um===yn)&&(mm=Zu.get('EXT_blend_minmax'),null!==mm)){if(um===hn)return mm.MIN_EXT;if(um===yn)return mm.MAX_EXT}return um===Es&&(mm=Zu.get('WEBGL_depth_texture'),null!==mm)?mm.UNSIGNED_INT_24_8_WEBGL:0}void 0,gc=gc||{};var $c=gc.canvas===void 0?document.createElementNS('http://www.w3.org/1999/xhtml','canvas'):gc.canvas,eu=gc.context===void 0?null:gc.context,tu=gc.alpha!==void 0&&gc.alpha,ru=!(gc.depth!==void 0)||gc.depth,au=!(gc.stencil!==void 0)||gc.stencil,ou=gc.antialias!==void 0&&gc.antialias,iu=!(gc.premultipliedAlpha!==void 0)||gc.premultipliedAlpha,nu=gc.preserveDrawingBuffer!==void 0&&gc.preserveDrawingBuffer,lu=[],du=[],pu=-1,uu=[],mu=-1,fu=new Float32Array(8),gu=[],hu=[];this.domElement=$c,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Hn,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var yu=this,xu=null,vu=null,_u=null,bu=-1,Eu='',Tu=null,Mu=new I,Su=null,Lu=new I,wu=0,Au=new Ie(0),Ru=0,Pu=$c.width,Cu=$c.height,Iu=1,Uu=new I(0,0,Pu,Cu),Du=!1,zu=new I(0,0,Pu,Cu),Nu=new We,Bu=new Kt,Fu=!1,Ou=!1,Gu=new He,Hu=new G,Vu=new O,ku=new G,Wu=new G,ju={hash:'',ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},Xu={calls:0,vertices:0,faces:0,points:0};this.info={render:Xu,memory:{geometries:0,textures:0},programs:null};var Yu;try{var qu={alpha:tu,depth:ru,stencil:au,antialias:ou,premultipliedAlpha:iu,preserveDrawingBuffer:nu};if(Yu=eu||$c.getContext('webgl',qu)||$c.getContext('experimental-webgl',qu),null===Yu)if(null!==$c.getContext('webgl'))throw'Error creating WebGL context with your selected attributes.';else throw'Error creating WebGL context.';void 0===Yu.getShaderPrecisionFormat&&(Yu.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),$c.addEventListener('webglcontextlost',vc,!1)}catch(um){}var Zu=new Zt(Yu);Zu.get('WEBGL_depth_texture'),Zu.get('OES_texture_float'),Zu.get('OES_texture_float_linear'),Zu.get('OES_texture_half_float'),Zu.get('OES_texture_half_float_linear'),Zu.get('OES_standard_derivatives'),Zu.get('ANGLE_instanced_arrays'),Zu.get('OES_element_index_uint')&&(gt.MaxIndex=4294967296);var Ku=new qt(Yu,Zu,gc),Ju=new Yt(Yu,Zu,Qc),Qu=new Xt,$u=new jt(Yu,Zu,Ju,Qu,Ku,Qc,this.info),em=new Wt(Yu,Qu,this.info),tm=new Vt(this,Ku),rm=new wt;this.info.programs=tm.programs;var am=new Lt(Yu,Zu,Xu),om=new St(Yu,Zu,Xu),im,nm,sm,lm;yc(),this.context=Yu,this.capabilities=Ku,this.extensions=Zu,this.properties=Qu,this.state=Ju;var dm=new je(this,ju,em,Ku);this.shadowMap=dm;var pm=new Ne(this,gu),cm=new ze(this,hu);this.getContext=function(){return Yu},this.getContextAttributes=function(){return Yu.getContextAttributes()},this.forceContextLoss=function(){Zu.get('WEBGL_lose_context').loseContext()},this.getMaxAnisotropy=function(){return Ku.getMaxAnisotropy()},this.getPrecision=function(){return Ku.precision},this.getPixelRatio=function(){return Iu},this.setPixelRatio=function(um){void 0===um||(Iu=um,this.setSize(zu.z,zu.w,!1))},this.getSize=function(){return{width:Pu,height:Cu}},this.setSize=function(um,mm,fm){Pu=um,Cu=mm,$c.width=um*Iu,$c.height=mm*Iu,!1!==fm&&($c.style.width=um+'px',$c.style.height=mm+'px'),this.setViewport(0,0,um,mm)},this.setViewport=function(um,mm,fm,gm){Ju.viewport(zu.set(um,mm,fm,gm))},this.setScissor=function(um,mm,fm,gm){Ju.scissor(Uu.set(um,mm,fm,gm))},this.setScissorTest=function(um){Ju.setScissorTest(Du=um)},this.getClearColor=function(){return Au},this.setClearColor=function(um,mm){Au.set(um),Ru=mm===void 0?1:mm,Ju.buffers.color.setClear(Au.r,Au.g,Au.b,Ru,iu)},this.getClearAlpha=function(){return Ru},this.setClearAlpha=function(um){Ru=um,Ju.buffers.color.setClear(Au.r,Au.g,Au.b,Ru,iu)},this.clear=function(um,mm,fm){var gm=0;(um===void 0||um)&&(gm|=Yu.COLOR_BUFFER_BIT),(mm===void 0||mm)&&(gm|=Yu.DEPTH_BUFFER_BIT),(fm===void 0||fm)&&(gm|=Yu.STENCIL_BUFFER_BIT),Yu.clear(gm)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(um,mm,fm,gm){this.setRenderTarget(um),this.clear(mm,fm,gm)},this.resetGLState=xc,this.dispose=function(){uu=[],mu=-1,du=[],pu=-1,$c.removeEventListener('webglcontextlost',vc,!1)},this.renderBufferImmediate=function(um,mm,fm){Ju.initAttributes();var gm=Qu.get(um);um.hasPositions&&!gm.position&&(gm.position=Yu.createBuffer()),um.hasNormals&&!gm.normal&&(gm.normal=Yu.createBuffer()),um.hasUvs&&!gm.uv&&(gm.uv=Yu.createBuffer()),um.hasColors&&!gm.color&&(gm.color=Yu.createBuffer());var hm=mm.getAttributes();if(um.hasPositions&&(Yu.bindBuffer(Yu.ARRAY_BUFFER,gm.position),Yu.bufferData(Yu.ARRAY_BUFFER,um.positionArray,Yu.DYNAMIC_DRAW),Ju.enableAttribute(hm.position),Yu.vertexAttribPointer(hm.position,3,Yu.FLOAT,!1,0,0)),um.hasNormals){if(Yu.bindBuffer(Yu.ARRAY_BUFFER,gm.normal),!fm.isMeshPhongMaterial&&!fm.isMeshStandardMaterial&&!fm.isMeshNormalMaterial&&fm.shading===en)for(var ym=0,xm=3*um.count;ym<xm;ym+=9){var vm=um.normalArray,_m=(vm[ym+0]+vm[ym+3]+vm[ym+6])/3,bm=(vm[ym+1]+vm[ym+4]+vm[ym+7])/3,Em=(vm[ym+2]+vm[ym+5]+vm[ym+8])/3;vm[ym+0]=_m,vm[ym+1]=bm,vm[ym+2]=Em,vm[ym+3]=_m,vm[ym+4]=bm,vm[ym+5]=Em,vm[ym+6]=_m,vm[ym+7]=bm,vm[ym+8]=Em}Yu.bufferData(Yu.ARRAY_BUFFER,um.normalArray,Yu.DYNAMIC_DRAW),Ju.enableAttribute(hm.normal),Yu.vertexAttribPointer(hm.normal,3,Yu.FLOAT,!1,0,0)}um.hasUvs&&fm.map&&(Yu.bindBuffer(Yu.ARRAY_BUFFER,gm.uv),Yu.bufferData(Yu.ARRAY_BUFFER,um.uvArray,Yu.DYNAMIC_DRAW),Ju.enableAttribute(hm.uv),Yu.vertexAttribPointer(hm.uv,2,Yu.FLOAT,!1,0,0)),um.hasColors&&fm.vertexColors!==rn&&(Yu.bindBuffer(Yu.ARRAY_BUFFER,gm.color),Yu.bufferData(Yu.ARRAY_BUFFER,um.colorArray,Yu.DYNAMIC_DRAW),Ju.enableAttribute(hm.color),Yu.vertexAttribPointer(hm.color,3,Yu.FLOAT,!1,0,0)),Ju.disableUnusedAttributes(),Yu.drawArrays(Yu.TRIANGLES,0,um.count),um.count=0},this.renderBufferDirect=function(um,mm,fm,gm,hm,ym){zc(gm);var xm=Nc(um,mm,gm,hm),vm=!1,_m=fm.id+'_'+xm.id+'_'+gm.wireframe;_m!=Eu&&(Eu=_m,vm=!0);var bm=hm.morphTargetInfluences;if(bm!==void 0){for(var Em=[],Tm=0,Mm=bm.length,Sm;Tm<Mm;Tm++)Sm=bm[Tm],Em.push([Sm,Tm]);Em.sort(Sc),8<Em.length&&(Em.length=8);for(var Lm=fm.morphAttributes,Tm=0,Mm=Em.length,Sm;Tm<Mm;Tm++)if(Sm=Em[Tm],fu[Tm]=Sm[0],0!==Sm[0]){var wm=Sm[1];!0===gm.morphTargets&&Lm.position&&fm.addAttribute('morphTarget'+Tm,Lm.position[wm]),!0===gm.morphNormals&&Lm.normal&&fm.addAttribute('morphNormal'+Tm,Lm.normal[wm])}else!0===gm.morphTargets&&fm.removeAttribute('morphTarget'+Tm),!0===gm.morphNormals&&fm.removeAttribute('morphNormal'+Tm);for(var Tm=Em.length,Am=fu.length;Tm<Am;Tm++)fu[Tm]=0;xm.getUniforms().setValue(Yu,'morphTargetInfluences',fu),vm=!0}var wm=fm.index,Rm=fm.attributes.position,Pm=1;!0===gm.wireframe&&(wm=em.getWireframeAttribute(fm),Pm=2);var Cm;null===wm?Cm=am:(Cm=om,Cm.setIndex(wm)),vm&&(Mc(gm,xm,fm),null!==wm&&Yu.bindBuffer(Yu.ELEMENT_ARRAY_BUFFER,em.getAttributeBuffer(wm)));var Im=0;null===wm?Rm!==void 0&&(Im=Rm.count):Im=wm.count;var Um=fm.drawRange.start*Pm,Dm=fm.drawRange.count*Pm,zm=null===ym?0:ym.start*Pm,Nm=null===ym?Infinity:ym.count*Pm,Bm=_Mathmax(Um,zm),Fm=_Mathmin(Im,Um+Dm,zm+Nm)-1,Om=_Mathmax(0,Fm-Bm+1);if(0!==Om){if(hm.isMesh){if(!0===gm.wireframe)Ju.setLineWidth(gm.wireframeLinewidth*hc()),Cm.setMode(Yu.LINES);else switch(hm.drawMode){case Zs:Cm.setMode(Yu.TRIANGLES);break;case Ks:Cm.setMode(Yu.TRIANGLE_STRIP);break;case Js:Cm.setMode(Yu.TRIANGLE_FAN);}}else if(hm.isLine){var Gm=gm.linewidth;void 0===Gm&&(Gm=1),Ju.setLineWidth(Gm*hc()),hm.isLineSegments?Cm.setMode(Yu.LINES):Cm.setMode(Yu.LINE_STRIP)}else hm.isPoints&&Cm.setMode(Yu.POINTS);fm&&fm.isInstancedBufferGeometry?0<fm.maxInstancedCount&&Cm.renderInstances(fm,Bm,Om):Cm.render(Bm,Om)}},this.render=function(um,mm,fm,gm){if(void 0===mm||!0===mm.isCamera){Eu='',bu=-1,Tu=null,!0===um.autoUpdate&&um.updateMatrixWorld(),null===mm.parent&&mm.updateMatrixWorld(),mm.matrixWorldInverse.getInverse(mm.matrixWorld),Hu.multiplyMatrices(mm.projectionMatrix,mm.matrixWorldInverse),Nu.setFromMatrix(Hu),lu.length=0,pu=-1,mu=-1,gu.length=0,hu.length=0,Ou=this.localClippingEnabled,Fu=Bu.init(this.clippingPlanes,Ou,mm),Ic(um,mm),du.length=pu+1,uu.length=mu+1,!0===yu.sortObjects&&(du.sort(Lc),uu.sort(wc)),Fu&&Bu.beginShadows(),Zc(lu),dm.render(um,mm),Kc(lu,mm),Fu&&Bu.endShadows(),Xu.calls=0,Xu.vertices=0,Xu.faces=0,Xu.points=0,void 0===fm&&(fm=null),this.setRenderTarget(fm);var hm=um.background;if(null===hm?Ju.buffers.color.setClear(Au.r,Au.g,Au.b,Ru,iu):hm&&hm.isColor&&(Ju.buffers.color.setClear(hm.r,hm.g,hm.b,1,iu),gm=!0),(this.autoClear||gm)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),hm&&hm.isCubeTexture?(void 0==sm&&(sm=new Tt,lm=new ht(new xt(5,5,5),new Fe({uniforms:Vp.cube.uniforms,vertexShader:Vp.cube.vertexShader,fragmentShader:Vp.cube.fragmentShader,side:Qi,depthTest:!1,depthWrite:!1,fog:!1}))),sm.projectionMatrix.copy(mm.projectionMatrix),sm.matrixWorld.extractRotation(mm.matrixWorld),sm.matrixWorldInverse.getInverse(sm.matrixWorld),lm.material.uniforms.tCube.value=hm,lm.modelViewMatrix.multiplyMatrices(sm.matrixWorldInverse,lm.matrixWorld),em.update(lm),yu.renderBufferDirect(sm,null,lm.geometry,lm.material,lm,null)):hm&&hm.isTexture&&(void 0==im&&(im=new Mt(-1,1,1,-1,0,1),nm=new ht(new bt(2,2),new $e({depthTest:!1,depthWrite:!1,fog:!1}))),nm.material.map=hm,em.update(nm),yu.renderBufferDirect(im,null,nm.geometry,nm.material,nm,null)),um.overrideMaterial){var ym=um.overrideMaterial;Uc(du,um,mm,ym),Uc(uu,um,mm,ym)}else Ju.setBlending(nn),Uc(du,um,mm),Uc(uu,um,mm);pm.render(um,mm),cm.render(um,mm,Lu),fm&&$u.updateRenderTargetMipmap(fm),Ju.setDepthTest(!0),Ju.setDepthWrite(!0),Ju.setColorWrite(!0)}},this.setFaceCulling=function(um,mm){Ju.setCullFace(um),Ju.setFlipSided(mm===Xi)},this.allocTextureUnit=function(){var um=wu;return um>=Ku.maxTextures&&void 0,wu+=1,um},this.setTexture2D=function(){var um=!1;return function(fm,gm){fm&&fm.isWebGLRenderTarget&&(!um&&(void 0,um=!0),fm=fm.texture),$u.setTexture2D(fm,gm)}}(),this.setTexture=function(){var um=!1;return function(fm,gm){um||(void 0,um=!0),$u.setTexture2D(fm,gm)}}(),this.setTextureCube=function(){var um=!1;return function(fm,gm){fm&&fm.isWebGLRenderTargetCube&&(!um&&(void 0,um=!0),fm=fm.texture),fm&&fm.isCubeTexture||Array.isArray(fm.image)&&6===fm.image.length?$u.setTextureCube(fm,gm):$u.setTextureCubeDynamic(fm,gm)}}(),this.getCurrentRenderTarget=function(){return vu},this.setRenderTarget=function(um){vu=um,um&&void 0===Qu.get(um).__webglFramebuffer&&$u.setupRenderTarget(um);var mm=um&&um.isWebGLRenderTargetCube,fm;if(um){var gm=Qu.get(um);fm=mm?gm.__webglFramebuffer[um.activeCubeFace]:gm.__webglFramebuffer,Mu.copy(um.scissor),Su=um.scissorTest,Lu.copy(um.viewport)}else fm=null,Mu.copy(Uu).multiplyScalar(Iu),Su=Du,Lu.copy(zu).multiplyScalar(Iu);if(_u!==fm&&(Yu.bindFramebuffer(Yu.FRAMEBUFFER,fm),_u=fm),Ju.scissor(Mu),Ju.setScissorTest(Su),Ju.viewport(Lu),mm){var hm=Qu.get(um.texture);Yu.framebufferTexture2D(Yu.FRAMEBUFFER,Yu.COLOR_ATTACHMENT0,Yu.TEXTURE_CUBE_MAP_POSITIVE_X+um.activeCubeFace,hm.__webglTexture,um.activeMipMapLevel)}},this.readRenderTargetPixels=function(um,mm,fm,gm,hm,ym){if(!1!==(um&&um.isWebGLRenderTarget)){var xm=Qu.get(um).__webglFramebuffer;if(xm){var vm=!1;xm!==_u&&(Yu.bindFramebuffer(Yu.FRAMEBUFFER,xm),vm=!0);try{var _m=um.texture,bm=_m.format,Em=_m.type;if(bm!==Ss&&Qc(bm)!==Yu.getParameter(Yu.IMPLEMENTATION_COLOR_READ_FORMAT))return;if(Em!==ds&&Qc(Em)!==Yu.getParameter(Yu.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Em===hs&&(Zu.get('OES_texture_float')||Zu.get('WEBGL_color_buffer_float')))&&!(Em===ys&&Zu.get('EXT_color_buffer_half_float')))return;Yu.checkFramebufferStatus(Yu.FRAMEBUFFER)===Yu.FRAMEBUFFER_COMPLETE?0<=mm&&mm<=um.width-gm&&0<=fm&&fm<=um.height-hm&&Yu.readPixels(mm,fm,gm,hm,Qc(bm),Qc(Em),ym):void 0}finally{vm&&Yu.bindFramebuffer(Yu.FRAMEBUFFER,_u)}}}}}function Qt(gc,hc){this.name='',this.color=new Ie(gc),this.density=hc===void 0?2.5e-4:hc}function $t(gc,hc,yc){this.name='',this.color=new Ie(gc),this.near=hc===void 0?1:hc,this.far=yc===void 0?1e3:yc}function er(){Ze.call(this),this.type='Scene',this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function tr(gc,hc,yc,xc,vc){Ze.call(this),this.lensFlares=[],this.positionScreen=new O,this.customUpdateCallback=void 0,gc!==void 0&&this.add(gc,hc,yc,xc,vc)}function rr(gc){Be.call(this),this.type='SpriteMaterial',this.color=new Ie(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(gc)}function ar(gc){Ze.call(this),this.type='Sprite',this.material=gc===void 0?new rr:gc}function or(){Ze.call(this),this.type='LOD',Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function ir(gc,hc,yc){if(this.useVertexTexture=void 0===yc||yc,this.identityMatrix=new G,gc=gc||[],this.bones=gc.slice(0),this.useVertexTexture){var xc=_Mathsqrt(4*this.bones.length);xc=xl.nextPowerOfTwo(_Mathceil(xc)),xc=_Mathmax(xc,4),this.boneTextureWidth=xc,this.boneTextureHeight=xc,this.boneMatrices=new Float32Array(4*(this.boneTextureWidth*this.boneTextureHeight)),this.boneTexture=new Ue(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,Ss,hs)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===hc)this.calculateInverses();else if(this.bones.length===hc.length)this.boneInverses=hc.slice(0);else{this.boneInverses=[];for(var vc=0,_c=this.bones.length;vc<_c;vc++)this.boneInverses.push(new G)}}function nr(){Ze.call(this),this.type='Bone'}function sr(gc,hc,yc){ht.call(this,gc,hc),this.type='SkinnedMesh',this.bindMode='attached',this.bindMatrix=new G,this.bindMatrixInverse=new G;var xc=[];if(this.geometry&&this.geometry.bones!==void 0){for(var Ec=0,Tc=this.geometry.bones.length,vc,_c;Ec<Tc;++Ec)_c=this.geometry.bones[Ec],vc=new nr,xc.push(vc),vc.name=_c.name,vc.position.fromArray(_c.pos),vc.quaternion.fromArray(_c.rotq),void 0!==_c.scl&&vc.scale.fromArray(_c.scl);for(var Ec=0,Tc=this.geometry.bones.length;Ec<Tc;++Ec)_c=this.geometry.bones[Ec],-1!==_c.parent&&null!==_c.parent&&void 0!==xc[_c.parent]?xc[_c.parent].add(xc[Ec]):this.add(xc[Ec])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new ir(xc,void 0,yc),this.matrixWorld)}function lr(gc){Be.call(this),this.type='LineBasicMaterial',this.color=new Ie(16777215),this.linewidth=1,this.linecap='round',this.linejoin='round',this.lights=!1,this.setValues(gc)}function dr(gc,hc,yc){return 1===yc?new pr(gc,hc):void(Ze.call(this),this.type='Line',this.geometry=gc===void 0?new gt:gc,this.material=hc===void 0?new lr({color:16777215*Math.random()}):hc)}function pr(gc,hc){dr.call(this,gc,hc),this.type='LineSegments'}function cr(gc){Be.call(this),this.type='PointsMaterial',this.color=new Ie(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(gc)}function ur(gc,hc){Ze.call(this),this.type='Points',this.geometry=gc===void 0?new gt:gc,this.material=hc===void 0?new cr({color:16777215*Math.random()}):hc}function mr(){Ze.call(this),this.type='Group'}function fr(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc){function Sc(){requestAnimationFrame(Sc),gc.readyState>=gc.HAVE_CURRENT_DATA&&(Lc.needsUpdate=!0)}C.call(this,gc,hc,yc,xc,vc,_c,Ec,Tc,Mc),this.generateMipmaps=!1;var Lc=this;Sc()}function gr(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc,Sc,Lc,wc){C.call(this,null,_c,Ec,Tc,Mc,Sc,xc,vc,Lc,wc),this.image={width:hc,height:yc},this.mipmaps=gc,this.flipY=!1,this.generateMipmaps=!1}function hr(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc){C.call(this,gc,hc,yc,xc,vc,_c,Ec,Tc,Mc),this.needsUpdate=!0}function yr(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc,Sc){if(Sc=void 0===Sc?Rs:Sc,Sc!==Rs&&Sc!==Ps)throw new Error('DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat');void 0===yc&&Sc===Rs&&(yc=ms),void 0===yc&&Sc===Ps&&(yc=Es),C.call(this,null,xc,vc,_c,Ec,Tc,Sc,yc,Mc),this.image={width:gc,height:hc},this.magFilter=void 0===Ec?as:Ec,this.minFilter=void 0===Tc?as:Tc,this.flipY=!1,this.generateMipmaps=!1}function xr(gc){function hc(Gc,Hc){return Gc-Hc}gt.call(this),this.type='WireframeGeometry';var yc=[],xc,vc,_c,Ec,Tc,Mc=[0,0],Sc={},Lc,wc,Ac=['a','b','c'],Rc;if(gc&&gc.isGeometry){var Pc=gc.faces;for(xc=0,_c=Pc.length;xc<_c;xc++){var Cc=Pc[xc];for(vc=0;3>vc;vc++)Mc[0]=Cc[Ac[vc]],Mc[1]=Cc[Ac[(vc+1)%3]],Mc.sort(hc),wc=Mc.toString(),void 0===Sc[wc]&&(Sc[wc]={index1:Mc[0],index2:Mc[1]})}for(wc in Sc)Lc=Sc[wc],Rc=gc.vertices[Lc.index1],yc.push(Rc.x,Rc.y,Rc.z),Rc=gc.vertices[Lc.index2],yc.push(Rc.x,Rc.y,Rc.z)}else if(gc&&gc.isBufferGeometry){var Ic,Uc,Dc,zc,Nc,Bc,Fc,Oc;if(Rc=new O,null!==gc.index){for(Ic=gc.attributes.position,Uc=gc.index,Dc=gc.groups,0===Dc.length&&gc.addGroup(0,Uc.count),(Ec=0,Tc=Dc.length);Ec<Tc;++Ec)for(zc=Dc[Ec],Nc=zc.start,Bc=zc.count,(xc=Nc,_c=Nc+Bc);xc<_c;xc+=3)for(vc=0;3>vc;vc++)Mc[0]=Uc.getX(xc+vc),Mc[1]=Uc.getX(xc+(vc+1)%3),Mc.sort(hc),wc=Mc.toString(),void 0===Sc[wc]&&(Sc[wc]={index1:Mc[0],index2:Mc[1]});for(wc in Sc)Lc=Sc[wc],Rc.fromBufferAttribute(Ic,Lc.index1),yc.push(Rc.x,Rc.y,Rc.z),Rc.fromBufferAttribute(Ic,Lc.index2),yc.push(Rc.x,Rc.y,Rc.z)}else for(Ic=gc.attributes.position,xc=0,_c=Ic.count/3;xc<_c;xc++)for(vc=0;3>vc;vc++)Fc=3*xc+vc,Rc.fromBufferAttribute(Ic,Fc),yc.push(Rc.x,Rc.y,Rc.z),Oc=3*xc+(vc+1)%3,Rc.fromBufferAttribute(Ic,Oc),yc.push(Rc.x,Rc.y,Rc.z)}this.addAttribute('position',new lt(yc,3))}function vr(gc,hc,yc){ft.call(this),this.type='ParametricGeometry',this.parameters={func:gc,slices:hc,stacks:yc},this.fromBufferGeometry(new _r(gc,hc,yc)),this.mergeVertices()}function _r(gc,hc,yc){gt.call(this),this.type='ParametricBufferGeometry',this.parameters={func:gc,slices:hc,stacks:yc};var xc=[],vc=[],_c=[],Ec,Tc,Mc=hc+1;for(Ec=0;Ec<=yc;Ec++){var Sc=Ec/yc;for(Tc=0;Tc<=hc;Tc++){var Lc=Tc/hc,wc=gc(Lc,Sc);vc.push(wc.x,wc.y,wc.z),_c.push(Lc,Sc)}}for(Ec=0;Ec<yc;Ec++)for(Tc=0;Tc<hc;Tc++){var Ac=Ec*Mc+Tc,Rc=Ec*Mc+Tc+1,Pc=(Ec+1)*Mc+Tc+1,Cc=(Ec+1)*Mc+Tc;xc.push(Ac,Rc,Cc),xc.push(Rc,Pc,Cc)}this.setIndex(xc),this.addAttribute('position',new lt(vc,3)),this.addAttribute('uv',new lt(_c,2)),this.computeVertexNormals()}function br(gc,hc,yc,xc){ft.call(this),this.type='PolyhedronGeometry',this.parameters={vertices:gc,indices:hc,radius:yc,detail:xc},this.fromBufferGeometry(new Er(gc,hc,yc,xc)),this.mergeVertices()}function Er(gc,hc,yc,xc){function _c(Uc,Dc,zc,Nc){var Bc=_Mathpow(2,Nc),Fc=[],Oc,Gc;for(Oc=0;Oc<=Bc;Oc++){Fc[Oc]=[];var Hc=Uc.clone().lerp(zc,Oc/Bc),Vc=Dc.clone().lerp(zc,Oc/Bc),kc=Bc-Oc;for(Gc=0;Gc<=kc;Gc++)Fc[Oc][Gc]=0===Gc&&Oc===Bc?Hc:Hc.clone().lerp(Vc,Gc/kc)}for(Oc=0;Oc<Bc;Oc++)for(Gc=0;Gc<2*(Bc-Oc)-1;Gc++){var Wc=_Mathfloor(Gc/2);0==Gc%2?(Sc(Fc[Oc][Wc+1]),Sc(Fc[Oc+1][Wc]),Sc(Fc[Oc][Wc])):(Sc(Fc[Oc][Wc+1]),Sc(Fc[Oc+1][Wc+1]),Sc(Fc[Oc+1][Wc]))}}function Mc(){for(var Uc=0;Uc<Ic.length;Uc+=6){var Dc=Ic[Uc+0],zc=Ic[Uc+2],Nc=Ic[Uc+4],Bc=_Mathmax(Dc,zc,Nc),Fc=_Mathmin(Dc,zc,Nc);0.9<Bc&&0.1>Fc&&(0.2>Dc&&(Ic[Uc+0]+=1),0.2>zc&&(Ic[Uc+2]+=1),0.2>Nc&&(Ic[Uc+4]+=1))}}function Sc(Uc){Cc.push(Uc.x,Uc.y,Uc.z)}function Lc(Uc,Dc){var zc=3*Uc;Dc.x=gc[zc+0],Dc.y=gc[zc+1],Dc.z=gc[zc+2]}function wc(){for(var Uc=new O,Dc=new O,zc=new O,Nc=new O,Bc=new R,Fc=new R,Oc=new R,Gc=0,Hc=0;Gc<Cc.length;Gc+=9,Hc+=6){Uc.set(Cc[Gc+0],Cc[Gc+1],Cc[Gc+2]),Dc.set(Cc[Gc+3],Cc[Gc+4],Cc[Gc+5]),zc.set(Cc[Gc+6],Cc[Gc+7],Cc[Gc+8]),Bc.set(Ic[Hc+0],Ic[Hc+1]),Fc.set(Ic[Hc+2],Ic[Hc+3]),Oc.set(Ic[Hc+4],Ic[Hc+5]),Nc.copy(Uc).add(Dc).add(zc).divideScalar(3);var Vc=Rc(Nc);Ac(Bc,Hc+0,Uc,Vc),Ac(Fc,Hc+2,Dc,Vc),Ac(Oc,Hc+4,zc,Vc)}}function Ac(Uc,Dc,zc,Nc){0>Nc&&1===Uc.x&&(Ic[Dc]=Uc.x-1),0===zc.x&&0===zc.z&&(Ic[Dc]=Nc/2/_MathPI+0.5)}function Rc(Uc){return _Mathatan(Uc.z,-Uc.x)}function Pc(Uc){return _Mathatan(-Uc.y,_Mathsqrt(Uc.x*Uc.x+Uc.z*Uc.z))}gt.call(this),this.type='PolyhedronBufferGeometry',this.parameters={vertices:gc,indices:hc,radius:yc,detail:xc},yc=yc||1,xc=xc||0;var Cc=[],Ic=[];(function(Uc){for(var Dc=new O,zc=new O,Nc=new O,Bc=0;Bc<hc.length;Bc+=3)Lc(hc[Bc+0],Dc),Lc(hc[Bc+1],zc),Lc(hc[Bc+2],Nc),_c(Dc,zc,Nc,Uc)})(xc),function(Uc){for(var Dc=new O,zc=0;zc<Cc.length;zc+=3)Dc.x=Cc[zc+0],Dc.y=Cc[zc+1],Dc.z=Cc[zc+2],Dc.normalize().multiplyScalar(Uc),Cc[zc+0]=Dc.x,Cc[zc+1]=Dc.y,Cc[zc+2]=Dc.z}(yc),function(){for(var Uc=new O,Dc=0;Dc<Cc.length;Dc+=3){Uc.x=Cc[Dc+0],Uc.y=Cc[Dc+1],Uc.z=Cc[Dc+2];var zc=Rc(Uc)/2/_MathPI+0.5,Nc=Pc(Uc)/_MathPI+0.5;Ic.push(zc,1-Nc)}wc(),Mc()}(),this.addAttribute('position',new lt(Cc,3)),this.addAttribute('normal',new lt(Cc.slice(),3)),this.addAttribute('uv',new lt(Ic,2)),this.normalizeNormals()}function Tr(gc,hc){ft.call(this),this.type='TetrahedronGeometry',this.parameters={radius:gc,detail:hc},this.fromBufferGeometry(new Mr(gc,hc)),this.mergeVertices()}function Mr(gc,hc){Er.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],gc,hc),this.type='TetrahedronBufferGeometry',this.parameters={radius:gc,detail:hc}}function Sr(gc,hc){ft.call(this),this.type='OctahedronGeometry',this.parameters={radius:gc,detail:hc},this.fromBufferGeometry(new Lr(gc,hc)),this.mergeVertices()}function Lr(gc,hc){Er.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],gc,hc),this.type='OctahedronBufferGeometry',this.parameters={radius:gc,detail:hc}}function wr(gc,hc){ft.call(this),this.type='IcosahedronGeometry',this.parameters={radius:gc,detail:hc},this.fromBufferGeometry(new Ar(gc,hc)),this.mergeVertices()}function Ar(gc,hc){var yc=(1+2.23606797749979)/2;Er.call(this,[-1,yc,0,1,yc,0,-1,-yc,0,1,-yc,0,0,-1,yc,0,1,yc,0,-1,-yc,0,1,-yc,yc,0,-1,yc,0,1,-yc,0,-1,-yc,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],gc,hc),this.type='IcosahedronBufferGeometry',this.parameters={radius:gc,detail:hc}}function Rr(gc,hc){ft.call(this),this.type='DodecahedronGeometry',this.parameters={radius:gc,detail:hc},this.fromBufferGeometry(new Pr(gc,hc)),this.mergeVertices()}function Pr(gc,hc){var yc=(1+2.23606797749979)/2,xc=1/yc;Er.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-xc,-yc,0,-xc,yc,0,xc,-yc,0,xc,yc,-xc,-yc,0,-xc,yc,0,xc,-yc,0,xc,yc,0,-yc,0,-xc,yc,0,-xc,-yc,0,xc,yc,0,xc],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],gc,hc),this.type='DodecahedronBufferGeometry',this.parameters={radius:gc,detail:hc}}function Cr(gc,hc,yc,xc,vc,_c){ft.call(this),this.type='TubeGeometry',this.parameters={path:gc,tubularSegments:hc,radius:yc,radialSegments:xc,closed:vc},_c!==void 0&&void 0;var Ec=new Ir(gc,hc,yc,xc,vc);this.tangents=Ec.tangents,this.normals=Ec.normals,this.binormals=Ec.binormals,this.fromBufferGeometry(Ec),this.mergeVertices()}function Ir(gc,hc,yc,xc,vc){function Ec(zc){var Nc=gc.getPointAt(zc/hc),Bc=Sc.normals[zc],Fc=Sc.binormals[zc];for(Pc=0;Pc<=xc;Pc++){var Oc=2*(Pc/xc*_MathPI),Gc=_Mathsin(Oc),Hc=-_Mathcos(Oc);wc.x=Hc*Bc.x+Gc*Fc.x,wc.y=Hc*Bc.y+Gc*Fc.y,wc.z=Hc*Bc.z+Gc*Fc.z,wc.normalize(),Ic.push(wc.x,wc.y,wc.z),Lc.x=Nc.x+yc*wc.x,Lc.y=Nc.y+yc*wc.y,Lc.z=Nc.z+yc*wc.z,Cc.push(Lc.x,Lc.y,Lc.z)}}function Tc(){for(Pc=1;Pc<=hc;Pc++)for(Rc=1;Rc<=xc;Rc++){var zc=(xc+1)*(Pc-1)+(Rc-1),Nc=(xc+1)*Pc+(Rc-1),Bc=(xc+1)*Pc+Rc,Fc=(xc+1)*(Pc-1)+Rc;Dc.push(zc,Nc,Fc),Dc.push(Nc,Bc,Fc)}}function Mc(){for(Rc=0;Rc<=hc;Rc++)for(Pc=0;Pc<=xc;Pc++)Ac.x=Rc/hc,Ac.y=Pc/xc,Uc.push(Ac.x,Ac.y)}gt.call(this),this.type='TubeBufferGeometry',this.parameters={path:gc,tubularSegments:hc,radius:yc,radialSegments:xc,closed:vc},hc=hc||64,yc=yc||1,xc=xc||8,vc=vc||!1;var Sc=gc.computeFrenetFrames(hc,vc);this.tangents=Sc.tangents,this.normals=Sc.normals,this.binormals=Sc.binormals;var Lc=new O,wc=new O,Ac=new R,Rc,Pc,Cc=[],Ic=[],Uc=[],Dc=[];(function(){for(Rc=0;Rc<hc;Rc++)Ec(Rc);Ec(!1===vc?hc:0),Mc(),Tc()})(),this.setIndex(Dc),this.addAttribute('position',new lt(Cc,3)),this.addAttribute('normal',new lt(Ic,3)),this.addAttribute('uv',new lt(Uc,2))}function Ur(gc,hc,yc,xc,vc,_c,Ec){ft.call(this),this.type='TorusKnotGeometry',this.parameters={radius:gc,tube:hc,tubularSegments:yc,radialSegments:xc,p:vc,q:_c},Ec!==void 0&&void 0,this.fromBufferGeometry(new Dr(gc,hc,yc,xc,vc,_c)),this.mergeVertices()}function Dr(gc,hc,yc,xc,vc,_c){function Ec(jc,Xc,Yc,qc,Zc){var Kc=_Mathcos(jc),Jc=_Mathsin(jc),Qc=Yc/Xc*jc,$c=_Mathcos(Qc);Zc.x=0.5*(qc*(2+$c))*Kc,Zc.y=0.5*(qc*(2+$c)*Jc),Zc.z=0.5*(qc*_Mathsin(Qc))}gt.call(this),this.type='TorusKnotBufferGeometry',this.parameters={radius:gc,tube:hc,tubularSegments:yc,radialSegments:xc,p:vc,q:_c},gc=gc||100,hc=hc||40,yc=_Mathfloor(yc)||64,xc=_Mathfloor(xc)||8,vc=vc||2,_c=_c||3;var Tc=[],Mc=[],Sc=[],Lc=[],wc,Ac,Rc=new O,Pc=new O,Cc=new R,Ic=new O,Uc=new O,Dc=new O,zc=new O,Nc=new O;for(wc=0;wc<=yc;++wc){var Bc=2*(wc/yc*vc*_MathPI);for(Ec(Bc,vc,_c,gc,Ic),Ec(Bc+0.01,vc,_c,gc,Uc),zc.subVectors(Uc,Ic),Nc.addVectors(Uc,Ic),Dc.crossVectors(zc,Nc),Nc.crossVectors(Dc,zc),Dc.normalize(),Nc.normalize(),Ac=0;Ac<=xc;++Ac){var Fc=2*(Ac/xc*_MathPI),Oc=-hc*_Mathcos(Fc),Gc=hc*_Mathsin(Fc);Rc.x=Ic.x+(Oc*Nc.x+Gc*Dc.x),Rc.y=Ic.y+(Oc*Nc.y+Gc*Dc.y),Rc.z=Ic.z+(Oc*Nc.z+Gc*Dc.z),Mc.push(Rc.x,Rc.y,Rc.z),Pc.subVectors(Rc,Ic).normalize(),Sc.push(Pc.x,Pc.y,Pc.z),Lc.push(wc/yc),Lc.push(Ac/xc)}}for(Ac=1;Ac<=yc;Ac++)for(wc=1;wc<=xc;wc++){var Hc=(xc+1)*(Ac-1)+(wc-1),Vc=(xc+1)*Ac+(wc-1),kc=(xc+1)*Ac+wc,Wc=(xc+1)*(Ac-1)+wc;Tc.push(Hc,Vc,Wc),Tc.push(Vc,kc,Wc)}this.setIndex(Tc),this.addAttribute('position',new lt(Mc,3)),this.addAttribute('normal',new lt(Sc,3)),this.addAttribute('uv',new lt(Lc,2))}function zr(gc,hc,yc,xc,vc){ft.call(this),this.type='TorusGeometry',this.parameters={radius:gc,tube:hc,radialSegments:yc,tubularSegments:xc,arc:vc},this.fromBufferGeometry(new Nr(gc,hc,yc,xc,vc))}function Nr(gc,hc,yc,xc,vc){gt.call(this),this.type='TorusBufferGeometry',this.parameters={radius:gc,tube:hc,radialSegments:yc,tubularSegments:xc,arc:vc},gc=gc||100,hc=hc||40,yc=_Mathfloor(yc)||8,xc=_Mathfloor(xc)||6,vc=vc||2*_MathPI;var _c=[],Ec=[],Tc=[],Mc=[],Sc=new O,Lc=new O,wc=new O,Ac,Rc;for(Ac=0;Ac<=yc;Ac++)for(Rc=0;Rc<=xc;Rc++){var Pc=Rc/xc*vc,Cc=2*(Ac/yc*_MathPI);Lc.x=(gc+hc*_Mathcos(Cc))*_Mathcos(Pc),Lc.y=(gc+hc*_Mathcos(Cc))*_Mathsin(Pc),Lc.z=hc*_Mathsin(Cc),Ec.push(Lc.x,Lc.y,Lc.z),Sc.x=gc*_Mathcos(Pc),Sc.y=gc*_Mathsin(Pc),wc.subVectors(Lc,Sc).normalize(),Tc.push(wc.x,wc.y,wc.z),Mc.push(Rc/xc),Mc.push(Ac/yc)}for(Ac=1;Ac<=yc;Ac++)for(Rc=1;Rc<=xc;Rc++){var Ic=(xc+1)*Ac+Rc-1,Uc=(xc+1)*(Ac-1)+Rc-1,Dc=(xc+1)*(Ac-1)+Rc,zc=(xc+1)*Ac+Rc;_c.push(Ic,Uc,zc),_c.push(Uc,Dc,zc)}this.setIndex(_c),this.addAttribute('position',new lt(Ec,3)),this.addAttribute('normal',new lt(Tc,3)),this.addAttribute('uv',new lt(Mc,2))}function Br(gc,hc){return'undefined'==typeof gc?void(gc=[]):void(ft.call(this),this.type='ExtrudeGeometry',gc=Array.isArray(gc)?gc:[gc],this.addShapeList(gc,hc),this.computeFaceNormals())}function Fr(gc,hc){hc=hc||{};var yc=hc.font;if(!1===(yc&&yc.isFont))return new ft;var xc=yc.generateShapes(gc,hc.size,hc.curveSegments);hc.amount=hc.height===void 0?50:hc.height,hc.bevelThickness===void 0&&(hc.bevelThickness=10),hc.bevelSize===void 0&&(hc.bevelSize=8),hc.bevelEnabled===void 0&&(hc.bevelEnabled=!1),Br.call(this,xc,hc),this.type='TextGeometry'}function Or(gc,hc,yc,xc,vc,_c,Ec){ft.call(this),this.type='SphereGeometry',this.parameters={radius:gc,widthSegments:hc,heightSegments:yc,phiStart:xc,phiLength:vc,thetaStart:_c,thetaLength:Ec},this.fromBufferGeometry(new Gr(gc,hc,yc,xc,vc,_c,Ec))}function Gr(gc,hc,yc,xc,vc,_c,Ec){gt.call(this),this.type='SphereBufferGeometry',this.parameters={radius:gc,widthSegments:hc,heightSegments:yc,phiStart:xc,phiLength:vc,thetaStart:_c,thetaLength:Ec},gc=gc||50,hc=_Mathmax(3,_Mathfloor(hc)||8),yc=_Mathmax(2,_Mathfloor(yc)||6),xc=xc===void 0?0:xc,vc=vc===void 0?2*_MathPI:vc,_c=_c===void 0?0:_c,Ec=Ec===void 0?_MathPI:Ec;var Tc=_c+Ec,Mc,Sc,Lc=0,wc=[],Ac=new O,Rc=new O,Pc=[],Cc=[],Ic=[],Uc=[];for(Sc=0;Sc<=yc;Sc++){var Dc=[],zc=Sc/yc;for(Mc=0;Mc<=hc;Mc++){var Nc=Mc/hc;Ac.x=-gc*_Mathcos(xc+Nc*vc)*_Mathsin(_c+zc*Ec),Ac.y=gc*_Mathcos(_c+zc*Ec),Ac.z=gc*_Mathsin(xc+Nc*vc)*_Mathsin(_c+zc*Ec),Cc.push(Ac.x,Ac.y,Ac.z),Rc.set(Ac.x,Ac.y,Ac.z).normalize(),Ic.push(Rc.x,Rc.y,Rc.z),Uc.push(Nc,1-zc),Dc.push(Lc++)}wc.push(Dc)}for(Sc=0;Sc<yc;Sc++)for(Mc=0;Mc<hc;Mc++){var Bc=wc[Sc][Mc+1],Fc=wc[Sc][Mc],Oc=wc[Sc+1][Mc],Gc=wc[Sc+1][Mc+1];(0!==Sc||0<_c)&&Pc.push(Bc,Fc,Gc),(Sc!==yc-1||Tc<_MathPI)&&Pc.push(Fc,Oc,Gc)}this.setIndex(Pc),this.addAttribute('position',new lt(Cc,3)),this.addAttribute('normal',new lt(Ic,3)),this.addAttribute('uv',new lt(Uc,2))}function Hr(gc,hc,yc,xc,vc,_c){ft.call(this),this.type='RingGeometry',this.parameters={innerRadius:gc,outerRadius:hc,thetaSegments:yc,phiSegments:xc,thetaStart:vc,thetaLength:_c},this.fromBufferGeometry(new Vr(gc,hc,yc,xc,vc,_c))}function Vr(gc,hc,yc,xc,vc,_c){gt.call(this),this.type='RingBufferGeometry',this.parameters={innerRadius:gc,outerRadius:hc,thetaSegments:yc,phiSegments:xc,thetaStart:vc,thetaLength:_c},gc=gc||20,hc=hc||50,vc=vc===void 0?0:vc,_c=_c===void 0?2*_MathPI:_c,yc=yc===void 0?8:_Mathmax(3,yc),xc=xc===void 0?1:_Mathmax(1,xc);var Ec=[],Tc=[],Mc=[],Sc=[],Lc,wc=gc,Ac=(hc-gc)/xc,Rc=new O,Pc=new R,Cc,Ic;for(Cc=0;Cc<=xc;Cc++){for(Ic=0;Ic<=yc;Ic++)Lc=vc+Ic/yc*_c,Rc.x=wc*_Mathcos(Lc),Rc.y=wc*_Mathsin(Lc),Tc.push(Rc.x,Rc.y,Rc.z),Mc.push(0,0,1),Pc.x=(Rc.x/hc+1)/2,Pc.y=(Rc.y/hc+1)/2,Sc.push(Pc.x,Pc.y);wc+=Ac}for(Cc=0;Cc<xc;Cc++){var Uc=Cc*(yc+1);for(Ic=0;Ic<yc;Ic++){Lc=Ic+Uc;var Dc=Lc,zc=Lc+yc+1,Nc=Lc+yc+2,Bc=Lc+1;Ec.push(Dc,zc,Bc),Ec.push(zc,Nc,Bc)}}this.setIndex(Ec),this.addAttribute('position',new lt(Tc,3)),this.addAttribute('normal',new lt(Mc,3)),this.addAttribute('uv',new lt(Sc,2))}function kr(gc,hc,yc,xc){ft.call(this),this.type='LatheGeometry',this.parameters={points:gc,segments:hc,phiStart:yc,phiLength:xc},this.fromBufferGeometry(new Wr(gc,hc,yc,xc)),this.mergeVertices()}function Wr(gc,hc,yc,xc){gt.call(this),this.type='LatheBufferGeometry',this.parameters={points:gc,segments:hc,phiStart:yc,phiLength:xc},hc=_Mathfloor(hc)||12,yc=yc||0,xc=xc||2*_MathPI,xc=xl.clamp(xc,0,2*_MathPI);var vc=[],_c=[],Ec=[],Mc=1/hc,Sc=new O,Lc=new R,Tc,wc,Ac;for(wc=0;wc<=hc;wc++){var Rc=yc+wc*Mc*xc,Pc=_Mathsin(Rc),Cc=_Mathcos(Rc);for(Ac=0;Ac<=gc.length-1;Ac++)Sc.x=gc[Ac].x*Pc,Sc.y=gc[Ac].y,Sc.z=gc[Ac].x*Cc,_c.push(Sc.x,Sc.y,Sc.z),Lc.x=wc/hc,Lc.y=Ac/(gc.length-1),Ec.push(Lc.x,Lc.y)}for(wc=0;wc<hc;wc++)for(Ac=0;Ac<gc.length-1;Ac++){Tc=Ac+wc*gc.length;var Ic=Tc,Uc=Tc+gc.length,Dc=Tc+gc.length+1,zc=Tc+1;vc.push(Ic,Uc,zc),vc.push(Uc,Dc,zc)}if(this.setIndex(vc),this.addAttribute('position',new lt(_c,3)),this.addAttribute('uv',new lt(Ec,2)),this.computeVertexNormals(),xc===2*_MathPI){var Nc=this.attributes.normal.array,Bc=new O,Fc=new O,Oc=new O;for(Tc=3*(hc*gc.length),wc=0,Ac=0;wc<gc.length;wc++,Ac+=3)Bc.x=Nc[Ac+0],Bc.y=Nc[Ac+1],Bc.z=Nc[Ac+2],Fc.x=Nc[Tc+Ac+0],Fc.y=Nc[Tc+Ac+1],Fc.z=Nc[Tc+Ac+2],Oc.addVectors(Bc,Fc).normalize(),Nc[Ac+0]=Nc[Tc+Ac+0]=Oc.x,Nc[Ac+1]=Nc[Tc+Ac+1]=Oc.y,Nc[Ac+2]=Nc[Tc+Ac+2]=Oc.z}}function jr(gc,hc){ft.call(this),this.type='ShapeGeometry','object'==typeof hc&&(void 0,hc=hc.curveSegments),this.parameters={shapes:gc,curveSegments:hc},this.fromBufferGeometry(new Xr(gc,hc)),this.mergeVertices()}function Xr(gc,hc){function yc(Lc){var wc,Ac,Rc,Pc=vc.length/3,Cc=Lc.extractPoints(hc),Ic=Cc.shape,Uc=Cc.holes;if(!1===Yp.isClockWise(Ic))for(Ic=Ic.reverse(),wc=0,Ac=Uc.length;wc<Ac;wc++)Rc=Uc[wc],!0===Yp.isClockWise(Rc)&&(Uc[wc]=Rc.reverse());var Dc=Yp.triangulateShape(Ic,Uc);for(wc=0,Ac=Uc.length;wc<Ac;wc++)Rc=Uc[wc],Ic=Ic.concat(Rc);for(wc=0,Ac=Ic.length;wc<Ac;wc++){var zc=Ic[wc];vc.push(zc.x,zc.y,0),_c.push(0,0,1),Ec.push(zc.x,zc.y)}for(wc=0,Ac=Dc.length;wc<Ac;wc++){var Nc=Dc[wc],Bc=Nc[0]+Pc,Fc=Nc[1]+Pc,Oc=Nc[2]+Pc;xc.push(Bc,Fc,Oc),Mc+=3}}gt.call(this),this.type='ShapeBufferGeometry',this.parameters={shapes:gc,curveSegments:hc},hc=hc||12;var xc=[],vc=[],_c=[],Ec=[],Tc=0,Mc=0;if(!1===Array.isArray(gc))yc(gc);else for(var Sc=0;Sc<gc.length;Sc++)yc(gc[Sc]),this.addGroup(Tc,Mc,Sc),Tc+=Mc,Mc=0;this.setIndex(xc),this.addAttribute('position',new lt(vc,3)),this.addAttribute('normal',new lt(_c,3)),this.addAttribute('uv',new lt(Ec,2))}function Yr(gc,hc){function yc(Dc,zc){return Dc-zc}gt.call(this),this.type='EdgesGeometry',this.parameters={thresholdAngle:hc},hc=hc===void 0?1:hc;var xc=[],vc=_Mathcos(xl.DEG2RAD*hc),_c=[0,0],Ec={},Tc,Mc=['a','b','c'],Sc;gc.isBufferGeometry?(Sc=new ft,Sc.fromBufferGeometry(gc)):Sc=gc.clone(),Sc.mergeVertices(),Sc.computeFaceNormals();for(var Lc=Sc.vertices,wc=Sc.faces,Ac=0,Rc=wc.length,Pc;Ac<Rc;Ac++){Pc=wc[Ac];for(var Cc=0;3>Cc;Cc++)_c[0]=Pc[Mc[Cc]],_c[1]=Pc[Mc[(Cc+1)%3]],_c.sort(yc),Tc=_c.toString(),void 0===Ec[Tc]?Ec[Tc]={index1:_c[0],index2:_c[1],face1:Ac,face2:void 0}:Ec[Tc].face2=Ac}for(Tc in Ec){var Ic=Ec[Tc];if(Ic.face2===void 0||wc[Ic.face1].normal.dot(wc[Ic.face2].normal)<=vc){var Uc=Lc[Ic.index1];xc.push(Uc.x,Uc.y,Uc.z),Uc=Lc[Ic.index2],xc.push(Uc.x,Uc.y,Uc.z)}}this.addAttribute('position',new lt(xc,3))}function qr(gc,hc,yc,xc,vc,_c,Ec,Tc){ft.call(this),this.type='CylinderGeometry',this.parameters={radiusTop:gc,radiusBottom:hc,height:yc,radialSegments:xc,heightSegments:vc,openEnded:_c,thetaStart:Ec,thetaLength:Tc},this.fromBufferGeometry(new Zr(gc,hc,yc,xc,vc,_c,Ec,Tc)),this.mergeVertices()}function Zr(gc,hc,yc,xc,vc,_c,Ec,Tc){function Sc(Nc){var Bc,Fc,Oc,Gc=new R,Hc=new O,Vc=0,kc=!0===Nc?gc:hc,Wc=!0===Nc?1:-1;for(Fc=Cc,Bc=1;Bc<=xc;Bc++)Ac.push(0,Dc*Wc,0),Rc.push(0,Wc,0),Pc.push(0.5,0.5),Cc++;for(Oc=Cc,Bc=0;Bc<=xc;Bc++){var jc=Bc/xc,Xc=jc*Tc+Ec,Yc=_Mathcos(Xc),qc=_Mathsin(Xc);Hc.x=kc*qc,Hc.y=Dc*Wc,Hc.z=kc*Yc,Ac.push(Hc.x,Hc.y,Hc.z),Rc.push(0,Wc,0),Gc.x=0.5*Yc+0.5,Gc.y=0.5*qc*Wc+0.5,Pc.push(Gc.x,Gc.y),Cc++}for(Bc=0;Bc<xc;Bc++){var Zc=Fc+Bc,Kc=Oc+Bc;!0===Nc?wc.push(Kc,Kc+1,Zc):wc.push(Kc+1,Kc,Zc),Vc+=3}Lc.addGroup(zc,Vc,!0===Nc?1:2),zc+=Vc}gt.call(this),this.type='CylinderBufferGeometry',this.parameters={radiusTop:gc,radiusBottom:hc,height:yc,radialSegments:xc,heightSegments:vc,openEnded:_c,thetaStart:Ec,thetaLength:Tc};var Lc=this;gc=gc===void 0?20:gc,hc=hc===void 0?20:hc,yc=yc===void 0?100:yc,xc=_Mathfloor(xc)||8,vc=_Mathfloor(vc)||1,_c=_c!==void 0&&_c,Ec=Ec===void 0?0:Ec,Tc=Tc===void 0?2*_MathPI:Tc;var wc=[],Ac=[],Rc=[],Pc=[],Cc=0,Uc=[],Dc=yc/2,zc=0;(function(){var Nc,Bc,Fc=new O,Oc=new O,Gc=0,Hc=(hc-gc)/yc;for(Bc=0;Bc<=vc;Bc++){var Vc=[],kc=Bc/vc,Wc=kc*(hc-gc)+gc;for(Nc=0;Nc<=xc;Nc++){var jc=Nc/xc,Xc=jc*Tc+Ec,Yc=_Mathsin(Xc),qc=_Mathcos(Xc);Oc.x=Wc*Yc,Oc.y=-kc*yc+Dc,Oc.z=Wc*qc,Ac.push(Oc.x,Oc.y,Oc.z),Fc.set(Yc,Hc,qc).normalize(),Rc.push(Fc.x,Fc.y,Fc.z),Pc.push(jc,1-kc),Vc.push(Cc++)}Uc.push(Vc)}for(Nc=0;Nc<xc;Nc++)for(Bc=0;Bc<vc;Bc++){var Zc=Uc[Bc][Nc],Kc=Uc[Bc+1][Nc],Jc=Uc[Bc+1][Nc+1],Qc=Uc[Bc][Nc+1];wc.push(Zc,Kc,Qc),wc.push(Kc,Jc,Qc),Gc+=6}Lc.addGroup(zc,Gc,0),zc+=Gc})(),!1===_c&&(0<gc&&Sc(!0),0<hc&&Sc(!1)),this.setIndex(wc),this.addAttribute('position',new lt(Ac,3)),this.addAttribute('normal',new lt(Rc,3)),this.addAttribute('uv',new lt(Pc,2))}function Kr(gc,hc,yc,xc,vc,_c,Ec){qr.call(this,0,gc,hc,yc,xc,vc,_c,Ec),this.type='ConeGeometry',this.parameters={radius:gc,height:hc,radialSegments:yc,heightSegments:xc,openEnded:vc,thetaStart:_c,thetaLength:Ec}}function Jr(gc,hc,yc,xc,vc,_c,Ec){Zr.call(this,0,gc,hc,yc,xc,vc,_c,Ec),this.type='ConeBufferGeometry',this.parameters={radius:gc,height:hc,radialSegments:yc,heightSegments:xc,openEnded:vc,thetaStart:_c,thetaLength:Ec}}function Qr(gc,hc,yc,xc){ft.call(this),this.type='CircleGeometry',this.parameters={radius:gc,segments:hc,thetaStart:yc,thetaLength:xc},this.fromBufferGeometry(new $r(gc,hc,yc,xc))}function $r(gc,hc,yc,xc){gt.call(this),this.type='CircleBufferGeometry',this.parameters={radius:gc,segments:hc,thetaStart:yc,thetaLength:xc},gc=gc||50,hc=hc===void 0?8:_Mathmax(3,hc),yc=yc===void 0?0:yc,xc=xc===void 0?2*_MathPI:xc;var vc=[],_c=[],Ec=[],Tc=[],Mc,Sc,Lc=new O,wc=new R;for(_c.push(0,0,0),Ec.push(0,0,1),Tc.push(0.5,0.5),(Sc=0,Mc=3);Sc<=hc;Sc++,Mc+=3){var Ac=yc+Sc/hc*xc;Lc.x=gc*_Mathcos(Ac),Lc.y=gc*_Mathsin(Ac),_c.push(Lc.x,Lc.y,Lc.z),Ec.push(0,0,1),wc.x=(_c[Mc]/gc+1)/2,wc.y=(_c[Mc+1]/gc+1)/2,Tc.push(wc.x,wc.y)}for(Mc=1;Mc<=hc;Mc++)vc.push(Mc,Mc+1,0);this.setIndex(vc),this.addAttribute('position',new lt(_c,3)),this.addAttribute('normal',new lt(Ec,3)),this.addAttribute('uv',new lt(Tc,2))}function ea(){Fe.call(this,{uniforms:wl.merge([Hp.lights,{opacity:{value:1}}]),vertexShader:Op.shadow_vert,fragmentShader:Op.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(gc){this.uniforms.opacity.value=gc}}})}function ta(gc){Fe.call(this,gc),this.type='RawShaderMaterial'}function ra(gc){this.uuid=xl.generateUUID(),this.type='MultiMaterial',this.materials=Array.isArray(gc)?gc:[],this.visible=!0}function aa(gc){Be.call(this),this.defines={STANDARD:''},this.type='MeshStandardMaterial',this.color=new Ie(16777215),this.roughness=0.5,this.metalness=0.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ie(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new R(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=0.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(gc)}function oa(gc){aa.call(this),this.defines={PHYSICAL:''},this.type='MeshPhysicalMaterial',this.reflectivity=0.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(gc)}function ia(gc){Be.call(this),this.type='MeshPhongMaterial',this.color=new Ie(16777215),this.specular=new Ie(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ie(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new R(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Bn,this.reflectivity=1,this.refractionRatio=0.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(gc)}function na(gc){ia.call(this),this.defines={TOON:''},this.type='MeshToonMaterial',this.gradientMap=null,this.setValues(gc)}function sa(gc){Be.call(this,gc),this.type='MeshNormalMaterial',this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new R(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(gc)}function la(gc){Be.call(this),this.type='MeshLambertMaterial',this.color=new Ie(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ie(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Bn,this.reflectivity=1,this.refractionRatio=0.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(gc)}function da(gc){Be.call(this),this.type='LineDashedMaterial',this.color=new Ie(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(gc)}function pa(gc,hc,yc){var xc=this,vc=!1,_c=0,Ec=0;this.onStart=void 0,this.onLoad=gc,this.onProgress=hc,this.onError=yc,this.itemStart=function(Tc){Ec++,!1==vc&&xc.onStart!==void 0&&xc.onStart(Tc,_c,Ec),vc=!0},this.itemEnd=function(Tc){_c++,xc.onProgress!==void 0&&xc.onProgress(Tc,_c,Ec),_c==Ec&&(vc=!1,xc.onLoad!==void 0&&xc.onLoad())},this.itemError=function(Tc){xc.onError!==void 0&&xc.onError(Tc)}}function ca(gc){this.manager=gc===void 0?Jp:gc}function ua(gc){this.manager=gc===void 0?Jp:gc,this._parser=null}function ma(gc){this.manager=gc===void 0?Jp:gc,this._parser=null}function fa(gc){this.manager=gc===void 0?Jp:gc}function ga(gc){this.manager=gc===void 0?Jp:gc}function ha(gc){this.manager=gc===void 0?Jp:gc}function ya(gc,hc){Ze.call(this),this.type='Light',this.color=new Ie(gc),this.intensity=hc===void 0?1:hc,this.receiveShadow=void 0}function xa(gc,hc,yc){ya.call(this,gc,yc),this.type='HemisphereLight',this.castShadow=void 0,this.position.copy(Ze.DefaultUp),this.updateMatrix(),this.groundColor=new Ie(hc)}function va(gc){this.camera=gc,this.bias=0,this.radius=1,this.mapSize=new R(512,512),this.map=null,this.matrix=new G}function _a(){va.call(this,new Tt(50,1,0.5,500))}function ba(gc,hc,yc,xc,vc,_c){ya.call(this,gc,hc),this.type='SpotLight',this.position.copy(Ze.DefaultUp),this.updateMatrix(),this.target=new Ze,Object.defineProperty(this,'power',{get:function(){return this.intensity*_MathPI},set:function(Ec){this.intensity=Ec/_MathPI}}),this.distance=yc===void 0?0:yc,this.angle=xc===void 0?_MathPI/3:xc,this.penumbra=vc===void 0?0:vc,this.decay=_c===void 0?1:_c,this.shadow=new _a}function Ea(gc,hc,yc,xc){ya.call(this,gc,hc),this.type='PointLight',Object.defineProperty(this,'power',{get:function(){return 4*this.intensity*_MathPI},set:function(vc){this.intensity=vc/(4*_MathPI)}}),this.distance=yc===void 0?0:yc,this.decay=xc===void 0?1:xc,this.shadow=new va(new Tt(90,1,0.5,500))}function Ta(){va.call(this,new Mt(-5,5,5,-5,0.5,500))}function Ma(gc,hc){ya.call(this,gc,hc),this.type='DirectionalLight',this.position.copy(Ze.DefaultUp),this.updateMatrix(),this.target=new Ze,this.shadow=new Ta}function Sa(gc,hc){ya.call(this,gc,hc),this.type='AmbientLight',this.castShadow=void 0}function La(gc,hc,yc,xc){this.parameterPositions=gc,this._cachedIndex=0,this.resultBuffer=xc===void 0?new hc.constructor(yc):xc,this.sampleValues=hc,this.valueSize=yc}function wa(gc,hc,yc,xc){La.call(this,gc,hc,yc,xc),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Aa(gc,hc,yc,xc){La.call(this,gc,hc,yc,xc)}function Ra(gc,hc,yc,xc){La.call(this,gc,hc,yc,xc)}function Pa(gc,hc,yc,xc){if(gc===void 0)throw new Error('track name is undefined');if(void 0===hc||0===hc.length)throw new Error('no keyframes in track named '+gc);this.name=gc,this.times=Qp.convertArray(hc,this.TimeBufferType),this.values=Qp.convertArray(yc,this.ValueBufferType),this.setInterpolation(xc||this.DefaultInterpolation),this.validate(),this.optimize()}function Ca(gc,hc,yc,xc){Pa.call(this,gc,hc,yc,xc)}function Ia(gc,hc,yc,xc){La.call(this,gc,hc,yc,xc)}function Ua(gc,hc,yc,xc){Pa.call(this,gc,hc,yc,xc)}function Da(gc,hc,yc,xc){Pa.call(this,gc,hc,yc,xc)}function za(gc,hc,yc,xc){Pa.call(this,gc,hc,yc,xc)}function Na(gc,hc,yc){Pa.call(this,gc,hc,yc)}function Ba(gc,hc,yc,xc){Pa.call(this,gc,hc,yc,xc)}function Fa(){Pa.apply(this,arguments)}function Oa(gc,hc,yc){this.name=gc,this.tracks=yc,this.duration=hc===void 0?-1:hc,this.uuid=xl.generateUUID(),0>this.duration&&this.resetDuration(),this.optimize()}function Ga(gc){this.manager=gc===void 0?Jp:gc,this.textures={}}function Ha(gc){this.manager=gc===void 0?Jp:gc}function Va(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function ka(gc){'boolean'==typeof gc&&(void 0,gc=void 0),this.manager=gc===void 0?Jp:gc,this.withCredentials=!1}function Wa(gc){this.manager=gc===void 0?Jp:gc,this.texturePath=''}function ja(gc,hc,yc,xc,vc){var _c=0.5*(xc-hc),Ec=0.5*(vc-yc),Tc=gc*gc;return(2*yc-2*xc+_c+Ec)*(gc*Tc)+(-3*yc+3*xc-2*_c-Ec)*Tc+_c*gc+yc}function Xa(gc,hc){var yc=1-gc;return yc*yc*hc}function Ya(gc,hc){return 2*(1-gc)*gc*hc}function Za(gc,hc){return gc*gc*hc}function Ka(gc,hc,yc,xc){return Xa(gc,hc)+Ya(gc,yc)+Za(gc,xc)}function Ja(gc,hc){var yc=1-gc;return yc*yc*yc*hc}function Qa(gc,hc){var yc=1-gc;return 3*yc*yc*gc*hc}function $a(gc,hc){return 3*(1-gc)*gc*gc*hc}function eo(gc,hc){return gc*gc*gc*hc}function ro(gc,hc,yc,xc,vc){return Ja(gc,hc)+Qa(gc,yc)+$a(gc,xc)+eo(gc,vc)}function ao(){}function oo(gc,hc){this.v1=gc,this.v2=hc}function io(){this.curves=[],this.autoClose=!1}function no(gc,hc,yc,xc,vc,_c,Ec,Tc){this.aX=gc,this.aY=hc,this.xRadius=yc,this.yRadius=xc,this.aStartAngle=vc,this.aEndAngle=_c,this.aClockwise=Ec,this.aRotation=Tc||0}function so(gc){this.points=gc===void 0?[]:gc}function lo(gc,hc,yc,xc){this.v0=gc,this.v1=hc,this.v2=yc,this.v3=xc}function po(gc,hc,yc){this.v0=gc,this.v1=hc,this.v2=yc}function co(gc){io.call(this),this.currentPoint=new R,gc&&this.fromPoints(gc)}function uo(){co.apply(this,arguments),this.holes=[]}function mo(){this.subPaths=[],this.currentPath=null}function fo(gc){this.data=gc}function go(gc){this.manager=gc===void 0?Jp:gc}function yo(gc){this.manager=gc===void 0?Jp:gc}function xo(gc,hc,yc,xc){ya.call(this,gc,hc),this.type='RectAreaLight',this.position.set(0,1,0),this.updateMatrix(),this.width=yc===void 0?10:yc,this.height=xc===void 0?10:xc}function vo(){this.type='StereoCamera',this.aspect=1,this.eyeSep=0.064,this.cameraL=new Tt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Tt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function _o(gc,hc,yc){Ze.call(this),this.type='CubeCamera';var xc=90,vc=1,_c=new Tt(xc,vc,gc,hc);_c.up.set(0,-1,0),_c.lookAt(new O(1,0,0)),this.add(_c);var Ec=new Tt(xc,vc,gc,hc);Ec.up.set(0,-1,0),Ec.lookAt(new O(-1,0,0)),this.add(Ec);var Tc=new Tt(xc,vc,gc,hc);Tc.up.set(0,0,1),Tc.lookAt(new O(0,1,0)),this.add(Tc);var Mc=new Tt(xc,vc,gc,hc);Mc.up.set(0,0,-1),Mc.lookAt(new O(0,-1,0)),this.add(Mc);var Sc=new Tt(xc,vc,gc,hc);Sc.up.set(0,-1,0),Sc.lookAt(new O(0,0,1)),this.add(Sc);var Lc=new Tt(xc,vc,gc,hc);Lc.up.set(0,-1,0),Lc.lookAt(new O(0,0,-1)),this.add(Lc);this.renderTarget=new D(yc,yc,{format:Ms,magFilter:ns,minFilter:ns}),this.updateCubeMap=function(Ac,Rc){null===this.parent&&this.updateMatrixWorld();var Pc=this.renderTarget,Cc=Pc.texture.generateMipmaps;Pc.texture.generateMipmaps=!1,Pc.activeCubeFace=0,Ac.render(Rc,_c,Pc),Pc.activeCubeFace=1,Ac.render(Rc,Ec,Pc),Pc.activeCubeFace=2,Ac.render(Rc,Tc,Pc),Pc.activeCubeFace=3,Ac.render(Rc,Mc,Pc),Pc.activeCubeFace=4,Ac.render(Rc,Sc,Pc),Pc.texture.generateMipmaps=Cc,Pc.activeCubeFace=5,Ac.render(Rc,Lc,Pc),Ac.setRenderTarget(null)}}function bo(){Ze.call(this),this.type='AudioListener',this.context=rc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Eo(gc){Ze.call(this),this.type='Audio',this.context=gc.context,this.gain=this.context.createGain(),this.gain.connect(gc.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType='empty',this.filters=[]}function To(gc){Eo.call(this,gc),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function Mo(gc,hc){this.analyser=gc.context.createAnalyser(),this.analyser.fftSize=hc===void 0?2048:hc,this.data=new Uint8Array(this.analyser.frequencyBinCount),gc.getOutput().connect(this.analyser)}function So(gc,hc,yc){this.binding=gc,this.valueSize=yc;var xc=Float64Array,vc;'quaternion'===hc?vc=this._slerp:'string'===hc||'bool'===hc?(xc=Array,vc=this._select):vc=this._lerp;this.buffer=new xc(4*yc),this._mixBufferRegion=vc,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Lo(gc,hc,yc){this.path=hc,this.parsedPath=yc||Lo.parseTrackName(hc),this.node=Lo.findNode(gc,this.parsedPath.nodeName)||gc,this.rootNode=gc}function wo(){this.uuid=xl.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var hc={};this._indicesByUUID=hc;for(var yc=0,xc=arguments.length;yc!==xc;++yc)hc[arguments[yc].uuid]=yc;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var vc=this;this.stats={objects:{get total(){return vc._objects.length},get inUse(){return this.total-vc.nCachedObjects_}},get bindingsPerObject(){return vc._bindings.length}}}function Ao(gc,hc,yc){this._mixer=gc,this._clip=hc,this._localRoot=yc||null;for(var xc=hc.tracks,vc=xc.length,_c=Array(vc),Ec={endingStart:Xs,endingEnd:Xs},Tc=0,Mc;Tc!==vc;++Tc)Mc=xc[Tc].createInterpolant(null),_c[Tc]=Mc,Mc.settings=Ec;this._interpolantSettings=Ec,this._interpolants=_c,this._propertyBindings=Array(vc),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Hs,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=Infinity,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Ro(gc){this._root=gc,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Po(gc){'string'==typeof gc&&(void 0,gc=arguments[1]),this.value=gc}function Co(){gt.call(this),this.type='InstancedBufferGeometry',this.maxInstancedCount=void 0}function Io(gc,hc,yc,xc){this.uuid=xl.generateUUID(),this.data=gc,this.itemSize=hc,this.offset=yc,this.normalized=!0===xc}function Uo(gc,hc){this.uuid=xl.generateUUID(),this.array=gc,this.stride=hc,this.count=gc===void 0?0:gc.length/hc,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function Do(gc,hc,yc){Uo.call(this,gc,hc),this.meshPerAttribute=yc||1}function zo(gc,hc,yc){et.call(this,gc,hc),this.meshPerAttribute=yc||1}function No(gc,hc,yc,xc){this.ray=new Xe(gc,hc),this.near=yc||0,this.far=xc||Infinity,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return this.Points}}})}function Bo(gc,hc){return gc.distance-hc.distance}function Fo(gc,hc,yc,xc){if(!1!==gc.visible&&(gc.raycast(hc,yc),!0===xc))for(var vc=gc.children,_c=0,Ec=vc.length;_c<Ec;_c++)Fo(vc[_c],hc,yc,!0)}function Oo(gc){this.autoStart=!(gc!==void 0)||gc,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Go(gc,hc,yc){return this.radius=void 0===gc?1:gc,this.phi=void 0===hc?0:hc,this.theta=void 0===yc?0:yc,this}function Ho(gc,hc,yc){return this.radius=void 0===gc?1:gc,this.theta=void 0===hc?0:hc,this.y=void 0===yc?0:yc,this}function Vo(gc,hc){ht.call(this,gc,hc),this.animationsMap={},this.animationsList=[];var yc=this.geometry.morphTargets.length,xc='__default';this.createAnimation(xc,0,yc-1,yc/1),this.setAnimationWeight(xc,1)}function ko(gc){Ze.call(this),this.material=gc,this.render=function(){}}function Wo(gc,hc,yc,xc){this.object=gc,this.size=hc===void 0?1:hc;var vc=yc===void 0?16711680:yc,_c=xc===void 0?1:xc,Ec=0,Tc=this.object.geometry;Tc&&Tc.isGeometry?Ec=3*Tc.faces.length:Tc&&Tc.isBufferGeometry&&(Ec=Tc.attributes.normal.count);var Mc=new gt,Sc=new lt(3*(2*Ec),3);Mc.addAttribute('position',Sc),pr.call(this,Mc,new lr({color:vc,linewidth:_c})),this.matrixAutoUpdate=!1,this.update()}function jo(gc){Ze.call(this),this.light=gc,this.light.updateMatrixWorld(),this.matrix=gc.matrixWorld,this.matrixAutoUpdate=!1;for(var hc=new gt,yc=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],xc=0,vc=1,_c=32;xc<_c;xc++,vc++){var Ec=2*(xc/_c*_MathPI),Tc=2*(vc/_c*_MathPI);yc.push(_Mathcos(Ec),_Mathsin(Ec),1,_Mathcos(Tc),_Mathsin(Tc),1)}hc.addAttribute('position',new lt(yc,3));var Mc=new lr({fog:!1});this.cone=new pr(hc,Mc),this.add(this.cone),this.update()}function Xo(gc){this.bones=this.getBoneList(gc);for(var hc=new gt,yc=[],xc=[],vc=new Ie(0,0,1),_c=new Ie(0,1,0),Ec=0,Tc;Ec<this.bones.length;Ec++)Tc=this.bones[Ec],Tc.parent&&Tc.parent.isBone&&(yc.push(0,0,0),yc.push(0,0,0),xc.push(vc.r,vc.g,vc.b),xc.push(_c.r,_c.g,_c.b));hc.addAttribute('position',new lt(yc,3)),hc.addAttribute('color',new lt(xc,3));var Mc=new lr({vertexColors:on,depthTest:!1,depthWrite:!1,transparent:!0});pr.call(this,hc,Mc),this.root=gc,this.matrix=gc.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Yo(gc,hc){this.light=gc,this.light.updateMatrixWorld();var yc=new Gr(hc,4,2),xc=new $e({wireframe:!0,fog:!1});xc.color.copy(this.light.color).multiplyScalar(this.light.intensity),ht.call(this,yc,xc),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function qo(gc){Ze.call(this),this.light=gc,this.light.updateMatrixWorld();var hc=new $e({color:gc.color,fog:!1}),yc=new $e({color:gc.color,fog:!1,wireframe:!0}),xc=new gt;xc.addAttribute('position',new et(new Float32Array(18),3)),this.add(new ht(xc,hc)),this.add(new ht(xc,yc)),this.update()}function Zo(gc,hc){Ze.call(this),this.light=gc,this.light.updateMatrixWorld(),this.matrix=gc.matrixWorld,this.matrixAutoUpdate=!1;var yc=new Lr(hc);yc.rotateY(0.5*_MathPI);var xc=new $e({vertexColors:on,wireframe:!0}),vc=yc.getAttribute('position'),_c=new Float32Array(3*vc.count);yc.addAttribute('color',new et(_c,3)),this.add(new ht(yc,xc)),this.update()}function Ko(gc,hc,yc,xc){gc=gc||10,hc=hc||10,yc=new Ie(yc===void 0?4473924:yc),xc=new Ie(xc===void 0?8947848:xc);for(var vc=hc/2,_c=gc/hc,Ec=gc/2,Tc=[],Mc=[],Sc=0,Lc=0,wc=-Ec;Sc<=hc;Sc++,wc+=_c){Tc.push(-Ec,0,wc,Ec,0,wc),Tc.push(wc,0,-Ec,wc,0,Ec);var Ac=Sc===vc?yc:xc;Ac.toArray(Mc,Lc),Lc+=3,Ac.toArray(Mc,Lc),Lc+=3,Ac.toArray(Mc,Lc),Lc+=3,Ac.toArray(Mc,Lc),Lc+=3}var Rc=new gt;Rc.addAttribute('position',new lt(Tc,3)),Rc.addAttribute('color',new lt(Mc,3));var Pc=new lr({vertexColors:on});pr.call(this,Rc,Pc)}function Jo(gc,hc,yc,xc,vc,_c){gc=gc||10,hc=hc||16,yc=yc||8,xc=xc||64,vc=new Ie(vc===void 0?4473924:vc),_c=new Ie(_c===void 0?8947848:_c);var Ec=[],Tc=[],Mc,Sc,Lc,wc,Ac,Rc,Pc;for(wc=0;wc<=hc;wc++)Lc=wc/hc*(2*_MathPI),Mc=_Mathsin(Lc)*gc,Sc=_Mathcos(Lc)*gc,Ec.push(0,0,0),Ec.push(Mc,0,Sc),Pc=1&wc?vc:_c,Tc.push(Pc.r,Pc.g,Pc.b),Tc.push(Pc.r,Pc.g,Pc.b);for(wc=0;wc<=yc;wc++)for(Pc=1&wc?vc:_c,Rc=gc-gc/yc*wc,Ac=0;Ac<xc;Ac++)Lc=Ac/xc*(2*_MathPI),Mc=_Mathsin(Lc)*Rc,Sc=_Mathcos(Lc)*Rc,Ec.push(Mc,0,Sc),Tc.push(Pc.r,Pc.g,Pc.b),Lc=(Ac+1)/xc*(2*_MathPI),Mc=_Mathsin(Lc)*Rc,Sc=_Mathcos(Lc)*Rc,Ec.push(Mc,0,Sc),Tc.push(Pc.r,Pc.g,Pc.b);var Cc=new gt;Cc.addAttribute('position',new lt(Ec,3)),Cc.addAttribute('color',new lt(Tc,3));var Ic=new lr({vertexColors:on});pr.call(this,Cc,Ic)}function Qo(gc,hc,yc,xc){this.object=gc,this.size=hc===void 0?1:hc;var vc=yc===void 0?16776960:yc,_c=xc===void 0?1:xc,Ec=0,Tc=this.object.geometry;Tc&&Tc.isGeometry?Ec=Tc.faces.length:void 0;var Mc=new gt,Sc=new lt(3*(2*Ec),3);Mc.addAttribute('position',Sc),pr.call(this,Mc,new lr({color:vc,linewidth:_c})),this.matrixAutoUpdate=!1,this.update()}function $o(gc,hc){Ze.call(this),this.light=gc,this.light.updateMatrixWorld(),this.matrix=gc.matrixWorld,this.matrixAutoUpdate=!1,hc===void 0&&(hc=1);var yc=new gt;yc.addAttribute('position',new lt([-hc,hc,0,hc,hc,0,hc,-hc,0,-hc,-hc,0,-hc,hc,0],3));var xc=new lr({fog:!1});this.add(new dr(yc,xc)),yc=new gt,yc.addAttribute('position',new lt([0,0,0,0,0,1],3)),this.add(new dr(yc,xc)),this.update()}function ei(gc){function hc(Rc,Pc,Cc){yc(Rc,Cc),yc(Pc,Cc)}function yc(Rc,Pc){_c.push(0,0,0),Ec.push(Pc.r,Pc.g,Pc.b),Tc[Rc]===void 0&&(Tc[Rc]=[]),Tc[Rc].push(_c.length/3-1)}var xc=new gt,vc=new lr({color:16777215,vertexColors:an}),_c=[],Ec=[],Tc={},Mc=new Ie(16755200),Sc=new Ie(16711680),Lc=new Ie(43775),wc=new Ie(16777215),Ac=new Ie(3355443);hc('n1','n2',Mc),hc('n2','n4',Mc),hc('n4','n3',Mc),hc('n3','n1',Mc),hc('f1','f2',Mc),hc('f2','f4',Mc),hc('f4','f3',Mc),hc('f3','f1',Mc),hc('n1','f1',Mc),hc('n2','f2',Mc),hc('n3','f3',Mc),hc('n4','f4',Mc),hc('p','n1',Sc),hc('p','n2',Sc),hc('p','n3',Sc),hc('p','n4',Sc),hc('u1','u2',Lc),hc('u2','u3',Lc),hc('u3','u1',Lc),hc('c','t',wc),hc('p','c',Ac),hc('cn1','cn2',Ac),hc('cn3','cn4',Ac),hc('cf1','cf2',Ac),hc('cf3','cf4',Ac),xc.addAttribute('position',new lt(_c,3)),xc.addAttribute('color',new lt(Ec,3)),pr.call(this,xc,vc),this.camera=gc,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=gc.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=Tc,this.update()}function ti(gc,hc){hc===void 0&&(hc=16776960);var yc=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),xc=new Float32Array(24),vc=new gt;vc.setIndex(new et(yc,1)),vc.addAttribute('position',new et(xc,3)),pr.call(this,vc,new lr({color:hc})),gc!==void 0&&this.update(gc)}function ri(gc,hc,yc,xc,vc,_c){Ze.call(this),xc===void 0&&(xc=16776960),yc===void 0&&(yc=1),vc===void 0&&(vc=0.2*yc),_c===void 0&&(_c=0.2*vc),oc==void 0&&(oc=new gt,oc.addAttribute('position',new lt([0,0,0,0,1,0],3)),ic=new Zr(0,0.5,1,5,1),ic.translate(0,-0.5,0)),this.position.copy(hc),this.line=new dr(oc,new lr({color:xc})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ht(ic,new $e({color:xc})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(gc),this.setLength(yc,vc,_c)}function ai(gc){gc=gc||1;var hc=[0,0,0,gc,0,0,0,0,0,0,gc,0,0,0,0,0,0,gc],xc=new gt;xc.addAttribute('position',new lt(hc,3)),xc.addAttribute('color',new lt([1,0,0,1,0.6,0,0,1,0,0.6,1,0,0,0,1,0,0.6,1],3));var vc=new lr({vertexColors:on});pr.call(this,xc,vc)}function oi(){function gc(_c,Ec,Tc,Mc){hc=_c,yc=Tc,xc=-3*_c+3*Ec-2*Tc-Mc,vc=2*_c-2*Ec+Tc+Mc}var hc=0,yc=0,xc=0,vc=0;return{initCatmullRom:function(_c,Ec,Tc,Mc,Sc){gc(Ec,Tc,Sc*(Tc-_c),Sc*(Mc-Ec))},initNonuniformCatmullRom:function(_c,Ec,Tc,Mc,Sc,Lc,wc){var Ac=(Ec-_c)/Sc-(Tc-_c)/(Sc+Lc)+(Tc-Ec)/Lc,Rc=(Tc-Ec)/Lc-(Mc-Ec)/(Lc+wc)+(Mc-Tc)/wc;Ac*=Lc,Rc*=Lc,gc(Ec,Tc,Ac,Rc)},calc:function(_c){var Ec=_c*_c;return hc+yc*_c+xc*Ec+vc*(Ec*_c)}}}function ii(gc){this.points=gc||[],this.closed=!1}function ni(gc,hc,yc,xc){this.v0=gc,this.v1=hc,this.v2=yc,this.v3=xc}function si(gc,hc,yc){this.v0=gc,this.v1=hc,this.v2=yc}function li(gc,hc){this.v1=gc,this.v2=hc}function di(gc,hc,yc,xc,vc,_c){no.call(this,gc,hc,yc,yc,xc,vc,_c)}function Pi(gc){void 0,ii.call(this,gc),this.type='catmullrom',this.closed=!0}function Ci(gc){void 0,ii.call(this,gc),this.type='catmullrom'}function Ii(gc){void 0,ii.call(this,gc),this.type='catmullrom'}_NumberEPSILON===void 0&&(_NumberEPSILON=2.220446049250313e-16),_Mathsign===void 0&&(_Mathsign=function(gc){return 0>gc?-1:0<gc?1:+gc}),Function.prototype.name===void 0&&Object.defineProperty(Function.prototype,'name',{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&function(){Object.assign=function(gc){'use strict';if(gc===void 0||null===gc)throw new TypeError('Cannot convert undefined or null to object');for(var hc=Object(gc),yc=1,xc;yc<arguments.length;yc++)if(xc=arguments[yc],void 0!==xc&&null!==xc)for(var vc in xc)Object.prototype.hasOwnProperty.call(xc,vc)&&(hc[vc]=xc[vc]);return hc}}(),A.prototype={addEventListener:function(gc,hc){this._listeners===void 0&&(this._listeners={});var yc=this._listeners;yc[gc]===void 0&&(yc[gc]=[]),-1===yc[gc].indexOf(hc)&&yc[gc].push(hc)},hasEventListener:function(gc,hc){if(this._listeners===void 0)return!1;var yc=this._listeners;return yc[gc]!==void 0&&-1!==yc[gc].indexOf(hc)},removeEventListener:function(gc,hc){if(void 0!==this._listeners){var yc=this._listeners,xc=yc[gc];if(void 0!==xc){var vc=xc.indexOf(hc);-1!==vc&&xc.splice(vc,1)}}},dispatchEvent:function(gc){if(void 0!==this._listeners){var hc=this._listeners,yc=hc[gc.type];if(void 0!==yc){gc.target=this;var xc=[],vc=0,_c=yc.length;for(vc=0;vc<_c;vc++)xc[vc]=yc[vc];for(vc=0;vc<_c;vc++)xc[vc].call(this,gc)}}}};var Vi=0,ki=1,Wi=2,Xi=0,Zi=1,Ki=2,Ji=0,Qi=1,$i=2,en=1,tn=2,rn=0,an=1,on=2,nn=0,sn=1,ln=2,dn=3,pn=4,cn=5,un=100,mn=101,gn=102,hn=103,yn=104,xn=200,vn=201,_n=202,bn=203,En=204,Tn=205,Mn=206,Sn=207,Ln=208,wn=209,An=210,Rn=0,Pn=1,Cn=2,In=3,Un=4,Dn=5,zn=6,Nn=7,Bn=0,Fn=1,On=2,Gn=0,Hn=1,Vn=2,kn=3,Wn=4,jn=300,Xn=301,Yn=302,qn=303,Zn=304,Kn=305,Jn=306,Qn=307,$n=1e3,es=1001,ts=1002,as=1003,os=1004,is=1005,ns=1006,ss=1007,ls=1008,ds=1009,ps=1010,us=1011,ms=1012,fs=1013,gs=1014,hs=1015,ys=1016,xs=1017,vs=1018,_s=1019,Es=1020,Ts=1021,Ms=1022,Ss=1023,Ls=1024,ws=1025,Rs=1026,Ps=1027,Cs=2001,Is=2002,Us=2003,Ds=2004,zs=2100,Ns=2101,Bs=2102,Fs=2103,Os=2151,Gs=2200,Hs=2201,Vs=2202,ks=2300,Ws=2301,js=2302,Xs=2400,Ys=2401,qs=2402,Zs=0,Ks=1,Js=2,Qs=3e3,$s=3001,el=3007,rl=3002,nl=3004,dl=3005,cl=3006,ul=3200,yl=3201,xl={DEG2RAD:_MathPI/180,RAD2DEG:180/_MathPI,generateUUID:function(){var gc='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''),hc=Array(36),yc=0,xc;return function(){for(var _c=0;36>_c;_c++)8===_c||13===_c||18===_c||23===_c?hc[_c]='-':14===_c?hc[_c]='4':(2>=yc&&(yc=0|33554432+16777216*Math.random()),xc=15&yc,yc>>=4,hc[_c]=gc[19===_c?8|3&xc:xc]);return hc.join('')}}(),clamp:function(gc,hc,yc){return _Mathmax(hc,_Mathmin(yc,gc))},euclideanModulo:function(gc,hc){return(gc%hc+hc)%hc},mapLinear:function(gc,hc,yc,xc,vc){return xc+(gc-hc)*(vc-xc)/(yc-hc)},lerp:function(gc,hc,yc){return(1-yc)*gc+yc*hc},smoothstep:function(gc,hc,yc){return gc<=hc?0:gc>=yc?1:(gc=(gc-hc)/(yc-hc),gc*gc*(3-2*gc))},smootherstep:function(gc,hc,yc){return gc<=hc?0:gc>=yc?1:(gc=(gc-hc)/(yc-hc),gc*gc*gc*(gc*(6*gc-15)+10))},randInt:function(gc,hc){return gc+_Mathfloor(Math.random()*(hc-gc+1))},randFloat:function(gc,hc){return gc+Math.random()*(hc-gc)},randFloatSpread:function(gc){return gc*(0.5-Math.random())},degToRad:function(gc){return gc*xl.DEG2RAD},radToDeg:function(gc){return gc*xl.RAD2DEG},isPowerOfTwo:function(gc){return 0==(gc&gc-1)&&0!==gc},nearestPowerOfTwo:function(gc){return _Mathpow(2,_Mathround(_Mathlog(gc)/_MathLN))},nextPowerOfTwo:function(gc){return gc--,gc|=gc>>1,gc|=gc>>2,gc|=gc>>4,gc|=gc>>8,gc|=gc>>16,gc++,gc}};R.prototype={constructor:R,isVector2:!0,get width(){return this.x},set width(gc){this.x=gc},get height(){return this.y},set height(gc){this.y=gc},set:function(gc,hc){return this.x=gc,this.y=hc,this},setScalar:function(gc){return this.x=gc,this.y=gc,this},setX:function(gc){return this.x=gc,this},setY:function(gc){return this.y=gc,this},setComponent:function(gc,hc){switch(gc){case 0:this.x=hc;break;case 1:this.y=hc;break;default:throw new Error('index is out of range: '+gc);}return this},getComponent:function(gc){switch(gc){case 0:return this.x;case 1:return this.y;default:throw new Error('index is out of range: '+gc);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(gc){return this.x=gc.x,this.y=gc.y,this},add:function(gc,hc){return void 0===hc?(this.x+=gc.x,this.y+=gc.y,this):this.addVectors(gc,hc)},addScalar:function(gc){return this.x+=gc,this.y+=gc,this},addVectors:function(gc,hc){return this.x=gc.x+hc.x,this.y=gc.y+hc.y,this},addScaledVector:function(gc,hc){return this.x+=gc.x*hc,this.y+=gc.y*hc,this},sub:function(gc,hc){return void 0===hc?(this.x-=gc.x,this.y-=gc.y,this):this.subVectors(gc,hc)},subScalar:function(gc){return this.x-=gc,this.y-=gc,this},subVectors:function(gc,hc){return this.x=gc.x-hc.x,this.y=gc.y-hc.y,this},multiply:function(gc){return this.x*=gc.x,this.y*=gc.y,this},multiplyScalar:function(gc){return isFinite(gc)?(this.x*=gc,this.y*=gc):(this.x=0,this.y=0),this},divide:function(gc){return this.x/=gc.x,this.y/=gc.y,this},divideScalar:function(gc){return this.multiplyScalar(1/gc)},min:function(gc){return this.x=_Mathmin(this.x,gc.x),this.y=_Mathmin(this.y,gc.y),this},max:function(gc){return this.x=_Mathmax(this.x,gc.x),this.y=_Mathmax(this.y,gc.y),this},clamp:function(gc,hc){return this.x=_Mathmax(gc.x,_Mathmin(hc.x,this.x)),this.y=_Mathmax(gc.y,_Mathmin(hc.y,this.y)),this},clampScalar:function(){var gc,hc;return function(xc,vc){return void 0==gc&&(gc=new R,hc=new R),gc.set(xc,xc),hc.set(vc,vc),this.clamp(gc,hc)}}(),clampLength:function(gc,hc){var yc=this.length();return this.multiplyScalar(_Mathmax(gc,_Mathmin(hc,yc))/yc)},floor:function(){return this.x=_Mathfloor(this.x),this.y=_Mathfloor(this.y),this},ceil:function(){return this.x=_Mathceil(this.x),this.y=_Mathceil(this.y),this},round:function(){return this.x=_Mathround(this.x),this.y=_Mathround(this.y),this},roundToZero:function(){return this.x=0>this.x?_Mathceil(this.x):_Mathfloor(this.x),this.y=0>this.y?_Mathceil(this.y):_Mathfloor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(gc){return this.x*gc.x+this.y*gc.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return _Mathsqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return _Mathabs(this.x)+_Mathabs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var gc=_Mathatan(this.y,this.x);return 0>gc&&(gc+=2*_MathPI),gc},distanceTo:function(gc){return _Mathsqrt(this.distanceToSquared(gc))},distanceToSquared:function(gc){var hc=this.x-gc.x,yc=this.y-gc.y;return hc*hc+yc*yc},distanceToManhattan:function(gc){return _Mathabs(this.x-gc.x)+_Mathabs(this.y-gc.y)},setLength:function(gc){return this.multiplyScalar(gc/this.length())},lerp:function(gc,hc){return this.x+=(gc.x-this.x)*hc,this.y+=(gc.y-this.y)*hc,this},lerpVectors:function(gc,hc,yc){return this.subVectors(hc,gc).multiplyScalar(yc).add(gc)},equals:function(gc){return gc.x===this.x&&gc.y===this.y},fromArray:function(gc,hc){return void 0===hc&&(hc=0),this.x=gc[hc],this.y=gc[hc+1],this},toArray:function(gc,hc){return void 0===gc&&(gc=[]),void 0===hc&&(hc=0),gc[hc]=this.x,gc[hc+1]=this.y,gc},fromBufferAttribute:function(gc,hc){return this.x=gc.getX(hc),this.y=gc.getY(hc),this},rotateAround:function(gc,hc){var yc=_Mathcos(hc),xc=_Mathsin(hc),vc=this.x-gc.x,_c=this.y-gc.y;return this.x=vc*yc-_c*xc+gc.x,this.y=vc*xc+_c*yc+gc.y,this}};var _l=0;C.DEFAULT_IMAGE=void 0,C.DEFAULT_MAPPING=jn,C.prototype={constructor:C,isTexture:!0,set needsUpdate(gc){!0===gc&&this.version++},clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.image=gc.image,this.mipmaps=gc.mipmaps.slice(0),this.mapping=gc.mapping,this.wrapS=gc.wrapS,this.wrapT=gc.wrapT,this.magFilter=gc.magFilter,this.minFilter=gc.minFilter,this.anisotropy=gc.anisotropy,this.format=gc.format,this.type=gc.type,this.offset.copy(gc.offset),this.repeat.copy(gc.repeat),this.generateMipmaps=gc.generateMipmaps,this.premultiplyAlpha=gc.premultiplyAlpha,this.flipY=gc.flipY,this.unpackAlignment=gc.unpackAlignment,this.encoding=gc.encoding,this},toJSON:function(gc){function hc(vc){var _c;return void 0===vc.toDataURL?(_c=document.createElementNS('http://www.w3.org/1999/xhtml','canvas'),_c.width=vc.width,_c.height=vc.height,_c.getContext('2d').drawImage(vc,0,0,vc.width,vc.height)):_c=vc,2048<_c.width||2048<_c.height?_c.toDataURL('image/jpeg',0.6):_c.toDataURL('image/png')}if(void 0!==gc.textures[this.uuid])return gc.textures[this.uuid];var yc={metadata:{version:4.4,type:'Texture',generator:'Texture.toJSON'},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var xc=this.image;void 0===xc.uuid&&(xc.uuid=xl.generateUUID()),void 0===gc.images[xc.uuid]&&(gc.images[xc.uuid]={uuid:xc.uuid,url:hc(xc)}),yc.image=xc.uuid}return gc.textures[this.uuid]=yc,yc},dispose:function(){this.dispatchEvent({type:'dispose'})},transformUv:function(gc){if(this.mapping===jn){if(gc.multiply(this.repeat),gc.add(this.offset),0>gc.x||1<gc.x)switch(this.wrapS){case $n:gc.x-=_Mathfloor(gc.x);break;case es:gc.x=0>gc.x?0:1;break;case ts:1===_Mathabs(_Mathfloor(gc.x)%2)?gc.x=_Mathceil(gc.x)-gc.x:gc.x-=_Mathfloor(gc.x);}if(0>gc.y||1<gc.y)switch(this.wrapT){case $n:gc.y-=_Mathfloor(gc.y);break;case es:gc.y=0>gc.y?0:1;break;case ts:1===_Mathabs(_Mathfloor(gc.y)%2)?gc.y=_Mathceil(gc.y)-gc.y:gc.y-=_Mathfloor(gc.y);}this.flipY&&(gc.y=1-gc.y)}}},Object.assign(C.prototype,A.prototype),I.prototype={constructor:I,isVector4:!0,set:function(gc,hc,yc,xc){return this.x=gc,this.y=hc,this.z=yc,this.w=xc,this},setScalar:function(gc){return this.x=gc,this.y=gc,this.z=gc,this.w=gc,this},setX:function(gc){return this.x=gc,this},setY:function(gc){return this.y=gc,this},setZ:function(gc){return this.z=gc,this},setW:function(gc){return this.w=gc,this},setComponent:function(gc,hc){switch(gc){case 0:this.x=hc;break;case 1:this.y=hc;break;case 2:this.z=hc;break;case 3:this.w=hc;break;default:throw new Error('index is out of range: '+gc);}return this},getComponent:function(gc){switch(gc){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error('index is out of range: '+gc);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(gc){return this.x=gc.x,this.y=gc.y,this.z=gc.z,this.w=void 0===gc.w?1:gc.w,this},add:function(gc,hc){return void 0===hc?(this.x+=gc.x,this.y+=gc.y,this.z+=gc.z,this.w+=gc.w,this):this.addVectors(gc,hc)},addScalar:function(gc){return this.x+=gc,this.y+=gc,this.z+=gc,this.w+=gc,this},addVectors:function(gc,hc){return this.x=gc.x+hc.x,this.y=gc.y+hc.y,this.z=gc.z+hc.z,this.w=gc.w+hc.w,this},addScaledVector:function(gc,hc){return this.x+=gc.x*hc,this.y+=gc.y*hc,this.z+=gc.z*hc,this.w+=gc.w*hc,this},sub:function(gc,hc){return void 0===hc?(this.x-=gc.x,this.y-=gc.y,this.z-=gc.z,this.w-=gc.w,this):this.subVectors(gc,hc)},subScalar:function(gc){return this.x-=gc,this.y-=gc,this.z-=gc,this.w-=gc,this},subVectors:function(gc,hc){return this.x=gc.x-hc.x,this.y=gc.y-hc.y,this.z=gc.z-hc.z,this.w=gc.w-hc.w,this},multiplyScalar:function(gc){return isFinite(gc)?(this.x*=gc,this.y*=gc,this.z*=gc,this.w*=gc):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(gc){var hc=this.x,yc=this.y,xc=this.z,vc=this.w,_c=gc.elements;return this.x=_c[0]*hc+_c[4]*yc+_c[8]*xc+_c[12]*vc,this.y=_c[1]*hc+_c[5]*yc+_c[9]*xc+_c[13]*vc,this.z=_c[2]*hc+_c[6]*yc+_c[10]*xc+_c[14]*vc,this.w=_c[3]*hc+_c[7]*yc+_c[11]*xc+_c[15]*vc,this},divideScalar:function(gc){return this.multiplyScalar(1/gc)},setAxisAngleFromQuaternion:function(gc){this.w=2*_Mathacos(gc.w);var hc=_Mathsqrt(1-gc.w*gc.w);return 1e-4>hc?(this.x=1,this.y=0,this.z=0):(this.x=gc.x/hc,this.y=gc.y/hc,this.z=gc.z/hc),this},setAxisAngleFromRotationMatrix:function(gc){var _c=0.01,Ec=0.1,Tc=gc.elements,Mc=Tc[0],Sc=Tc[4],Lc=Tc[8],wc=Tc[1],Ac=Tc[5],Rc=Tc[9],Pc=Tc[2],Cc=Tc[6],Ic=Tc[10],hc,yc,xc,vc;if(_Mathabs(Sc-wc)<_c&&_Mathabs(Lc-Pc)<_c&&_Mathabs(Rc-Cc)<_c){if(_Mathabs(Sc+wc)<Ec&&_Mathabs(Lc+Pc)<Ec&&_Mathabs(Rc+Cc)<Ec&&_Mathabs(Mc+Ac+Ic-3)<Ec)return this.set(1,0,0,0),this;hc=_MathPI;var Uc=(Mc+1)/2,Dc=(Ac+1)/2,zc=(Ic+1)/2,Nc=(Sc+wc)/4,Bc=(Lc+Pc)/4,Fc=(Rc+Cc)/4;return Uc>Dc&&Uc>zc?Uc<_c?(yc=0,xc=0.707106781,vc=0.707106781):(yc=_Mathsqrt(Uc),xc=Nc/yc,vc=Bc/yc):Dc>zc?Dc<_c?(yc=0.707106781,xc=0,vc=0.707106781):(xc=_Mathsqrt(Dc),yc=Nc/xc,vc=Fc/xc):zc<_c?(yc=0.707106781,xc=0.707106781,vc=0):(vc=_Mathsqrt(zc),yc=Bc/vc,xc=Fc/vc),this.set(yc,xc,vc,hc),this}var Oc=_Mathsqrt((Cc-Rc)*(Cc-Rc)+(Lc-Pc)*(Lc-Pc)+(wc-Sc)*(wc-Sc));return 1e-3>_Mathabs(Oc)&&(Oc=1),this.x=(Cc-Rc)/Oc,this.y=(Lc-Pc)/Oc,this.z=(wc-Sc)/Oc,this.w=_Mathacos((Mc+Ac+Ic-1)/2),this},min:function(gc){return this.x=_Mathmin(this.x,gc.x),this.y=_Mathmin(this.y,gc.y),this.z=_Mathmin(this.z,gc.z),this.w=_Mathmin(this.w,gc.w),this},max:function(gc){return this.x=_Mathmax(this.x,gc.x),this.y=_Mathmax(this.y,gc.y),this.z=_Mathmax(this.z,gc.z),this.w=_Mathmax(this.w,gc.w),this},clamp:function(gc,hc){return this.x=_Mathmax(gc.x,_Mathmin(hc.x,this.x)),this.y=_Mathmax(gc.y,_Mathmin(hc.y,this.y)),this.z=_Mathmax(gc.z,_Mathmin(hc.z,this.z)),this.w=_Mathmax(gc.w,_Mathmin(hc.w,this.w)),this},clampScalar:function(){var gc,hc;return function(xc,vc){return void 0==gc&&(gc=new I,hc=new I),gc.set(xc,xc,xc,xc),hc.set(vc,vc,vc,vc),this.clamp(gc,hc)}}(),floor:function(){return this.x=_Mathfloor(this.x),this.y=_Mathfloor(this.y),this.z=_Mathfloor(this.z),this.w=_Mathfloor(this.w),this},ceil:function(){return this.x=_Mathceil(this.x),this.y=_Mathceil(this.y),this.z=_Mathceil(this.z),this.w=_Mathceil(this.w),this},round:function(){return this.x=_Mathround(this.x),this.y=_Mathround(this.y),this.z=_Mathround(this.z),this.w=_Mathround(this.w),this},roundToZero:function(){return this.x=0>this.x?_Mathceil(this.x):_Mathfloor(this.x),this.y=0>this.y?_Mathceil(this.y):_Mathfloor(this.y),this.z=0>this.z?_Mathceil(this.z):_Mathfloor(this.z),this.w=0>this.w?_Mathceil(this.w):_Mathfloor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(gc){return this.x*gc.x+this.y*gc.y+this.z*gc.z+this.w*gc.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return _Mathsqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return _Mathabs(this.x)+_Mathabs(this.y)+_Mathabs(this.z)+_Mathabs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(gc){return this.multiplyScalar(gc/this.length())},lerp:function(gc,hc){return this.x+=(gc.x-this.x)*hc,this.y+=(gc.y-this.y)*hc,this.z+=(gc.z-this.z)*hc,this.w+=(gc.w-this.w)*hc,this},lerpVectors:function(gc,hc,yc){return this.subVectors(hc,gc).multiplyScalar(yc).add(gc)},equals:function(gc){return gc.x===this.x&&gc.y===this.y&&gc.z===this.z&&gc.w===this.w},fromArray:function(gc,hc){return void 0===hc&&(hc=0),this.x=gc[hc],this.y=gc[hc+1],this.z=gc[hc+2],this.w=gc[hc+3],this},toArray:function(gc,hc){return void 0===gc&&(gc=[]),void 0===hc&&(hc=0),gc[hc]=this.x,gc[hc+1]=this.y,gc[hc+2]=this.z,gc[hc+3]=this.w,gc},fromBufferAttribute:function(gc,hc){return this.x=gc.getX(hc),this.y=gc.getY(hc),this.z=gc.getZ(hc),this.w=gc.getW(hc),this}},U.prototype={constructor:U,isWebGLRenderTarget:!0,setSize:function(gc,hc){(this.width!==gc||this.height!==hc)&&(this.width=gc,this.height=hc,this.dispose()),this.viewport.set(0,0,gc,hc),this.scissor.set(0,0,gc,hc)},clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.width=gc.width,this.height=gc.height,this.viewport.copy(gc.viewport),this.texture=gc.texture.clone(),this.depthBuffer=gc.depthBuffer,this.stencilBuffer=gc.stencilBuffer,this.depthTexture=gc.depthTexture,this},dispose:function(){this.dispatchEvent({type:'dispose'})}},Object.assign(U.prototype,A.prototype),D.prototype=Object.create(U.prototype),D.prototype.constructor=D,D.prototype.isWebGLRenderTargetCube=!0,F.prototype={constructor:F,get x(){return this._x},set x(gc){this._x=gc,this.onChangeCallback()},get y(){return this._y},set y(gc){this._y=gc,this.onChangeCallback()},get z(){return this._z},set z(gc){this._z=gc,this.onChangeCallback()},get w(){return this._w},set w(gc){this._w=gc,this.onChangeCallback()},set:function(gc,hc,yc,xc){return this._x=gc,this._y=hc,this._z=yc,this._w=xc,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(gc){return this._x=gc.x,this._y=gc.y,this._z=gc.z,this._w=gc.w,this.onChangeCallback(),this},setFromEuler:function(gc,hc){if(!1===(gc&&gc.isEuler))throw new Error('THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.');var yc=_Mathcos(gc._x/2),xc=_Mathcos(gc._y/2),vc=_Mathcos(gc._z/2),_c=_Mathsin(gc._x/2),Ec=_Mathsin(gc._y/2),Tc=_Mathsin(gc._z/2),Mc=gc.order;return'XYZ'===Mc?(this._x=_c*xc*vc+yc*Ec*Tc,this._y=yc*Ec*vc-_c*xc*Tc,this._z=yc*xc*Tc+_c*Ec*vc,this._w=yc*xc*vc-_c*Ec*Tc):'YXZ'===Mc?(this._x=_c*xc*vc+yc*Ec*Tc,this._y=yc*Ec*vc-_c*xc*Tc,this._z=yc*xc*Tc-_c*Ec*vc,this._w=yc*xc*vc+_c*Ec*Tc):'ZXY'===Mc?(this._x=_c*xc*vc-yc*Ec*Tc,this._y=yc*Ec*vc+_c*xc*Tc,this._z=yc*xc*Tc+_c*Ec*vc,this._w=yc*xc*vc-_c*Ec*Tc):'ZYX'===Mc?(this._x=_c*xc*vc-yc*Ec*Tc,this._y=yc*Ec*vc+_c*xc*Tc,this._z=yc*xc*Tc-_c*Ec*vc,this._w=yc*xc*vc+_c*Ec*Tc):'YZX'===Mc?(this._x=_c*xc*vc+yc*Ec*Tc,this._y=yc*Ec*vc+_c*xc*Tc,this._z=yc*xc*Tc-_c*Ec*vc,this._w=yc*xc*vc-_c*Ec*Tc):'XZY'===Mc&&(this._x=_c*xc*vc-yc*Ec*Tc,this._y=yc*Ec*vc-_c*xc*Tc,this._z=yc*xc*Tc+_c*Ec*vc,this._w=yc*xc*vc+_c*Ec*Tc),!1!==hc&&this.onChangeCallback(),this},setFromAxisAngle:function(gc,hc){var yc=hc/2,xc=_Mathsin(yc);return this._x=gc.x*xc,this._y=gc.y*xc,this._z=gc.z*xc,this._w=_Mathcos(yc),this.onChangeCallback(),this},setFromRotationMatrix:function(gc){var hc=gc.elements,yc=hc[0],xc=hc[4],vc=hc[8],_c=hc[1],Ec=hc[5],Tc=hc[9],Mc=hc[2],Sc=hc[6],Lc=hc[10],wc=yc+Ec+Lc,Ac;return 0<wc?(Ac=0.5/_Mathsqrt(wc+1),this._w=0.25/Ac,this._x=(Sc-Tc)*Ac,this._y=(vc-Mc)*Ac,this._z=(_c-xc)*Ac):yc>Ec&&yc>Lc?(Ac=2*_Mathsqrt(1+yc-Ec-Lc),this._w=(Sc-Tc)/Ac,this._x=0.25*Ac,this._y=(xc+_c)/Ac,this._z=(vc+Mc)/Ac):Ec>Lc?(Ac=2*_Mathsqrt(1+Ec-yc-Lc),this._w=(vc-Mc)/Ac,this._x=(xc+_c)/Ac,this._y=0.25*Ac,this._z=(Tc+Sc)/Ac):(Ac=2*_Mathsqrt(1+Lc-yc-Ec),this._w=(_c-xc)/Ac,this._x=(vc+Mc)/Ac,this._y=(Tc+Sc)/Ac,this._z=0.25*Ac),this.onChangeCallback(),this},setFromUnitVectors:function(){var gc,hc;return function(vc,_c){return void 0==gc&&(gc=new O),hc=vc.dot(_c)+1,hc<1e-6?(hc=0,_Mathabs(vc.x)>_Mathabs(vc.z)?gc.set(-vc.y,vc.x,0):gc.set(0,-vc.z,vc.y)):gc.crossVectors(vc,_c),this._x=gc.x,this._y=gc.y,this._z=gc.z,this._w=hc,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(gc){return this._x*gc._x+this._y*gc._y+this._z*gc._z+this._w*gc._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return _Mathsqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var gc=this.length();return 0===gc?(this._x=0,this._y=0,this._z=0,this._w=1):(gc=1/gc,this._x*=gc,this._y*=gc,this._z*=gc,this._w*=gc),this.onChangeCallback(),this},multiply:function(gc,hc){return void 0===hc?this.multiplyQuaternions(this,gc):this.multiplyQuaternions(gc,hc)},premultiply:function(gc){return this.multiplyQuaternions(gc,this)},multiplyQuaternions:function(gc,hc){var yc=gc._x,xc=gc._y,vc=gc._z,_c=gc._w,Ec=hc._x,Tc=hc._y,Mc=hc._z,Sc=hc._w;return this._x=yc*Sc+_c*Ec+xc*Mc-vc*Tc,this._y=xc*Sc+_c*Tc+vc*Ec-yc*Mc,this._z=vc*Sc+_c*Mc+yc*Tc-xc*Ec,this._w=_c*Sc-yc*Ec-xc*Tc-vc*Mc,this.onChangeCallback(),this},slerp:function(gc,hc){if(0===hc)return this;if(1===hc)return this.copy(gc);var yc=this._x,xc=this._y,vc=this._z,_c=this._w,Ec=_c*gc._w+yc*gc._x+xc*gc._y+vc*gc._z;if(0>Ec?(this._w=-gc._w,this._x=-gc._x,this._y=-gc._y,this._z=-gc._z,Ec=-Ec):this.copy(gc),1<=Ec)return this._w=_c,this._x=yc,this._y=xc,this._z=vc,this;var Tc=_Mathsqrt(1-Ec*Ec);if(1e-3>_Mathabs(Tc))return this._w=0.5*(_c+this._w),this._x=0.5*(yc+this._x),this._y=0.5*(xc+this._y),this._z=0.5*(vc+this._z),this;var Mc=_Mathatan(Tc,Ec),Sc=_Mathsin((1-hc)*Mc)/Tc,Lc=_Mathsin(hc*Mc)/Tc;return this._w=_c*Sc+this._w*Lc,this._x=yc*Sc+this._x*Lc,this._y=xc*Sc+this._y*Lc,this._z=vc*Sc+this._z*Lc,this.onChangeCallback(),this},equals:function(gc){return gc._x===this._x&&gc._y===this._y&&gc._z===this._z&&gc._w===this._w},fromArray:function(gc,hc){return void 0===hc&&(hc=0),this._x=gc[hc],this._y=gc[hc+1],this._z=gc[hc+2],this._w=gc[hc+3],this.onChangeCallback(),this},toArray:function(gc,hc){return void 0===gc&&(gc=[]),void 0===hc&&(hc=0),gc[hc]=this._x,gc[hc+1]=this._y,gc[hc+2]=this._z,gc[hc+3]=this._w,gc},onChange:function(gc){return this.onChangeCallback=gc,this},onChangeCallback:function(){}},Object.assign(F,{slerp:function(gc,hc,yc,xc){return yc.copy(gc).slerp(hc,xc)},slerpFlat:function(gc,hc,yc,xc,vc,_c,Ec){var Tc=yc[xc+0],Mc=yc[xc+1],Sc=yc[xc+2],Lc=yc[xc+3],wc=vc[_c+0],Ac=vc[_c+1],Rc=vc[_c+2],Pc=vc[_c+3];if(Lc!==Pc||Tc!==wc||Mc!==Ac||Sc!==Rc){var Cc=1-Ec,Ic=Tc*wc+Mc*Ac+Sc*Rc+Lc*Pc,Uc=0<=Ic?1:-1,Dc=1-Ic*Ic;if(Dc>_NumberEPSILON){var zc=_Mathsqrt(Dc),Nc=_Mathatan(zc,Ic*Uc);Cc=_Mathsin(Cc*Nc)/zc,Ec=_Mathsin(Ec*Nc)/zc}var Bc=Ec*Uc;if(Tc=Tc*Cc+wc*Bc,Mc=Mc*Cc+Ac*Bc,Sc=Sc*Cc+Rc*Bc,Lc=Lc*Cc+Pc*Bc,Cc==1-Ec){var Fc=1/_Mathsqrt(Tc*Tc+Mc*Mc+Sc*Sc+Lc*Lc);Tc*=Fc,Mc*=Fc,Sc*=Fc,Lc*=Fc}}gc[hc]=Tc,gc[hc+1]=Mc,gc[hc+2]=Sc,gc[hc+3]=Lc}}),O.prototype={constructor:O,isVector3:!0,set:function(gc,hc,yc){return this.x=gc,this.y=hc,this.z=yc,this},setScalar:function(gc){return this.x=gc,this.y=gc,this.z=gc,this},setX:function(gc){return this.x=gc,this},setY:function(gc){return this.y=gc,this},setZ:function(gc){return this.z=gc,this},setComponent:function(gc,hc){switch(gc){case 0:this.x=hc;break;case 1:this.y=hc;break;case 2:this.z=hc;break;default:throw new Error('index is out of range: '+gc);}return this},getComponent:function(gc){switch(gc){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error('index is out of range: '+gc);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(gc){return this.x=gc.x,this.y=gc.y,this.z=gc.z,this},add:function(gc,hc){return void 0===hc?(this.x+=gc.x,this.y+=gc.y,this.z+=gc.z,this):this.addVectors(gc,hc)},addScalar:function(gc){return this.x+=gc,this.y+=gc,this.z+=gc,this},addVectors:function(gc,hc){return this.x=gc.x+hc.x,this.y=gc.y+hc.y,this.z=gc.z+hc.z,this},addScaledVector:function(gc,hc){return this.x+=gc.x*hc,this.y+=gc.y*hc,this.z+=gc.z*hc,this},sub:function(gc,hc){return void 0===hc?(this.x-=gc.x,this.y-=gc.y,this.z-=gc.z,this):this.subVectors(gc,hc)},subScalar:function(gc){return this.x-=gc,this.y-=gc,this.z-=gc,this},subVectors:function(gc,hc){return this.x=gc.x-hc.x,this.y=gc.y-hc.y,this.z=gc.z-hc.z,this},multiply:function(gc,hc){return void 0===hc?(this.x*=gc.x,this.y*=gc.y,this.z*=gc.z,this):this.multiplyVectors(gc,hc)},multiplyScalar:function(gc){return isFinite(gc)?(this.x*=gc,this.y*=gc,this.z*=gc):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(gc,hc){return this.x=gc.x*hc.x,this.y=gc.y*hc.y,this.z=gc.z*hc.z,this},applyEuler:function(){var gc;return function(yc){return!1===(yc&&yc.isEuler)&&void 0,void 0==gc&&(gc=new F),this.applyQuaternion(gc.setFromEuler(yc))}}(),applyAxisAngle:function(){var gc;return function(yc,xc){return void 0==gc&&(gc=new F),this.applyQuaternion(gc.setFromAxisAngle(yc,xc))}}(),applyMatrix3:function(gc){var hc=this.x,yc=this.y,xc=this.z,vc=gc.elements;return this.x=vc[0]*hc+vc[3]*yc+vc[6]*xc,this.y=vc[1]*hc+vc[4]*yc+vc[7]*xc,this.z=vc[2]*hc+vc[5]*yc+vc[8]*xc,this},applyMatrix4:function(gc){var hc=this.x,yc=this.y,xc=this.z,vc=gc.elements;this.x=vc[0]*hc+vc[4]*yc+vc[8]*xc+vc[12],this.y=vc[1]*hc+vc[5]*yc+vc[9]*xc+vc[13],this.z=vc[2]*hc+vc[6]*yc+vc[10]*xc+vc[14];var _c=vc[3]*hc+vc[7]*yc+vc[11]*xc+vc[15];return this.divideScalar(_c)},applyQuaternion:function(gc){var hc=this.x,yc=this.y,xc=this.z,vc=gc.x,_c=gc.y,Ec=gc.z,Tc=gc.w,Mc=Tc*hc+_c*xc-Ec*yc,Sc=Tc*yc+Ec*hc-vc*xc,Lc=Tc*xc+vc*yc-_c*hc,wc=-vc*hc-_c*yc-Ec*xc;return this.x=Mc*Tc+wc*-vc+Sc*-Ec-Lc*-_c,this.y=Sc*Tc+wc*-_c+Lc*-vc-Mc*-Ec,this.z=Lc*Tc+wc*-Ec+Mc*-_c-Sc*-vc,this},project:function(){var gc;return function(yc){return void 0==gc&&(gc=new G),gc.multiplyMatrices(yc.projectionMatrix,gc.getInverse(yc.matrixWorld)),this.applyMatrix4(gc)}}(),unproject:function(){var gc;return function(yc){return void 0==gc&&(gc=new G),gc.multiplyMatrices(yc.matrixWorld,gc.getInverse(yc.projectionMatrix)),this.applyMatrix4(gc)}}(),transformDirection:function(gc){var hc=this.x,yc=this.y,xc=this.z,vc=gc.elements;return this.x=vc[0]*hc+vc[4]*yc+vc[8]*xc,this.y=vc[1]*hc+vc[5]*yc+vc[9]*xc,this.z=vc[2]*hc+vc[6]*yc+vc[10]*xc,this.normalize()},divide:function(gc){return this.x/=gc.x,this.y/=gc.y,this.z/=gc.z,this},divideScalar:function(gc){return this.multiplyScalar(1/gc)},min:function(gc){return this.x=_Mathmin(this.x,gc.x),this.y=_Mathmin(this.y,gc.y),this.z=_Mathmin(this.z,gc.z),this},max:function(gc){return this.x=_Mathmax(this.x,gc.x),this.y=_Mathmax(this.y,gc.y),this.z=_Mathmax(this.z,gc.z),this},clamp:function(gc,hc){return this.x=_Mathmax(gc.x,_Mathmin(hc.x,this.x)),this.y=_Mathmax(gc.y,_Mathmin(hc.y,this.y)),this.z=_Mathmax(gc.z,_Mathmin(hc.z,this.z)),this},clampScalar:function(){var gc,hc;return function(xc,vc){return void 0==gc&&(gc=new O,hc=new O),gc.set(xc,xc,xc),hc.set(vc,vc,vc),this.clamp(gc,hc)}}(),clampLength:function(gc,hc){var yc=this.length();return this.multiplyScalar(_Mathmax(gc,_Mathmin(hc,yc))/yc)},floor:function(){return this.x=_Mathfloor(this.x),this.y=_Mathfloor(this.y),this.z=_Mathfloor(this.z),this},ceil:function(){return this.x=_Mathceil(this.x),this.y=_Mathceil(this.y),this.z=_Mathceil(this.z),this},round:function(){return this.x=_Mathround(this.x),this.y=_Mathround(this.y),this.z=_Mathround(this.z),this},roundToZero:function(){return this.x=0>this.x?_Mathceil(this.x):_Mathfloor(this.x),this.y=0>this.y?_Mathceil(this.y):_Mathfloor(this.y),this.z=0>this.z?_Mathceil(this.z):_Mathfloor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(gc){return this.x*gc.x+this.y*gc.y+this.z*gc.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return _Mathsqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return _Mathabs(this.x)+_Mathabs(this.y)+_Mathabs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(gc){return this.multiplyScalar(gc/this.length())},lerp:function(gc,hc){return this.x+=(gc.x-this.x)*hc,this.y+=(gc.y-this.y)*hc,this.z+=(gc.z-this.z)*hc,this},lerpVectors:function(gc,hc,yc){return this.subVectors(hc,gc).multiplyScalar(yc).add(gc)},cross:function(gc,hc){if(void 0!==hc)return this.crossVectors(gc,hc);var yc=this.x,xc=this.y,vc=this.z;return this.x=xc*gc.z-vc*gc.y,this.y=vc*gc.x-yc*gc.z,this.z=yc*gc.y-xc*gc.x,this},crossVectors:function(gc,hc){var yc=gc.x,xc=gc.y,vc=gc.z,_c=hc.x,Ec=hc.y,Tc=hc.z;return this.x=xc*Tc-vc*Ec,this.y=vc*_c-yc*Tc,this.z=yc*Ec-xc*_c,this},projectOnVector:function(gc){var hc=gc.dot(this)/gc.lengthSq();return this.copy(gc).multiplyScalar(hc)},projectOnPlane:function(){var gc;return function(yc){return void 0==gc&&(gc=new O),gc.copy(this).projectOnVector(yc),this.sub(gc)}}(),reflect:function(){var gc;return function(yc){return void 0==gc&&(gc=new O),this.sub(gc.copy(yc).multiplyScalar(2*this.dot(yc)))}}(),angleTo:function(gc){var hc=this.dot(gc)/_Mathsqrt(this.lengthSq()*gc.lengthSq());return _Mathacos(xl.clamp(hc,-1,1))},distanceTo:function(gc){return _Mathsqrt(this.distanceToSquared(gc))},distanceToSquared:function(gc){var hc=this.x-gc.x,yc=this.y-gc.y,xc=this.z-gc.z;return hc*hc+yc*yc+xc*xc},distanceToManhattan:function(gc){return _Mathabs(this.x-gc.x)+_Mathabs(this.y-gc.y)+_Mathabs(this.z-gc.z)},setFromSpherical:function(gc){var hc=_Mathsin(gc.phi)*gc.radius;return this.x=hc*_Mathsin(gc.theta),this.y=_Mathcos(gc.phi)*gc.radius,this.z=hc*_Mathcos(gc.theta),this},setFromCylindrical:function(gc){return this.x=gc.radius*_Mathsin(gc.theta),this.y=gc.y,this.z=gc.radius*_Mathcos(gc.theta),this},setFromMatrixPosition:function(gc){return this.setFromMatrixColumn(gc,3)},setFromMatrixScale:function(gc){var hc=this.setFromMatrixColumn(gc,0).length(),yc=this.setFromMatrixColumn(gc,1).length(),xc=this.setFromMatrixColumn(gc,2).length();return this.x=hc,this.y=yc,this.z=xc,this},setFromMatrixColumn:function(gc,hc){if('number'==typeof gc){var yc=gc;gc=hc,hc=yc}return this.fromArray(gc.elements,4*hc)},equals:function(gc){return gc.x===this.x&&gc.y===this.y&&gc.z===this.z},fromArray:function(gc,hc){return void 0===hc&&(hc=0),this.x=gc[hc],this.y=gc[hc+1],this.z=gc[hc+2],this},toArray:function(gc,hc){return void 0===gc&&(gc=[]),void 0===hc&&(hc=0),gc[hc]=this.x,gc[hc+1]=this.y,gc[hc+2]=this.z,gc},fromBufferAttribute:function(gc,hc){return this.x=gc.getX(hc),this.y=gc.getY(hc),this.z=gc.getZ(hc),this}},G.prototype={constructor:G,isMatrix4:!0,set:function(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc,Sc,Lc,wc,Ac,Rc,Pc,Cc){var Ic=this.elements;return Ic[0]=gc,Ic[4]=hc,Ic[8]=yc,Ic[12]=xc,Ic[1]=vc,Ic[5]=_c,Ic[9]=Ec,Ic[13]=Tc,Ic[2]=Mc,Ic[6]=Sc,Ic[10]=Lc,Ic[14]=wc,Ic[3]=Ac,Ic[7]=Rc,Ic[11]=Pc,Ic[15]=Cc,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new G().fromArray(this.elements)},copy:function(gc){return this.elements.set(gc.elements),this},copyPosition:function(gc){var hc=this.elements,yc=gc.elements;return hc[12]=yc[12],hc[13]=yc[13],hc[14]=yc[14],this},extractBasis:function(gc,hc,yc){return gc.setFromMatrixColumn(this,0),hc.setFromMatrixColumn(this,1),yc.setFromMatrixColumn(this,2),this},makeBasis:function(gc,hc,yc){return this.set(gc.x,hc.x,yc.x,0,gc.y,hc.y,yc.y,0,gc.z,hc.z,yc.z,0,0,0,0,1),this},extractRotation:function(){var gc;return function(yc){void 0==gc&&(gc=new O);var xc=this.elements,vc=yc.elements,_c=1/gc.setFromMatrixColumn(yc,0).length(),Ec=1/gc.setFromMatrixColumn(yc,1).length(),Tc=1/gc.setFromMatrixColumn(yc,2).length();return xc[0]=vc[0]*_c,xc[1]=vc[1]*_c,xc[2]=vc[2]*_c,xc[4]=vc[4]*Ec,xc[5]=vc[5]*Ec,xc[6]=vc[6]*Ec,xc[8]=vc[8]*Tc,xc[9]=vc[9]*Tc,xc[10]=vc[10]*Tc,this}}(),makeRotationFromEuler:function(gc){!1===(gc&&gc.isEuler);var hc=this.elements,yc=gc.x,xc=gc.y,vc=gc.z,_c=_Mathcos(yc),Ec=_Mathsin(yc),Tc=_Mathcos(xc),Mc=_Mathsin(xc),Sc=_Mathcos(vc),Lc=_Mathsin(vc);if('XYZ'===gc.order){var wc=_c*Sc,Ac=_c*Lc,Rc=Ec*Sc,Pc=Ec*Lc;hc[0]=Tc*Sc,hc[4]=-Tc*Lc,hc[8]=Mc,hc[1]=Ac+Rc*Mc,hc[5]=wc-Pc*Mc,hc[9]=-Ec*Tc,hc[2]=Pc-wc*Mc,hc[6]=Rc+Ac*Mc,hc[10]=_c*Tc}else if('YXZ'===gc.order){var Cc=Tc*Sc,Ic=Tc*Lc,Uc=Mc*Sc,Dc=Mc*Lc;hc[0]=Cc+Dc*Ec,hc[4]=Uc*Ec-Ic,hc[8]=_c*Mc,hc[1]=_c*Lc,hc[5]=_c*Sc,hc[9]=-Ec,hc[2]=Ic*Ec-Uc,hc[6]=Dc+Cc*Ec,hc[10]=_c*Tc}else if('ZXY'===gc.order){var Cc=Tc*Sc,Ic=Tc*Lc,Uc=Mc*Sc,Dc=Mc*Lc;hc[0]=Cc-Dc*Ec,hc[4]=-_c*Lc,hc[8]=Uc+Ic*Ec,hc[1]=Ic+Uc*Ec,hc[5]=_c*Sc,hc[9]=Dc-Cc*Ec,hc[2]=-_c*Mc,hc[6]=Ec,hc[10]=_c*Tc}else if('ZYX'===gc.order){var wc=_c*Sc,Ac=_c*Lc,Rc=Ec*Sc,Pc=Ec*Lc;hc[0]=Tc*Sc,hc[4]=Rc*Mc-Ac,hc[8]=wc*Mc+Pc,hc[1]=Tc*Lc,hc[5]=Pc*Mc+wc,hc[9]=Ac*Mc-Rc,hc[2]=-Mc,hc[6]=Ec*Tc,hc[10]=_c*Tc}else if('YZX'===gc.order){var zc=_c*Tc,Nc=_c*Mc,Bc=Ec*Tc,Fc=Ec*Mc;hc[0]=Tc*Sc,hc[4]=Fc-zc*Lc,hc[8]=Bc*Lc+Nc,hc[1]=Lc,hc[5]=_c*Sc,hc[9]=-Ec*Sc,hc[2]=-Mc*Sc,hc[6]=Nc*Lc+Bc,hc[10]=zc-Fc*Lc}else if('XZY'===gc.order){var zc=_c*Tc,Nc=_c*Mc,Bc=Ec*Tc,Fc=Ec*Mc;hc[0]=Tc*Sc,hc[4]=-Lc,hc[8]=Mc*Sc,hc[1]=zc*Lc+Fc,hc[5]=_c*Sc,hc[9]=Nc*Lc-Bc,hc[2]=Bc*Lc-Nc,hc[6]=Ec*Sc,hc[10]=Fc*Lc+zc}return hc[3]=0,hc[7]=0,hc[11]=0,hc[12]=0,hc[13]=0,hc[14]=0,hc[15]=1,this},makeRotationFromQuaternion:function(gc){var hc=this.elements,yc=gc.x,xc=gc.y,vc=gc.z,_c=gc.w,Ec=yc+yc,Tc=xc+xc,Mc=vc+vc,Sc=yc*Ec,Lc=yc*Tc,wc=yc*Mc,Ac=xc*Tc,Rc=xc*Mc,Pc=vc*Mc,Cc=_c*Ec,Ic=_c*Tc,Uc=_c*Mc;return hc[0]=1-(Ac+Pc),hc[4]=Lc-Uc,hc[8]=wc+Ic,hc[1]=Lc+Uc,hc[5]=1-(Sc+Pc),hc[9]=Rc-Cc,hc[2]=wc-Ic,hc[6]=Rc+Cc,hc[10]=1-(Sc+Ac),hc[3]=0,hc[7]=0,hc[11]=0,hc[12]=0,hc[13]=0,hc[14]=0,hc[15]=1,this},lookAt:function(){var gc,hc,yc;return function(vc,_c,Ec){void 0==gc&&(gc=new O,hc=new O,yc=new O);var Tc=this.elements;return yc.subVectors(vc,_c).normalize(),0===yc.lengthSq()&&(yc.z=1),gc.crossVectors(Ec,yc).normalize(),0===gc.lengthSq()&&(yc.z+=1e-4,gc.crossVectors(Ec,yc).normalize()),hc.crossVectors(yc,gc),Tc[0]=gc.x,Tc[4]=hc.x,Tc[8]=yc.x,Tc[1]=gc.y,Tc[5]=hc.y,Tc[9]=yc.y,Tc[2]=gc.z,Tc[6]=hc.z,Tc[10]=yc.z,this}}(),multiply:function(gc,hc){return void 0===hc?this.multiplyMatrices(this,gc):this.multiplyMatrices(gc,hc)},premultiply:function(gc){return this.multiplyMatrices(gc,this)},multiplyMatrices:function(gc,hc){var yc=gc.elements,xc=hc.elements,vc=this.elements,_c=yc[0],Ec=yc[4],Tc=yc[8],Mc=yc[12],Sc=yc[1],Lc=yc[5],wc=yc[9],Ac=yc[13],Rc=yc[2],Pc=yc[6],Cc=yc[10],Ic=yc[14],Uc=yc[3],Dc=yc[7],zc=yc[11],Nc=yc[15],Bc=xc[0],Fc=xc[4],Oc=xc[8],Gc=xc[12],Hc=xc[1],Vc=xc[5],kc=xc[9],Wc=xc[13],jc=xc[2],Xc=xc[6],Yc=xc[10],qc=xc[14],Zc=xc[3],Kc=xc[7],Jc=xc[11],Qc=xc[15];return vc[0]=_c*Bc+Ec*Hc+Tc*jc+Mc*Zc,vc[4]=_c*Fc+Ec*Vc+Tc*Xc+Mc*Kc,vc[8]=_c*Oc+Ec*kc+Tc*Yc+Mc*Jc,vc[12]=_c*Gc+Ec*Wc+Tc*qc+Mc*Qc,vc[1]=Sc*Bc+Lc*Hc+wc*jc+Ac*Zc,vc[5]=Sc*Fc+Lc*Vc+wc*Xc+Ac*Kc,vc[9]=Sc*Oc+Lc*kc+wc*Yc+Ac*Jc,vc[13]=Sc*Gc+Lc*Wc+wc*qc+Ac*Qc,vc[2]=Rc*Bc+Pc*Hc+Cc*jc+Ic*Zc,vc[6]=Rc*Fc+Pc*Vc+Cc*Xc+Ic*Kc,vc[10]=Rc*Oc+Pc*kc+Cc*Yc+Ic*Jc,vc[14]=Rc*Gc+Pc*Wc+Cc*qc+Ic*Qc,vc[3]=Uc*Bc+Dc*Hc+zc*jc+Nc*Zc,vc[7]=Uc*Fc+Dc*Vc+zc*Xc+Nc*Kc,vc[11]=Uc*Oc+Dc*kc+zc*Yc+Nc*Jc,vc[15]=Uc*Gc+Dc*Wc+zc*qc+Nc*Qc,this},multiplyToArray:function(gc,hc,yc){var xc=this.elements;return this.multiplyMatrices(gc,hc),yc[0]=xc[0],yc[1]=xc[1],yc[2]=xc[2],yc[3]=xc[3],yc[4]=xc[4],yc[5]=xc[5],yc[6]=xc[6],yc[7]=xc[7],yc[8]=xc[8],yc[9]=xc[9],yc[10]=xc[10],yc[11]=xc[11],yc[12]=xc[12],yc[13]=xc[13],yc[14]=xc[14],yc[15]=xc[15],this},multiplyScalar:function(gc){var hc=this.elements;return hc[0]*=gc,hc[4]*=gc,hc[8]*=gc,hc[12]*=gc,hc[1]*=gc,hc[5]*=gc,hc[9]*=gc,hc[13]*=gc,hc[2]*=gc,hc[6]*=gc,hc[10]*=gc,hc[14]*=gc,hc[3]*=gc,hc[7]*=gc,hc[11]*=gc,hc[15]*=gc,this},applyToBufferAttribute:function(){var gc;return function(yc){gc==void 0&&(gc=new O);for(var xc=0,vc=yc.count;xc<vc;xc++)gc.x=yc.getX(xc),gc.y=yc.getY(xc),gc.z=yc.getZ(xc),gc.applyMatrix4(this),yc.setXYZ(xc,gc.x,gc.y,gc.z);return yc}}(),determinant:function(){var gc=this.elements,hc=gc[0],yc=gc[4],xc=gc[8],vc=gc[12],_c=gc[1],Ec=gc[5],Tc=gc[9],Mc=gc[13],Sc=gc[2],Lc=gc[6],wc=gc[10],Ac=gc[14],Rc=gc[3],Pc=gc[7],Cc=gc[11],Ic=gc[15];return Rc*(+vc*Tc*Lc-xc*Mc*Lc-vc*Ec*wc+yc*Mc*wc+xc*Ec*Ac-yc*Tc*Ac)+Pc*(+hc*Tc*Ac-hc*Mc*wc+vc*_c*wc-xc*_c*Ac+xc*Mc*Sc-vc*Tc*Sc)+Cc*(+hc*Mc*Lc-hc*Ec*Ac-vc*_c*Lc+yc*_c*Ac+vc*Ec*Sc-yc*Mc*Sc)+Ic*(-xc*Ec*Sc-hc*Tc*Lc+hc*Ec*wc+xc*_c*Lc-yc*_c*wc+yc*Tc*Sc)},transpose:function(){var gc=this.elements,hc;return hc=gc[1],gc[1]=gc[4],gc[4]=hc,hc=gc[2],gc[2]=gc[8],gc[8]=hc,hc=gc[6],gc[6]=gc[9],gc[9]=hc,hc=gc[3],gc[3]=gc[12],gc[12]=hc,hc=gc[7],gc[7]=gc[13],gc[13]=hc,hc=gc[11],gc[11]=gc[14],gc[14]=hc,this},setPosition:function(gc){var hc=this.elements;return hc[12]=gc.x,hc[13]=gc.y,hc[14]=gc.z,this},getInverse:function(gc,hc){var yc=this.elements,xc=gc.elements,vc=xc[0],_c=xc[1],Ec=xc[2],Tc=xc[3],Mc=xc[4],Sc=xc[5],Lc=xc[6],wc=xc[7],Ac=xc[8],Rc=xc[9],Pc=xc[10],Cc=xc[11],Ic=xc[12],Uc=xc[13],Dc=xc[14],zc=xc[15],Nc=Rc*Dc*wc-Uc*Pc*wc+Uc*Lc*Cc-Sc*Dc*Cc-Rc*Lc*zc+Sc*Pc*zc,Bc=Ic*Pc*wc-Ac*Dc*wc-Ic*Lc*Cc+Mc*Dc*Cc+Ac*Lc*zc-Mc*Pc*zc,Fc=Ac*Uc*wc-Ic*Rc*wc+Ic*Sc*Cc-Mc*Uc*Cc-Ac*Sc*zc+Mc*Rc*zc,Oc=Ic*Rc*Lc-Ac*Uc*Lc-Ic*Sc*Pc+Mc*Uc*Pc+Ac*Sc*Dc-Mc*Rc*Dc,Gc=vc*Nc+_c*Bc+Ec*Fc+Tc*Oc;if(0==Gc){if(!0===hc)throw new Error('THREE.Matrix4.getInverse(): can\'t invert matrix, determinant is 0');else;return this.identity()}var Vc=1/Gc;return yc[0]=Nc*Vc,yc[1]=(Uc*Pc*Tc-Rc*Dc*Tc-Uc*Ec*Cc+_c*Dc*Cc+Rc*Ec*zc-_c*Pc*zc)*Vc,yc[2]=(Sc*Dc*Tc-Uc*Lc*Tc+Uc*Ec*wc-_c*Dc*wc-Sc*Ec*zc+_c*Lc*zc)*Vc,yc[3]=(Rc*Lc*Tc-Sc*Pc*Tc-Rc*Ec*wc+_c*Pc*wc+Sc*Ec*Cc-_c*Lc*Cc)*Vc,yc[4]=Bc*Vc,yc[5]=(Ac*Dc*Tc-Ic*Pc*Tc+Ic*Ec*Cc-vc*Dc*Cc-Ac*Ec*zc+vc*Pc*zc)*Vc,yc[6]=(Ic*Lc*Tc-Mc*Dc*Tc-Ic*Ec*wc+vc*Dc*wc+Mc*Ec*zc-vc*Lc*zc)*Vc,yc[7]=(Mc*Pc*Tc-Ac*Lc*Tc+Ac*Ec*wc-vc*Pc*wc-Mc*Ec*Cc+vc*Lc*Cc)*Vc,yc[8]=Fc*Vc,yc[9]=(Ic*Rc*Tc-Ac*Uc*Tc-Ic*_c*Cc+vc*Uc*Cc+Ac*_c*zc-vc*Rc*zc)*Vc,yc[10]=(Mc*Uc*Tc-Ic*Sc*Tc+Ic*_c*wc-vc*Uc*wc-Mc*_c*zc+vc*Sc*zc)*Vc,yc[11]=(Ac*Sc*Tc-Mc*Rc*Tc-Ac*_c*wc+vc*Rc*wc+Mc*_c*Cc-vc*Sc*Cc)*Vc,yc[12]=Oc*Vc,yc[13]=(Ac*Uc*Ec-Ic*Rc*Ec+Ic*_c*Pc-vc*Uc*Pc-Ac*_c*Dc+vc*Rc*Dc)*Vc,yc[14]=(Ic*Sc*Ec-Mc*Uc*Ec-Ic*_c*Lc+vc*Uc*Lc+Mc*_c*Dc-vc*Sc*Dc)*Vc,yc[15]=(Mc*Rc*Ec-Ac*Sc*Ec+Ac*_c*Lc-vc*Rc*Lc-Mc*_c*Pc+vc*Sc*Pc)*Vc,this},scale:function(gc){var hc=this.elements,yc=gc.x,xc=gc.y,vc=gc.z;return hc[0]*=yc,hc[4]*=xc,hc[8]*=vc,hc[1]*=yc,hc[5]*=xc,hc[9]*=vc,hc[2]*=yc,hc[6]*=xc,hc[10]*=vc,hc[3]*=yc,hc[7]*=xc,hc[11]*=vc,this},getMaxScaleOnAxis:function(){var gc=this.elements,hc=gc[0]*gc[0]+gc[1]*gc[1]+gc[2]*gc[2],yc=gc[4]*gc[4]+gc[5]*gc[5]+gc[6]*gc[6],xc=gc[8]*gc[8]+gc[9]*gc[9]+gc[10]*gc[10];return _Mathsqrt(_Mathmax(hc,yc,xc))},makeTranslation:function(gc,hc,yc){return this.set(1,0,0,gc,0,1,0,hc,0,0,1,yc,0,0,0,1),this},makeRotationX:function(gc){var hc=_Mathcos(gc),yc=_Mathsin(gc);return this.set(1,0,0,0,0,hc,-yc,0,0,yc,hc,0,0,0,0,1),this},makeRotationY:function(gc){var hc=_Mathcos(gc),yc=_Mathsin(gc);return this.set(hc,0,yc,0,0,1,0,0,-yc,0,hc,0,0,0,0,1),this},makeRotationZ:function(gc){var hc=_Mathcos(gc),yc=_Mathsin(gc);return this.set(hc,-yc,0,0,yc,hc,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(gc,hc){var yc=_Mathcos(hc),xc=_Mathsin(hc),vc=1-yc,_c=gc.x,Ec=gc.y,Tc=gc.z,Mc=vc*_c,Sc=vc*Ec;return this.set(Mc*_c+yc,Mc*Ec-xc*Tc,Mc*Tc+xc*Ec,0,Mc*Ec+xc*Tc,Sc*Ec+yc,Sc*Tc-xc*_c,0,Mc*Tc-xc*Ec,Sc*Tc+xc*_c,vc*Tc*Tc+yc,0,0,0,0,1),this},makeScale:function(gc,hc,yc){return this.set(gc,0,0,0,0,hc,0,0,0,0,yc,0,0,0,0,1),this},makeShear:function(gc,hc,yc){return this.set(1,hc,yc,0,gc,1,yc,0,gc,hc,1,0,0,0,0,1),this},compose:function(gc,hc,yc){return this.makeRotationFromQuaternion(hc),this.scale(yc),this.setPosition(gc),this},decompose:function(){var gc,hc;return function(xc,vc,_c){void 0==gc&&(gc=new O,hc=new G);var Ec=this.elements,Tc=gc.set(Ec[0],Ec[1],Ec[2]).length(),Mc=gc.set(Ec[4],Ec[5],Ec[6]).length(),Sc=gc.set(Ec[8],Ec[9],Ec[10]).length(),Lc=this.determinant();0>Lc&&(Tc=-Tc),xc.x=Ec[12],xc.y=Ec[13],xc.z=Ec[14],hc.elements.set(this.elements);var wc=1/Tc,Ac=1/Mc,Rc=1/Sc;return hc.elements[0]*=wc,hc.elements[1]*=wc,hc.elements[2]*=wc,hc.elements[4]*=Ac,hc.elements[5]*=Ac,hc.elements[6]*=Ac,hc.elements[8]*=Rc,hc.elements[9]*=Rc,hc.elements[10]*=Rc,vc.setFromRotationMatrix(hc),_c.x=Tc,_c.y=Mc,_c.z=Sc,this}}(),makePerspective:function(gc,hc,yc,xc,vc,_c){var Ec=this.elements;return Ec[0]=2*vc/(hc-gc),Ec[4]=0,Ec[8]=(hc+gc)/(hc-gc),Ec[12]=0,Ec[1]=0,Ec[5]=2*vc/(yc-xc),Ec[9]=(yc+xc)/(yc-xc),Ec[13]=0,Ec[2]=0,Ec[6]=0,Ec[10]=-(_c+vc)/(_c-vc),Ec[14]=-2*_c*vc/(_c-vc),Ec[3]=0,Ec[7]=0,Ec[11]=-1,Ec[15]=0,this},makeOrthographic:function(gc,hc,yc,xc,vc,_c){var Ec=this.elements,Tc=1/(hc-gc),Mc=1/(yc-xc),Sc=1/(_c-vc);return Ec[0]=2*Tc,Ec[4]=0,Ec[8]=0,Ec[12]=-((hc+gc)*Tc),Ec[1]=0,Ec[5]=2*Mc,Ec[9]=0,Ec[13]=-((yc+xc)*Mc),Ec[2]=0,Ec[6]=0,Ec[10]=-2*Sc,Ec[14]=-((_c+vc)*Sc),Ec[3]=0,Ec[7]=0,Ec[11]=0,Ec[15]=1,this},equals:function(gc){for(var hc=this.elements,yc=gc.elements,xc=0;16>xc;xc++)if(hc[xc]!==yc[xc])return!1;return!0},fromArray:function(gc,hc){hc===void 0&&(hc=0);for(var yc=0;16>yc;yc++)this.elements[yc]=gc[yc+hc];return this},toArray:function(gc,hc){void 0===gc&&(gc=[]),void 0===hc&&(hc=0);var yc=this.elements;return gc[hc]=yc[0],gc[hc+1]=yc[1],gc[hc+2]=yc[2],gc[hc+3]=yc[3],gc[hc+4]=yc[4],gc[hc+5]=yc[5],gc[hc+6]=yc[6],gc[hc+7]=yc[7],gc[hc+8]=yc[8],gc[hc+9]=yc[9],gc[hc+10]=yc[10],gc[hc+11]=yc[11],gc[hc+12]=yc[12],gc[hc+13]=yc[13],gc[hc+14]=yc[14],gc[hc+15]=yc[15],gc}},H.prototype=Object.create(C.prototype),H.prototype.constructor=H,H.prototype.isCubeTexture=!0,Object.defineProperty(H.prototype,'images',{get:function(){return this.image},set:function(gc){this.image=gc}});var El=new C,Tl=new H,Ml=[],Sl=[];Ae.prototype.setValue=function(gc,hc){for(var yc=this.seq,xc=0,vc=yc.length,_c;xc!==vc;++xc)_c=yc[xc],_c.setValue(gc,hc[_c.id])};var Ll=/([\w\d_]+)(\])?(\[|\.)?/g;Ce.prototype.setValue=function(gc,hc,yc){var xc=this.map[hc];xc!==void 0&&xc.setValue(gc,yc,this.renderer)},Ce.prototype.set=function(gc,hc,yc){var xc=this.map[yc];xc!==void 0&&xc.setValue(gc,hc[yc],this.renderer)},Ce.prototype.setOptional=function(gc,hc,yc){var xc=hc[yc];xc!==void 0&&this.setValue(gc,yc,xc)},Ce.upload=function(gc,hc,yc,xc){for(var vc=0,_c=hc.length;vc!==_c;++vc){var Ec=hc[vc],Tc=yc[Ec.id];!1!==Tc.needsUpdate&&Ec.setValue(gc,Tc.value,xc)}},Ce.seqWithValue=function(gc,hc){for(var yc=[],xc=0,vc=gc.length,_c;xc!==vc;++xc)_c=gc[xc],_c.id in hc&&yc.push(_c);return yc};var wl={merge:function(gc){for(var hc={},yc=0,xc;yc<gc.length;yc++)for(var vc in xc=this.clone(gc[yc]),xc)hc[vc]=xc[vc];return hc},clone:function(gc){var hc={};for(var yc in gc)for(var xc in hc[yc]={},gc[yc]){var vc=gc[yc][xc];hc[yc][xc]=vc&&(vc.isColor||vc.isMatrix3||vc.isMatrix4||vc.isVector2||vc.isVector3||vc.isVector4||vc.isTexture)?vc.clone():Array.isArray(vc)?vc.slice():vc}return hc}},Op={alphamap_fragment:'#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n',alphamap_pars_fragment:'#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n',alphatest_fragment:'#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n',aomap_fragment:'#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n',aomap_pars_fragment:'#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif',begin_vertex:'\nvec3 transformed = vec3( position );\n',beginnormal_vertex:'\nvec3 objectNormal = vec3( normal );\n',bsdfs:'float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n',bumpmap_pars_fragment:'#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n',clipping_planes_fragment:'#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n',clipping_planes_pars_fragment:'#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n',clipping_planes_pars_vertex:'#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n',clipping_planes_vertex:'#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n',color_fragment:'#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif',color_pars_fragment:'#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n',color_pars_vertex:'#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif',color_vertex:'#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif',common:'#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n',cube_uv_reflection_fragment:'#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n',defaultnormal_vertex:'#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n',displacementmap_pars_vertex:'#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n',displacementmap_vertex:'#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n',emissivemap_fragment:'#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n',emissivemap_pars_fragment:'#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n',encodings_fragment:'  gl_FragColor = linearToOutputTexel( gl_FragColor );\n',encodings_pars_fragment:'\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n',envmap_fragment:'#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n',envmap_pars_fragment:'#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n',envmap_pars_vertex:'#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n',envmap_vertex:'#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n',fog_vertex:'\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif',fog_pars_vertex:'#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n',fog_fragment:'#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n',fog_pars_fragment:'#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n',gradientmap_pars_fragment:'#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n',lightmap_fragment:'#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n',lightmap_pars_fragment:'#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif',lights_lambert_vertex:'vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n',lights_pars:'uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n',lights_phong_fragment:'BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n',lights_phong_pars_fragment:'varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n\t}\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n',lights_physical_fragment:'PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n',lights_physical_pars_fragment:'struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n',lights_template:'\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n',logdepthbuf_fragment:'#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif',logdepthbuf_pars_fragment:'#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n',logdepthbuf_pars_vertex:'#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif',logdepthbuf_vertex:'#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n',map_fragment:'#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n',map_pars_fragment:'#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n',map_particle_fragment:'#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n',map_particle_pars_fragment:'#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n',metalnessmap_fragment:'float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n',metalnessmap_pars_fragment:'#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif',morphnormal_vertex:'#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n',morphtarget_pars_vertex:'#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif',morphtarget_vertex:'#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n',normal_flip:'#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n',normal_fragment:'#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n',normalmap_pars_fragment:'#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n',packing:'vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n',premultiplied_alpha_fragment:'#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n',project_vertex:'#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n',roughnessmap_fragment:'float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n',roughnessmap_pars_fragment:'#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif',shadowmap_pars_fragment:'#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n',shadowmap_pars_vertex:'#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n',shadowmap_vertex:'#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n',shadowmask_pars_fragment:'float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n',skinbase_vertex:'#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif',skinning_pars_vertex:'#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n',skinning_vertex:'#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n',skinnormal_vertex:'#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n',specularmap_fragment:'float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif',specularmap_pars_fragment:'#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif',tonemapping_fragment:'#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n',tonemapping_pars_fragment:'#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n',uv_pars_fragment:'#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif',uv_pars_vertex:'#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n',uv_vertex:'#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif',uv2_pars_fragment:'#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif',uv2_pars_vertex:'#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif',uv2_vertex:'#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif',worldpos_vertex:'#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n',cube_frag:'uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n',cube_vert:'varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n',depth_frag:'#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n',depth_vert:'#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n',distanceRGBA_frag:'uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n',distanceRGBA_vert:'varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n',equirect_frag:'uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n',equirect_vert:'varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n',linedashed_frag:'uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',linedashed_vert:'uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n',meshbasic_frag:'uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',meshbasic_vert:'#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n',meshlambert_frag:'uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',meshlambert_vert:'#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n',meshphong_frag:'#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',meshphong_vert:'#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n',meshphysical_frag:'#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',meshphysical_vert:'#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n',normal_frag:'#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n',normal_vert:'#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n',points_frag:'uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n',points_vert:'uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n',shadow_frag:'uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n',shadow_vert:'#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n'};Ie.prototype={constructor:Ie,isColor:!0,r:1,g:1,b:1,set:function(gc){return gc&&gc.isColor?this.copy(gc):'number'==typeof gc?this.setHex(gc):'string'==typeof gc&&this.setStyle(gc),this},setScalar:function(gc){return this.r=gc,this.g=gc,this.b=gc,this},setHex:function(gc){return gc=_Mathfloor(gc),this.r=(255&gc>>16)/255,this.g=(255&gc>>8)/255,this.b=(255&gc)/255,this},setRGB:function(gc,hc,yc){return this.r=gc,this.g=hc,this.b=yc,this},setHSL:function(){function gc(hc,yc,xc){return 0>xc&&(xc+=1),1<xc&&(xc-=1),xc<1/6?hc+6*(yc-hc)*xc:xc<1/2?yc:xc<2/3?hc+6*(yc-hc)*(2/3-xc):hc}return function(yc,xc,vc){if(yc=xl.euclideanModulo(yc,1),xc=xl.clamp(xc,0,1),vc=xl.clamp(vc,0,1),0===xc)this.r=this.g=this.b=vc;else{var _c=0.5>=vc?vc*(1+xc):vc+xc-vc*xc,Ec=2*vc-_c;this.r=gc(Ec,_c,yc+1/3),this.g=gc(Ec,_c,yc),this.b=gc(Ec,_c,yc-1/3)}return this}}(),setStyle:function(gc){function hc(wc){void 0===wc||1>parseFloat(wc)&&void 0}var yc;if(yc=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(gc)){var xc,vc=yc[1],_c=yc[2];switch(vc){case'rgb':case'rgba':if(xc=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(_c))return this.r=_Mathmin(255,parseInt(xc[1],10))/255,this.g=_Mathmin(255,parseInt(xc[2],10))/255,this.b=_Mathmin(255,parseInt(xc[3],10))/255,hc(xc[5]),this;if(xc=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(_c))return this.r=_Mathmin(100,parseInt(xc[1],10))/100,this.g=_Mathmin(100,parseInt(xc[2],10))/100,this.b=_Mathmin(100,parseInt(xc[3],10))/100,hc(xc[5]),this;break;case'hsl':case'hsla':if(xc=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(_c)){var Ec=parseFloat(xc[1])/360,Tc=parseInt(xc[2],10)/100,Mc=parseInt(xc[3],10)/100;return hc(xc[5]),this.setHSL(Ec,Tc,Mc)}}}else if(yc=/^\#([A-Fa-f0-9]+)$/.exec(gc)){var Sc=yc[1],Lc=Sc.length;if(3===Lc)return this.r=parseInt(Sc.charAt(0)+Sc.charAt(0),16)/255,this.g=parseInt(Sc.charAt(1)+Sc.charAt(1),16)/255,this.b=parseInt(Sc.charAt(2)+Sc.charAt(2),16)/255,this;if(6===Lc)return this.r=parseInt(Sc.charAt(0)+Sc.charAt(1),16)/255,this.g=parseInt(Sc.charAt(2)+Sc.charAt(3),16)/255,this.b=parseInt(Sc.charAt(4)+Sc.charAt(5),16)/255,this}if(gc&&0<gc.length){var Sc=Gp[gc];void 0===Sc?void 0:this.setHex(Sc)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(gc){return this.r=gc.r,this.g=gc.g,this.b=gc.b,this},copyGammaToLinear:function(gc,hc){return void 0===hc&&(hc=2),this.r=_Mathpow(gc.r,hc),this.g=_Mathpow(gc.g,hc),this.b=_Mathpow(gc.b,hc),this},copyLinearToGamma:function(gc,hc){void 0===hc&&(hc=2);var yc=0<hc?1/hc:1;return this.r=_Mathpow(gc.r,yc),this.g=_Mathpow(gc.g,yc),this.b=_Mathpow(gc.b,yc),this},convertGammaToLinear:function(){var gc=this.r,hc=this.g,yc=this.b;return this.r=gc*gc,this.g=hc*hc,this.b=yc*yc,this},convertLinearToGamma:function(){return this.r=_Mathsqrt(this.r),this.g=_Mathsqrt(this.g),this.b=_Mathsqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return('000000'+this.getHex().toString(16)).slice(-6)},getHSL:function(gc){var hc=gc||{h:0,s:0,l:0},yc=this.r,xc=this.g,vc=this.b,_c=_Mathmax(yc,xc,vc),Ec=_Mathmin(yc,xc,vc),Sc=(Ec+_c)/2,Tc,Mc;if(Ec===_c)Tc=0,Mc=0;else{var Lc=_c-Ec;Mc=0.5>=Sc?Lc/(_c+Ec):Lc/(2-_c-Ec),_c===yc?Tc=(xc-vc)/Lc+(xc<vc?6:0):_c===xc?Tc=(vc-yc)/Lc+2:_c===vc?Tc=(yc-xc)/Lc+4:void 0,Tc/=6}return hc.h=Tc,hc.s=Mc,hc.l=Sc,hc},getStyle:function(){return'rgb('+(0|255*this.r)+','+(0|255*this.g)+','+(0|255*this.b)+')'},offsetHSL:function(gc,hc,yc){var xc=this.getHSL();return xc.h+=gc,xc.s+=hc,xc.l+=yc,this.setHSL(xc.h,xc.s,xc.l),this},add:function(gc){return this.r+=gc.r,this.g+=gc.g,this.b+=gc.b,this},addColors:function(gc,hc){return this.r=gc.r+hc.r,this.g=gc.g+hc.g,this.b=gc.b+hc.b,this},addScalar:function(gc){return this.r+=gc,this.g+=gc,this.b+=gc,this},sub:function(gc){return this.r=_Mathmax(0,this.r-gc.r),this.g=_Mathmax(0,this.g-gc.g),this.b=_Mathmax(0,this.b-gc.b),this},multiply:function(gc){return this.r*=gc.r,this.g*=gc.g,this.b*=gc.b,this},multiplyScalar:function(gc){return this.r*=gc,this.g*=gc,this.b*=gc,this},lerp:function(gc,hc){return this.r+=(gc.r-this.r)*hc,this.g+=(gc.g-this.g)*hc,this.b+=(gc.b-this.b)*hc,this},equals:function(gc){return gc.r===this.r&&gc.g===this.g&&gc.b===this.b},fromArray:function(gc,hc){return void 0===hc&&(hc=0),this.r=gc[hc],this.g=gc[hc+1],this.b=gc[hc+2],this},toArray:function(gc,hc){return void 0===gc&&(gc=[]),void 0===hc&&(hc=0),gc[hc]=this.r,gc[hc+1]=this.g,gc[hc+2]=this.b,gc},toJSON:function(){return this.getHex()}};var Gp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ue.prototype=Object.create(C.prototype),Ue.prototype.constructor=Ue,Ue.prototype.isDataTexture=!0;var Hp={common:{diffuse:{value:new Ie(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new I(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:0.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new R(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5e-4},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ie(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Ie(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new I(0,0,1,1)}}},Vp={basic:{uniforms:wl.merge([Hp.common,Hp.aomap,Hp.lightmap,Hp.fog]),vertexShader:Op.meshbasic_vert,fragmentShader:Op.meshbasic_frag},lambert:{uniforms:wl.merge([Hp.common,Hp.aomap,Hp.lightmap,Hp.emissivemap,Hp.fog,Hp.lights,{emissive:{value:new Ie(0)}}]),vertexShader:Op.meshlambert_vert,fragmentShader:Op.meshlambert_frag},phong:{uniforms:wl.merge([Hp.common,Hp.aomap,Hp.lightmap,Hp.emissivemap,Hp.bumpmap,Hp.normalmap,Hp.displacementmap,Hp.gradientmap,Hp.fog,Hp.lights,{emissive:{value:new Ie(0)},specular:{value:new Ie(1118481)},shininess:{value:30}}]),vertexShader:Op.meshphong_vert,fragmentShader:Op.meshphong_frag},standard:{uniforms:wl.merge([Hp.common,Hp.aomap,Hp.lightmap,Hp.emissivemap,Hp.bumpmap,Hp.normalmap,Hp.displacementmap,Hp.roughnessmap,Hp.metalnessmap,Hp.fog,Hp.lights,{emissive:{value:new Ie(0)},roughness:{value:0.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Op.meshphysical_vert,fragmentShader:Op.meshphysical_frag},points:{uniforms:wl.merge([Hp.points,Hp.fog]),vertexShader:Op.points_vert,fragmentShader:Op.points_frag},dashed:{uniforms:wl.merge([Hp.common,Hp.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Op.linedashed_vert,fragmentShader:Op.linedashed_frag},depth:{uniforms:wl.merge([Hp.common,Hp.displacementmap]),vertexShader:Op.depth_vert,fragmentShader:Op.depth_frag},normal:{uniforms:wl.merge([Hp.common,Hp.bumpmap,Hp.normalmap,Hp.displacementmap,{opacity:{value:1}}]),vertexShader:Op.normal_vert,fragmentShader:Op.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Op.cube_vert,fragmentShader:Op.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Op.equirect_vert,fragmentShader:Op.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new O}},vertexShader:Op.distanceRGBA_vert,fragmentShader:Op.distanceRGBA_frag}};Vp.physical={uniforms:wl.merge([Vp.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Op.meshphysical_vert,fragmentShader:Op.meshphysical_frag},De.prototype={constructor:De,set:function(gc,hc){return this.min.copy(gc),this.max.copy(hc),this},setFromPoints:function(gc){this.makeEmpty();for(var hc=0,yc=gc.length;hc<yc;hc++)this.expandByPoint(gc[hc]);return this},setFromCenterAndSize:function(){var gc=new R;return function(yc,xc){var vc=gc.copy(xc).multiplyScalar(0.5);return this.min.copy(yc).sub(vc),this.max.copy(yc).add(vc),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.min.copy(gc.min),this.max.copy(gc.max),this},makeEmpty:function(){return this.min.x=this.min.y=+Infinity,this.max.x=this.max.y=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(gc){var hc=gc||new R;return this.isEmpty()?hc.set(0,0):hc.addVectors(this.min,this.max).multiplyScalar(0.5)},getSize:function(gc){var hc=gc||new R;return this.isEmpty()?hc.set(0,0):hc.subVectors(this.max,this.min)},expandByPoint:function(gc){return this.min.min(gc),this.max.max(gc),this},expandByVector:function(gc){return this.min.sub(gc),this.max.add(gc),this},expandByScalar:function(gc){return this.min.addScalar(-gc),this.max.addScalar(gc),this},containsPoint:function(gc){return gc.x<this.min.x||gc.x>this.max.x||gc.y<this.min.y||gc.y>this.max.y?!1:!0},containsBox:function(gc){return this.min.x<=gc.min.x&&gc.max.x<=this.max.x&&this.min.y<=gc.min.y&&gc.max.y<=this.max.y},getParameter:function(gc,hc){var yc=hc||new R;return yc.set((gc.x-this.min.x)/(this.max.x-this.min.x),(gc.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(gc){return gc.max.x<this.min.x||gc.min.x>this.max.x||gc.max.y<this.min.y||gc.min.y>this.max.y?!1:!0},clampPoint:function(gc,hc){var yc=hc||new R;return yc.copy(gc).clamp(this.min,this.max)},distanceToPoint:function(){var gc=new R;return function(yc){var xc=gc.copy(yc).clamp(this.min,this.max);return xc.sub(yc).length()}}(),intersect:function(gc){return this.min.max(gc.min),this.max.min(gc.max),this},union:function(gc){return this.min.min(gc.min),this.max.max(gc.max),this},translate:function(gc){return this.min.add(gc),this.max.add(gc),this},equals:function(gc){return gc.min.equals(this.min)&&gc.max.equals(this.max)}};var kp=0;Be.prototype={constructor:Be,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(gc){!0===gc&&this.update(),this._needsUpdate=gc},setValues:function(gc){if(void 0!==gc)for(var hc in gc){var yc=gc[hc];if(void 0!==yc){var xc=this[hc];void 0!==xc&&(xc&&xc.isColor?xc.set(yc):xc&&xc.isVector3&&yc&&yc.isVector3?xc.copy(yc):'overdraw'==hc?this[hc]=+yc:this[hc]=yc)}}},toJSON:function(gc){function hc(Ec){var Tc=[];for(var Mc in Ec){var Sc=Ec[Mc];delete Sc.metadata,Tc.push(Sc)}return Tc}var yc=void 0===gc;yc&&(gc={textures:{},images:{}});var xc={metadata:{version:4.4,type:'Material',generator:'Material.toJSON'}};if(xc.uuid=this.uuid,xc.type=this.type,''!==this.name&&(xc.name=this.name),this.color&&this.color.isColor&&(xc.color=this.color.getHex()),void 0!==this.roughness&&(xc.roughness=this.roughness),void 0!==this.metalness&&(xc.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(xc.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(xc.specular=this.specular.getHex()),void 0!==this.shininess&&(xc.shininess=this.shininess),void 0!==this.clearCoat&&(xc.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(xc.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(xc.map=this.map.toJSON(gc).uuid),this.alphaMap&&this.alphaMap.isTexture&&(xc.alphaMap=this.alphaMap.toJSON(gc).uuid),this.lightMap&&this.lightMap.isTexture&&(xc.lightMap=this.lightMap.toJSON(gc).uuid),this.bumpMap&&this.bumpMap.isTexture&&(xc.bumpMap=this.bumpMap.toJSON(gc).uuid,xc.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(xc.normalMap=this.normalMap.toJSON(gc).uuid,xc.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(xc.displacementMap=this.displacementMap.toJSON(gc).uuid,xc.displacementScale=this.displacementScale,xc.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(xc.roughnessMap=this.roughnessMap.toJSON(gc).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(xc.metalnessMap=this.metalnessMap.toJSON(gc).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(xc.emissiveMap=this.emissiveMap.toJSON(gc).uuid),this.specularMap&&this.specularMap.isTexture&&(xc.specularMap=this.specularMap.toJSON(gc).uuid),this.envMap&&this.envMap.isTexture&&(xc.envMap=this.envMap.toJSON(gc).uuid,xc.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(xc.gradientMap=this.gradientMap.toJSON(gc).uuid),void 0!==this.size&&(xc.size=this.size),void 0!==this.sizeAttenuation&&(xc.sizeAttenuation=this.sizeAttenuation),this.blending!==sn&&(xc.blending=this.blending),this.shading!==tn&&(xc.shading=this.shading),this.side!==Ji&&(xc.side=this.side),this.vertexColors!==rn&&(xc.vertexColors=this.vertexColors),1>this.opacity&&(xc.opacity=this.opacity),!0===this.transparent&&(xc.transparent=this.transparent),xc.depthFunc=this.depthFunc,xc.depthTest=this.depthTest,xc.depthWrite=this.depthWrite,0<this.alphaTest&&(xc.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(xc.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(xc.wireframe=this.wireframe),1<this.wireframeLinewidth&&(xc.wireframeLinewidth=this.wireframeLinewidth),'round'!==this.wireframeLinecap&&(xc.wireframeLinecap=this.wireframeLinecap),'round'!==this.wireframeLinejoin&&(xc.wireframeLinejoin=this.wireframeLinejoin),xc.skinning=this.skinning,xc.morphTargets=this.morphTargets,yc){var vc=hc(gc.textures),_c=hc(gc.images);0<vc.length&&(xc.textures=vc),0<_c.length&&(xc.images=_c)}return xc},clone:function(){return new this.constructor().copy(this)},copy:function(gc){this.name=gc.name,this.fog=gc.fog,this.lights=gc.lights,this.blending=gc.blending,this.side=gc.side,this.shading=gc.shading,this.vertexColors=gc.vertexColors,this.opacity=gc.opacity,this.transparent=gc.transparent,this.blendSrc=gc.blendSrc,this.blendDst=gc.blendDst,this.blendEquation=gc.blendEquation,this.blendSrcAlpha=gc.blendSrcAlpha,this.blendDstAlpha=gc.blendDstAlpha,this.blendEquationAlpha=gc.blendEquationAlpha,this.depthFunc=gc.depthFunc,this.depthTest=gc.depthTest,this.depthWrite=gc.depthWrite,this.colorWrite=gc.colorWrite,this.precision=gc.precision,this.polygonOffset=gc.polygonOffset,this.polygonOffsetFactor=gc.polygonOffsetFactor,this.polygonOffsetUnits=gc.polygonOffsetUnits,this.alphaTest=gc.alphaTest,this.premultipliedAlpha=gc.premultipliedAlpha,this.overdraw=gc.overdraw,this.visible=gc.visible,this.clipShadows=gc.clipShadows,this.clipIntersection=gc.clipIntersection;var hc=gc.clippingPlanes,yc=null;if(null!==hc){var xc=hc.length;yc=Array(xc);for(var vc=0;vc!==xc;++vc)yc[vc]=hc[vc].clone()}return this.clippingPlanes=yc,this},update:function(){this.dispatchEvent({type:'update'})},dispose:function(){this.dispatchEvent({type:'dispose'})}},Object.assign(Be.prototype,A.prototype),Fe.prototype=Object.create(Be.prototype),Fe.prototype.constructor=Fe,Fe.prototype.isShaderMaterial=!0,Fe.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.fragmentShader=gc.fragmentShader,this.vertexShader=gc.vertexShader,this.uniforms=wl.clone(gc.uniforms),this.defines=gc.defines,this.wireframe=gc.wireframe,this.wireframeLinewidth=gc.wireframeLinewidth,this.lights=gc.lights,this.clipping=gc.clipping,this.skinning=gc.skinning,this.morphTargets=gc.morphTargets,this.morphNormals=gc.morphNormals,this.extensions=gc.extensions,this},Fe.prototype.toJSON=function(gc){var hc=Be.prototype.toJSON.call(this,gc);return hc.uniforms=this.uniforms,hc.vertexShader=this.vertexShader,hc.fragmentShader=this.fragmentShader,hc},Oe.prototype=Object.create(Be.prototype),Oe.prototype.constructor=Oe,Oe.prototype.isMeshDepthMaterial=!0,Oe.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.depthPacking=gc.depthPacking,this.skinning=gc.skinning,this.morphTargets=gc.morphTargets,this.map=gc.map,this.alphaMap=gc.alphaMap,this.displacementMap=gc.displacementMap,this.displacementScale=gc.displacementScale,this.displacementBias=gc.displacementBias,this.wireframe=gc.wireframe,this.wireframeLinewidth=gc.wireframeLinewidth,this},Ge.prototype={constructor:Ge,isBox3:!0,set:function(gc,hc){return this.min.copy(gc),this.max.copy(hc),this},setFromArray:function(gc){for(var hc=+Infinity,yc=+Infinity,xc=+Infinity,vc=-Infinity,_c=-Infinity,Ec=-Infinity,Tc=0,Mc=gc.length;Tc<Mc;Tc+=3){var Sc=gc[Tc],Lc=gc[Tc+1],wc=gc[Tc+2];Sc<hc&&(hc=Sc),Lc<yc&&(yc=Lc),wc<xc&&(xc=wc),Sc>vc&&(vc=Sc),Lc>_c&&(_c=Lc),wc>Ec&&(Ec=wc)}return this.min.set(hc,yc,xc),this.max.set(vc,_c,Ec),this},setFromBufferAttribute:function(gc){for(var hc=+Infinity,yc=+Infinity,xc=+Infinity,vc=-Infinity,_c=-Infinity,Ec=-Infinity,Tc=0,Mc=gc.count;Tc<Mc;Tc++){var Sc=gc.getX(Tc),Lc=gc.getY(Tc),wc=gc.getZ(Tc);Sc<hc&&(hc=Sc),Lc<yc&&(yc=Lc),wc<xc&&(xc=wc),Sc>vc&&(vc=Sc),Lc>_c&&(_c=Lc),wc>Ec&&(Ec=wc)}return this.min.set(hc,yc,xc),this.max.set(vc,_c,Ec),this},setFromPoints:function(gc){this.makeEmpty();for(var hc=0,yc=gc.length;hc<yc;hc++)this.expandByPoint(gc[hc]);return this},setFromCenterAndSize:function(){var gc=new O;return function(yc,xc){var vc=gc.copy(xc).multiplyScalar(0.5);return this.min.copy(yc).sub(vc),this.max.copy(yc).add(vc),this}}(),setFromObject:function(gc){return this.makeEmpty(),this.expandByObject(gc)},clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.min.copy(gc.min),this.max.copy(gc.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(gc){var hc=gc||new O;return this.isEmpty()?hc.set(0,0,0):hc.addVectors(this.min,this.max).multiplyScalar(0.5)},getSize:function(gc){var hc=gc||new O;return this.isEmpty()?hc.set(0,0,0):hc.subVectors(this.max,this.min)},expandByPoint:function(gc){return this.min.min(gc),this.max.max(gc),this},expandByVector:function(gc){return this.min.sub(gc),this.max.add(gc),this},expandByScalar:function(gc){return this.min.addScalar(-gc),this.max.addScalar(gc),this},expandByObject:function(){var gc=new O;return function(yc){var xc=this;return yc.updateMatrixWorld(!0),yc.traverse(function(vc){var Tc=vc.geometry,_c,Ec;if(void 0!==Tc)if(Tc.isGeometry){var Mc=Tc.vertices;for(_c=0,Ec=Mc.length;_c<Ec;_c++)gc.copy(Mc[_c]),gc.applyMatrix4(vc.matrixWorld),xc.expandByPoint(gc)}else if(Tc.isBufferGeometry){var Sc=Tc.attributes.position;if(void 0!==Sc)for(_c=0,Ec=Sc.count;_c<Ec;_c++)gc.fromBufferAttribute(Sc,_c).applyMatrix4(vc.matrixWorld),xc.expandByPoint(gc)}}),this}}(),containsPoint:function(gc){return gc.x<this.min.x||gc.x>this.max.x||gc.y<this.min.y||gc.y>this.max.y||gc.z<this.min.z||gc.z>this.max.z?!1:!0},containsBox:function(gc){return this.min.x<=gc.min.x&&gc.max.x<=this.max.x&&this.min.y<=gc.min.y&&gc.max.y<=this.max.y&&this.min.z<=gc.min.z&&gc.max.z<=this.max.z},getParameter:function(gc,hc){var yc=hc||new O;return yc.set((gc.x-this.min.x)/(this.max.x-this.min.x),(gc.y-this.min.y)/(this.max.y-this.min.y),(gc.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(gc){return gc.max.x<this.min.x||gc.min.x>this.max.x||gc.max.y<this.min.y||gc.min.y>this.max.y||gc.max.z<this.min.z||gc.min.z>this.max.z?!1:!0},intersectsSphere:function(){var gc;return function(yc){return void 0==gc&&(gc=new O),this.clampPoint(yc.center,gc),gc.distanceToSquared(yc.center)<=yc.radius*yc.radius}}(),intersectsPlane:function(gc){var hc,yc;return 0<gc.normal.x?(hc=gc.normal.x*this.min.x,yc=gc.normal.x*this.max.x):(hc=gc.normal.x*this.max.x,yc=gc.normal.x*this.min.x),0<gc.normal.y?(hc+=gc.normal.y*this.min.y,yc+=gc.normal.y*this.max.y):(hc+=gc.normal.y*this.max.y,yc+=gc.normal.y*this.min.y),0<gc.normal.z?(hc+=gc.normal.z*this.min.z,yc+=gc.normal.z*this.max.z):(hc+=gc.normal.z*this.max.z,yc+=gc.normal.z*this.min.z),hc<=gc.constant&&yc>=gc.constant},clampPoint:function(gc,hc){var yc=hc||new O;return yc.copy(gc).clamp(this.min,this.max)},distanceToPoint:function(){var gc=new O;return function(yc){var xc=gc.copy(yc).clamp(this.min,this.max);return xc.sub(yc).length()}}(),getBoundingSphere:function(){var gc=new O;return function(yc){var xc=yc||new He;return this.getCenter(xc.center),xc.radius=0.5*this.getSize(gc).length(),xc}}(),intersect:function(gc){return this.min.max(gc.min),this.max.min(gc.max),this.isEmpty()&&this.makeEmpty(),this},union:function(gc){return this.min.min(gc.min),this.max.max(gc.max),this},applyMatrix4:function(){var gc=[new O,new O,new O,new O,new O,new O,new O,new O];return function(yc){return this.isEmpty()?this:(gc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(yc),gc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(yc),gc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(yc),gc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(yc),gc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(yc),gc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(yc),gc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(yc),gc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(yc),this.setFromPoints(gc),this)}}(),translate:function(gc){return this.min.add(gc),this.max.add(gc),this},equals:function(gc){return gc.min.equals(this.min)&&gc.max.equals(this.max)}},He.prototype={constructor:He,set:function(gc,hc){return this.center.copy(gc),this.radius=hc,this},setFromPoints:function(){var gc;return function(yc,xc){void 0==gc&&(gc=new Ge);var vc=this.center;void 0===xc?gc.setFromPoints(yc).getCenter(vc):vc.copy(xc);for(var _c=0,Ec=0,Tc=yc.length;Ec<Tc;Ec++)_c=_Mathmax(_c,vc.distanceToSquared(yc[Ec]));return this.radius=_Mathsqrt(_c),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.center.copy(gc.center),this.radius=gc.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(gc){return gc.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(gc){return gc.distanceTo(this.center)-this.radius},intersectsSphere:function(gc){var hc=this.radius+gc.radius;return gc.center.distanceToSquared(this.center)<=hc*hc},intersectsBox:function(gc){return gc.intersectsSphere(this)},intersectsPlane:function(gc){return _Mathabs(this.center.dot(gc.normal)-gc.constant)<=this.radius},clampPoint:function(gc,hc){var yc=this.center.distanceToSquared(gc),xc=hc||new O;return xc.copy(gc),yc>this.radius*this.radius&&(xc.sub(this.center).normalize(),xc.multiplyScalar(this.radius).add(this.center)),xc},getBoundingBox:function(gc){var hc=gc||new Ge;return hc.set(this.center,this.center),hc.expandByScalar(this.radius),hc},applyMatrix4:function(gc){return this.center.applyMatrix4(gc),this.radius*=gc.getMaxScaleOnAxis(),this},translate:function(gc){return this.center.add(gc),this},equals:function(gc){return gc.center.equals(this.center)&&gc.radius===this.radius}},Ve.prototype={constructor:Ve,isMatrix3:!0,set:function(gc,hc,yc,xc,vc,_c,Ec,Tc,Mc){var Sc=this.elements;return Sc[0]=gc,Sc[1]=xc,Sc[2]=Ec,Sc[3]=hc,Sc[4]=vc,Sc[5]=Tc,Sc[6]=yc,Sc[7]=_c,Sc[8]=Mc,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(gc){var hc=gc.elements;return this.set(hc[0],hc[3],hc[6],hc[1],hc[4],hc[7],hc[2],hc[5],hc[8]),this},setFromMatrix4:function(gc){var hc=gc.elements;return this.set(hc[0],hc[4],hc[8],hc[1],hc[5],hc[9],hc[2],hc[6],hc[10]),this},applyToBufferAttribute:function(){var gc;return function(yc){gc==void 0&&(gc=new O);for(var xc=0,vc=yc.count;xc<vc;xc++)gc.x=yc.getX(xc),gc.y=yc.getY(xc),gc.z=yc.getZ(xc),gc.applyMatrix3(this),yc.setXYZ(xc,gc.x,gc.y,gc.z);return yc}}(),multiplyScalar:function(gc){var hc=this.elements;return hc[0]*=gc,hc[3]*=gc,hc[6]*=gc,hc[1]*=gc,hc[4]*=gc,hc[7]*=gc,hc[2]*=gc,hc[5]*=gc,hc[8]*=gc,this},determinant:function(){var gc=this.elements,hc=gc[0],yc=gc[1],xc=gc[2],vc=gc[3],_c=gc[4],Ec=gc[5],Tc=gc[6],Mc=gc[7],Sc=gc[8];return hc*_c*Sc-hc*Ec*Mc-yc*vc*Sc+yc*Ec*Tc+xc*vc*Mc-xc*_c*Tc},getInverse:function(gc,hc){gc&&gc.isMatrix4;var yc=gc.elements,xc=this.elements,vc=yc[0],_c=yc[1],Ec=yc[2],Tc=yc[3],Mc=yc[4],Sc=yc[5],Lc=yc[6],wc=yc[7],Ac=yc[8],Rc=Ac*Mc-Sc*wc,Pc=Sc*Lc-Ac*Tc,Cc=wc*Tc-Mc*Lc,Ic=vc*Rc+_c*Pc+Ec*Cc;if(0==Ic){if(!0===hc)throw new Error('THREE.Matrix3.getInverse(): can\'t invert matrix, determinant is 0');else;return this.identity()}var Dc=1/Ic;return xc[0]=Rc*Dc,xc[1]=(Ec*wc-Ac*_c)*Dc,xc[2]=(Sc*_c-Ec*Mc)*Dc,xc[3]=Pc*Dc,xc[4]=(Ac*vc-Ec*Lc)*Dc,xc[5]=(Ec*Tc-Sc*vc)*Dc,xc[6]=Cc*Dc,xc[7]=(_c*Lc-wc*vc)*Dc,xc[8]=(Mc*vc-_c*Tc)*Dc,this},transpose:function(){var hc=this.elements,gc;return gc=hc[1],hc[1]=hc[3],hc[3]=gc,gc=hc[2],hc[2]=hc[6],hc[6]=gc,gc=hc[5],hc[5]=hc[7],hc[7]=gc,this},getNormalMatrix:function(gc){return this.setFromMatrix4(gc).getInverse(this).transpose()},transposeIntoArray:function(gc){var hc=this.elements;return gc[0]=hc[0],gc[1]=hc[3],gc[2]=hc[6],gc[3]=hc[1],gc[4]=hc[4],gc[5]=hc[7],gc[6]=hc[2],gc[7]=hc[5],gc[8]=hc[8],this},fromArray:function(gc,hc){hc===void 0&&(hc=0);for(var yc=0;9>yc;yc++)this.elements[yc]=gc[yc+hc];return this},toArray:function(gc,hc){void 0===gc&&(gc=[]),void 0===hc&&(hc=0);var yc=this.elements;return gc[hc]=yc[0],gc[hc+1]=yc[1],gc[hc+2]=yc[2],gc[hc+3]=yc[3],gc[hc+4]=yc[4],gc[hc+5]=yc[5],gc[hc+6]=yc[6],gc[hc+7]=yc[7],gc[hc+8]=yc[8],gc}},ke.prototype={constructor:ke,set:function(gc,hc){return this.normal.copy(gc),this.constant=hc,this},setComponents:function(gc,hc,yc,xc){return this.normal.set(gc,hc,yc),this.constant=xc,this},setFromNormalAndCoplanarPoint:function(gc,hc){return this.normal.copy(gc),this.constant=-hc.dot(this.normal),this},setFromCoplanarPoints:function(){var gc=new O,hc=new O;return function(xc,vc,_c){var Ec=gc.subVectors(_c,vc).cross(hc.subVectors(xc,vc)).normalize();return this.setFromNormalAndCoplanarPoint(Ec,xc),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.normal.copy(gc.normal),this.constant=gc.constant,this},normalize:function(){var gc=1/this.normal.length();return this.normal.multiplyScalar(gc),this.constant*=gc,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(gc){return this.normal.dot(gc)+this.constant},distanceToSphere:function(gc){return this.distanceToPoint(gc.center)-gc.radius},projectPoint:function(gc,hc){return this.orthoPoint(gc,hc).sub(gc).negate()},orthoPoint:function(gc,hc){var yc=this.distanceToPoint(gc),xc=hc||new O;return xc.copy(this.normal).multiplyScalar(yc)},intersectLine:function(){var gc=new O;return function(yc,xc){var vc=xc||new O,_c=yc.delta(gc),Ec=this.normal.dot(_c);if(0===Ec)return 0===this.distanceToPoint(yc.start)?vc.copy(yc.start):void 0;var Tc=-(yc.start.dot(this.normal)+this.constant)/Ec;return 0>Tc||1<Tc?void 0:vc.copy(_c).multiplyScalar(Tc).add(yc.start)}}(),intersectsLine:function(gc){var hc=this.distanceToPoint(gc.start),yc=this.distanceToPoint(gc.end);return 0>hc&&0<yc||0>yc&&0<hc},intersectsBox:function(gc){return gc.intersectsPlane(this)},intersectsSphere:function(gc){return gc.intersectsPlane(this)},coplanarPoint:function(gc){var hc=gc||new O;return hc.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var gc=new O,hc=new Ve;return function(xc,vc){var _c=this.coplanarPoint(gc).applyMatrix4(xc),Ec=vc||hc.getNormalMatrix(xc),Tc=this.normal.applyMatrix3(Ec).normalize();return this.constant=-_c.dot(Tc),this}}(),translate:function(gc){return this.constant-=gc.dot(this.normal),this},equals:function(gc){return gc.normal.equals(this.normal)&&gc.constant===this.constant}},We.prototype={constructor:We,set:function(gc,hc,yc,xc,vc,_c){var Ec=this.planes;return Ec[0].copy(gc),Ec[1].copy(hc),Ec[2].copy(yc),Ec[3].copy(xc),Ec[4].copy(vc),Ec[5].copy(_c),this},clone:function(){return new this.constructor().copy(this)},copy:function(gc){for(var hc=this.planes,yc=0;6>yc;yc++)hc[yc].copy(gc.planes[yc]);return this},setFromMatrix:function(gc){var hc=this.planes,yc=gc.elements,xc=yc[0],vc=yc[1],_c=yc[2],Ec=yc[3],Tc=yc[4],Mc=yc[5],Sc=yc[6],Lc=yc[7],wc=yc[8],Ac=yc[9],Rc=yc[10],Pc=yc[11],Cc=yc[12],Ic=yc[13],Uc=yc[14],Dc=yc[15];return hc[0].setComponents(Ec-xc,Lc-Tc,Pc-wc,Dc-Cc).normalize(),hc[1].setComponents(Ec+xc,Lc+Tc,Pc+wc,Dc+Cc).normalize(),hc[2].setComponents(Ec+vc,Lc+Mc,Pc+Ac,Dc+Ic).normalize(),hc[3].setComponents(Ec-vc,Lc-Mc,Pc-Ac,Dc-Ic).normalize(),hc[4].setComponents(Ec-_c,Lc-Sc,Pc-Rc,Dc-Uc).normalize(),hc[5].setComponents(Ec+_c,Lc+Sc,Pc+Rc,Dc+Uc).normalize(),this},intersectsObject:function(){var gc=new He;return function(yc){var xc=yc.geometry;return null===xc.boundingSphere&&xc.computeBoundingSphere(),gc.copy(xc.boundingSphere).applyMatrix4(yc.matrixWorld),this.intersectsSphere(gc)}}(),intersectsSprite:function(){var gc=new He;return function(yc){return gc.center.set(0,0,0),gc.radius=0.7071067811865476,gc.applyMatrix4(yc.matrixWorld),this.intersectsSphere(gc)}}(),intersectsSphere:function(gc){for(var hc=this.planes,yc=gc.center,xc=-gc.radius,vc=0,_c;6>vc;vc++)if(_c=hc[vc].distanceToPoint(yc),_c<xc)return!1;return!0},intersectsBox:function(){var gc=new O,hc=new O;return function(xc){for(var vc=this.planes,_c=0,Ec;6>_c;_c++){Ec=vc[_c],gc.x=0<Ec.normal.x?xc.min.x:xc.max.x,hc.x=0<Ec.normal.x?xc.max.x:xc.min.x,gc.y=0<Ec.normal.y?xc.min.y:xc.max.y,hc.y=0<Ec.normal.y?xc.max.y:xc.min.y,gc.z=0<Ec.normal.z?xc.min.z:xc.max.z,hc.z=0<Ec.normal.z?xc.max.z:xc.min.z;var Tc=Ec.distanceToPoint(gc),Mc=Ec.distanceToPoint(hc);if(0>Tc&&0>Mc)return!1}return!0}}(),containsPoint:function(gc){for(var hc=this.planes,yc=0;6>yc;yc++)if(0>hc[yc].distanceToPoint(gc))return!1;return!0}},Xe.prototype={constructor:Xe,set:function(gc,hc){return this.origin.copy(gc),this.direction.copy(hc),this},clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.origin.copy(gc.origin),this.direction.copy(gc.direction),this},at:function(gc,hc){var yc=hc||new O;return yc.copy(this.direction).multiplyScalar(gc).add(this.origin)},lookAt:function(gc){return this.direction.copy(gc).sub(this.origin).normalize(),this},recast:function(){var gc=new O;return function(yc){return this.origin.copy(this.at(yc,gc)),this}}(),closestPointToPoint:function(gc,hc){var yc=hc||new O;yc.subVectors(gc,this.origin);var xc=yc.dot(this.direction);return 0>xc?yc.copy(this.origin):yc.copy(this.direction).multiplyScalar(xc).add(this.origin)},distanceToPoint:function(gc){return _Mathsqrt(this.distanceSqToPoint(gc))},distanceSqToPoint:function(){var gc=new O;return function(yc){var xc=gc.subVectors(yc,this.origin).dot(this.direction);return 0>xc?this.origin.distanceToSquared(yc):(gc.copy(this.direction).multiplyScalar(xc).add(this.origin),gc.distanceToSquared(yc))}}(),distanceSqToSegment:function(){var gc=new O,hc=new O,yc=new O;return function(vc,_c,Ec,Tc){gc.copy(vc).add(_c).multiplyScalar(0.5),hc.copy(_c).sub(vc).normalize(),yc.copy(this.origin).sub(gc);var Mc=0.5*vc.distanceTo(_c),Sc=-this.direction.dot(hc),Lc=yc.dot(this.direction),wc=-yc.dot(hc),Ac=yc.lengthSq(),Rc=_Mathabs(1-Sc*Sc),Pc,Cc,Ic,Uc;if(!(0<Rc))Cc=0<Sc?-Mc:Mc,Pc=_Mathmax(0,-(Sc*Cc+Lc)),Ic=-Pc*Pc+Cc*(Cc+2*wc)+Ac;else if(Pc=Sc*wc-Lc,Cc=Sc*Lc-wc,Uc=Mc*Rc,!(0<=Pc))Cc<=-Uc?(Pc=_Mathmax(0,-(-Sc*Mc+Lc)),Cc=0<Pc?-Mc:_Mathmin(_Mathmax(-Mc,-wc),Mc),Ic=-Pc*Pc+Cc*(Cc+2*wc)+Ac):Cc<=Uc?(Pc=0,Cc=_Mathmin(_Mathmax(-Mc,-wc),Mc),Ic=Cc*(Cc+2*wc)+Ac):(Pc=_Mathmax(0,-(Sc*Mc+Lc)),Cc=0<Pc?Mc:_Mathmin(_Mathmax(-Mc,-wc),Mc),Ic=-Pc*Pc+Cc*(Cc+2*wc)+Ac);else if(!(Cc>=-Uc))Cc=-Mc,Pc=_Mathmax(0,-(Sc*Cc+Lc)),Ic=-Pc*Pc+Cc*(Cc+2*wc)+Ac;else if(Cc<=Uc){var Dc=1/Rc;Pc*=Dc,Cc*=Dc,Ic=Pc*(Pc+Sc*Cc+2*Lc)+Cc*(Sc*Pc+Cc+2*wc)+Ac}else Cc=Mc,Pc=_Mathmax(0,-(Sc*Cc+Lc)),Ic=-Pc*Pc+Cc*(Cc+2*wc)+Ac;return Ec&&Ec.copy(this.direction).multiplyScalar(Pc).add(this.origin),Tc&&Tc.copy(hc).multiplyScalar(Cc).add(gc),Ic}}(),intersectSphere:function(){var gc=new O;return function(yc,xc){gc.subVectors(yc.center,this.origin);var vc=gc.dot(this.direction),_c=gc.dot(gc)-vc*vc,Ec=yc.radius*yc.radius;if(_c>Ec)return null;var Tc=_Mathsqrt(Ec-_c),Mc=vc-Tc,Sc=vc+Tc;return 0>Mc&&0>Sc?null:0>Mc?this.at(Sc,xc):this.at(Mc,xc)}}(),intersectsSphere:function(gc){return this.distanceToPoint(gc.center)<=gc.radius},distanceToPlane:function(gc){var hc=gc.normal.dot(this.direction);if(0===hc)return 0===gc.distanceToPoint(this.origin)?0:null;var yc=-(this.origin.dot(gc.normal)+gc.constant)/hc;return 0<=yc?yc:null},intersectPlane:function(gc,hc){var yc=this.distanceToPlane(gc);return null===yc?null:this.at(yc,hc)},intersectsPlane:function(gc){var hc=gc.distanceToPoint(this.origin);if(0===hc)return!0;var yc=gc.normal.dot(this.direction);return!!(0>yc*hc)},intersectBox:function(gc,hc){var Mc=1/this.direction.x,Sc=1/this.direction.y,Lc=1/this.direction.z,wc=this.origin,yc,xc,vc,_c,Ec,Tc;return(0<=Mc?(yc=(gc.min.x-wc.x)*Mc,xc=(gc.max.x-wc.x)*Mc):(yc=(gc.max.x-wc.x)*Mc,xc=(gc.min.x-wc.x)*Mc),0<=Sc?(vc=(gc.min.y-wc.y)*Sc,_c=(gc.max.y-wc.y)*Sc):(vc=(gc.max.y-wc.y)*Sc,_c=(gc.min.y-wc.y)*Sc),yc>_c||vc>xc)?null:((vc>yc||yc!==yc)&&(yc=vc),(_c<xc||xc!==xc)&&(xc=_c),0<=Lc?(Ec=(gc.min.z-wc.z)*Lc,Tc=(gc.max.z-wc.z)*Lc):(Ec=(gc.max.z-wc.z)*Lc,Tc=(gc.min.z-wc.z)*Lc),yc>Tc||Ec>xc)?null:((Ec>yc||yc!==yc)&&(yc=Ec),(Tc<xc||xc!==xc)&&(xc=Tc),0>xc?null:this.at(0<=yc?yc:xc,hc))},intersectsBox:function(){var gc=new O;return function(yc){return null!==this.intersectBox(yc,gc)}}(),intersectTriangle:function(){var gc=new O,hc=new O,yc=new O,xc=new O;return function(_c,Ec,Tc,Mc,Sc){hc.subVectors(Ec,_c),yc.subVectors(Tc,_c),xc.crossVectors(hc,yc);var Lc=this.direction.dot(xc),wc;if(0<Lc){if(Mc)return null;wc=1}else if(0>Lc)wc=-1,Lc=-Lc;else return null;gc.subVectors(this.origin,_c);var Ac=wc*this.direction.dot(yc.crossVectors(gc,yc));if(0>Ac)return null;var Rc=wc*this.direction.dot(hc.cross(gc));if(0>Rc)return null;if(Ac+Rc>Lc)return null;var Pc=-wc*gc.dot(xc);return 0>Pc?null:this.at(Pc/Lc,Sc)}}(),applyMatrix4:function(gc){return this.direction.add(this.origin).applyMatrix4(gc),this.origin.applyMatrix4(gc),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(gc){return gc.origin.equals(this.origin)&&gc.direction.equals(this.direction)}},Ye.RotationOrders=['XYZ','YZX','ZXY','XZY','YXZ','ZYX'],Ye.DefaultOrder='XYZ',Ye.prototype={constructor:Ye,isEuler:!0,get x(){return this._x},set x(gc){this._x=gc,this.onChangeCallback()},get y(){return this._y},set y(gc){this._y=gc,this.onChangeCallback()},get z(){return this._z},set z(gc){this._z=gc,this.onChangeCallback()},get order(){return this._order},set order(gc){this._order=gc,this.onChangeCallback()},set:function(gc,hc,yc,xc){return this._x=gc,this._y=hc,this._z=yc,this._order=xc||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(gc){return this._x=gc._x,this._y=gc._y,this._z=gc._z,this._order=gc._order,this.onChangeCallback(),this},setFromRotationMatrix:function(gc,hc,yc){var xc=xl.clamp,vc=gc.elements,_c=vc[0],Ec=vc[4],Tc=vc[8],Mc=vc[1],Sc=vc[5],Lc=vc[9],wc=vc[2],Ac=vc[6],Rc=vc[10];return hc=hc||this._order,'XYZ'===hc?(this._y=_Mathasin(xc(Tc,-1,1)),0.99999>_Mathabs(Tc)?(this._x=_Mathatan(-Lc,Rc),this._z=_Mathatan(-Ec,_c)):(this._x=_Mathatan(Ac,Sc),this._z=0)):'YXZ'===hc?(this._x=_Mathasin(-xc(Lc,-1,1)),0.99999>_Mathabs(Lc)?(this._y=_Mathatan(Tc,Rc),this._z=_Mathatan(Mc,Sc)):(this._y=_Mathatan(-wc,_c),this._z=0)):'ZXY'===hc?(this._x=_Mathasin(xc(Ac,-1,1)),0.99999>_Mathabs(Ac)?(this._y=_Mathatan(-wc,Rc),this._z=_Mathatan(-Ec,Sc)):(this._y=0,this._z=_Mathatan(Mc,_c))):'ZYX'===hc?(this._y=_Mathasin(-xc(wc,-1,1)),0.99999>_Mathabs(wc)?(this._x=_Mathatan(Ac,Rc),this._z=_Mathatan(Mc,_c)):(this._x=0,this._z=_Mathatan(-Ec,Sc))):'YZX'===hc?(this._z=_Mathasin(xc(Mc,-1,1)),0.99999>_Mathabs(Mc)?(this._x=_Mathatan(-Lc,Sc),this._y=_Mathatan(-wc,_c)):(this._x=0,this._y=_Mathatan(Tc,Rc))):'XZY'===hc?(this._z=_Mathasin(-xc(Ec,-1,1)),0.99999>_Mathabs(Ec)?(this._x=_Mathatan(Ac,Sc),this._y=_Mathatan(Tc,_c)):(this._x=_Mathatan(-Lc,Rc),this._y=0)):void 0,this._order=hc,!1!==yc&&this.onChangeCallback(),this},setFromQuaternion:function(){var gc;return function(yc,xc,vc){return void 0==gc&&(gc=new G),gc.makeRotationFromQuaternion(yc),this.setFromRotationMatrix(gc,xc,vc)}}(),setFromVector3:function(gc,hc){return this.set(gc.x,gc.y,gc.z,hc||this._order)},reorder:function(){var gc=new F;return function(yc){return gc.setFromEuler(this),this.setFromQuaternion(gc,yc)}}(),equals:function(gc){return gc._x===this._x&&gc._y===this._y&&gc._z===this._z&&gc._order===this._order},fromArray:function(gc){return this._x=gc[0],this._y=gc[1],this._z=gc[2],void 0!==gc[3]&&(this._order=gc[3]),this.onChangeCallback(),this},toArray:function(gc,hc){return void 0===gc&&(gc=[]),void 0===hc&&(hc=0),gc[hc]=this._x,gc[hc+1]=this._y,gc[hc+2]=this._z,gc[hc+3]=this._order,gc},toVector3:function(gc){return gc?gc.set(this._x,this._y,this._z):new O(this._x,this._y,this._z)},onChange:function(gc){return this.onChangeCallback=gc,this},onChangeCallback:function(){}},qe.prototype={constructor:qe,set:function(gc){this.mask=1<<gc},enable:function(gc){this.mask|=1<<gc},toggle:function(gc){this.mask^=1<<gc},disable:function(gc){this.mask&=~(1<<gc)},test:function(gc){return 0!=(this.mask&gc.mask)}};var Wp=0;Ze.DefaultUp=new O(0,1,0),Ze.DefaultMatrixAutoUpdate=!0,Ze.prototype={constructor:Ze,isObject3D:!0,applyMatrix:function(gc){this.matrix.multiplyMatrices(gc,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(gc,hc){this.quaternion.setFromAxisAngle(gc,hc)},setRotationFromEuler:function(gc){this.quaternion.setFromEuler(gc,!0)},setRotationFromMatrix:function(gc){this.quaternion.setFromRotationMatrix(gc)},setRotationFromQuaternion:function(gc){this.quaternion.copy(gc)},rotateOnAxis:function(){var gc=new F;return function(yc,xc){return gc.setFromAxisAngle(yc,xc),this.quaternion.multiply(gc),this}}(),rotateX:function(){var gc=new O(1,0,0);return function(yc){return this.rotateOnAxis(gc,yc)}}(),rotateY:function(){var gc=new O(0,1,0);return function(yc){return this.rotateOnAxis(gc,yc)}}(),rotateZ:function(){var gc=new O(0,0,1);return function(yc){return this.rotateOnAxis(gc,yc)}}(),translateOnAxis:function(){var gc=new O;return function(yc,xc){return gc.copy(yc).applyQuaternion(this.quaternion),this.position.add(gc.multiplyScalar(xc)),this}}(),translateX:function(){var gc=new O(1,0,0);return function(yc){return this.translateOnAxis(gc,yc)}}(),translateY:function(){var gc=new O(0,1,0);return function(yc){return this.translateOnAxis(gc,yc)}}(),translateZ:function(){var gc=new O(0,0,1);return function(yc){return this.translateOnAxis(gc,yc)}}(),localToWorld:function(gc){return gc.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var gc=new G;return function(yc){return yc.applyMatrix4(gc.getInverse(this.matrixWorld))}}(),lookAt:function(){var gc=new G;return function(yc){gc.lookAt(yc,this.position,this.up),this.quaternion.setFromRotationMatrix(gc)}}(),add:function(gc){if(1<arguments.length){for(var hc=0;hc<arguments.length;hc++)this.add(arguments[hc]);return this}return gc===this?this:(gc&&gc.isObject3D?(null!==gc.parent&&gc.parent.remove(gc),gc.parent=this,gc.dispatchEvent({type:'added'}),this.children.push(gc)):void 0,this)},remove:function(gc){if(1<arguments.length)for(var hc=0;hc<arguments.length;hc++)this.remove(arguments[hc]);var yc=this.children.indexOf(gc);-1!==yc&&(gc.parent=null,gc.dispatchEvent({type:'removed'}),this.children.splice(yc,1))},getObjectById:function(gc){return this.getObjectByProperty('id',gc)},getObjectByName:function(gc){return this.getObjectByProperty('name',gc)},getObjectByProperty:function(gc,hc){if(this[gc]===hc)return this;for(var yc=0,xc=this.children.length;yc<xc;yc++){var vc=this.children[yc],_c=vc.getObjectByProperty(gc,hc);if(_c!==void 0)return _c}},getWorldPosition:function(gc){var hc=gc||new O;return this.updateMatrixWorld(!0),hc.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var gc=new O,hc=new O;return function(xc){var vc=xc||new F;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(gc,vc,hc),vc}}(),getWorldRotation:function(){var gc=new F;return function(yc){var xc=yc||new Ye;return this.getWorldQuaternion(gc),xc.setFromQuaternion(gc,this.rotation.order,!1)}}(),getWorldScale:function(){var gc=new O,hc=new F;return function(xc){var vc=xc||new O;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(gc,hc,vc),vc}}(),getWorldDirection:function(){var gc=new F;return function(yc){var xc=yc||new O;return this.getWorldQuaternion(gc),xc.set(0,0,1).applyQuaternion(gc)}}(),raycast:function(){},traverse:function(gc){gc(this);for(var hc=this.children,yc=0,xc=hc.length;yc<xc;yc++)hc[yc].traverse(gc)},traverseVisible:function(gc){if(!1!==this.visible){gc(this);for(var hc=this.children,yc=0,xc=hc.length;yc<xc;yc++)hc[yc].traverseVisible(gc)}},traverseAncestors:function(gc){var hc=this.parent;null!==hc&&(gc(hc),hc.traverseAncestors(gc))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(gc){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===gc)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,gc=!0);for(var hc=this.children,yc=0,xc=hc.length;yc<xc;yc++)hc[yc].updateMatrixWorld(gc)},toJSON:function(gc){function hc(Lc){var wc=[];for(var Ac in Lc){var Rc=Lc[Ac];delete Rc.metadata,wc.push(Rc)}return wc}var yc=void 0===gc||''===gc,xc={};yc&&(gc={geometries:{},materials:{},textures:{},images:{}},xc.metadata={version:4.4,type:'Object',generator:'Object3D.toJSON'});var vc={};if(vc.uuid=this.uuid,vc.type=this.type,''!==this.name&&(vc.name=this.name),'{}'!==JSON.stringify(this.userData)&&(vc.userData=this.userData),!0===this.castShadow&&(vc.castShadow=!0),!0===this.receiveShadow&&(vc.receiveShadow=!0),!1===this.visible&&(vc.visible=!1),vc.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===gc.geometries[this.geometry.uuid]&&(gc.geometries[this.geometry.uuid]=this.geometry.toJSON(gc)),vc.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===gc.materials[this.material.uuid]&&(gc.materials[this.material.uuid]=this.material.toJSON(gc)),vc.material=this.material.uuid),0<this.children.length){vc.children=[];for(var _c=0;_c<this.children.length;_c++)vc.children.push(this.children[_c].toJSON(gc).object)}if(yc){var Ec=hc(gc.geometries),Tc=hc(gc.materials),Mc=hc(gc.textures),Sc=hc(gc.images);0<Ec.length&&(xc.geometries=Ec),0<Tc.length&&(xc.materials=Tc),0<Mc.length&&(xc.textures=Mc),0<Sc.length&&(xc.images=Sc)}return xc.object=vc,xc},clone:function(gc){return new this.constructor().copy(this,gc)},copy:function(gc,hc){if(void 0===hc&&(hc=!0),this.name=gc.name,this.up.copy(gc.up),this.position.copy(gc.position),this.quaternion.copy(gc.quaternion),this.scale.copy(gc.scale),this.matrix.copy(gc.matrix),this.matrixWorld.copy(gc.matrixWorld),this.matrixAutoUpdate=gc.matrixAutoUpdate,this.matrixWorldNeedsUpdate=gc.matrixWorldNeedsUpdate,this.layers.mask=gc.layers.mask,this.visible=gc.visible,this.castShadow=gc.castShadow,this.receiveShadow=gc.receiveShadow,this.frustumCulled=gc.frustumCulled,this.renderOrder=gc.renderOrder,this.userData=JSON.parse(JSON.stringify(gc.userData)),!0===hc)for(var yc=0,xc;yc<gc.children.length;yc++)xc=gc.children[yc],this.add(xc.clone());return this}},Object.assign(Ze.prototype,A.prototype),Ke.prototype={constructor:Ke,set:function(gc,hc){return this.start.copy(gc),this.end.copy(hc),this},clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.start.copy(gc.start),this.end.copy(gc.end),this},getCenter:function(gc){var hc=gc||new O;return hc.addVectors(this.start,this.end).multiplyScalar(0.5)},delta:function(gc){var hc=gc||new O;return hc.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(gc,hc){var yc=hc||new O;return this.delta(yc).multiplyScalar(gc).add(this.start)},closestPointToPointParameter:function(){var gc=new O,hc=new O;return function(xc,vc){gc.subVectors(xc,this.start),hc.subVectors(this.end,this.start);var _c=hc.dot(hc),Ec=hc.dot(gc),Tc=Ec/_c;return vc&&(Tc=xl.clamp(Tc,0,1)),Tc}}(),closestPointToPoint:function(gc,hc,yc){var xc=this.closestPointToPointParameter(gc,hc),vc=yc||new O;return this.delta(vc).multiplyScalar(xc).add(this.start)},applyMatrix4:function(gc){return this.start.applyMatrix4(gc),this.end.applyMatrix4(gc),this},equals:function(gc){return gc.start.equals(this.start)&&gc.end.equals(this.end)}},Je.normal=function(){var gc=new O;return function(yc,xc,vc,_c){var Ec=_c||new O;Ec.subVectors(vc,xc),gc.subVectors(yc,xc),Ec.cross(gc);var Tc=Ec.lengthSq();return 0<Tc?Ec.multiplyScalar(1/_Mathsqrt(Tc)):Ec.set(0,0,0)}}(),Je.barycoordFromPoint=function(){var gc=new O,hc=new O,yc=new O;return function(vc,_c,Ec,Tc,Mc){gc.subVectors(Tc,_c),hc.subVectors(Ec,_c),yc.subVectors(vc,_c);var Sc=gc.dot(gc),Lc=gc.dot(hc),wc=gc.dot(yc),Ac=hc.dot(hc),Rc=hc.dot(yc),Pc=Sc*Ac-Lc*Lc,Cc=Mc||new O;if(0==Pc)return Cc.set(-2,-1,-1);var Ic=1/Pc,Uc=(Ac*wc-Lc*Rc)*Ic,Dc=(Sc*Rc-Lc*wc)*Ic;return Cc.set(1-Uc-Dc,Dc,Uc)}}(),Je.containsPoint=function(){var gc=new O;return function(yc,xc,vc,_c){var Ec=Je.barycoordFromPoint(yc,xc,vc,_c,gc);return 0<=Ec.x&&0<=Ec.y&&1>=Ec.x+Ec.y}}(),Je.prototype={constructor:Je,set:function(gc,hc,yc){return this.a.copy(gc),this.b.copy(hc),this.c.copy(yc),this},setFromPointsAndIndices:function(gc,hc,yc,xc){return this.a.copy(gc[hc]),this.b.copy(gc[yc]),this.c.copy(gc[xc]),this},clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.a.copy(gc.a),this.b.copy(gc.b),this.c.copy(gc.c),this},area:function(){var gc=new O,hc=new O;return function(){return gc.subVectors(this.c,this.b),hc.subVectors(this.a,this.b),0.5*gc.cross(hc).length()}}(),midpoint:function(gc){var hc=gc||new O;return hc.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(gc){return Je.normal(this.a,this.b,this.c,gc)},plane:function(gc){var hc=gc||new ke;return hc.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(gc,hc){return Je.barycoordFromPoint(gc,this.a,this.b,this.c,hc)},containsPoint:function(gc){return Je.containsPoint(gc,this.a,this.b,this.c)},closestPointToPoint:function(){var gc,hc,yc,xc;return function(_c,Ec){void 0==gc&&(gc=new ke,hc=[new Ke,new Ke,new Ke],yc=new O,xc=new O);var Tc=Ec||new O,Mc=Infinity;if(gc.setFromCoplanarPoints(this.a,this.b,this.c),gc.projectPoint(_c,yc),!0===this.containsPoint(yc))Tc.copy(yc);else{hc[0].set(this.a,this.b),hc[1].set(this.b,this.c),hc[2].set(this.c,this.a);for(var Sc=0;Sc<hc.length;Sc++){hc[Sc].closestPointToPoint(yc,!0,xc);var Lc=yc.distanceToSquared(xc);Lc<Mc&&(Mc=Lc,Tc.copy(xc))}}return Tc}}(),equals:function(gc){return gc.a.equals(this.a)&&gc.b.equals(this.b)&&gc.c.equals(this.c)}},Qe.prototype={constructor:Qe,clone:function(){return new this.constructor().copy(this)},copy:function(gc){this.a=gc.a,this.b=gc.b,this.c=gc.c,this.normal.copy(gc.normal),this.color.copy(gc.color),this.materialIndex=gc.materialIndex;for(var hc=0,yc=gc.vertexNormals.length;hc<yc;hc++)this.vertexNormals[hc]=gc.vertexNormals[hc].clone();for(var hc=0,yc=gc.vertexColors.length;hc<yc;hc++)this.vertexColors[hc]=gc.vertexColors[hc].clone();return this}},$e.prototype=Object.create(Be.prototype),$e.prototype.constructor=$e,$e.prototype.isMeshBasicMaterial=!0,$e.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.color.copy(gc.color),this.map=gc.map,this.lightMap=gc.lightMap,this.lightMapIntensity=gc.lightMapIntensity,this.aoMap=gc.aoMap,this.aoMapIntensity=gc.aoMapIntensity,this.specularMap=gc.specularMap,this.alphaMap=gc.alphaMap,this.envMap=gc.envMap,this.combine=gc.combine,this.reflectivity=gc.reflectivity,this.refractionRatio=gc.refractionRatio,this.wireframe=gc.wireframe,this.wireframeLinewidth=gc.wireframeLinewidth,this.wireframeLinecap=gc.wireframeLinecap,this.wireframeLinejoin=gc.wireframeLinejoin,this.skinning=gc.skinning,this.morphTargets=gc.morphTargets,this},et.prototype={constructor:et,isBufferAttribute:!0,set needsUpdate(gc){!0===gc&&this.version++},setArray:function(gc){if(Array.isArray(gc))throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');this.count=gc===void 0?0:gc.length/this.itemSize,this.array=gc},setDynamic:function(gc){return this.dynamic=gc,this},copy:function(gc){return this.array=new gc.array.constructor(gc.array),this.itemSize=gc.itemSize,this.count=gc.count,this.normalized=gc.normalized,this.dynamic=gc.dynamic,this},copyAt:function(gc,hc,yc){gc*=this.itemSize,yc*=hc.itemSize;for(var xc=0,vc=this.itemSize;xc<vc;xc++)this.array[gc+xc]=hc.array[yc+xc];return this},copyArray:function(gc){return this.array.set(gc),this},copyColorsArray:function(gc){for(var hc=this.array,yc=0,xc=0,vc=gc.length,_c;xc<vc;xc++)_c=gc[xc],void 0===_c&&(_c=new Ie),hc[yc++]=_c.r,hc[yc++]=_c.g,hc[yc++]=_c.b;return this},copyIndicesArray:function(gc){for(var hc=this.array,yc=0,xc=0,vc=gc.length,_c;xc<vc;xc++)_c=gc[xc],hc[yc++]=_c.a,hc[yc++]=_c.b,hc[yc++]=_c.c;return this},copyVector2sArray:function(gc){for(var hc=this.array,yc=0,xc=0,vc=gc.length,_c;xc<vc;xc++)_c=gc[xc],void 0===_c&&(_c=new R),hc[yc++]=_c.x,hc[yc++]=_c.y;return this},copyVector3sArray:function(gc){for(var hc=this.array,yc=0,xc=0,vc=gc.length,_c;xc<vc;xc++)_c=gc[xc],void 0===_c&&(_c=new O),hc[yc++]=_c.x,hc[yc++]=_c.y,hc[yc++]=_c.z;return this},copyVector4sArray:function(gc){for(var hc=this.array,yc=0,xc=0,vc=gc.length,_c;xc<vc;xc++)_c=gc[xc],void 0===_c&&(_c=new I),hc[yc++]=_c.x,hc[yc++]=_c.y,hc[yc++]=_c.z,hc[yc++]=_c.w;return this},set:function(gc,hc){return void 0===hc&&(hc=0),this.array.set(gc,hc),this},getX:function(gc){return this.array[gc*this.itemSize]},setX:function(gc,hc){return this.array[gc*this.itemSize]=hc,this},getY:function(gc){return this.array[gc*this.itemSize+1]},setY:function(gc,hc){return this.array[gc*this.itemSize+1]=hc,this},getZ:function(gc){return this.array[gc*this.itemSize+2]},setZ:function(gc,hc){return this.array[gc*this.itemSize+2]=hc,this},getW:function(gc){return this.array[gc*this.itemSize+3]},setW:function(gc,hc){return this.array[gc*this.itemSize+3]=hc,this},setXY:function(gc,hc,yc){return gc*=this.itemSize,this.array[gc+0]=hc,this.array[gc+1]=yc,this},setXYZ:function(gc,hc,yc,xc){return gc*=this.itemSize,this.array[gc+0]=hc,this.array[gc+1]=yc,this.array[gc+2]=xc,this},setXYZW:function(gc,hc,yc,xc,vc){return gc*=this.itemSize,this.array[gc+0]=hc,this.array[gc+1]=yc,this.array[gc+2]=xc,this.array[gc+3]=vc,this},onUpload:function(gc){return this.onUploadCallback=gc,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},tt.prototype=Object.create(et.prototype),tt.prototype.constructor=tt,rt.prototype=Object.create(et.prototype),rt.prototype.constructor=rt,at.prototype=Object.create(et.prototype),at.prototype.constructor=at,ot.prototype=Object.create(et.prototype),ot.prototype.constructor=ot,it.prototype=Object.create(et.prototype),it.prototype.constructor=it,nt.prototype=Object.create(et.prototype),nt.prototype.constructor=nt,st.prototype=Object.create(et.prototype),st.prototype.constructor=st,lt.prototype=Object.create(et.prototype),lt.prototype.constructor=lt,dt.prototype=Object.create(et.prototype),dt.prototype.constructor=dt,Object.assign(ct.prototype,{computeGroups:function(gc){for(var yc=[],xc=void 0,vc=gc.faces,_c=0,hc,Ec;_c<vc.length;_c++)Ec=vc[_c],Ec.materialIndex!==xc&&(xc=Ec.materialIndex,void 0!=hc&&(hc.count=3*_c-hc.start,yc.push(hc)),hc={start:3*_c,materialIndex:xc});hc!==void 0&&(hc.count=3*_c-hc.start,yc.push(hc)),this.groups=yc},fromGeometry:function(gc){var hc=gc.faces,yc=gc.vertices,xc=gc.faceVertexUvs,vc=xc[0]&&0<xc[0].length,_c=xc[1]&&0<xc[1].length,Ec=gc.morphTargets,Tc=Ec.length,Mc;if(0<Tc){Mc=[];for(var Sc=0;Sc<Tc;Sc++)Mc[Sc]=[];this.morphTargets.position=Mc}var Lc=gc.morphNormals,wc=Lc.length,Ac;if(0<wc){Ac=[];for(var Sc=0;Sc<wc;Sc++)Ac[Sc]=[];this.morphTargets.normal=Ac}for(var Rc=gc.skinIndices,Pc=gc.skinWeights,Cc=Rc.length===yc.length,Ic=Pc.length===yc.length,Sc=0,Uc;Sc<hc.length;Sc++){Uc=hc[Sc],this.vertices.push(yc[Uc.a],yc[Uc.b],yc[Uc.c]);var Dc=Uc.vertexNormals;if(3===Dc.length)this.normals.push(Dc[0],Dc[1],Dc[2]);else{var zc=Uc.normal;this.normals.push(zc,zc,zc)}var Nc=Uc.vertexColors;if(3===Nc.length)this.colors.push(Nc[0],Nc[1],Nc[2]);else{var Bc=Uc.color;this.colors.push(Bc,Bc,Bc)}if(!0===vc){var Fc=xc[0][Sc];void 0===Fc?(this.uvs.push(new R,new R,new R)):this.uvs.push(Fc[0],Fc[1],Fc[2])}if(!0===_c){var Fc=xc[1][Sc];void 0===Fc?(this.uvs2.push(new R,new R,new R)):this.uvs2.push(Fc[0],Fc[1],Fc[2])}for(var Oc=0,Gc;Oc<Tc;Oc++)Gc=Ec[Oc].vertices,Mc[Oc].push(Gc[Uc.a],Gc[Uc.b],Gc[Uc.c]);for(var Oc=0,Hc;Oc<wc;Oc++)Hc=Lc[Oc].vertexNormals[Sc],Ac[Oc].push(Hc.a,Hc.b,Hc.c);Cc&&this.skinIndices.push(Rc[Uc.a],Rc[Uc.b],Rc[Uc.c]),Ic&&this.skinWeights.push(Pc[Uc.a],Pc[Uc.b],Pc[Uc.c])}return this.computeGroups(gc),this.verticesNeedUpdate=gc.verticesNeedUpdate,this.normalsNeedUpdate=gc.normalsNeedUpdate,this.colorsNeedUpdate=gc.colorsNeedUpdate,this.uvsNeedUpdate=gc.uvsNeedUpdate,this.groupsNeedUpdate=gc.groupsNeedUpdate,this}});var jp=0;ft.prototype={constructor:ft,isGeometry:!0,applyMatrix:function(gc){for(var hc=new Ve().getNormalMatrix(gc),yc=0,xc=this.vertices.length,vc;yc<xc;yc++)vc=this.vertices[yc],vc.applyMatrix4(gc);for(var yc=0,xc=this.faces.length,_c;yc<xc;yc++){_c=this.faces[yc],_c.normal.applyMatrix3(hc).normalize();for(var Ec=0,Tc=_c.vertexNormals.length;Ec<Tc;Ec++)_c.vertexNormals[Ec].applyMatrix3(hc).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var gc;return function(yc){return void 0==gc&&(gc=new G),gc.makeRotationX(yc),this.applyMatrix(gc),this}}(),rotateY:function(){var gc;return function(yc){return void 0==gc&&(gc=new G),gc.makeRotationY(yc),this.applyMatrix(gc),this}}(),rotateZ:function(){var gc;return function(yc){return void 0==gc&&(gc=new G),gc.makeRotationZ(yc),this.applyMatrix(gc),this}}(),translate:function(){var gc;return function(yc,xc,vc){return void 0==gc&&(gc=new G),gc.makeTranslation(yc,xc,vc),this.applyMatrix(gc),this}}(),scale:function(){var gc;return function(yc,xc,vc){return void 0==gc&&(gc=new G),gc.makeScale(yc,xc,vc),this.applyMatrix(gc),this}}(),lookAt:function(){var gc;return function(yc){gc==void 0&&(gc=new Ze),gc.lookAt(yc),gc.updateMatrix(),this.applyMatrix(gc.matrix)}}(),fromBufferGeometry:function(gc){function hc(Nc,Bc,Fc,Oc){var Gc=void 0===Ec?[]:[Lc[Nc].clone(),Lc[Bc].clone(),Lc[Fc].clone()],Hc=void 0===Tc?[]:[yc.colors[Nc].clone(),yc.colors[Bc].clone(),yc.colors[Fc].clone()],Vc=new Qe(Nc,Bc,Fc,Gc,Hc,Oc);yc.faces.push(Vc),void 0!==Mc&&yc.faceVertexUvs[0].push([wc[Nc].clone(),wc[Bc].clone(),wc[Fc].clone()]),void 0!==Sc&&yc.faceVertexUvs[1].push([Ac[Nc].clone(),Ac[Bc].clone(),Ac[Fc].clone()])}var yc=this,xc=null===gc.index?void 0:gc.index.array,vc=gc.attributes,_c=vc.position.array,Ec=void 0===vc.normal?void 0:vc.normal.array,Tc=void 0===vc.color?void 0:vc.color.array,Mc=void 0===vc.uv?void 0:vc.uv.array,Sc=void 0===vc.uv2?void 0:vc.uv2.array;void 0!==Sc&&(this.faceVertexUvs[1]=[]);for(var Lc=[],wc=[],Ac=[],Rc=0,Pc=0;Rc<_c.length;Rc+=3,Pc+=2)yc.vertices.push(new O(_c[Rc],_c[Rc+1],_c[Rc+2])),void 0!==Ec&&Lc.push(new O(Ec[Rc],Ec[Rc+1],Ec[Rc+2])),void 0!==Tc&&yc.colors.push(new Ie(Tc[Rc],Tc[Rc+1],Tc[Rc+2])),void 0!==Mc&&wc.push(new R(Mc[Pc],Mc[Pc+1])),void 0!==Sc&&Ac.push(new R(Sc[Pc],Sc[Pc+1]));if(void 0!==xc){var Cc=gc.groups;if(0<Cc.length)for(var Rc=0;Rc<Cc.length;Rc++)for(var Ic=Cc[Rc],Uc=Ic.start,Dc=Ic.count,Pc=Uc;Pc<Uc+Dc;Pc+=3)hc(xc[Pc],xc[Pc+1],xc[Pc+2],Ic.materialIndex);else for(var Rc=0;Rc<xc.length;Rc+=3)hc(xc[Rc],xc[Rc+1],xc[Rc+2])}else for(var Rc=0;Rc<_c.length/3;Rc+=3)hc(Rc,Rc+1,Rc+2);return this.computeFaceNormals(),null!==gc.boundingBox&&(this.boundingBox=gc.boundingBox.clone()),null!==gc.boundingSphere&&(this.boundingSphere=gc.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var gc=this.boundingBox.getCenter().negate();return this.translate(gc.x,gc.y,gc.z),gc},normalize:function(){this.computeBoundingSphere();var gc=this.boundingSphere.center,hc=this.boundingSphere.radius,yc=0===hc?1:1/hc,xc=new G;return xc.set(yc,0,0,-yc*gc.x,0,yc,0,-yc*gc.y,0,0,yc,-yc*gc.z,0,0,0,1),this.applyMatrix(xc),this},computeFaceNormals:function(){for(var gc=new O,hc=new O,yc=0,xc=this.faces.length;yc<xc;yc++){var vc=this.faces[yc],_c=this.vertices[vc.a],Ec=this.vertices[vc.b],Tc=this.vertices[vc.c];gc.subVectors(Tc,Ec),hc.subVectors(_c,Ec),gc.cross(hc),gc.normalize(),vc.normal.copy(gc)}},computeVertexNormals:function(gc){gc===void 0&&(gc=!0);var hc,yc,xc,vc,_c,Ec;for(Ec=Array(this.vertices.length),hc=0,yc=this.vertices.length;hc<yc;hc++)Ec[hc]=new O;if(gc){var Tc,Mc,Sc,Lc=new O,wc=new O;for(xc=0,vc=this.faces.length;xc<vc;xc++)_c=this.faces[xc],Tc=this.vertices[_c.a],Mc=this.vertices[_c.b],Sc=this.vertices[_c.c],Lc.subVectors(Sc,Mc),wc.subVectors(Tc,Mc),Lc.cross(wc),Ec[_c.a].add(Lc),Ec[_c.b].add(Lc),Ec[_c.c].add(Lc)}else for(this.computeFaceNormals(),xc=0,vc=this.faces.length;xc<vc;xc++)_c=this.faces[xc],Ec[_c.a].add(_c.normal),Ec[_c.b].add(_c.normal),Ec[_c.c].add(_c.normal);for(hc=0,yc=this.vertices.length;hc<yc;hc++)Ec[hc].normalize();for(xc=0,vc=this.faces.length;xc<vc;xc++){_c=this.faces[xc];var Ac=_c.vertexNormals;3===Ac.length?(Ac[0].copy(Ec[_c.a]),Ac[1].copy(Ec[_c.b]),Ac[2].copy(Ec[_c.c])):(Ac[0]=Ec[_c.a].clone(),Ac[1]=Ec[_c.b].clone(),Ac[2]=Ec[_c.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var gc,hc,yc;for(this.computeFaceNormals(),gc=0,hc=this.faces.length;gc<hc;gc++){yc=this.faces[gc];var xc=yc.vertexNormals;3===xc.length?(xc[0].copy(yc.normal),xc[1].copy(yc.normal),xc[2].copy(yc.normal)):(xc[0]=yc.normal.clone(),xc[1]=yc.normal.clone(),xc[2]=yc.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var gc,hc,yc,xc,vc;for(yc=0,xc=this.faces.length;yc<xc;yc++)for(vc=this.faces[yc],vc.__originalFaceNormal?vc.__originalFaceNormal.copy(vc.normal):vc.__originalFaceNormal=vc.normal.clone(),vc.__originalVertexNormals||(vc.__originalVertexNormals=[]),(gc=0,hc=vc.vertexNormals.length);gc<hc;gc++)vc.__originalVertexNormals[gc]?vc.__originalVertexNormals[gc].copy(vc.vertexNormals[gc]):vc.__originalVertexNormals[gc]=vc.vertexNormals[gc].clone();var _c=new ft;for(_c.faces=this.faces,gc=0,hc=this.morphTargets.length;gc<hc;gc++){if(!this.morphNormals[gc]){this.morphNormals[gc]={},this.morphNormals[gc].faceNormals=[],this.morphNormals[gc].vertexNormals=[];var Ec=this.morphNormals[gc].faceNormals,Tc=this.morphNormals[gc].vertexNormals,Mc,Sc;for(yc=0,xc=this.faces.length;yc<xc;yc++)Mc=new O,Sc={a:new O,b:new O,c:new O},Ec.push(Mc),Tc.push(Sc)}var Lc=this.morphNormals[gc];_c.vertices=this.morphTargets[gc].vertices,_c.computeFaceNormals(),_c.computeVertexNormals();var Mc,Sc;for(yc=0,xc=this.faces.length;yc<xc;yc++)vc=this.faces[yc],Mc=Lc.faceNormals[yc],Sc=Lc.vertexNormals[yc],Mc.copy(vc.normal),Sc.a.copy(vc.vertexNormals[0]),Sc.b.copy(vc.vertexNormals[1]),Sc.c.copy(vc.vertexNormals[2])}for(yc=0,xc=this.faces.length;yc<xc;yc++)vc=this.faces[yc],vc.normal=vc.__originalFaceNormal,vc.vertexNormals=vc.__originalVertexNormals},computeLineDistances:function(){for(var gc=0,hc=this.vertices,yc=0,xc=hc.length;yc<xc;yc++)0<yc&&(gc+=hc[yc].distanceTo(hc[yc-1])),this.lineDistances[yc]=gc},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ge),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new He),this.boundingSphere.setFromPoints(this.vertices)},merge:function(gc,hc,yc){if(!1!==(gc&&gc.isGeometry)){var vc=this.vertices.length,_c=this.vertices,Ec=gc.vertices,Tc=this.faces,Mc=gc.faces,Sc=this.faceVertexUvs[0],Lc=gc.faceVertexUvs[0],wc=this.colors,Ac=gc.colors,xc;void 0===yc&&(yc=0),void 0!==hc&&(xc=new Ve().getNormalMatrix(hc));for(var Rc=0,Pc=Ec.length;Rc<Pc;Rc++){var Cc=Ec[Rc],Ic=Cc.clone();void 0!==hc&&Ic.applyMatrix4(hc),_c.push(Ic)}for(var Rc=0,Pc=Ac.length;Rc<Pc;Rc++)wc.push(Ac[Rc].clone());for(Rc=0,Pc=Mc.length;Rc<Pc;Rc++){var Uc=Mc[Rc],Bc=Uc.vertexNormals,Fc=Uc.vertexColors,Dc,zc,Nc;Dc=new Qe(Uc.a+vc,Uc.b+vc,Uc.c+vc),Dc.normal.copy(Uc.normal),void 0!==xc&&Dc.normal.applyMatrix3(xc).normalize();for(var Oc=0,Gc=Bc.length;Oc<Gc;Oc++)zc=Bc[Oc].clone(),void 0!==xc&&zc.applyMatrix3(xc).normalize(),Dc.vertexNormals.push(zc);Dc.color.copy(Uc.color);for(var Oc=0,Gc=Fc.length;Oc<Gc;Oc++)Nc=Fc[Oc],Dc.vertexColors.push(Nc.clone());Dc.materialIndex=Uc.materialIndex+yc,Tc.push(Dc)}for(Rc=0,Pc=Lc.length;Rc<Pc;Rc++){var Hc=Lc[Rc],Vc=[];if(void 0!==Hc){for(var Oc=0,Gc=Hc.length;Oc<Gc;Oc++)Vc.push(Hc[Oc].clone());Sc.push(Vc)}}}},mergeMesh:function(gc){!1===(gc&&gc.isMesh)||(gc.matrixAutoUpdate&&gc.updateMatrix(),this.merge(gc.geometry,gc.matrix))},mergeVertices:function(){var gc={},hc=[],yc=[],Ec=10000,xc,vc,Tc,Mc,Sc,Lc,wc,Ac;for(Tc=0,Mc=this.vertices.length;Tc<Mc;Tc++)xc=this.vertices[Tc],vc=_Mathround(xc.x*Ec)+'_'+_Mathround(xc.y*Ec)+'_'+_Mathround(xc.z*Ec),void 0===gc[vc]?(gc[vc]=Tc,hc.push(this.vertices[Tc]),yc[Tc]=hc.length-1):yc[Tc]=yc[gc[vc]];var Rc=[];for(Tc=0,Mc=this.faces.length;Tc<Mc;Tc++){Sc=this.faces[Tc],Sc.a=yc[Sc.a],Sc.b=yc[Sc.b],Sc.c=yc[Sc.c],Lc=[Sc.a,Sc.b,Sc.c];for(var Pc=0;3>Pc;Pc++)if(Lc[Pc]===Lc[(Pc+1)%3]){Rc.push(Tc);break}}for(Tc=Rc.length-1;0<=Tc;Tc--){var Cc=Rc[Tc];for(this.faces.splice(Cc,1),wc=0,Ac=this.faceVertexUvs.length;wc<Ac;wc++)this.faceVertexUvs[wc].splice(Cc,1)}var Ic=this.vertices.length-hc.length;return this.vertices=hc,Ic},sortFacesByMaterialIndex:function(){for(var hc=this.faces,yc=hc.length,xc=0;xc<yc;xc++)hc[xc]._id=xc;hc.sort(function(Sc,Lc){return Sc.materialIndex-Lc.materialIndex});var vc=this.faceVertexUvs[0],_c=this.faceVertexUvs[1],Ec,Tc;vc&&vc.length===yc&&(Ec=[]),_c&&_c.length===yc&&(Tc=[]);for(var xc=0,Mc;xc<yc;xc++)Mc=hc[xc]._id,Ec&&Ec.push(vc[Mc]),Tc&&Tc.push(_c[Mc]);Ec&&(this.faceVertexUvs[0]=Ec),Tc&&(this.faceVertexUvs[1]=Tc)},toJSON:function(){function gc(jc,Xc,Yc){return Yc?jc|1<<Xc:jc&~(1<<Xc)}function hc(jc){var Xc=jc.x.toString()+jc.y.toString()+jc.z.toString();return void 0===Ac[Xc]?(Ac[Xc]=wc.length/3,wc.push(jc.x,jc.y,jc.z),Ac[Xc]):Ac[Xc]}function yc(jc){var Xc=jc.r.toString()+jc.g.toString()+jc.b.toString();return void 0===Pc[Xc]?(Pc[Xc]=Rc.length,Rc.push(jc.getHex()),Pc[Xc]):Pc[Xc]}function xc(jc){var Xc=jc.x.toString()+jc.y.toString();return void 0===Ic[Xc]?(Ic[Xc]=Cc.length/2,Cc.push(jc.x,jc.y),Ic[Xc]):Ic[Xc]}var vc={metadata:{version:4.4,type:'Geometry',generator:'Geometry.toJSON'}};if(vc.uuid=this.uuid,vc.type=this.type,''!==this.name&&(vc.name=this.name),void 0!==this.parameters){var _c=this.parameters;for(var Ec in _c)void 0!==_c[Ec]&&(vc[Ec]=_c[Ec]);return vc}for(var Tc=[],Mc=0,Sc;Mc<this.vertices.length;Mc++)Sc=this.vertices[Mc],Tc.push(Sc.x,Sc.y,Sc.z);for(var Lc=[],wc=[],Ac={},Rc=[],Pc={},Cc=[],Ic={},Mc=0;Mc<this.faces.length;Mc++){var Uc=this.faces[Mc],Nc=void 0!==this.faceVertexUvs[0][Mc],Bc=0<Uc.normal.length(),Fc=0<Uc.vertexNormals.length,Oc=1!==Uc.color.r||1!==Uc.color.g||1!==Uc.color.b,Gc=0<Uc.vertexColors.length,Hc=0;if(Hc=gc(Hc,0,0),Hc=gc(Hc,1,!0),Hc=gc(Hc,2,!1),Hc=gc(Hc,3,Nc),Hc=gc(Hc,4,Bc),Hc=gc(Hc,5,Fc),Hc=gc(Hc,6,Oc),Hc=gc(Hc,7,Gc),Lc.push(Hc),Lc.push(Uc.a,Uc.b,Uc.c),Lc.push(Uc.materialIndex),Nc){var Vc=this.faceVertexUvs[0][Mc];Lc.push(xc(Vc[0]),xc(Vc[1]),xc(Vc[2]))}if(Bc&&Lc.push(hc(Uc.normal)),Fc){var kc=Uc.vertexNormals;Lc.push(hc(kc[0]),hc(kc[1]),hc(kc[2]))}if(Oc&&Lc.push(yc(Uc.color)),Gc){var Wc=Uc.vertexColors;Lc.push(yc(Wc[0]),yc(Wc[1]),yc(Wc[2]))}}return vc.data={},vc.data.vertices=Tc,vc.data.normals=wc,0<Rc.length&&(vc.data.colors=Rc),0<Cc.length&&(vc.data.uvs=[Cc]),vc.data.faces=Lc,vc},clone:function(){return new ft().copy(this)},copy:function(gc){var hc,yc,xc,vc,_c,Ec;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=gc.name;var Tc=gc.vertices;for(hc=0,yc=Tc.length;hc<yc;hc++)this.vertices.push(Tc[hc].clone());var Mc=gc.colors;for(hc=0,yc=Mc.length;hc<yc;hc++)this.colors.push(Mc[hc].clone());var Sc=gc.faces;for(hc=0,yc=Sc.length;hc<yc;hc++)this.faces.push(Sc[hc].clone());for(hc=0,yc=gc.faceVertexUvs.length;hc<yc;hc++){var Lc=gc.faceVertexUvs[hc];for(void 0===this.faceVertexUvs[hc]&&(this.faceVertexUvs[hc]=[]),xc=0,vc=Lc.length;xc<vc;xc++){var wc=Lc[xc],Ac=[];for(_c=0,Ec=wc.length;_c<Ec;_c++){var Rc=wc[_c];Ac.push(Rc.clone())}this.faceVertexUvs[hc].push(Ac)}}var Pc=gc.morphTargets;for(hc=0,yc=Pc.length;hc<yc;hc++){var Cc={name:Pc[hc].name};if(void 0!==Pc[hc].vertices)for(Cc.vertices=[],xc=0,vc=Pc[hc].vertices.length;xc<vc;xc++)Cc.vertices.push(Pc[hc].vertices[xc].clone());if(void 0!==Pc[hc].normals)for(Cc.normals=[],xc=0,vc=Pc[hc].normals.length;xc<vc;xc++)Cc.normals.push(Pc[hc].normals[xc].clone());this.morphTargets.push(Cc)}var Ic=gc.morphNormals;for(hc=0,yc=Ic.length;hc<yc;hc++){var Uc={};if(void 0!==Ic[hc].vertexNormals)for(Uc.vertexNormals=[],xc=0,vc=Ic[hc].vertexNormals.length;xc<vc;xc++){var Dc=Ic[hc].vertexNormals[xc],zc={};zc.a=Dc.a.clone(),zc.b=Dc.b.clone(),zc.c=Dc.c.clone(),Uc.vertexNormals.push(zc)}if(void 0!==Ic[hc].faceNormals)for(Uc.faceNormals=[],xc=0,vc=Ic[hc].faceNormals.length;xc<vc;xc++)Uc.faceNormals.push(Ic[hc].faceNormals[xc].clone());this.morphNormals.push(Uc)}var Nc=gc.skinWeights;for(hc=0,yc=Nc.length;hc<yc;hc++)this.skinWeights.push(Nc[hc].clone());var Bc=gc.skinIndices;for(hc=0,yc=Bc.length;hc<yc;hc++)this.skinIndices.push(Bc[hc].clone());var Fc=gc.lineDistances;for(hc=0,yc=Fc.length;hc<yc;hc++)this.lineDistances.push(Fc[hc]);var Oc=gc.boundingBox;null!==Oc&&(this.boundingBox=Oc.clone());var Gc=gc.boundingSphere;return null!==Gc&&(this.boundingSphere=Gc.clone()),this.elementsNeedUpdate=gc.elementsNeedUpdate,this.verticesNeedUpdate=gc.verticesNeedUpdate,this.uvsNeedUpdate=gc.uvsNeedUpdate,this.normalsNeedUpdate=gc.normalsNeedUpdate,this.colorsNeedUpdate=gc.colorsNeedUpdate,this.lineDistancesNeedUpdate=gc.lineDistancesNeedUpdate,this.groupsNeedUpdate=gc.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:'dispose'})}},Object.assign(ft.prototype,A.prototype),gt.prototype={constructor:gt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(gc){this.index=Array.isArray(gc)?new(65535<ut(gc)?st:it)(gc,1):gc},addAttribute:function(gc,hc){return!1===(hc&&hc.isBufferAttribute)&&!1===(hc&&hc.isInterleavedBufferAttribute)?(void this.addAttribute(gc,new et(arguments[1],arguments[2]))):'index'===gc?(void this.setIndex(hc)):(this.attributes[gc]=hc,this)},getAttribute:function(gc){return this.attributes[gc]},removeAttribute:function(gc){return delete this.attributes[gc],this},addGroup:function(gc,hc,yc){this.groups.push({start:gc,count:hc,materialIndex:yc===void 0?0:yc})},clearGroups:function(){this.groups=[]},setDrawRange:function(gc,hc){this.drawRange.start=gc,this.drawRange.count=hc},applyMatrix:function(gc){var hc=this.attributes.position;void 0!==hc&&(gc.applyToBufferAttribute(hc),hc.needsUpdate=!0);var yc=this.attributes.normal;if(void 0!==yc){var xc=new Ve().getNormalMatrix(gc);xc.applyToBufferAttribute(yc),yc.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var gc;return function(yc){return void 0==gc&&(gc=new G),gc.makeRotationX(yc),this.applyMatrix(gc),this}}(),rotateY:function(){var gc;return function(yc){return void 0==gc&&(gc=new G),gc.makeRotationY(yc),this.applyMatrix(gc),this}}(),rotateZ:function(){var gc;return function(yc){return void 0==gc&&(gc=new G),gc.makeRotationZ(yc),this.applyMatrix(gc),this}}(),translate:function(){var gc;return function(yc,xc,vc){return void 0==gc&&(gc=new G),gc.makeTranslation(yc,xc,vc),this.applyMatrix(gc),this}}(),scale:function(){var gc;return function(yc,xc,vc){return void 0==gc&&(gc=new G),gc.makeScale(yc,xc,vc),this.applyMatrix(gc),this}}(),lookAt:function(){var gc;return function(yc){gc==void 0&&(gc=new Ze),gc.lookAt(yc),gc.updateMatrix(),this.applyMatrix(gc.matrix)}}(),center:function(){this.computeBoundingBox();var gc=this.boundingBox.getCenter().negate();return this.translate(gc.x,gc.y,gc.z),gc},setFromObject:function(gc){var hc=gc.geometry;if(gc.isPoints||gc.isLine){var yc=new lt(3*hc.vertices.length,3),xc=new lt(3*hc.colors.length,3);if(this.addAttribute('position',yc.copyVector3sArray(hc.vertices)),this.addAttribute('color',xc.copyColorsArray(hc.colors)),hc.lineDistances&&hc.lineDistances.length===hc.vertices.length){var vc=new lt(hc.lineDistances.length,1);this.addAttribute('lineDistance',vc.copyArray(hc.lineDistances))}null!==hc.boundingSphere&&(this.boundingSphere=hc.boundingSphere.clone()),null!==hc.boundingBox&&(this.boundingBox=hc.boundingBox.clone())}else gc.isMesh&&hc&&hc.isGeometry&&this.fromGeometry(hc);return this},updateFromObject:function(gc){var hc=gc.geometry;if(gc.isMesh){var yc=hc.__directGeometry;if(!0===hc.elementsNeedUpdate&&(yc=void 0,hc.elementsNeedUpdate=!1),void 0===yc)return this.fromGeometry(hc);yc.verticesNeedUpdate=hc.verticesNeedUpdate,yc.normalsNeedUpdate=hc.normalsNeedUpdate,yc.colorsNeedUpdate=hc.colorsNeedUpdate,yc.uvsNeedUpdate=hc.uvsNeedUpdate,yc.groupsNeedUpdate=hc.groupsNeedUpdate,hc.verticesNeedUpdate=!1,hc.normalsNeedUpdate=!1,hc.colorsNeedUpdate=!1,hc.uvsNeedUpdate=!1,hc.groupsNeedUpdate=!1,hc=yc}var xc;return!0===hc.verticesNeedUpdate&&(xc=this.attributes.position,void 0!==xc&&(xc.copyVector3sArray(hc.vertices),xc.needsUpdate=!0),hc.verticesNeedUpdate=!1),!0===hc.normalsNeedUpdate&&(xc=this.attributes.normal,void 0!==xc&&(xc.copyVector3sArray(hc.normals),xc.needsUpdate=!0),hc.normalsNeedUpdate=!1),!0===hc.colorsNeedUpdate&&(xc=this.attributes.color,void 0!==xc&&(xc.copyColorsArray(hc.colors),xc.needsUpdate=!0),hc.colorsNeedUpdate=!1),hc.uvsNeedUpdate&&(xc=this.attributes.uv,void 0!==xc&&(xc.copyVector2sArray(hc.uvs),xc.needsUpdate=!0),hc.uvsNeedUpdate=!1),hc.lineDistancesNeedUpdate&&(xc=this.attributes.lineDistance,void 0!==xc&&(xc.copyArray(hc.lineDistances),xc.needsUpdate=!0),hc.lineDistancesNeedUpdate=!1),hc.groupsNeedUpdate&&(hc.computeGroups(gc.geometry),this.groups=hc.groups,hc.groupsNeedUpdate=!1),this},fromGeometry:function(gc){return gc.__directGeometry=new ct().fromGeometry(gc),this.fromDirectGeometry(gc.__directGeometry)},fromDirectGeometry:function(gc){var hc=new Float32Array(3*gc.vertices.length);if(this.addAttribute('position',new et(hc,3).copyVector3sArray(gc.vertices)),0<gc.normals.length){var yc=new Float32Array(3*gc.normals.length);this.addAttribute('normal',new et(yc,3).copyVector3sArray(gc.normals))}if(0<gc.colors.length){var xc=new Float32Array(3*gc.colors.length);this.addAttribute('color',new et(xc,3).copyColorsArray(gc.colors))}if(0<gc.uvs.length){var vc=new Float32Array(2*gc.uvs.length);this.addAttribute('uv',new et(vc,2).copyVector2sArray(gc.uvs))}if(0<gc.uvs2.length){var _c=new Float32Array(2*gc.uvs2.length);this.addAttribute('uv2',new et(_c,2).copyVector2sArray(gc.uvs2))}if(0<gc.indices.length){var Ec=65535<ut(gc.indices)?Uint32Array:Uint16Array,Tc=new Ec(3*gc.indices.length);this.setIndex(new et(Tc,1).copyIndicesArray(gc.indices))}for(var Mc in this.groups=gc.groups,gc.morphTargets){for(var Sc=[],Lc=gc.morphTargets[Mc],wc=0,Ac=Lc.length;wc<Ac;wc++){var Rc=Lc[wc],Pc=new lt(3*Rc.length,3);Sc.push(Pc.copyVector3sArray(Rc))}this.morphAttributes[Mc]=Sc}if(0<gc.skinIndices.length){var Cc=new lt(4*gc.skinIndices.length,4);this.addAttribute('skinIndex',Cc.copyVector4sArray(gc.skinIndices))}if(0<gc.skinWeights.length){var Ic=new lt(4*gc.skinWeights.length,4);this.addAttribute('skinWeight',Ic.copyVector4sArray(gc.skinWeights))}return null!==gc.boundingSphere&&(this.boundingSphere=gc.boundingSphere.clone()),null!==gc.boundingBox&&(this.boundingBox=gc.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ge);var gc=this.attributes.position;gc===void 0?this.boundingBox.makeEmpty():this.boundingBox.setFromBufferAttribute(gc),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&void 0},computeBoundingSphere:function(){var gc=new Ge,hc=new O;return function(){null===this.boundingSphere&&(this.boundingSphere=new He);var xc=this.attributes.position;if(xc){var vc=this.boundingSphere.center;gc.setFromBufferAttribute(xc),gc.getCenter(vc);for(var _c=0,Ec=0,Tc=xc.count;Ec<Tc;Ec++)hc.x=xc.getX(Ec),hc.y=xc.getY(Ec),hc.z=xc.getZ(Ec),_c=_Mathmax(_c,vc.distanceToSquared(hc));this.boundingSphere.radius=_Mathsqrt(_c),isNaN(this.boundingSphere.radius)&&void 0}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var gc=this.index,hc=this.attributes,yc=this.groups;if(hc.position){var xc=hc.position.array;if(hc.normal===void 0)this.addAttribute('normal',new et(new Float32Array(xc.length),3));else for(var vc=hc.normal.array,_c=0,Ec=vc.length;_c<Ec;_c++)vc[_c]=0;var Tc=hc.normal.array,Mc,Sc,Lc,wc=new O,Ac=new O,Rc=new O,Pc=new O,Cc=new O;if(gc){var Ic=gc.array;0===yc.length&&this.addGroup(0,Ic.length);for(var Uc=0,Dc=yc.length;Uc<Dc;++Uc)for(var zc=yc[Uc],Nc=zc.start,Bc=zc.count,_c=Nc,Ec=Nc+Bc;_c<Ec;_c+=3)Mc=3*Ic[_c+0],Sc=3*Ic[_c+1],Lc=3*Ic[_c+2],wc.fromArray(xc,Mc),Ac.fromArray(xc,Sc),Rc.fromArray(xc,Lc),Pc.subVectors(Rc,Ac),Cc.subVectors(wc,Ac),Pc.cross(Cc),Tc[Mc]+=Pc.x,Tc[Mc+1]+=Pc.y,Tc[Mc+2]+=Pc.z,Tc[Sc]+=Pc.x,Tc[Sc+1]+=Pc.y,Tc[Sc+2]+=Pc.z,Tc[Lc]+=Pc.x,Tc[Lc+1]+=Pc.y,Tc[Lc+2]+=Pc.z}else for(var _c=0,Ec=xc.length;_c<Ec;_c+=9)wc.fromArray(xc,_c),Ac.fromArray(xc,_c+3),Rc.fromArray(xc,_c+6),Pc.subVectors(Rc,Ac),Cc.subVectors(wc,Ac),Pc.cross(Cc),Tc[_c]=Pc.x,Tc[_c+1]=Pc.y,Tc[_c+2]=Pc.z,Tc[_c+3]=Pc.x,Tc[_c+4]=Pc.y,Tc[_c+5]=Pc.z,Tc[_c+6]=Pc.x,Tc[_c+7]=Pc.y,Tc[_c+8]=Pc.z;this.normalizeNormals(),hc.normal.needsUpdate=!0}},merge:function(gc,hc){if(!1!==(gc&&gc.isBufferGeometry)){void 0===hc&&(hc=0);var yc=this.attributes;for(var xc in yc)if(void 0!==gc.attributes[xc])for(var vc=yc[xc],_c=vc.array,Ec=gc.attributes[xc],Tc=Ec.array,Mc=Ec.itemSize,Sc=0,Lc=Mc*hc;Sc<Tc.length;Sc++,Lc++)_c[Lc]=Tc[Sc];return this}},normalizeNormals:function(){for(var gc=this.attributes.normal.array,_c=0,Ec=gc.length,hc,yc,xc,vc;_c<Ec;_c+=3)hc=gc[_c],yc=gc[_c+1],xc=gc[_c+2],vc=1/_Mathsqrt(hc*hc+yc*yc+xc*xc),gc[_c]*=vc,gc[_c+1]*=vc,gc[_c+2]*=vc},toNonIndexed:function(){if(null===this.index)return this;var gc=new gt,hc=this.index.array,yc=this.attributes;for(var xc in yc){for(var vc=yc[xc],_c=vc.array,Ec=vc.itemSize,Tc=new _c.constructor(hc.length*Ec),Mc=0,Sc=0,Lc=0,wc=hc.length;Lc<wc;Lc++){Mc=hc[Lc]*Ec;for(var Ac=0;Ac<Ec;Ac++)Tc[Sc++]=_c[Mc++]}gc.addAttribute(xc,new et(Tc,Ec))}return gc},toJSON:function(){var gc={metadata:{version:4.4,type:'BufferGeometry',generator:'BufferGeometry.toJSON'}};if(gc.uuid=this.uuid,gc.type=this.type,''!==this.name&&(gc.name=this.name),void 0!==this.parameters){var hc=this.parameters;for(var yc in hc)void 0!==hc[yc]&&(gc[yc]=hc[yc]);return gc}gc.data={attributes:{}};var xc=this.index;if(null!==xc){var vc=Array.prototype.slice.call(xc.array);gc.data.index={type:xc.array.constructor.name,array:vc}}var _c=this.attributes;for(var yc in _c){var Ec=_c[yc],vc=Array.prototype.slice.call(Ec.array);gc.data.attributes[yc]={itemSize:Ec.itemSize,type:Ec.array.constructor.name,array:vc,normalized:Ec.normalized}}var Tc=this.groups;0<Tc.length&&(gc.data.groups=JSON.parse(JSON.stringify(Tc)));var Mc=this.boundingSphere;return null!==Mc&&(gc.data.boundingSphere={center:Mc.center.toArray(),radius:Mc.radius}),gc},clone:function(){return new gt().copy(this)},copy:function(gc){var hc,yc,xc;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=gc.name;var vc=gc.index;null!==vc&&this.setIndex(vc.clone());var _c=gc.attributes;for(hc in _c){var Ec=_c[hc];this.addAttribute(hc,Ec.clone())}var Tc=gc.morphAttributes;for(hc in Tc){var Mc=[],Sc=Tc[hc];for(yc=0,xc=Sc.length;yc<xc;yc++)Mc.push(Sc[yc].clone());this.morphAttributes[hc]=Mc}var Lc=gc.groups;for(yc=0,xc=Lc.length;yc<xc;yc++){var wc=Lc[yc];this.addGroup(wc.start,wc.count,wc.materialIndex)}var Ac=gc.boundingBox;null!==Ac&&(this.boundingBox=Ac.clone());var Rc=gc.boundingSphere;return null!==Rc&&(this.boundingSphere=Rc.clone()),this.drawRange.start=gc.drawRange.start,this.drawRange.count=gc.drawRange.count,this},dispose:function(){this.dispatchEvent({type:'dispose'})}},gt.MaxIndex=65535,Object.assign(gt.prototype,A.prototype),ht.prototype=Object.assign(Object.create(Ze.prototype),{constructor:ht,isMesh:!0,setDrawMode:function(gc){this.drawMode=gc},copy:function(gc){return Ze.prototype.copy.call(this,gc),this.drawMode=gc.drawMode,this},updateMorphTargets:function(){var gc=this.geometry.morphTargets;if(gc!==void 0&&0<gc.length){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var hc=0,yc=gc.length;hc<yc;hc++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[gc[hc].name]=hc}},raycast:function(){function gc(Dc,zc,Nc,Bc,Fc,Oc,Gc){return Je.barycoordFromPoint(Dc,zc,Nc,Bc,Cc),Fc.multiplyScalar(Cc.x),Oc.multiplyScalar(Cc.y),Gc.multiplyScalar(Cc.z),Fc.add(Oc).add(Gc),Fc.clone()}function hc(Dc,zc,Nc,Bc,Fc,Oc,Gc){var Vc=Dc.material,Hc;if(Hc=Vc.side===Qi?Nc.intersectTriangle(Oc,Fc,Bc,!0,Gc):Nc.intersectTriangle(Bc,Fc,Oc,Vc.side!==$i,Gc),null===Hc)return null;Uc.copy(Gc),Uc.applyMatrix4(Dc.matrixWorld);var kc=zc.ray.origin.distanceTo(Uc);return kc<zc.near||kc>zc.far?null:{distance:kc,point:Uc.clone(),object:Dc}}function yc(Dc,zc,Nc,Bc,Fc,Oc,Gc,Hc){Ec.fromBufferAttribute(Bc,Oc),Tc.fromBufferAttribute(Bc,Gc),Mc.fromBufferAttribute(Bc,Hc);var Vc=hc(Dc,zc,Nc,Ec,Tc,Mc,Ic);return Vc&&(Fc&&(Ac.fromBufferAttribute(Fc,Oc),Rc.fromBufferAttribute(Fc,Gc),Pc.fromBufferAttribute(Fc,Hc),Vc.uv=gc(Ic,Ec,Tc,Mc,Ac,Rc,Pc)),Vc.face=new Qe(Oc,Gc,Hc,Je.normal(Ec,Tc,Mc)),Vc.faceIndex=Oc),Vc}var xc=new G,vc=new Xe,_c=new He,Ec=new O,Tc=new O,Mc=new O,Sc=new O,Lc=new O,wc=new O,Ac=new R,Rc=new R,Pc=new R,Cc=new O,Ic=new O,Uc=new O;return function(zc,Nc){var Bc=this.geometry,Fc=this.material,Oc=this.matrixWorld;if(void 0!==Fc&&(null===Bc.boundingSphere&&Bc.computeBoundingSphere(),_c.copy(Bc.boundingSphere),_c.applyMatrix4(Oc),!1!==zc.ray.intersectsSphere(_c))&&(xc.getInverse(Oc),vc.copy(zc.ray).applyMatrix4(xc),null===Bc.boundingBox||!1!==vc.intersectsBox(Bc.boundingBox))){var Gc;if(Bc.isBufferGeometry){var Wc=Bc.index,jc=Bc.attributes.position,Xc=Bc.attributes.uv,Hc,Vc,kc,Yc,qc;if(null!==Wc)for(Yc=0,qc=Wc.count;Yc<qc;Yc+=3)Hc=Wc.getX(Yc),Vc=Wc.getX(Yc+1),kc=Wc.getX(Yc+2),Gc=yc(this,zc,vc,jc,Xc,Hc,Vc,kc),Gc&&(Gc.faceIndex=_Mathfloor(Yc/3),Nc.push(Gc));else for(Yc=0,qc=jc.count;Yc<qc;Yc+=3)Hc=Yc,Vc=Yc+1,kc=Yc+2,Gc=yc(this,zc,vc,jc,Xc,Hc,Vc,kc),Gc&&(Gc.index=Hc,Nc.push(Gc))}else if(Bc.isGeometry){var Qc=Fc&&Fc.isMultiMaterial,$c=!0===Qc?Fc.materials:null,eu=Bc.vertices,tu=Bc.faces,au=Bc.faceVertexUvs[0],Zc,Kc,Jc,ru;0<au.length&&(ru=au);for(var ou=0,iu=tu.length;ou<iu;ou++){var nu=tu[ou],lu=!0===Qc?$c[nu.materialIndex]:Fc;if(void 0!==lu){if(Zc=eu[nu.a],Kc=eu[nu.b],Jc=eu[nu.c],!0===lu.morphTargets){var du=Bc.morphTargets,pu=this.morphTargetInfluences;Ec.set(0,0,0),Tc.set(0,0,0),Mc.set(0,0,0);for(var uu=0,mu=du.length,fu;uu<mu;uu++)if(fu=pu[uu],0!==fu){var gu=du[uu].vertices;Ec.addScaledVector(Sc.subVectors(gu[nu.a],Zc),fu),Tc.addScaledVector(Lc.subVectors(gu[nu.b],Kc),fu),Mc.addScaledVector(wc.subVectors(gu[nu.c],Jc),fu)}Ec.add(Zc),Tc.add(Kc),Mc.add(Jc),Zc=Ec,Kc=Tc,Jc=Mc}if(Gc=hc(this,zc,vc,Zc,Kc,Jc,Ic),Gc){if(ru){var hu=ru[ou];Ac.copy(hu[0]),Rc.copy(hu[1]),Pc.copy(hu[2]),Gc.uv=gc(Ic,Zc,Kc,Jc,Ac,Rc,Pc)}Gc.face=nu,Gc.faceIndex=ou,Nc.push(Gc)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),yt.prototype=Object.create(ft.prototype),yt.prototype.constructor=yt,xt.prototype=Object.create(gt.prototype),xt.prototype.constructor=xt,vt.prototype=Object.create(ft.prototype),vt.prototype.constructor=vt,bt.prototype=Object.create(gt.prototype),bt.prototype.constructor=bt,Et.prototype=Object.create(Ze.prototype),Et.prototype.constructor=Et,Et.prototype.isCamera=!0,Et.prototype.getWorldDirection=function(){var gc=new F;return function(yc){var xc=yc||new O;return this.getWorldQuaternion(gc),xc.set(0,0,-1).applyQuaternion(gc)}}(),Et.prototype.lookAt=function(){var gc=new G;return function(yc){gc.lookAt(this.position,yc,this.up),this.quaternion.setFromRotationMatrix(gc)}}(),Et.prototype.clone=function(){return new this.constructor().copy(this)},Et.prototype.copy=function(gc){return Ze.prototype.copy.call(this,gc),this.matrixWorldInverse.copy(gc.matrixWorldInverse),this.projectionMatrix.copy(gc.projectionMatrix),this},Tt.prototype=Object.assign(Object.create(Et.prototype),{constructor:Tt,isPerspectiveCamera:!0,copy:function(gc){return Et.prototype.copy.call(this,gc),this.fov=gc.fov,this.zoom=gc.zoom,this.near=gc.near,this.far=gc.far,this.focus=gc.focus,this.aspect=gc.aspect,this.view=null===gc.view?null:Object.assign({},gc.view),this.filmGauge=gc.filmGauge,this.filmOffset=gc.filmOffset,this},setFocalLength:function(gc){var hc=0.5*this.getFilmHeight()/gc;this.fov=2*xl.RAD2DEG*_Mathatan2(hc),this.updateProjectionMatrix()},getFocalLength:function(){var gc=_Mathtan(0.5*xl.DEG2RAD*this.fov);return 0.5*this.getFilmHeight()/gc},getEffectiveFOV:function(){return 2*xl.RAD2DEG*_Mathatan2(_Mathtan(0.5*xl.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*_Mathmin(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/_Mathmax(this.aspect,1)},setViewOffset:function(gc,hc,yc,xc,vc,_c){this.aspect=gc/hc,this.view={fullWidth:gc,fullHeight:hc,offsetX:yc,offsetY:xc,width:vc,height:_c},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var gc=this.near,hc=gc*_Mathtan(0.5*xl.DEG2RAD*this.fov)/this.zoom,yc=2*hc,xc=this.aspect*yc,vc=-0.5*xc,_c=this.view;if(null!==_c){var Ec=_c.fullWidth,Tc=_c.fullHeight;vc+=_c.offsetX*xc/Ec,hc-=_c.offsetY*yc/Tc,xc*=_c.width/Ec,yc*=_c.height/Tc}var Mc=this.filmOffset;0!==Mc&&(vc+=gc*Mc/this.getFilmWidth()),this.projectionMatrix.makePerspective(vc,vc+xc,hc,hc-yc,gc,this.far)},toJSON:function(gc){var hc=Ze.prototype.toJSON.call(this,gc);return hc.object.fov=this.fov,hc.object.zoom=this.zoom,hc.object.near=this.near,hc.object.far=this.far,hc.object.focus=this.focus,hc.object.aspect=this.aspect,null!==this.view&&(hc.object.view=Object.assign({},this.view)),hc.object.filmGauge=this.filmGauge,hc.object.filmOffset=this.filmOffset,hc}}),Mt.prototype=Object.assign(Object.create(Et.prototype),{constructor:Mt,isOrthographicCamera:!0,copy:function(gc){return Et.prototype.copy.call(this,gc),this.left=gc.left,this.right=gc.right,this.top=gc.top,this.bottom=gc.bottom,this.near=gc.near,this.far=gc.far,this.zoom=gc.zoom,this.view=null===gc.view?null:Object.assign({},gc.view),this},setViewOffset:function(gc,hc,yc,xc,vc,_c){this.view={fullWidth:gc,fullHeight:hc,offsetX:yc,offsetY:xc,width:vc,height:_c},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var gc=(this.right-this.left)/(2*this.zoom),hc=(this.top-this.bottom)/(2*this.zoom),yc=(this.right+this.left)/2,xc=(this.top+this.bottom)/2,vc=yc-gc,_c=yc+gc,Ec=xc+hc,Tc=xc-hc;if(null!==this.view){var Mc=this.zoom/(this.view.width/this.view.fullWidth),Sc=this.zoom/(this.view.height/this.view.fullHeight),Lc=(this.right-this.left)/this.view.width,wc=(this.top-this.bottom)/this.view.height;vc+=Lc*(this.view.offsetX/Mc),_c=vc+Lc*(this.view.width/Mc),Ec-=wc*(this.view.offsetY/Sc),Tc=Ec-wc*(this.view.height/Sc)}this.projectionMatrix.makeOrthographic(vc,_c,Ec,Tc,this.near,this.far)},toJSON:function(gc){var hc=Ze.prototype.toJSON.call(this,gc);return hc.object.zoom=this.zoom,hc.object.left=this.left,hc.object.right=this.right,hc.object.top=this.top,hc.object.bottom=this.bottom,hc.object.near=this.near,hc.object.far=this.far,null!==this.view&&(hc.object.view=Object.assign({},this.view)),hc}});var Xp=0;Qt.prototype.isFogExp2=!0,Qt.prototype.clone=function(){return new Qt(this.color.getHex(),this.density)},Qt.prototype.toJSON=function(){return{type:'FogExp2',color:this.color.getHex(),density:this.density}},$t.prototype.isFog=!0,$t.prototype.clone=function(){return new $t(this.color.getHex(),this.near,this.far)},$t.prototype.toJSON=function(){return{type:'Fog',color:this.color.getHex(),near:this.near,far:this.far}},er.prototype=Object.create(Ze.prototype),er.prototype.constructor=er,er.prototype.copy=function(gc,hc){return Ze.prototype.copy.call(this,gc,hc),null!==gc.background&&(this.background=gc.background.clone()),null!==gc.fog&&(this.fog=gc.fog.clone()),null!==gc.overrideMaterial&&(this.overrideMaterial=gc.overrideMaterial.clone()),this.autoUpdate=gc.autoUpdate,this.matrixAutoUpdate=gc.matrixAutoUpdate,this},er.prototype.toJSON=function(gc){var hc=Ze.prototype.toJSON.call(this,gc);return null!==this.background&&(hc.object.background=this.background.toJSON(gc)),null!==this.fog&&(hc.object.fog=this.fog.toJSON()),hc},tr.prototype=Object.assign(Object.create(Ze.prototype),{constructor:tr,isLensFlare:!0,copy:function(gc){Ze.prototype.copy.call(this,gc),this.positionScreen.copy(gc.positionScreen),this.customUpdateCallback=gc.customUpdateCallback;for(var hc=0,yc=gc.lensFlares.length;hc<yc;hc++)this.lensFlares.push(gc.lensFlares[hc]);return this},add:function(gc,hc,yc,xc,vc,_c){hc===void 0&&(hc=-1),yc===void 0&&(yc=0),_c===void 0&&(_c=1),vc===void 0&&(vc=new Ie(16777215)),xc===void 0&&(xc=sn),yc=_Mathmin(yc,_Mathmax(0,yc)),this.lensFlares.push({texture:gc,size:hc,distance:yc,x:0,y:0,z:0,scale:1,rotation:0,opacity:_c,color:vc,blending:xc})},updateLensFlares:function(){var hc=this.lensFlares.length,gc,yc,xc=2*-this.positionScreen.x,vc=2*-this.positionScreen.y;for(gc=0;gc<hc;gc++)yc=this.lensFlares[gc],yc.x=this.positionScreen.x+xc*yc.distance,yc.y=this.positionScreen.y+vc*yc.distance,yc.wantedRotation=0.25*(yc.x*_MathPI),yc.rotation+=0.25*(yc.wantedRotation-yc.rotation)}}),rr.prototype=Object.create(Be.prototype),rr.prototype.constructor=rr,rr.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.color.copy(gc.color),this.map=gc.map,this.rotation=gc.rotation,this},ar.prototype=Object.assign(Object.create(Ze.prototype),{constructor:ar,isSprite:!0,raycast:function(){var gc=new O;return function(yc,xc){gc.setFromMatrixPosition(this.matrixWorld);var vc=yc.ray.distanceSqToPoint(gc),_c=this.scale.x*this.scale.y/4;vc>_c||xc.push({distance:_Mathsqrt(vc),point:this.position,face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),or.prototype=Object.assign(Object.create(Ze.prototype),{constructor:or,copy:function(gc){Ze.prototype.copy.call(this,gc,!1);for(var hc=gc.levels,yc=0,xc=hc.length,vc;yc<xc;yc++)vc=hc[yc],this.addLevel(vc.object.clone(),vc.distance);return this},addLevel:function(gc,hc){hc===void 0&&(hc=0),hc=_Mathabs(hc);for(var yc=this.levels,xc=0;xc<yc.length&&!(hc<yc[xc].distance);xc++);yc.splice(xc,0,{distance:hc,object:gc}),this.add(gc)},getObjectForDistance:function(gc){for(var hc=this.levels,yc=1,xc=hc.length;yc<xc&&!(gc<hc[yc].distance);yc++);return hc[yc-1].object},raycast:function(){var gc=new O;return function(yc,xc){gc.setFromMatrixPosition(this.matrixWorld);var vc=yc.ray.origin.distanceTo(gc);this.getObjectForDistance(vc).raycast(yc,xc)}}(),update:function(){var gc=new O,hc=new O;return function(xc){var vc=this.levels;if(1<vc.length){gc.setFromMatrixPosition(xc.matrixWorld),hc.setFromMatrixPosition(this.matrixWorld);var _c=gc.distanceTo(hc);vc[0].object.visible=!0;for(var Ec=1,Tc=vc.length;Ec<Tc&&_c>=vc[Ec].distance;Ec++)vc[Ec-1].object.visible=!1,vc[Ec].object.visible=!0;for(;Ec<Tc;Ec++)vc[Ec].object.visible=!1}}}(),toJSON:function(gc){var hc=Ze.prototype.toJSON.call(this,gc);hc.object.levels=[];for(var yc=this.levels,xc=0,vc=yc.length,_c;xc<vc;xc++)_c=yc[xc],hc.object.levels.push({object:_c.object.uuid,distance:_c.distance});return hc}}),Object.assign(ir.prototype,{calculateInverses:function(){this.boneInverses=[];for(var gc=0,hc=this.bones.length,yc;gc<hc;gc++)yc=new G,this.bones[gc]&&yc.getInverse(this.bones[gc].matrixWorld),this.boneInverses.push(yc)},pose:function(){for(var hc=0,yc=this.bones.length,gc;hc<yc;hc++)gc=this.bones[hc],gc&&gc.matrixWorld.getInverse(this.boneInverses[hc]);for(var hc=0,yc=this.bones.length;hc<yc;hc++)gc=this.bones[hc],gc&&(gc.parent&&gc.parent.isBone?(gc.matrix.getInverse(gc.parent.matrixWorld),gc.matrix.multiply(gc.matrixWorld)):gc.matrix.copy(gc.matrixWorld),gc.matrix.decompose(gc.position,gc.quaternion,gc.scale))},update:function(){var gc=new G;return function(){for(var yc=0,xc=this.bones.length,vc;yc<xc;yc++)vc=this.bones[yc]?this.bones[yc].matrixWorld:this.identityMatrix,gc.multiplyMatrices(vc,this.boneInverses[yc]),gc.toArray(this.boneMatrices,16*yc);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new ir(this.bones,this.boneInverses,this.useVertexTexture)}}),nr.prototype=Object.assign(Object.create(Ze.prototype),{constructor:nr,isBone:!0}),sr.prototype=Object.assign(Object.create(ht.prototype),{constructor:sr,isSkinnedMesh:!0,bind:function(gc,hc){this.skeleton=gc,hc===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),hc=this.matrixWorld),this.bindMatrix.copy(hc),this.bindMatrixInverse.getInverse(hc)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var gc=0;gc<this.geometry.skinWeights.length;gc++){var hc=this.geometry.skinWeights[gc],yc=1/hc.lengthManhattan();yc==Infinity?hc.set(1,0,0,0):hc.multiplyScalar(yc)}else if(this.geometry&&this.geometry.isBufferGeometry)for(var xc=new I,vc=this.geometry.attributes.skinWeight,gc=0;gc<vc.count;gc++){xc.x=vc.getX(gc),xc.y=vc.getY(gc),xc.z=vc.getZ(gc),xc.w=vc.getW(gc);var yc=1/xc.lengthManhattan();yc==Infinity?xc.set(1,0,0,0):xc.multiplyScalar(yc),vc.setXYZW(gc,xc.x,xc.y,xc.z,xc.w)}},updateMatrixWorld:function(){ht.prototype.updateMatrixWorld.call(this,!0),'attached'===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):'detached'===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):void 0},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}}),lr.prototype=Object.create(Be.prototype),lr.prototype.constructor=lr,lr.prototype.isLineBasicMaterial=!0,lr.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.color.copy(gc.color),this.linewidth=gc.linewidth,this.linecap=gc.linecap,this.linejoin=gc.linejoin,this},dr.prototype=Object.assign(Object.create(Ze.prototype),{constructor:dr,isLine:!0,raycast:function(){var gc=new G,hc=new Xe,yc=new He;return function(vc,_c){var Ec=vc.linePrecision,Tc=Ec*Ec,Mc=this.geometry,Sc=this.matrixWorld;if(null===Mc.boundingSphere&&Mc.computeBoundingSphere(),yc.copy(Mc.boundingSphere),yc.applyMatrix4(Sc),!1!==vc.ray.intersectsSphere(yc)){gc.getInverse(Sc),hc.copy(vc.ray).applyMatrix4(gc);var Lc=new O,wc=new O,Ac=new O,Rc=new O,Pc=this&&this.isLineSegments?2:1;if(Mc.isBufferGeometry){var Cc=Mc.index,Ic=Mc.attributes,Uc=Ic.position.array;if(null!==Cc)for(var Dc=Cc.array,zc=0,Nc=Dc.length-1;zc<Nc;zc+=Pc){var Bc=Dc[zc],Fc=Dc[zc+1];Lc.fromArray(Uc,3*Bc),wc.fromArray(Uc,3*Fc);var Oc=hc.distanceSqToSegment(Lc,wc,Rc,Ac);if(!(Oc>Tc)){Rc.applyMatrix4(this.matrixWorld);var Gc=vc.ray.origin.distanceTo(Rc);Gc<vc.near||Gc>vc.far||_c.push({distance:Gc,point:Ac.clone().applyMatrix4(this.matrixWorld),index:zc,face:null,faceIndex:null,object:this})}}else for(var zc=0,Nc=Uc.length/3-1;zc<Nc;zc+=Pc){Lc.fromArray(Uc,3*zc),wc.fromArray(Uc,3*zc+3);var Oc=hc.distanceSqToSegment(Lc,wc,Rc,Ac);if(!(Oc>Tc)){Rc.applyMatrix4(this.matrixWorld);var Gc=vc.ray.origin.distanceTo(Rc);Gc<vc.near||Gc>vc.far||_c.push({distance:Gc,point:Ac.clone().applyMatrix4(this.matrixWorld),index:zc,face:null,faceIndex:null,object:this})}}}else if(Mc.isGeometry)for(var Hc=Mc.vertices,Vc=Hc.length,zc=0,Oc;zc<Vc-1;zc+=Pc)if(Oc=hc.distanceSqToSegment(Hc[zc],Hc[zc+1],Rc,Ac),!(Oc>Tc)){Rc.applyMatrix4(this.matrixWorld);var Gc=vc.ray.origin.distanceTo(Rc);Gc<vc.near||Gc>vc.far||_c.push({distance:Gc,point:Ac.clone().applyMatrix4(this.matrixWorld),index:zc,face:null,faceIndex:null,object:this})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),pr.prototype=Object.assign(Object.create(dr.prototype),{constructor:pr,isLineSegments:!0}),cr.prototype=Object.create(Be.prototype),cr.prototype.constructor=cr,cr.prototype.isPointsMaterial=!0,cr.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.color.copy(gc.color),this.map=gc.map,this.size=gc.size,this.sizeAttenuation=gc.sizeAttenuation,this},ur.prototype=Object.assign(Object.create(Ze.prototype),{constructor:ur,isPoints:!0,raycast:function(){var gc=new G,hc=new Xe,yc=new He;return function(vc,_c){function Ec(Oc,Gc){var Hc=hc.distanceSqToPoint(Oc);if(Hc<Ac){var Vc=hc.closestPointToPoint(Oc);Vc.applyMatrix4(Sc);var kc=vc.ray.origin.distanceTo(Vc);if(kc<vc.near||kc>vc.far)return;_c.push({distance:kc,distanceToRay:_Mathsqrt(Hc),point:Vc.clone(),index:Gc,face:null,object:Tc})}}var Tc=this,Mc=this.geometry,Sc=this.matrixWorld,Lc=vc.params.Points.threshold;if(null===Mc.boundingSphere&&Mc.computeBoundingSphere(),yc.copy(Mc.boundingSphere),yc.applyMatrix4(Sc),!1!==vc.ray.intersectsSphere(yc)){gc.getInverse(Sc),hc.copy(vc.ray).applyMatrix4(gc);var wc=Lc/((this.scale.x+this.scale.y+this.scale.z)/3),Ac=wc*wc,Rc=new O;if(Mc.isBufferGeometry){var Pc=Mc.index,Cc=Mc.attributes,Ic=Cc.position.array;if(null!==Pc)for(var Uc=Pc.array,Dc=0,zc=Uc.length,Nc;Dc<zc;Dc++)Nc=Uc[Dc],Rc.fromArray(Ic,3*Nc),Ec(Rc,Nc);else for(var Dc=0,Bc=Ic.length/3;Dc<Bc;Dc++)Rc.fromArray(Ic,3*Dc),Ec(Rc,Dc)}else for(var Fc=Mc.vertices,Dc=0,Bc=Fc.length;Dc<Bc;Dc++)Ec(Fc[Dc],Dc)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),mr.prototype=Object.assign(Object.create(Ze.prototype),{constructor:mr}),fr.prototype=Object.create(C.prototype),fr.prototype.constructor=fr,gr.prototype=Object.create(C.prototype),gr.prototype.constructor=gr,gr.prototype.isCompressedTexture=!0,hr.prototype=Object.create(C.prototype),hr.prototype.constructor=hr,yr.prototype=Object.create(C.prototype),yr.prototype.constructor=yr,yr.prototype.isDepthTexture=!0,xr.prototype=Object.create(gt.prototype),xr.prototype.constructor=xr,vr.prototype=Object.create(ft.prototype),vr.prototype.constructor=vr,_r.prototype=Object.create(gt.prototype),_r.prototype.constructor=_r,br.prototype=Object.create(ft.prototype),br.prototype.constructor=br,Er.prototype=Object.create(gt.prototype),Er.prototype.constructor=Er,Tr.prototype=Object.create(ft.prototype),Tr.prototype.constructor=Tr,Mr.prototype=Object.create(Er.prototype),Mr.prototype.constructor=Mr,Sr.prototype=Object.create(ft.prototype),Sr.prototype.constructor=Sr,Lr.prototype=Object.create(Er.prototype),Lr.prototype.constructor=Lr,wr.prototype=Object.create(ft.prototype),wr.prototype.constructor=wr,Ar.prototype=Object.create(Er.prototype),Ar.prototype.constructor=Ar,Rr.prototype=Object.create(ft.prototype),Rr.prototype.constructor=Rr,Pr.prototype=Object.create(Er.prototype),Pr.prototype.constructor=Pr,Cr.prototype=Object.create(ft.prototype),Cr.prototype.constructor=Cr,Ir.prototype=Object.create(gt.prototype),Ir.prototype.constructor=Ir,Ur.prototype=Object.create(ft.prototype),Ur.prototype.constructor=Ur,Dr.prototype=Object.create(gt.prototype),Dr.prototype.constructor=Dr,zr.prototype=Object.create(ft.prototype),zr.prototype.constructor=zr,Nr.prototype=Object.create(gt.prototype),Nr.prototype.constructor=Nr;var Yp={area:function(gc){for(var hc=gc.length,yc=0,xc=hc-1,vc=0;vc<hc;xc=vc++)yc+=gc[xc].x*gc[vc].y-gc[vc].x*gc[xc].y;return 0.5*yc},triangulate:function(){function gc(hc,yc,xc,vc,_c,Ec){var Tc,Mc,Sc,Lc,wc,Ac,Rc,Pc,Cc;if(Mc=hc[Ec[yc]].x,Sc=hc[Ec[yc]].y,Lc=hc[Ec[xc]].x,wc=hc[Ec[xc]].y,Ac=hc[Ec[vc]].x,Rc=hc[Ec[vc]].y,0>=(Lc-Mc)*(Rc-Sc)-(wc-Sc)*(Ac-Mc))return!1;var Ic,Uc,Dc,zc,Nc,Bc,Fc,Oc,Gc,Hc,Vc,kc,Wc,jc,Xc;for(Ic=Ac-Lc,Uc=Rc-wc,Dc=Mc-Ac,zc=Sc-Rc,Nc=Lc-Mc,Bc=wc-Sc,Tc=0;Tc<_c;Tc++)if(Pc=hc[Ec[Tc]].x,Cc=hc[Ec[Tc]].y,(Pc!==Mc||Cc!==Sc)&&(Pc!==Lc||Cc!==wc)&&(Pc!==Ac||Cc!==Rc)&&(Fc=Pc-Mc,Oc=Cc-Sc,Gc=Pc-Lc,Hc=Cc-wc,Vc=Pc-Ac,kc=Cc-Rc,Xc=Ic*Hc-Uc*Gc,Wc=Nc*Oc-Bc*Fc,jc=Dc*kc-zc*Vc,Xc>=-_NumberEPSILON&&jc>=-_NumberEPSILON&&Wc>=-_NumberEPSILON))return!1;return!0}return function(yc,xc){var vc=yc.length;if(3>vc)return null;var _c=[],Ec=[],Tc=[],Mc,Sc,Lc;if(0<Yp.area(yc))for(Sc=0;Sc<vc;Sc++)Ec[Sc]=Sc;else for(Sc=0;Sc<vc;Sc++)Ec[Sc]=vc-1-Sc;var wc=vc,Ac=2*wc;for(Sc=wc-1;2<wc;){if(0>=Ac--)return xc?Tc:_c;if(Mc=Sc,wc<=Mc&&(Mc=0),Sc=Mc+1,wc<=Sc&&(Sc=0),Lc=Sc+1,wc<=Lc&&(Lc=0),gc(yc,Mc,Sc,Lc,wc,Ec)){var Rc,Pc,Cc,Ic,Uc;for(Rc=Ec[Mc],Pc=Ec[Sc],Cc=Ec[Lc],_c.push([yc[Rc],yc[Pc],yc[Cc]]),Tc.push([Ec[Mc],Ec[Sc],Ec[Lc]]),(Ic=Sc,Uc=Sc+1);Uc<wc;Ic++,Uc++)Ec[Ic]=Ec[Uc];wc--,Ac=2*wc}}return xc?Tc:_c}}(),triangulateShape:function(gc,hc){function yc(zc){var Nc=zc.length;2<Nc&&zc[Nc-1].equals(zc[0])&&zc.pop()}function xc(zc,Nc,Bc){return zc.x===Nc.x?zc.y<Nc.y?zc.y<=Bc.y&&Bc.y<=Nc.y:Nc.y<=Bc.y&&Bc.y<=zc.y:zc.x<Nc.x?zc.x<=Bc.x&&Bc.x<=Nc.x:Nc.x<=Bc.x&&Bc.x<=zc.x}function vc(zc,Nc,Bc,Fc,Oc){var Gc=Nc.x-zc.x,Hc=Nc.y-zc.y,Vc=Fc.x-Bc.x,kc=Fc.y-Bc.y,Wc=zc.x-Bc.x,jc=zc.y-Bc.y,Xc=Hc*Vc-Gc*kc,Yc=Hc*Wc-Gc*jc;if(_Mathabs(Xc)>_NumberEPSILON){var qc;if(0<Xc){if(0>Yc||Yc>Xc)return[];if(qc=kc*Wc-Vc*jc,0>qc||qc>Xc)return[]}else{if(0<Yc||Yc<Xc)return[];if(qc=kc*Wc-Vc*jc,0<qc||qc<Xc)return[]}if(0===qc)return Oc&&(0==Yc||Yc==Xc)?[]:[zc];if(qc===Xc)return Oc&&(0==Yc||Yc==Xc)?[]:[Nc];if(0==Yc)return[Bc];if(Yc==Xc)return[Fc];var Zc=qc/Xc;return[{x:zc.x+Zc*Gc,y:zc.y+Zc*Hc}]}if(0!=Yc||kc*Wc!=Vc*jc)return[];var Kc=0==Gc&&0==Hc,Jc=0==Vc&&0==kc;if(Kc&&Jc)return zc.x!==Bc.x||zc.y!==Bc.y?[]:[zc];if(Kc)return xc(Bc,Fc,zc)?[zc]:[];if(Jc)return xc(zc,Nc,Bc)?[Bc]:[];var Qc,$c,eu,tu,ru,au,ou,iu;return 0==Gc?(zc.y<Nc.y?(Qc=zc,eu=zc.y,$c=Nc,tu=Nc.y):(Qc=Nc,eu=Nc.y,$c=zc,tu=zc.y),Bc.y<Fc.y?(ru=Bc,ou=Bc.y,au=Fc,iu=Fc.y):(ru=Fc,ou=Fc.y,au=Bc,iu=Bc.y)):(zc.x<Nc.x?(Qc=zc,eu=zc.x,$c=Nc,tu=Nc.x):(Qc=Nc,eu=Nc.x,$c=zc,tu=zc.x),Bc.x<Fc.x?(ru=Bc,ou=Bc.x,au=Fc,iu=Fc.x):(ru=Fc,ou=Fc.x,au=Bc,iu=Bc.x)),eu<=ou?tu<ou?[]:tu===ou?Oc?[]:[ru]:tu<=iu?[ru,$c]:[ru,au]:eu>iu?[]:eu===iu?Oc?[]:[Qc]:tu<=iu?[Qc,$c]:[Qc,au]}function _c(zc,Nc,Bc,Fc){var Oc=Nc.x-zc.x,Gc=Nc.y-zc.y,Hc=Bc.x-zc.x,Vc=Bc.y-zc.y,kc=Fc.x-zc.x,Wc=Fc.y-zc.y,jc=Oc*Vc-Gc*Hc,Xc=Oc*Wc-Gc*kc;if(_Mathabs(jc)>_NumberEPSILON){var Yc=kc*Vc-Wc*Hc;return 0<jc?0<=Xc&&0<=Yc:0<=Xc||0<=Yc}return 0<Xc}yc(gc),hc.forEach(yc);for(var Rc={},Pc=gc.concat(),Cc=0,Ic=hc.length,Tc,Mc,Sc,Lc,wc,Ac;Cc<Ic;Cc++)Array.prototype.push.apply(Pc,hc[Cc]);for(Tc=0,Mc=Pc.length;Tc<Mc;Tc++)wc=Pc[Tc].x+':'+Pc[Tc].y,void 0!==Rc[wc]&&void 0,Rc[wc]=Tc;var Uc=function(zc,Nc){function Bc(iu,nu){var lu=Gc.length-1,du=iu-1;0>du&&(du=lu);var pu=iu+1;pu>lu&&(pu=0);var uu=_c(Gc[iu],Gc[du],Gc[pu],Hc[nu]);if(!uu)return!1;var mu=Hc.length-1,fu=nu-1;0>fu&&(fu=mu);var gu=nu+1;return gu>mu&&(gu=0),uu=_c(Hc[nu],Hc[fu],Hc[gu],Gc[iu]),!!uu}function Fc(iu,nu){var lu,du,pu;for(lu=0;lu<Gc.length;lu++)if(du=lu+1,du%=Gc.length,pu=vc(iu,nu,Gc[lu],Gc[du],!0),0<pu.length)return!0;return!1}function Oc(iu,nu){var lu,du,pu,uu,mu;for(lu=0;lu<Vc.length;lu++)for(du=Nc[Vc[lu]],pu=0;pu<du.length;pu++)if(uu=pu+1,uu%=du.length,mu=vc(iu,nu,du[pu],du[uu],!0),0<mu.length)return!0;return!1}for(var Gc=zc.concat(),Vc=[],Zc=[],eu=0,tu=Nc.length,Hc,kc,Wc,jc,Xc,Yc,qc,Kc,Jc,Qc,$c;eu<tu;eu++)Vc.push(eu);for(var ru=0,au=2*Vc.length;0<Vc.length&&(au--,!(0>au));)for(Wc=ru;Wc<Gc.length;Wc++){jc=Gc[Wc],kc=-1;for(var eu=0;eu<Vc.length;eu++)if(Yc=Vc[eu],qc=jc.x+':'+jc.y+':'+Yc,void 0===Zc[qc]){Hc=Nc[Yc];for(var ou=0;ou<Hc.length;ou++)if(Xc=Hc[ou],Bc(Wc,ou)&&!Fc(jc,Xc)&&!Oc(jc,Xc)){kc=ou,Vc.splice(eu,1),Kc=Gc.slice(0,Wc+1),Jc=Gc.slice(Wc),Qc=Hc.slice(kc),$c=Hc.slice(0,kc+1),Gc=Kc.concat(Qc).concat($c).concat(Jc),ru=Wc;break}if(0<=kc)break;Zc[qc]=!0}if(0<=kc)break}return Gc}(gc,hc),Dc=Yp.triangulate(Uc,!1);for(Tc=0,Mc=Dc.length;Tc<Mc;Tc++)for(Lc=Dc[Tc],Sc=0;3>Sc;Sc++)wc=Lc[Sc].x+':'+Lc[Sc].y,Ac=Rc[wc],void 0!==Ac&&(Lc[Sc]=Ac);return Dc.concat()},isClockWise:function(gc){return 0>Yp.area(gc)}};Br.prototype=Object.create(ft.prototype),Br.prototype.constructor=Br,Br.prototype.addShapeList=function(gc,hc){for(var yc=gc.length,xc=0,vc;xc<yc;xc++)vc=gc[xc],this.addShape(vc,hc)},Br.prototype.addShape=function(gc,hc){function yc(yu,xu,vu){return xu||void 0,xu.clone().multiplyScalar(vu).add(yu)}function xc(yu,xu,vu){var Eu=1,_u,bu,Tu=yu.x-xu.x,Mu=yu.y-xu.y,Su=vu.x-yu.x,Lu=vu.y-yu.y,wu=Tu*Tu+Mu*Mu;if(_Mathabs(Tu*Lu-Mu*Su)>_NumberEPSILON){var Ru=_Mathsqrt(wu),Pu=_Mathsqrt(Su*Su+Lu*Lu),Cu=xu.x-Mu/Ru,Iu=xu.y+Tu/Ru,Uu=vu.x-Lu/Pu,Du=vu.y+Su/Pu,zu=((Uu-Cu)*Lu-(Du-Iu)*Su)/(Tu*Lu-Mu*Su);_u=Cu+Tu*zu-yu.x,bu=Iu+Mu*zu-yu.y;var Nu=_u*_u+bu*bu;if(2>=Nu)return new R(_u,bu);Eu=_Mathsqrt(Nu/2)}else{var Bu=!1;Tu>_NumberEPSILON?Su>_NumberEPSILON&&(Bu=!0):Tu<-_NumberEPSILON?Su<-_NumberEPSILON&&(Bu=!0):_Mathsign(Mu)===_Mathsign(Lu)&&(Bu=!0),Bu?(_u=-Mu,bu=Tu,Eu=_Mathsqrt(wu)):(_u=Tu,bu=Mu,Eu=_Mathsqrt(wu/2))}return new R(_u/Eu,bu/Eu)}function Ec(yu,xu){var vu,_u;for(lu=yu.length;0<=--lu;){vu=lu,_u=lu-1,0>_u&&(_u=yu.length-1);var bu=0,Eu=Ic+2*Rc;for(bu=0;bu<Eu;bu++){var Tu=au*bu,Mu=au*(bu+1),Su=xu+vu+Tu,Lu=xu+_u+Tu,wu=xu+_u+Mu,Au=xu+vu+Mu;Sc(Su,Lu,wu,Au,yu,bu,Eu,vu,_u)}}}function Tc(yu,xu,vu){Wc.vertices.push(new O(yu,xu,vu))}function Mc(yu,xu,vu){yu+=jc,xu+=jc,vu+=jc,Wc.faces.push(new Qe(yu,xu,vu,null,null,0));var _u=Nc.generateTopUV(Wc,yu,xu,vu);Wc.faceVertexUvs[0].push(_u)}function Sc(yu,xu,vu,_u){yu+=jc,xu+=jc,vu+=jc,_u+=jc,Wc.faces.push(new Qe(yu,xu,_u,null,null,1)),Wc.faces.push(new Qe(xu,vu,_u,null,null,1));var Lu=Nc.generateSideWallUV(Wc,yu,xu,vu,_u);Wc.faceVertexUvs[0].push([Lu[0],Lu[1],Lu[3]]),Wc.faceVertexUvs[0].push([Lu[1],Lu[2],Lu[3]])}var Lc=hc.amount===void 0?100:hc.amount,wc=hc.bevelThickness===void 0?6:hc.bevelThickness,Ac=hc.bevelSize===void 0?wc-2:hc.bevelSize,Rc=hc.bevelSegments===void 0?3:hc.bevelSegments,Pc=!(hc.bevelEnabled!==void 0)||hc.bevelEnabled,Cc=hc.curveSegments===void 0?12:hc.curveSegments,Ic=hc.steps===void 0?1:hc.steps,Uc=hc.extrudePath,Dc,zc=!1,Nc=hc.UVGenerator===void 0?Br.WorldUVGenerator:hc.UVGenerator,Bc,Fc,Oc,Gc;Uc&&(Dc=Uc.getSpacedPoints(Ic),zc=!0,Pc=!1,Bc=hc.frames===void 0?Uc.computeFrenetFrames(Ic,!1):hc.frames,Fc=new O,Oc=new O,Gc=new O),Pc||(Rc=0,wc=0,Ac=0);var Hc,Vc,kc,Wc=this,jc=this.vertices.length,Xc=gc.extractPoints(Cc),Yc=Xc.shape,qc=Xc.holes,Zc=!Yp.isClockWise(Yc);if(Zc){for(Yc=Yc.reverse(),Vc=0,kc=qc.length;Vc<kc;Vc++)Hc=qc[Vc],Yp.isClockWise(Hc)&&(qc[Vc]=Hc.reverse());Zc=!1}var Kc=Yp.triangulateShape(Yc,qc),Jc=Yc;for(Vc=0,kc=qc.length;Vc<kc;Vc++)Hc=qc[Vc],Yc=Yc.concat(Hc);for(var au=Yc.length,iu=Kc.length,nu=[],lu=0,du=Jc.length,pu=du-1,uu=lu+1,Qc,$c,eu,tu,ru,ou;lu<du;lu++,pu++,uu++)pu===du&&(pu=0),uu===du&&(uu=0),nu[lu]=xc(Jc[lu],Jc[pu],Jc[uu]);var mu=[],gu=nu.concat(),fu;for(Vc=0,kc=qc.length;Vc<kc;Vc++){for(Hc=qc[Vc],fu=[],(lu=0,du=Hc.length,pu=du-1,uu=lu+1);lu<du;lu++,pu++,uu++)pu===du&&(pu=0),uu===du&&(uu=0),fu[lu]=xc(Hc[lu],Hc[pu],Hc[uu]);mu.push(fu),gu=gu.concat(fu)}for(Qc=0;Qc<Rc;Qc++){for(eu=Qc/Rc,tu=wc*_Mathcos(eu*_MathPI/2),$c=Ac*_Mathsin(eu*_MathPI/2),(lu=0,du=Jc.length);lu<du;lu++)ru=yc(Jc[lu],nu[lu],$c),Tc(ru.x,ru.y,-tu);for(Vc=0,kc=qc.length;Vc<kc;Vc++)for(Hc=qc[Vc],fu=mu[Vc],(lu=0,du=Hc.length);lu<du;lu++)ru=yc(Hc[lu],fu[lu],$c),Tc(ru.x,ru.y,-tu)}for($c=Ac,lu=0;lu<au;lu++)ru=Pc?yc(Yc[lu],gu[lu],$c):Yc[lu],zc?(Oc.copy(Bc.normals[0]).multiplyScalar(ru.x),Fc.copy(Bc.binormals[0]).multiplyScalar(ru.y),Gc.copy(Dc[0]).add(Oc).add(Fc),Tc(Gc.x,Gc.y,Gc.z)):Tc(ru.x,ru.y,0);var hu;for(hu=1;hu<=Ic;hu++)for(lu=0;lu<au;lu++)ru=Pc?yc(Yc[lu],gu[lu],$c):Yc[lu],zc?(Oc.copy(Bc.normals[hu]).multiplyScalar(ru.x),Fc.copy(Bc.binormals[hu]).multiplyScalar(ru.y),Gc.copy(Dc[hu]).add(Oc).add(Fc),Tc(Gc.x,Gc.y,Gc.z)):Tc(ru.x,ru.y,Lc/Ic*hu);for(Qc=Rc-1;0<=Qc;Qc--){for(eu=Qc/Rc,tu=wc*_Mathcos(eu*_MathPI/2),$c=Ac*_Mathsin(eu*_MathPI/2),(lu=0,du=Jc.length);lu<du;lu++)ru=yc(Jc[lu],nu[lu],$c),Tc(ru.x,ru.y,Lc+tu);for(Vc=0,kc=qc.length;Vc<kc;Vc++)for(Hc=qc[Vc],fu=mu[Vc],(lu=0,du=Hc.length);lu<du;lu++)ru=yc(Hc[lu],fu[lu],$c),zc?Tc(ru.x,ru.y+Dc[Ic-1].y,Dc[Ic-1].x+tu):Tc(ru.x,ru.y,Lc+tu)}(function(){if(Pc){var yu=0,xu=au*yu;for(lu=0;lu<iu;lu++)ou=Kc[lu],Mc(ou[2]+xu,ou[1]+xu,ou[0]+xu);for(yu=Ic+2*Rc,xu=au*yu,lu=0;lu<iu;lu++)ou=Kc[lu],Mc(ou[0]+xu,ou[1]+xu,ou[2]+xu)}else{for(lu=0;lu<iu;lu++)ou=Kc[lu],Mc(ou[2],ou[1],ou[0]);for(lu=0;lu<iu;lu++)ou=Kc[lu],Mc(ou[0]+au*Ic,ou[1]+au*Ic,ou[2]+au*Ic)}})(),function(){var yu=0;for(Ec(Jc,yu),yu+=Jc.length,(Vc=0,kc=qc.length);Vc<kc;Vc++)Hc=qc[Vc],Ec(Hc,yu),yu+=Hc.length}()},Br.WorldUVGenerator={generateTopUV:function(gc,hc,yc,xc){var vc=gc.vertices,_c=vc[hc],Ec=vc[yc],Tc=vc[xc];return[new R(_c.x,_c.y),new R(Ec.x,Ec.y),new R(Tc.x,Tc.y)]},generateSideWallUV:function(gc,hc,yc,xc,vc){var _c=gc.vertices,Ec=_c[hc],Tc=_c[yc],Mc=_c[xc],Sc=_c[vc];return 0.01>_Mathabs(Ec.y-Tc.y)?[new R(Ec.x,1-Ec.z),new R(Tc.x,1-Tc.z),new R(Mc.x,1-Mc.z),new R(Sc.x,1-Sc.z)]:[new R(Ec.y,1-Ec.z),new R(Tc.y,1-Tc.z),new R(Mc.y,1-Mc.z),new R(Sc.y,1-Sc.z)]}},Fr.prototype=Object.create(Br.prototype),Fr.prototype.constructor=Fr,Or.prototype=Object.create(ft.prototype),Or.prototype.constructor=Or,Gr.prototype=Object.create(gt.prototype),Gr.prototype.constructor=Gr,Hr.prototype=Object.create(ft.prototype),Hr.prototype.constructor=Hr,Vr.prototype=Object.create(gt.prototype),Vr.prototype.constructor=Vr,kr.prototype=Object.create(ft.prototype),kr.prototype.constructor=kr,Wr.prototype=Object.create(gt.prototype),Wr.prototype.constructor=Wr,jr.prototype=Object.create(ft.prototype),jr.prototype.constructor=jr,Xr.prototype=Object.create(gt.prototype),Xr.prototype.constructor=Xr,Yr.prototype=Object.create(gt.prototype),Yr.prototype.constructor=Yr,qr.prototype=Object.create(ft.prototype),qr.prototype.constructor=qr,Zr.prototype=Object.create(gt.prototype),Zr.prototype.constructor=Zr,Kr.prototype=Object.create(qr.prototype),Kr.prototype.constructor=Kr,Jr.prototype=Object.create(Zr.prototype),Jr.prototype.constructor=Jr,Qr.prototype=Object.create(ft.prototype),Qr.prototype.constructor=Qr,$r.prototype=Object.create(gt.prototype),$r.prototype.constructor=$r;var qp=Object.freeze({WireframeGeometry:xr,ParametricGeometry:vr,ParametricBufferGeometry:_r,TetrahedronGeometry:Tr,TetrahedronBufferGeometry:Mr,OctahedronGeometry:Sr,OctahedronBufferGeometry:Lr,IcosahedronGeometry:wr,IcosahedronBufferGeometry:Ar,DodecahedronGeometry:Rr,DodecahedronBufferGeometry:Pr,PolyhedronGeometry:br,PolyhedronBufferGeometry:Er,TubeGeometry:Cr,TubeBufferGeometry:Ir,TorusKnotGeometry:Ur,TorusKnotBufferGeometry:Dr,TorusGeometry:zr,TorusBufferGeometry:Nr,TextGeometry:Fr,SphereGeometry:Or,SphereBufferGeometry:Gr,RingGeometry:Hr,RingBufferGeometry:Vr,PlaneGeometry:vt,PlaneBufferGeometry:bt,LatheGeometry:kr,LatheBufferGeometry:Wr,ShapeGeometry:jr,ShapeBufferGeometry:Xr,ExtrudeGeometry:Br,EdgesGeometry:Yr,ConeGeometry:Kr,ConeBufferGeometry:Jr,CylinderGeometry:qr,CylinderBufferGeometry:Zr,CircleGeometry:Qr,CircleBufferGeometry:$r,BoxGeometry:yt,BoxBufferGeometry:xt});ea.prototype=Object.create(Fe.prototype),ea.prototype.constructor=ea,ea.prototype.isShadowMaterial=!0,ta.prototype=Object.create(Fe.prototype),ta.prototype.constructor=ta,ta.prototype.isRawShaderMaterial=!0,ra.prototype={constructor:ra,isMultiMaterial:!0,toJSON:function(gc){for(var hc={metadata:{version:4.2,type:'material',generator:'MaterialExporter'},uuid:this.uuid,type:this.type,materials:[]},yc=this.materials,xc=0,vc=yc.length,_c;xc<vc;xc++)_c=yc[xc].toJSON(gc),delete _c.metadata,hc.materials.push(_c);return hc.visible=this.visible,hc},clone:function(){for(var gc=new this.constructor,hc=0;hc<this.materials.length;hc++)gc.materials.push(this.materials[hc].clone());return gc.visible=this.visible,gc}},aa.prototype=Object.create(Be.prototype),aa.prototype.constructor=aa,aa.prototype.isMeshStandardMaterial=!0,aa.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.defines={STANDARD:''},this.color.copy(gc.color),this.roughness=gc.roughness,this.metalness=gc.metalness,this.map=gc.map,this.lightMap=gc.lightMap,this.lightMapIntensity=gc.lightMapIntensity,this.aoMap=gc.aoMap,this.aoMapIntensity=gc.aoMapIntensity,this.emissive.copy(gc.emissive),this.emissiveMap=gc.emissiveMap,this.emissiveIntensity=gc.emissiveIntensity,this.bumpMap=gc.bumpMap,this.bumpScale=gc.bumpScale,this.normalMap=gc.normalMap,this.normalScale.copy(gc.normalScale),this.displacementMap=gc.displacementMap,this.displacementScale=gc.displacementScale,this.displacementBias=gc.displacementBias,this.roughnessMap=gc.roughnessMap,this.metalnessMap=gc.metalnessMap,this.alphaMap=gc.alphaMap,this.envMap=gc.envMap,this.envMapIntensity=gc.envMapIntensity,this.refractionRatio=gc.refractionRatio,this.wireframe=gc.wireframe,this.wireframeLinewidth=gc.wireframeLinewidth,this.wireframeLinecap=gc.wireframeLinecap,this.wireframeLinejoin=gc.wireframeLinejoin,this.skinning=gc.skinning,this.morphTargets=gc.morphTargets,this.morphNormals=gc.morphNormals,this},oa.prototype=Object.create(aa.prototype),oa.prototype.constructor=oa,oa.prototype.isMeshPhysicalMaterial=!0,oa.prototype.copy=function(gc){return aa.prototype.copy.call(this,gc),this.defines={PHYSICAL:''},this.reflectivity=gc.reflectivity,this.clearCoat=gc.clearCoat,this.clearCoatRoughness=gc.clearCoatRoughness,this},ia.prototype=Object.create(Be.prototype),ia.prototype.constructor=ia,ia.prototype.isMeshPhongMaterial=!0,ia.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.color.copy(gc.color),this.specular.copy(gc.specular),this.shininess=gc.shininess,this.map=gc.map,this.lightMap=gc.lightMap,this.lightMapIntensity=gc.lightMapIntensity,this.aoMap=gc.aoMap,this.aoMapIntensity=gc.aoMapIntensity,this.emissive.copy(gc.emissive),this.emissiveMap=gc.emissiveMap,this.emissiveIntensity=gc.emissiveIntensity,this.bumpMap=gc.bumpMap,this.bumpScale=gc.bumpScale,this.normalMap=gc.normalMap,this.normalScale.copy(gc.normalScale),this.displacementMap=gc.displacementMap,this.displacementScale=gc.displacementScale,this.displacementBias=gc.displacementBias,this.specularMap=gc.specularMap,this.alphaMap=gc.alphaMap,this.envMap=gc.envMap,this.combine=gc.combine,this.reflectivity=gc.reflectivity,this.refractionRatio=gc.refractionRatio,this.wireframe=gc.wireframe,this.wireframeLinewidth=gc.wireframeLinewidth,this.wireframeLinecap=gc.wireframeLinecap,this.wireframeLinejoin=gc.wireframeLinejoin,this.skinning=gc.skinning,this.morphTargets=gc.morphTargets,this.morphNormals=gc.morphNormals,this},na.prototype=Object.create(ia.prototype),na.prototype.constructor=na,na.prototype.isMeshToonMaterial=!0,na.prototype.copy=function(gc){return ia.prototype.copy.call(this,gc),this.gradientMap=gc.gradientMap,this},sa.prototype=Object.create(Be.prototype),sa.prototype.constructor=sa,sa.prototype.isMeshNormalMaterial=!0,sa.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.bumpMap=gc.bumpMap,this.bumpScale=gc.bumpScale,this.normalMap=gc.normalMap,this.normalScale.copy(gc.normalScale),this.displacementMap=gc.displacementMap,this.displacementScale=gc.displacementScale,this.displacementBias=gc.displacementBias,this.wireframe=gc.wireframe,this.wireframeLinewidth=gc.wireframeLinewidth,this.skinning=gc.skinning,this.morphTargets=gc.morphTargets,this.morphNormals=gc.morphNormals,this},la.prototype=Object.create(Be.prototype),la.prototype.constructor=la,la.prototype.isMeshLambertMaterial=!0,la.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.color.copy(gc.color),this.map=gc.map,this.lightMap=gc.lightMap,this.lightMapIntensity=gc.lightMapIntensity,this.aoMap=gc.aoMap,this.aoMapIntensity=gc.aoMapIntensity,this.emissive.copy(gc.emissive),this.emissiveMap=gc.emissiveMap,this.emissiveIntensity=gc.emissiveIntensity,this.specularMap=gc.specularMap,this.alphaMap=gc.alphaMap,this.envMap=gc.envMap,this.combine=gc.combine,this.reflectivity=gc.reflectivity,this.refractionRatio=gc.refractionRatio,this.wireframe=gc.wireframe,this.wireframeLinewidth=gc.wireframeLinewidth,this.wireframeLinecap=gc.wireframeLinecap,this.wireframeLinejoin=gc.wireframeLinejoin,this.skinning=gc.skinning,this.morphTargets=gc.morphTargets,this.morphNormals=gc.morphNormals,this},da.prototype=Object.create(Be.prototype),da.prototype.constructor=da,da.prototype.isLineDashedMaterial=!0,da.prototype.copy=function(gc){return Be.prototype.copy.call(this,gc),this.color.copy(gc.color),this.linewidth=gc.linewidth,this.scale=gc.scale,this.dashSize=gc.dashSize,this.gapSize=gc.gapSize,this};var Zp=Object.freeze({ShadowMaterial:ea,SpriteMaterial:rr,RawShaderMaterial:ta,ShaderMaterial:Fe,PointsMaterial:cr,MultiMaterial:ra,MeshPhysicalMaterial:oa,MeshStandardMaterial:aa,MeshPhongMaterial:ia,MeshToonMaterial:na,MeshNormalMaterial:sa,MeshLambertMaterial:la,MeshDepthMaterial:Oe,MeshBasicMaterial:$e,LineDashedMaterial:da,LineBasicMaterial:lr,Material:Be}),Kp={enabled:!1,files:{},add:function(gc,hc){!1===this.enabled||(this.files[gc]=hc)},get:function(gc){return!1===this.enabled?void 0:this.files[gc]},remove:function(gc){delete this.files[gc]},clear:function(){this.files={}}},Jp=new pa;Object.assign(ca.prototype,{load:function(gc,hc,yc,xc){void 0===gc&&(gc=''),void 0!==this.path&&(gc=this.path+gc);var vc=this,_c=Kp.get(gc);if(void 0!==_c)return vc.manager.itemStart(gc),setTimeout(function(){hc&&hc(_c),vc.manager.itemEnd(gc)},0),_c;var Ec=/^data:(.*?)(;base64)?,(.*)$/,Tc=gc.match(Ec);if(Tc){var Mc=Tc[1],Sc=!!Tc[2],Lc=Tc[3];Lc=window.decodeURIComponent(Lc),Sc&&(Lc=window.atob(Lc));try{var Ac=(this.responseType||'').toLowerCase(),wc;switch(Ac){case'arraybuffer':case'blob':wc=new ArrayBuffer(Lc.length);for(var Rc=new Uint8Array(wc),Pc=0;Pc<Lc.length;Pc++)Rc[Pc]=Lc.charCodeAt(Pc);'blob'===Ac&&(wc=new Blob([wc],{type:Mc}));break;case'document':var Cc=new DOMParser;wc=Cc.parseFromString(Lc,Mc);break;case'json':wc=JSON.parse(Lc);break;default:wc=Lc;}window.setTimeout(function(){hc&&hc(wc),vc.manager.itemEnd(gc)},0)}catch(Uc){window.setTimeout(function(){xc&&xc(Uc),vc.manager.itemError(gc)},0)}}else{var Ic=new XMLHttpRequest;Ic.open('GET',gc,!0),Ic.addEventListener('load',function(Uc){var Dc=Uc.target.response;Kp.add(gc,Dc),200===this.status?(hc&&hc(Dc),vc.manager.itemEnd(gc)):0===this.status?(hc&&hc(Dc),vc.manager.itemEnd(gc)):(xc&&xc(Uc),vc.manager.itemError(gc))},!1),void 0!==yc&&Ic.addEventListener('progress',function(Uc){yc(Uc)},!1),Ic.addEventListener('error',function(Uc){xc&&xc(Uc),vc.manager.itemError(gc)},!1),void 0!==this.responseType&&(Ic.responseType=this.responseType),void 0!==this.withCredentials&&(Ic.withCredentials=this.withCredentials),Ic.overrideMimeType&&Ic.overrideMimeType(void 0===this.mimeType?'text/plain':this.mimeType),Ic.send(null)}return vc.manager.itemStart(gc),Ic},setPath:function(gc){return this.path=gc,this},setResponseType:function(gc){return this.responseType=gc,this},setWithCredentials:function(gc){return this.withCredentials=gc,this},setMimeType:function(gc){return this.mimeType=gc,this}}),Object.assign(ua.prototype,{load:function(gc,hc,yc,xc){function vc(Ac){Mc.load(gc[Ac],function(Rc){var Pc=_c._parser(Rc,!0);Ec[Ac]={width:Pc.width,height:Pc.height,format:Pc.format,mipmaps:Pc.mipmaps},Sc+=1,6==Sc&&(1===Pc.mipmapCount&&(Tc.minFilter=ns),Tc.format=Pc.format,Tc.needsUpdate=!0,hc&&hc(Tc))},yc,xc)}var _c=this,Ec=[],Tc=new gr;Tc.image=Ec;var Mc=new ca(this.manager);if(Mc.setPath(this.path),Mc.setResponseType('arraybuffer'),Array.isArray(gc))for(var Sc=0,Lc=0,wc=gc.length;Lc<wc;++Lc)vc(Lc);else Mc.load(gc,function(Ac){var Rc=_c._parser(Ac,!0);if(Rc.isCubemap)for(var Pc=Rc.mipmaps.length/Rc.mipmapCount,Cc=0;Cc<Pc;Cc++){Ec[Cc]={mipmaps:[]};for(var Ic=0;Ic<Rc.mipmapCount;Ic++)Ec[Cc].mipmaps.push(Rc.mipmaps[Cc*Rc.mipmapCount+Ic]),Ec[Cc].format=Rc.format,Ec[Cc].width=Rc.width,Ec[Cc].height=Rc.height}else Tc.image.width=Rc.width,Tc.image.height=Rc.height,Tc.mipmaps=Rc.mipmaps;1===Rc.mipmapCount&&(Tc.minFilter=ns),Tc.format=Rc.format,Tc.needsUpdate=!0,hc&&hc(Tc)},yc,xc);return Tc},setPath:function(gc){return this.path=gc,this}}),Object.assign(ma.prototype,{load:function(gc,hc,yc,xc){var vc=this,_c=new Ue,Ec=new ca(this.manager);return Ec.setResponseType('arraybuffer'),Ec.load(gc,function(Tc){var Mc=vc._parser(Tc);Mc&&(void 0===Mc.image?void 0!==Mc.data&&(_c.image.width=Mc.width,_c.image.height=Mc.height,_c.image.data=Mc.data):_c.image=Mc.image,_c.wrapS=void 0===Mc.wrapS?es:Mc.wrapS,_c.wrapT=void 0===Mc.wrapT?es:Mc.wrapT,_c.magFilter=void 0===Mc.magFilter?ns:Mc.magFilter,_c.minFilter=void 0===Mc.minFilter?ls:Mc.minFilter,_c.anisotropy=void 0===Mc.anisotropy?1:Mc.anisotropy,void 0!==Mc.format&&(_c.format=Mc.format),void 0!==Mc.type&&(_c.type=Mc.type),void 0!==Mc.mipmaps&&(_c.mipmaps=Mc.mipmaps),1===Mc.mipmapCount&&(_c.minFilter=ns),_c.needsUpdate=!0,hc&&hc(_c,Mc))},yc,xc),_c}}),Object.assign(fa.prototype,{load:function(gc,hc,yc,xc){void 0===gc&&(gc=''),void 0!==this.path&&(gc=this.path+gc);var vc=this,_c=Kp.get(gc);if(void 0!==_c)return vc.manager.itemStart(gc),setTimeout(function(){hc&&hc(_c),vc.manager.itemEnd(gc)},0),_c;var Ec=document.createElementNS('http://www.w3.org/1999/xhtml','img');return Ec.addEventListener('load',function(){Kp.add(gc,this),hc&&hc(this),vc.manager.itemEnd(gc)},!1),Ec.addEventListener('error',function(Tc){xc&&xc(Tc),vc.manager.itemError(gc)},!1),void 0!==this.crossOrigin&&(Ec.crossOrigin=this.crossOrigin),vc.manager.itemStart(gc),Ec.src=gc,Ec},setCrossOrigin:function(gc){return this.crossOrigin=gc,this},setPath:function(gc){return this.path=gc,this}}),Object.assign(ga.prototype,{load:function(gc,hc,yc,xc){function vc(Sc){Ec.load(gc[Sc],function(Lc){_c.images[Sc]=Lc,Tc++,6==Tc&&(_c.needsUpdate=!0,hc&&hc(_c))},void 0,xc)}var _c=new H,Ec=new fa(this.manager);Ec.setCrossOrigin(this.crossOrigin),Ec.setPath(this.path);for(var Tc=0,Mc=0;Mc<gc.length;++Mc)vc(Mc);return _c},setCrossOrigin:function(gc){return this.crossOrigin=gc,this},setPath:function(gc){return this.path=gc,this}}),Object.assign(ha.prototype,{load:function(gc,hc,yc,xc){var vc=new C,_c=new fa(this.manager);return _c.setCrossOrigin(this.crossOrigin),_c.setPath(this.path),_c.load(gc,function(Ec){var Tc=0<gc.search(/\.(jpg|jpeg)$/)||0===gc.search(/^data\:image\/jpeg/);vc.format=Tc?Ms:Ss,vc.image=Ec,vc.needsUpdate=!0,void 0!==hc&&hc(vc)},yc,xc),vc},setCrossOrigin:function(gc){return this.crossOrigin=gc,this},setPath:function(gc){return this.path=gc,this}}),ya.prototype=Object.assign(Object.create(Ze.prototype),{constructor:ya,isLight:!0,copy:function(gc){return Ze.prototype.copy.call(this,gc),this.color.copy(gc.color),this.intensity=gc.intensity,this},toJSON:function(gc){var hc=Ze.prototype.toJSON.call(this,gc);return hc.object.color=this.color.getHex(),hc.object.intensity=this.intensity,void 0!==this.groundColor&&(hc.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(hc.object.distance=this.distance),void 0!==this.angle&&(hc.object.angle=this.angle),void 0!==this.decay&&(hc.object.decay=this.decay),void 0!==this.penumbra&&(hc.object.penumbra=this.penumbra),void 0!==this.shadow&&(hc.object.shadow=this.shadow.toJSON()),hc}}),xa.prototype=Object.assign(Object.create(ya.prototype),{constructor:xa,isHemisphereLight:!0,copy:function(gc){return ya.prototype.copy.call(this,gc),this.groundColor.copy(gc.groundColor),this}}),Object.assign(va.prototype,{copy:function(gc){return this.camera=gc.camera.clone(),this.bias=gc.bias,this.radius=gc.radius,this.mapSize.copy(gc.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var gc={};return 0!==this.bias&&(gc.bias=this.bias),1!==this.radius&&(gc.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(gc.mapSize=this.mapSize.toArray()),gc.camera=this.camera.toJSON(!1).object,delete gc.camera.matrix,gc}}),_a.prototype=Object.assign(Object.create(va.prototype),{constructor:_a,isSpotLightShadow:!0,update:function(gc){var hc=2*xl.RAD2DEG*gc.angle,yc=this.mapSize.width/this.mapSize.height,xc=gc.distance||500,vc=this.camera;(hc!==vc.fov||yc!==vc.aspect||xc!==vc.far)&&(vc.fov=hc,vc.aspect=yc,vc.far=xc,vc.updateProjectionMatrix())}}),ba.prototype=Object.assign(Object.create(ya.prototype),{constructor:ba,isSpotLight:!0,copy:function(gc){return ya.prototype.copy.call(this,gc),this.distance=gc.distance,this.angle=gc.angle,this.penumbra=gc.penumbra,this.decay=gc.decay,this.target=gc.target.clone(),this.shadow=gc.shadow.clone(),this}}),Ea.prototype=Object.assign(Object.create(ya.prototype),{constructor:Ea,isPointLight:!0,copy:function(gc){return ya.prototype.copy.call(this,gc),this.distance=gc.distance,this.decay=gc.decay,this.shadow=gc.shadow.clone(),this}}),Ta.prototype=Object.assign(Object.create(va.prototype),{constructor:Ta}),Ma.prototype=Object.assign(Object.create(ya.prototype),{constructor:Ma,isDirectionalLight:!0,copy:function(gc){return ya.prototype.copy.call(this,gc),this.target=gc.target.clone(),this.shadow=gc.shadow.clone(),this}}),Sa.prototype=Object.assign(Object.create(ya.prototype),{constructor:Sa,isAmbientLight:!0});var Qp={arraySlice:function(gc,hc,yc){return Qp.isTypedArray(gc)?new gc.constructor(gc.subarray(hc,yc)):gc.slice(hc,yc)},convertArray:function(gc,hc,yc){return gc&&(yc||gc.constructor!==hc)?'number'==typeof hc.BYTES_PER_ELEMENT?new hc(gc):Array.prototype.slice.call(gc):gc},isTypedArray:function(gc){return ArrayBuffer.isView(gc)&&!(gc instanceof DataView)},getKeyframeOrder:function(gc){for(var yc=gc.length,xc=Array(yc),vc=0;vc!==yc;++vc)xc[vc]=vc;return xc.sort(function(_c,Ec){return gc[_c]-gc[Ec]}),xc},sortedArray:function(gc,hc,yc){for(var xc=gc.length,vc=new gc.constructor(xc),_c=0,Ec=0,Tc;Ec!==xc;++_c){Tc=yc[_c]*hc;for(var Mc=0;Mc!==hc;++Mc)vc[Ec++]=gc[Tc+Mc]}return vc},flattenJSON:function(gc,hc,yc,xc){for(var vc=1,_c=gc[0];_c!==void 0&&_c[xc]===void 0;)_c=gc[vc++];if(void 0!==_c){var Ec=_c[xc];if(void 0!==Ec)if(Array.isArray(Ec))do Ec=_c[xc],void 0!==Ec&&(hc.push(_c.time),yc.push.apply(yc,Ec)),_c=gc[vc++];while(void 0!==_c);else if(void 0!==Ec.toArray)do Ec=_c[xc],void 0!==Ec&&(hc.push(_c.time),Ec.toArray(yc,yc.length)),_c=gc[vc++];while(void 0!==_c);else do Ec=_c[xc],void 0!==Ec&&(hc.push(_c.time),yc.push(Ec)),_c=gc[vc++];while(void 0!==_c)}}};La.prototype={constructor:La,evaluate:function(gc){var hc=this.parameterPositions,yc=this._cachedIndex,xc=hc[yc],vc=hc[yc-1];validate_interval:{seek:{var _c;linear_scan:{forward_scan:if(!(gc<xc)){for(var Ec=yc+2;;){if(void 0===xc){if(gc<vc)break forward_scan;return yc=hc.length,this._cachedIndex=yc,this.afterEnd_(yc-1,gc,vc)}if(yc===Ec)break;if(vc=xc,xc=hc[++yc],gc<xc)break seek}_c=hc.length;break linear_scan}if(!(gc>=vc)){var Tc=hc[1];gc<Tc&&(yc=2,vc=Tc);for(var Ec=yc-2;;){if(void 0===vc)return this._cachedIndex=0,this.beforeStart_(0,gc,xc);if(yc===Ec)break;if(xc=vc,vc=hc[--yc-1],gc>=vc)break seek}_c=yc,yc=0;break linear_scan}break validate_interval}for(;yc<_c;){var Mc=yc+_c>>>1;gc<hc[Mc]?_c=Mc:yc=Mc+1}if(xc=hc[yc],vc=hc[yc-1],void 0===vc)return this._cachedIndex=0,this.beforeStart_(0,gc,xc);if(void 0===xc)return yc=hc.length,this._cachedIndex=yc,this.afterEnd_(yc-1,vc,gc)}this._cachedIndex=yc,this.intervalChanged_(yc,vc,xc)}return this.interpolate_(yc,vc,gc,xc)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(gc){for(var hc=this.resultBuffer,yc=this.sampleValues,xc=this.valueSize,_c=0;_c!==xc;++_c)hc[_c]=yc[gc*xc+_c];return hc},interpolate_:function(){throw new Error('call to abstract method')},intervalChanged_:function(){}},Object.assign(La.prototype,{beforeStart_:La.prototype.copySampleValue_,afterEnd_:La.prototype.copySampleValue_}),wa.prototype=Object.assign(Object.create(La.prototype),{constructor:wa,DefaultSettings_:{endingStart:Xs,endingEnd:Xs},intervalChanged_:function(gc,hc,yc){var xc=this.parameterPositions,vc=gc-2,_c=gc+1,Ec=xc[vc],Tc=xc[_c];if(Ec===void 0)switch(this.getSettings_().endingStart){case Ys:vc=gc,Ec=2*hc-yc;break;case qs:vc=xc.length-2,Ec=hc+xc[vc]-xc[vc+1];break;default:vc=gc,Ec=yc;}if(void 0===Tc)switch(this.getSettings_().endingEnd){case Ys:_c=gc,Tc=2*yc-hc;break;case qs:_c=1,Tc=yc+xc[1]-xc[0];break;default:_c=gc-1,Tc=hc;}var Mc=0.5*(yc-hc),Sc=this.valueSize;this._weightPrev=Mc/(hc-Ec),this._weightNext=Mc/(Tc-yc),this._offsetPrev=vc*Sc,this._offsetNext=_c*Sc},interpolate_:function(gc,hc,yc,xc){for(var vc=this.resultBuffer,_c=this.sampleValues,Ec=this.valueSize,Tc=gc*Ec,Sc=this._offsetPrev,Lc=this._offsetNext,wc=this._weightPrev,Ac=this._weightNext,Rc=(yc-hc)/(xc-hc),Pc=Rc*Rc,Cc=Pc*Rc,Nc=0;Nc!==Ec;++Nc)vc[Nc]=(-wc*Cc+2*wc*Pc-wc*Rc)*_c[Sc+Nc]+((1+wc)*Cc+(-1.5-2*wc)*Pc+(-0.5+wc)*Rc+1)*_c[Tc-Ec+Nc]+((-1-Ac)*Cc+(1.5+Ac)*Pc+0.5*Rc)*_c[Tc+Nc]+(Ac*Cc-Ac*Pc)*_c[Lc+Nc];return vc}}),Aa.prototype=Object.assign(Object.create(La.prototype),{constructor:Aa,interpolate_:function(gc,hc,yc,xc){for(var vc=this.resultBuffer,_c=this.sampleValues,Ec=this.valueSize,Tc=gc*Ec,Sc=(yc-hc)/(xc-hc),wc=0;wc!==Ec;++wc)vc[wc]=_c[Tc-Ec+wc]*(1-Sc)+_c[Tc+wc]*Sc;return vc}}),Ra.prototype=Object.assign(Object.create(La.prototype),{constructor:Ra,interpolate_:function(gc){return this.copySampleValue_(gc-1)}});var $p;$p={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ws,InterpolantFactoryMethodDiscrete:function(gc){return new Ra(this.times,this.values,this.getValueSize(),gc)},InterpolantFactoryMethodLinear:function(gc){return new Aa(this.times,this.values,this.getValueSize(),gc)},InterpolantFactoryMethodSmooth:function(gc){return new wa(this.times,this.values,this.getValueSize(),gc)},setInterpolation:function(gc){var hc;if(gc===ks?hc=this.InterpolantFactoryMethodDiscrete:gc===Ws?hc=this.InterpolantFactoryMethodLinear:gc===js?hc=this.InterpolantFactoryMethodSmooth:void 0,void 0===hc){var yc='unsupported interpolation for '+this.ValueTypeName+' keyframe track named '+this.name;if(void 0===this.createInterpolant)if(gc!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(yc);return}this.createInterpolant=hc},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ks;case this.InterpolantFactoryMethodLinear:return Ws;case this.InterpolantFactoryMethodSmooth:return js;}},getValueSize:function(){return this.values.length/this.times.length},shift:function(gc){if(0!==gc)for(var hc=this.times,yc=0,xc=hc.length;yc!==xc;++yc)hc[yc]+=gc;return this},scale:function(gc){if(1!==gc)for(var hc=this.times,yc=0,xc=hc.length;yc!==xc;++yc)hc[yc]*=gc;return this},trim:function(gc,hc){for(var yc=this.times,xc=yc.length,vc=0,_c=xc-1;vc!==xc&&yc[vc]<gc;)++vc;for(;-1!=_c&&yc[_c]>hc;)--_c;if(++_c,0!=vc||_c!==xc){vc>=_c&&(_c=_Mathmax(_c,1),vc=_c-1);var Ec=this.getValueSize();this.times=Qp.arraySlice(yc,vc,_c),this.values=Qp.arraySlice(this.values,vc*Ec,_c*Ec)}return this},validate:function(){var gc=!0,hc=this.getValueSize();0!=hc-_Mathfloor(hc)&&(void 0,gc=!1);var yc=this.times,xc=this.values,vc=yc.length;0===vc&&(void 0,gc=!1);for(var _c=null,Ec=0,Tc;Ec!==vc;Ec++){if(Tc=yc[Ec],'number'==typeof Tc&&isNaN(Tc)){gc=!1;break}if(null!=_c&&_c>Tc){gc=!1;break}_c=Tc}if(xc!==void 0&&Qp.isTypedArray(xc))for(var Ec=0,Mc=xc.length,Sc;Ec!==Mc;++Ec)if(Sc=xc[Ec],isNaN(Sc)){gc=!1;break}return gc},optimize:function(){for(var gc=this.times,hc=this.values,yc=this.getValueSize(),xc=this.getInterpolation()===js,vc=1,_c=gc.length-1,Ec=1;Ec<_c;++Ec){var Tc=!1,Mc=gc[Ec],Sc=gc[Ec+1];if(Mc!==Sc&&(1!==Ec||Mc!==Mc[0]))if(!xc){for(var Lc=Ec*yc,Rc=0,Pc;Rc!==yc;++Rc)if(Pc=hc[Lc+Rc],Pc!==hc[Lc-yc+Rc]||Pc!==hc[Lc+yc+Rc]){Tc=!0;break}}else Tc=!0;if(Tc){if(Ec!==vc){gc[vc]=gc[Ec];for(var Cc=Ec*yc,Ic=vc*yc,Rc=0;Rc!==yc;++Rc)hc[Ic+Rc]=hc[Cc+Rc]}++vc}}if(0<_c){gc[vc]=gc[_c];for(var Cc=_c*yc,Ic=vc*yc,Rc=0;Rc!==yc;++Rc)hc[Ic+Rc]=hc[Cc+Rc];++vc}return vc!==gc.length&&(this.times=Qp.arraySlice(gc,0,vc),this.values=Qp.arraySlice(hc,0,vc*yc)),this}},Ca.prototype=Object.assign(Object.create($p),{constructor:Ca,ValueTypeName:'vector'}),Ia.prototype=Object.assign(Object.create(La.prototype),{constructor:Ia,interpolate_:function(gc,hc,yc,xc){for(var vc=this.resultBuffer,_c=this.sampleValues,Ec=this.valueSize,Tc=gc*Ec,Sc=Tc+Ec;Tc!==Sc;Tc+=4)F.slerpFlat(vc,0,_c,Tc-Ec,_c,Tc,(yc-hc)/(xc-hc));return vc}}),Ua.prototype=Object.assign(Object.create($p),{constructor:Ua,ValueTypeName:'quaternion',DefaultInterpolation:Ws,InterpolantFactoryMethodLinear:function(gc){return new Ia(this.times,this.values,this.getValueSize(),gc)},InterpolantFactoryMethodSmooth:void 0}),Da.prototype=Object.assign(Object.create($p),{constructor:Da,ValueTypeName:'number'}),za.prototype=Object.assign(Object.create($p),{constructor:za,ValueTypeName:'string',ValueBufferType:Array,DefaultInterpolation:ks,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Na.prototype=Object.assign(Object.create($p),{constructor:Na,ValueTypeName:'bool',ValueBufferType:Array,DefaultInterpolation:ks,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ba.prototype=Object.assign(Object.create($p),{constructor:Ba,ValueTypeName:'color'}),Fa.prototype=$p,$p.constructor=Fa,Object.assign(Fa,{parse:function(gc){if(gc.type===void 0)throw new Error('track type undefined, can not parse');var hc=Fa._getTrackTypeForValueTypeName(gc.type);if(gc.times===void 0){var yc=[],xc=[];Qp.flattenJSON(gc.keys,yc,xc,'value'),gc.times=yc,gc.values=xc}return void 0===hc.parse?new hc(gc.name,gc.times,gc.values,gc.interpolation):hc.parse(gc)},toJSON:function(gc){var hc=gc.constructor,yc;if(void 0!==hc.toJSON)yc=hc.toJSON(gc);else{yc={name:gc.name,times:Qp.convertArray(gc.times,Array),values:Qp.convertArray(gc.values,Array)};var xc=gc.getInterpolation();xc!==gc.DefaultInterpolation&&(yc.interpolation=xc)}return yc.type=gc.ValueTypeName,yc},_getTrackTypeForValueTypeName:function(gc){switch(gc.toLowerCase()){case'scalar':case'double':case'float':case'number':case'integer':return Da;case'vector':case'vector2':case'vector3':case'vector4':return Ca;case'color':return Ba;case'quaternion':return Ua;case'bool':case'boolean':return Na;case'string':return za;}throw new Error('Unsupported typeName: '+gc)}}),Oa.prototype={constructor:Oa,resetDuration:function(){for(var gc=this.tracks,hc=0,yc=0,xc=gc.length,vc;yc!==xc;++yc)vc=this.tracks[yc],hc=_Mathmax(hc,vc.times[vc.times.length-1]);this.duration=hc},trim:function(){for(var gc=0;gc<this.tracks.length;gc++)this.tracks[gc].trim(0,this.duration);return this},optimize:function(){for(var gc=0;gc<this.tracks.length;gc++)this.tracks[gc].optimize();return this}},Object.assign(Oa,{parse:function(gc){for(var hc=[],yc=gc.tracks,xc=1/(gc.fps||1),vc=0,_c=yc.length;vc!==_c;++vc)hc.push(Fa.parse(yc[vc]).scale(xc));return new Oa(gc.name,gc.duration,hc)},toJSON:function(gc){for(var hc=[],yc=gc.tracks,xc={name:gc.name,duration:gc.duration,tracks:hc},vc=0,_c=yc.length;vc!==_c;++vc)hc.push(Fa.toJSON(yc[vc]));return xc},CreateFromMorphTargetSequence:function(gc,hc,yc,xc){for(var vc=hc.length,_c=[],Ec=0;Ec<vc;Ec++){var Tc=[],Mc=[];Tc.push((Ec+vc-1)%vc,Ec,(Ec+1)%vc),Mc.push(0,1,0);var Sc=Qp.getKeyframeOrder(Tc);Tc=Qp.sortedArray(Tc,1,Sc),Mc=Qp.sortedArray(Mc,1,Sc),xc||0!==Tc[0]||(Tc.push(vc),Mc.push(Mc[0])),_c.push(new Da('.morphTargetInfluences['+hc[Ec].name+']',Tc,Mc).scale(1/yc))}return new Oa(gc,-1,_c)},findByName:function(gc,hc){var yc=gc;if(!Array.isArray(gc)){var xc=gc;yc=xc.geometry&&xc.geometry.animations||xc.animations}for(var vc=0;vc<yc.length;vc++)if(yc[vc].name===hc)return yc[vc];return null},CreateClipsFromMorphTargetSequences:function(gc,hc,yc){for(var xc={},vc=/^([\w-]*?)([\d]+)$/,_c=0,Ec=gc.length;_c<Ec;_c++){var Tc=gc[_c],Mc=Tc.name.match(vc);if(Mc&&1<Mc.length){var Sc=Mc[1],Lc=xc[Sc];Lc||(xc[Sc]=Lc=[]),Lc.push(Tc)}}var wc=[];for(var Sc in xc)wc.push(Oa.CreateFromMorphTargetSequence(Sc,xc[Sc],hc,yc));return wc},parseAnimation:function(gc,hc){if(!gc)return null;for(var yc=function(zc,Nc,Bc,Fc,Oc){if(0!==Bc.length){var Gc=[],Hc=[];Qp.flattenJSON(Bc,Gc,Hc,Fc),0!==Gc.length&&Oc.push(new zc(Nc,Gc,Hc))}},xc=[],vc=gc.name||'default',_c=gc.length||-1,Ec=gc.fps||30,Tc=gc.hierarchy||[],Mc=0,Sc;Mc<Tc.length;Mc++)if(Sc=Tc[Mc].keys,Sc&&0!==Sc.length)if(Sc[0].morphTargets){for(var Lc={},wc=0;wc<Sc.length;wc++)if(Sc[wc].morphTargets)for(var Ac=0;Ac<Sc[wc].morphTargets.length;Ac++)Lc[Sc[wc].morphTargets[Ac]]=-1;for(var Rc in Lc){for(var Pc=[],Cc=[],Ac=0,Ic;Ac!==Sc[wc].morphTargets.length;++Ac)Ic=Sc[wc],Pc.push(Ic.time),Cc.push(Ic.morphTarget===Rc?1:0);xc.push(new Da('.morphTargetInfluence['+Rc+']',Pc,Cc))}_c=Lc.length*(Ec||1)}else{var Uc='.bones['+hc[Mc].name+']';yc(Ca,Uc+'.position',Sc,'pos',xc),yc(Ua,Uc+'.quaternion',Sc,'rot',xc),yc(Ca,Uc+'.scale',Sc,'scl',xc)}if(0===xc.length)return null;var Dc=new Oa(vc,_c,xc);return Dc}}),Object.assign(Ga.prototype,{load:function(gc,hc,yc,xc){var vc=this,_c=new ca(vc.manager);_c.load(gc,function(Ec){hc(vc.parse(JSON.parse(Ec)))},yc,xc)},setTextures:function(gc){this.textures=gc},parse:function(gc){function hc(Tc){return void 0===yc[Tc]&&void 0,yc[Tc]}var yc=this.textures,xc=new Zp[gc.type];if(void 0!==gc.uuid&&(xc.uuid=gc.uuid),void 0!==gc.name&&(xc.name=gc.name),void 0!==gc.color&&xc.color.setHex(gc.color),void 0!==gc.roughness&&(xc.roughness=gc.roughness),void 0!==gc.metalness&&(xc.metalness=gc.metalness),void 0!==gc.emissive&&xc.emissive.setHex(gc.emissive),void 0!==gc.specular&&xc.specular.setHex(gc.specular),void 0!==gc.shininess&&(xc.shininess=gc.shininess),void 0!==gc.clearCoat&&(xc.clearCoat=gc.clearCoat),void 0!==gc.clearCoatRoughness&&(xc.clearCoatRoughness=gc.clearCoatRoughness),void 0!==gc.uniforms&&(xc.uniforms=gc.uniforms),void 0!==gc.vertexShader&&(xc.vertexShader=gc.vertexShader),void 0!==gc.fragmentShader&&(xc.fragmentShader=gc.fragmentShader),void 0!==gc.vertexColors&&(xc.vertexColors=gc.vertexColors),void 0!==gc.fog&&(xc.fog=gc.fog),void 0!==gc.shading&&(xc.shading=gc.shading),void 0!==gc.blending&&(xc.blending=gc.blending),void 0!==gc.side&&(xc.side=gc.side),void 0!==gc.opacity&&(xc.opacity=gc.opacity),void 0!==gc.transparent&&(xc.transparent=gc.transparent),void 0!==gc.alphaTest&&(xc.alphaTest=gc.alphaTest),void 0!==gc.depthTest&&(xc.depthTest=gc.depthTest),void 0!==gc.depthWrite&&(xc.depthWrite=gc.depthWrite),void 0!==gc.colorWrite&&(xc.colorWrite=gc.colorWrite),void 0!==gc.wireframe&&(xc.wireframe=gc.wireframe),void 0!==gc.wireframeLinewidth&&(xc.wireframeLinewidth=gc.wireframeLinewidth),void 0!==gc.wireframeLinecap&&(xc.wireframeLinecap=gc.wireframeLinecap),void 0!==gc.wireframeLinejoin&&(xc.wireframeLinejoin=gc.wireframeLinejoin),void 0!==gc.skinning&&(xc.skinning=gc.skinning),void 0!==gc.morphTargets&&(xc.morphTargets=gc.morphTargets),void 0!==gc.size&&(xc.size=gc.size),void 0!==gc.sizeAttenuation&&(xc.sizeAttenuation=gc.sizeAttenuation),void 0!==gc.map&&(xc.map=hc(gc.map)),void 0!==gc.alphaMap&&(xc.alphaMap=hc(gc.alphaMap),xc.transparent=!0),void 0!==gc.bumpMap&&(xc.bumpMap=hc(gc.bumpMap)),void 0!==gc.bumpScale&&(xc.bumpScale=gc.bumpScale),void 0!==gc.normalMap&&(xc.normalMap=hc(gc.normalMap)),void 0!==gc.normalScale){var vc=gc.normalScale;!1===Array.isArray(vc)&&(vc=[vc,vc]),xc.normalScale=new R().fromArray(vc)}if(void 0!==gc.displacementMap&&(xc.displacementMap=hc(gc.displacementMap)),void 0!==gc.displacementScale&&(xc.displacementScale=gc.displacementScale),void 0!==gc.displacementBias&&(xc.displacementBias=gc.displacementBias),void 0!==gc.roughnessMap&&(xc.roughnessMap=hc(gc.roughnessMap)),void 0!==gc.metalnessMap&&(xc.metalnessMap=hc(gc.metalnessMap)),void 0!==gc.emissiveMap&&(xc.emissiveMap=hc(gc.emissiveMap)),void 0!==gc.emissiveIntensity&&(xc.emissiveIntensity=gc.emissiveIntensity),void 0!==gc.specularMap&&(xc.specularMap=hc(gc.specularMap)),void 0!==gc.envMap&&(xc.envMap=hc(gc.envMap)),void 0!==gc.reflectivity&&(xc.reflectivity=gc.reflectivity),void 0!==gc.lightMap&&(xc.lightMap=hc(gc.lightMap)),void 0!==gc.lightMapIntensity&&(xc.lightMapIntensity=gc.lightMapIntensity),void 0!==gc.aoMap&&(xc.aoMap=hc(gc.aoMap)),void 0!==gc.aoMapIntensity&&(xc.aoMapIntensity=gc.aoMapIntensity),void 0!==gc.gradientMap&&(xc.gradientMap=hc(gc.gradientMap)),void 0!==gc.materials)for(var _c=0,Ec=gc.materials.length;_c<Ec;_c++)xc.materials.push(this.parse(gc.materials[_c]));return xc}}),Object.assign(Ha.prototype,{load:function(gc,hc,yc,xc){var vc=this,_c=new ca(vc.manager);_c.load(gc,function(Ec){hc(vc.parse(JSON.parse(Ec)))},yc,xc)},parse:function(gc){var hc=new gt,yc=gc.data.index,xc={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(yc!==void 0){var vc=new xc[yc.type](yc.array);hc.setIndex(new et(vc,1))}var _c=gc.data.attributes;for(var Ec in _c){var Tc=_c[Ec],vc=new xc[Tc.type](Tc.array);hc.addAttribute(Ec,new et(vc,Tc.itemSize,Tc.normalized))}var Mc=gc.data.groups||gc.data.drawcalls||gc.data.offsets;if(Mc!==void 0)for(var Sc=0,Lc=Mc.length,wc;Sc!==Lc;++Sc)wc=Mc[Sc],hc.addGroup(wc.start,wc.count,wc.materialIndex);var Ac=gc.data.boundingSphere;if(Ac!==void 0){var Rc=new O;Ac.center!==void 0&&Rc.fromArray(Ac.center),hc.boundingSphere=new He(Rc,Ac.radius)}return hc}}),Va.prototype={constructor:Va,crossOrigin:void 0,extractUrlBase:function(gc){var hc=gc.split('/');return 1===hc.length?'./':(hc.pop(),hc.join('/')+'/')},initMaterials:function(gc,hc,yc){for(var xc=[],vc=0;vc<gc.length;++vc)xc[vc]=this.createMaterial(gc[vc],hc,yc);return xc},createMaterial:function(){var gc={NoBlending:nn,NormalBlending:sn,AdditiveBlending:ln,SubtractiveBlending:dn,MultiplyBlending:pn,CustomBlending:cn},hc,yc,xc;return function(_c,Ec,Tc){function Mc(Rc,Pc,Cc,Ic,Uc){var Dc=Ec+Rc,zc=Va.Handlers.get(Dc),Nc;null===zc?(yc.setCrossOrigin(Tc),Nc=yc.load(Dc)):Nc=zc.load(Dc),void 0!==Pc&&(Nc.repeat.fromArray(Pc),1!==Pc[0]&&(Nc.wrapS=$n),1!==Pc[1]&&(Nc.wrapT=$n)),void 0!==Cc&&Nc.offset.fromArray(Cc),void 0!==Ic&&('repeat'===Ic[0]&&(Nc.wrapS=$n),'mirror'===Ic[0]&&(Nc.wrapS=ts),'repeat'===Ic[1]&&(Nc.wrapT=$n),'mirror'===Ic[1]&&(Nc.wrapT=ts)),void 0!==Uc&&(Nc.anisotropy=Uc);var Bc=xl.generateUUID();return Sc[Bc]=Nc,Bc}void 0==hc&&(hc=new Ie),void 0==yc&&(yc=new ha),void 0==xc&&(xc=new Ga);var Sc={},Lc={uuid:xl.generateUUID(),type:'MeshLambertMaterial'};for(var wc in _c){var Ac=_c[wc];switch(wc){case'DbgColor':case'DbgIndex':case'opticalDensity':case'illumination':break;case'DbgName':Lc.name=Ac;break;case'blending':Lc.blending=gc[Ac];break;case'colorAmbient':case'mapAmbient':break;case'colorDiffuse':Lc.color=hc.fromArray(Ac).getHex();break;case'colorSpecular':Lc.specular=hc.fromArray(Ac).getHex();break;case'colorEmissive':Lc.emissive=hc.fromArray(Ac).getHex();break;case'specularCoef':Lc.shininess=Ac;break;case'shading':'basic'===Ac.toLowerCase()&&(Lc.type='MeshBasicMaterial'),'phong'===Ac.toLowerCase()&&(Lc.type='MeshPhongMaterial'),'standard'===Ac.toLowerCase()&&(Lc.type='MeshStandardMaterial');break;case'mapDiffuse':Lc.map=Mc(Ac,_c.mapDiffuseRepeat,_c.mapDiffuseOffset,_c.mapDiffuseWrap,_c.mapDiffuseAnisotropy);break;case'mapDiffuseRepeat':case'mapDiffuseOffset':case'mapDiffuseWrap':case'mapDiffuseAnisotropy':break;case'mapEmissive':Lc.emissiveMap=Mc(Ac,_c.mapEmissiveRepeat,_c.mapEmissiveOffset,_c.mapEmissiveWrap,_c.mapEmissiveAnisotropy);break;case'mapEmissiveRepeat':case'mapEmissiveOffset':case'mapEmissiveWrap':case'mapEmissiveAnisotropy':break;case'mapLight':Lc.lightMap=Mc(Ac,_c.mapLightRepeat,_c.mapLightOffset,_c.mapLightWrap,_c.mapLightAnisotropy);break;case'mapLightRepeat':case'mapLightOffset':case'mapLightWrap':case'mapLightAnisotropy':break;case'mapAO':Lc.aoMap=Mc(Ac,_c.mapAORepeat,_c.mapAOOffset,_c.mapAOWrap,_c.mapAOAnisotropy);break;case'mapAORepeat':case'mapAOOffset':case'mapAOWrap':case'mapAOAnisotropy':break;case'mapBump':Lc.bumpMap=Mc(Ac,_c.mapBumpRepeat,_c.mapBumpOffset,_c.mapBumpWrap,_c.mapBumpAnisotropy);break;case'mapBumpScale':Lc.bumpScale=Ac;break;case'mapBumpRepeat':case'mapBumpOffset':case'mapBumpWrap':case'mapBumpAnisotropy':break;case'mapNormal':Lc.normalMap=Mc(Ac,_c.mapNormalRepeat,_c.mapNormalOffset,_c.mapNormalWrap,_c.mapNormalAnisotropy);break;case'mapNormalFactor':Lc.normalScale=[Ac,Ac];break;case'mapNormalRepeat':case'mapNormalOffset':case'mapNormalWrap':case'mapNormalAnisotropy':break;case'mapSpecular':Lc.specularMap=Mc(Ac,_c.mapSpecularRepeat,_c.mapSpecularOffset,_c.mapSpecularWrap,_c.mapSpecularAnisotropy);break;case'mapSpecularRepeat':case'mapSpecularOffset':case'mapSpecularWrap':case'mapSpecularAnisotropy':break;case'mapMetalness':Lc.metalnessMap=Mc(Ac,_c.mapMetalnessRepeat,_c.mapMetalnessOffset,_c.mapMetalnessWrap,_c.mapMetalnessAnisotropy);break;case'mapMetalnessRepeat':case'mapMetalnessOffset':case'mapMetalnessWrap':case'mapMetalnessAnisotropy':break;case'mapRoughness':Lc.roughnessMap=Mc(Ac,_c.mapRoughnessRepeat,_c.mapRoughnessOffset,_c.mapRoughnessWrap,_c.mapRoughnessAnisotropy);break;case'mapRoughnessRepeat':case'mapRoughnessOffset':case'mapRoughnessWrap':case'mapRoughnessAnisotropy':break;case'mapAlpha':Lc.alphaMap=Mc(Ac,_c.mapAlphaRepeat,_c.mapAlphaOffset,_c.mapAlphaWrap,_c.mapAlphaAnisotropy);break;case'mapAlphaRepeat':case'mapAlphaOffset':case'mapAlphaWrap':case'mapAlphaAnisotropy':break;case'flipSided':Lc.side=Qi;break;case'doubleSided':Lc.side=$i;break;case'transparency':Lc.opacity=Ac;break;case'depthTest':case'depthWrite':case'colorWrite':case'opacity':case'reflectivity':case'transparent':case'visible':case'wireframe':Lc[wc]=Ac;break;case'vertexColors':!0===Ac&&(Lc.vertexColors=on),'face'===Ac&&(Lc.vertexColors=an);break;default:}}return'MeshBasicMaterial'===Lc.type&&delete Lc.emissive,'MeshPhongMaterial'!==Lc.type&&delete Lc.specular,1>Lc.opacity&&(Lc.transparent=!0),xc.setTextures(Sc),xc.parse(Lc)}}()},Va.Handlers={handlers:[],add:function(gc,hc){this.handlers.push(gc,hc)},get:function(gc){for(var hc=this.handlers,yc=0,xc=hc.length;yc<xc;yc+=2){var vc=hc[yc],_c=hc[yc+1];if(vc.test(gc))return _c}return null}},Object.assign(ka.prototype,{load:function(gc,hc,yc,xc){var vc=this,_c=this.texturePath&&'string'==typeof this.texturePath?this.texturePath:Va.prototype.extractUrlBase(gc),Ec=new ca(this.manager);Ec.setWithCredentials(this.withCredentials),Ec.load(gc,function(Tc){var Mc=JSON.parse(Tc),Sc=Mc.metadata;if(Sc!==void 0){var Lc=Sc.type;if(Lc!==void 0){if('object'===Lc.toLowerCase())return;if('scene'===Lc.toLowerCase())return}}var wc=vc.parse(Mc,_c);hc(wc.geometry,wc.materials)},yc,xc)},setTexturePath:function(gc){this.texturePath=gc},parse:function(gc,hc){var Ec=new ft,Tc=void 0===gc.scale?1:1/gc.scale;if(function(Sc){function Lc(iu,nu){return iu&1<<nu}var eu=gc.faces,tu=gc.vertices,ru=gc.normals,au=gc.colors,ou=0,wc,Ac,Rc,Pc,Cc,Ic,Uc,Dc,zc,Nc,Bc,Fc,Oc,Gc,Hc,Vc,kc,Wc,jc,Xc,Yc,qc,Zc,Kc,Jc,Qc,$c;if(void 0!==gc.uvs){for(wc=0;wc<gc.uvs.length;wc++)gc.uvs[wc].length&&ou++;for(wc=0;wc<ou;wc++)Ec.faceVertexUvs[wc]=[]}for(Pc=0,Cc=tu.length;Pc<Cc;)Wc=new O,Wc.x=tu[Pc++]*Sc,Wc.y=tu[Pc++]*Sc,Wc.z=tu[Pc++]*Sc,Ec.vertices.push(Wc);for(Pc=0,Cc=eu.length;Pc<Cc;)if(Nc=eu[Pc++],Bc=Lc(Nc,0),Fc=Lc(Nc,1),Oc=Lc(Nc,3),Gc=Lc(Nc,4),Hc=Lc(Nc,5),Vc=Lc(Nc,6),kc=Lc(Nc,7),Bc){if(Xc=new Qe,Xc.a=eu[Pc],Xc.b=eu[Pc+1],Xc.c=eu[Pc+3],Yc=new Qe,Yc.a=eu[Pc+1],Yc.b=eu[Pc+2],Yc.c=eu[Pc+3],Pc+=4,Fc&&(zc=eu[Pc++],Xc.materialIndex=zc,Yc.materialIndex=zc),Rc=Ec.faces.length,Oc)for(wc=0;wc<ou;wc++)for(Kc=gc.uvs[wc],Ec.faceVertexUvs[wc][Rc]=[],Ec.faceVertexUvs[wc][Rc+1]=[],Ac=0;4>Ac;Ac++)Dc=eu[Pc++],Qc=Kc[2*Dc],$c=Kc[2*Dc+1],Jc=new R(Qc,$c),2!==Ac&&Ec.faceVertexUvs[wc][Rc].push(Jc),0!==Ac&&Ec.faceVertexUvs[wc][Rc+1].push(Jc);if(Gc&&(Uc=3*eu[Pc++],Xc.normal.set(ru[Uc++],ru[Uc++],ru[Uc]),Yc.normal.copy(Xc.normal)),Hc)for(wc=0;4>wc;wc++)Uc=3*eu[Pc++],Zc=new O(ru[Uc++],ru[Uc++],ru[Uc]),2!==wc&&Xc.vertexNormals.push(Zc),0!==wc&&Yc.vertexNormals.push(Zc);if(Vc&&(Ic=eu[Pc++],qc=au[Ic],Xc.color.setHex(qc),Yc.color.setHex(qc)),kc)for(wc=0;4>wc;wc++)Ic=eu[Pc++],qc=au[Ic],2!==wc&&Xc.vertexColors.push(new Ie(qc)),0!==wc&&Yc.vertexColors.push(new Ie(qc));Ec.faces.push(Xc),Ec.faces.push(Yc)}else{if(jc=new Qe,jc.a=eu[Pc++],jc.b=eu[Pc++],jc.c=eu[Pc++],Fc&&(zc=eu[Pc++],jc.materialIndex=zc),Rc=Ec.faces.length,Oc)for(wc=0;wc<ou;wc++)for(Kc=gc.uvs[wc],Ec.faceVertexUvs[wc][Rc]=[],Ac=0;3>Ac;Ac++)Dc=eu[Pc++],Qc=Kc[2*Dc],$c=Kc[2*Dc+1],Jc=new R(Qc,$c),Ec.faceVertexUvs[wc][Rc].push(Jc);if(Gc&&(Uc=3*eu[Pc++],jc.normal.set(ru[Uc++],ru[Uc++],ru[Uc])),Hc)for(wc=0;3>wc;wc++)Uc=3*eu[Pc++],Zc=new O(ru[Uc++],ru[Uc++],ru[Uc]),jc.vertexNormals.push(Zc);if(Vc&&(Ic=eu[Pc++],jc.color.setHex(au[Ic])),kc)for(wc=0;3>wc;wc++)Ic=eu[Pc++],jc.vertexColors.push(new Ie(au[Ic]));Ec.faces.push(jc)}}(Tc),function(){var Sc=void 0===gc.influencesPerVertex?2:gc.influencesPerVertex;if(gc.skinWeights)for(var Lc=0,wc=gc.skinWeights.length;Lc<wc;Lc+=Sc){var Ac=gc.skinWeights[Lc],Rc=1<Sc?gc.skinWeights[Lc+1]:0,Pc=2<Sc?gc.skinWeights[Lc+2]:0,Cc=3<Sc?gc.skinWeights[Lc+3]:0;Ec.skinWeights.push(new I(Ac,Rc,Pc,Cc))}if(gc.skinIndices)for(var Lc=0,wc=gc.skinIndices.length;Lc<wc;Lc+=Sc){var Ic=gc.skinIndices[Lc],Uc=1<Sc?gc.skinIndices[Lc+1]:0,Dc=2<Sc?gc.skinIndices[Lc+2]:0,zc=3<Sc?gc.skinIndices[Lc+3]:0;Ec.skinIndices.push(new I(Ic,Uc,Dc,zc))}Ec.bones=gc.bones,Ec.bones&&0<Ec.bones.length&&(Ec.skinWeights.length!==Ec.skinIndices.length||Ec.skinIndices.length!==Ec.vertices.length)&&void 0}(),function(Sc){if(void 0!==gc.morphTargets)for(var Lc=0,wc=gc.morphTargets.length;Lc<wc;Lc++){Ec.morphTargets[Lc]={},Ec.morphTargets[Lc].name=gc.morphTargets[Lc].name,Ec.morphTargets[Lc].vertices=[];for(var Ac=Ec.morphTargets[Lc].vertices,Rc=gc.morphTargets[Lc].vertices,Pc=0,Cc=Rc.length,Ic;Pc<Cc;Pc+=3)Ic=new O,Ic.x=Rc[Pc]*Sc,Ic.y=Rc[Pc+1]*Sc,Ic.z=Rc[Pc+2]*Sc,Ac.push(Ic)}if(void 0!==gc.morphColors&&0<gc.morphColors.length)for(var Uc=Ec.faces,Dc=gc.morphColors[0].colors,Lc=0,wc=Uc.length;Lc<wc;Lc++)Uc[Lc].color.fromArray(Dc,3*Lc)}(Tc),function(){var Sc=[],Lc=[];void 0!==gc.animation&&Lc.push(gc.animation),void 0!==gc.animations&&(gc.animations.length?Lc=Lc.concat(gc.animations):Lc.push(gc.animations));for(var wc=0,Ac;wc<Lc.length;wc++)Ac=Oa.parseAnimation(Lc[wc],Ec.bones),Ac&&Sc.push(Ac);if(Ec.morphTargets){var Rc=Oa.CreateClipsFromMorphTargetSequences(Ec.morphTargets,10);Sc=Sc.concat(Rc)}0<Sc.length&&(Ec.animations=Sc)}(),Ec.computeFaceNormals(),Ec.computeBoundingSphere(),void 0===gc.materials||0===gc.materials.length)return{geometry:Ec};var Mc=Va.prototype.initMaterials(gc.materials,hc,this.crossOrigin);return{geometry:Ec,materials:Mc}}}),Object.assign(Wa.prototype,{load:function(gc,hc,yc,xc){''===this.texturePath&&(this.texturePath=gc.substring(0,gc.lastIndexOf('/')+1));var vc=this,_c=new ca(vc.manager);_c.load(gc,function(Ec){var Tc=null;try{Tc=JSON.parse(Ec)}catch(Sc){return void 0!==xc&&xc(Sc),void 0}var Mc=Tc.metadata;void 0===Mc||void 0===Mc.type||'geometry'===Mc.type.toLowerCase()||vc.parse(Tc,hc)},yc,xc)},setTexturePath:function(gc){this.texturePath=gc},setCrossOrigin:function(gc){this.crossOrigin=gc},parse:function(gc,hc){var yc=this.parseGeometries(gc.geometries),xc=this.parseImages(gc.images,function(){void 0!==hc&&hc(Ec)}),vc=this.parseTextures(gc.textures,xc),_c=this.parseMaterials(gc.materials,vc),Ec=this.parseObject(gc.object,yc,_c);return gc.animations&&(Ec.animations=this.parseAnimations(gc.animations)),(void 0===gc.images||0===gc.images.length)&&void 0!==hc&&hc(Ec),Ec},parseGeometries:function(gc){var hc={};if(gc!==void 0)for(var yc=new ka,xc=new Ha,vc=0,_c=gc.length;vc<_c;vc++){var Tc=gc[vc],Ec;switch(Tc.type){case'PlaneGeometry':case'PlaneBufferGeometry':Ec=new qp[Tc.type](Tc.width,Tc.height,Tc.widthSegments,Tc.heightSegments);break;case'BoxGeometry':case'BoxBufferGeometry':case'CubeGeometry':Ec=new qp[Tc.type](Tc.width,Tc.height,Tc.depth,Tc.widthSegments,Tc.heightSegments,Tc.depthSegments);break;case'CircleGeometry':case'CircleBufferGeometry':Ec=new qp[Tc.type](Tc.radius,Tc.segments,Tc.thetaStart,Tc.thetaLength);break;case'CylinderGeometry':case'CylinderBufferGeometry':Ec=new qp[Tc.type](Tc.radiusTop,Tc.radiusBottom,Tc.height,Tc.radialSegments,Tc.heightSegments,Tc.openEnded,Tc.thetaStart,Tc.thetaLength);break;case'ConeGeometry':case'ConeBufferGeometry':Ec=new qp[Tc.type](Tc.radius,Tc.height,Tc.radialSegments,Tc.heightSegments,Tc.openEnded,Tc.thetaStart,Tc.thetaLength);break;case'SphereGeometry':case'SphereBufferGeometry':Ec=new qp[Tc.type](Tc.radius,Tc.widthSegments,Tc.heightSegments,Tc.phiStart,Tc.phiLength,Tc.thetaStart,Tc.thetaLength);break;case'DodecahedronGeometry':case'IcosahedronGeometry':case'OctahedronGeometry':case'TetrahedronGeometry':Ec=new qp[Tc.type](Tc.radius,Tc.detail);break;case'RingGeometry':case'RingBufferGeometry':Ec=new qp[Tc.type](Tc.innerRadius,Tc.outerRadius,Tc.thetaSegments,Tc.phiSegments,Tc.thetaStart,Tc.thetaLength);break;case'TorusGeometry':case'TorusBufferGeometry':Ec=new qp[Tc.type](Tc.radius,Tc.tube,Tc.radialSegments,Tc.tubularSegments,Tc.arc);break;case'TorusKnotGeometry':case'TorusKnotBufferGeometry':Ec=new qp[Tc.type](Tc.radius,Tc.tube,Tc.tubularSegments,Tc.radialSegments,Tc.p,Tc.q);break;case'LatheGeometry':case'LatheBufferGeometry':Ec=new qp[Tc.type](Tc.points,Tc.segments,Tc.phiStart,Tc.phiLength);break;case'BufferGeometry':Ec=xc.parse(Tc);break;case'Geometry':Ec=yc.parse(Tc.data,this.texturePath).geometry;break;default:continue;}Ec.uuid=Tc.uuid,void 0!==Tc.name&&(Ec.name=Tc.name),hc[Tc.uuid]=Ec}return hc},parseMaterials:function(gc,hc){var yc={};if(gc!==void 0){var xc=new Ga;xc.setTextures(hc);for(var vc=0,_c=gc.length,Ec;vc<_c;vc++)Ec=xc.parse(gc[vc]),yc[Ec.uuid]=Ec}return yc},parseAnimations:function(gc){for(var hc=[],yc=0,xc;yc<gc.length;yc++)xc=Oa.parse(gc[yc]),hc.push(xc);return hc},parseImages:function(gc,hc){function yc(wc){return xc.manager.itemStart(wc),Ec.load(wc,function(){xc.manager.itemEnd(wc)},void 0,function(){xc.manager.itemError(wc)})}var xc=this,vc={};if(gc!==void 0&&0<gc.length){var _c=new pa(hc),Ec=new fa(_c);Ec.setCrossOrigin(this.crossOrigin);for(var Tc=0,Mc=gc.length;Tc<Mc;Tc++){var Sc=gc[Tc],Lc=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Sc.url)?Sc.url:xc.texturePath+Sc.url;vc[Sc.uuid]=yc(Lc)}}return vc},parseTextures:function(gc,hc){function yc(wc,Ac){if('number'==typeof wc)return wc;return Ac[wc]}var xc={UVMapping:jn,CubeReflectionMapping:Xn,CubeRefractionMapping:Yn,EquirectangularReflectionMapping:qn,EquirectangularRefractionMapping:Zn,SphericalReflectionMapping:Kn,CubeUVReflectionMapping:Jn,CubeUVRefractionMapping:Qn},vc={RepeatWrapping:$n,ClampToEdgeWrapping:es,MirroredRepeatWrapping:ts},_c={NearestFilter:as,NearestMipMapNearestFilter:os,NearestMipMapLinearFilter:is,LinearFilter:ns,LinearMipMapNearestFilter:ss,LinearMipMapLinearFilter:ls},Ec={};if(gc!==void 0)for(var Tc=0,Mc=gc.length,Sc;Tc<Mc;Tc++){Sc=gc[Tc],void 0===Sc.image&&void 0,void 0===hc[Sc.image]&&void 0;var Lc=new C(hc[Sc.image]);Lc.needsUpdate=!0,Lc.uuid=Sc.uuid,void 0!==Sc.name&&(Lc.name=Sc.name),void 0!==Sc.mapping&&(Lc.mapping=yc(Sc.mapping,xc)),void 0!==Sc.offset&&Lc.offset.fromArray(Sc.offset),void 0!==Sc.repeat&&Lc.repeat.fromArray(Sc.repeat),void 0!==Sc.wrap&&(Lc.wrapS=yc(Sc.wrap[0],vc),Lc.wrapT=yc(Sc.wrap[1],vc)),void 0!==Sc.minFilter&&(Lc.minFilter=yc(Sc.minFilter,_c)),void 0!==Sc.magFilter&&(Lc.magFilter=yc(Sc.magFilter,_c)),void 0!==Sc.anisotropy&&(Lc.anisotropy=Sc.anisotropy),void 0!==Sc.flipY&&(Lc.flipY=Sc.flipY),Ec[Sc.uuid]=Lc}return Ec},parseObject:function(){var gc=new G;return function(yc,xc,vc){function _c(Pc){return void 0===xc[Pc]&&void 0,xc[Pc]}function Ec(Pc){if(void 0!==Pc)return void 0===vc[Pc]&&void 0,vc[Pc]}var Tc;switch(yc.type){case'Scene':Tc=new er,void 0!==yc.background&&Number.isInteger(yc.background)&&(Tc.background=new Ie(yc.background)),void 0!==yc.fog&&('Fog'===yc.fog.type?Tc.fog=new $t(yc.fog.color,yc.fog.near,yc.fog.far):'FogExp2'===yc.fog.type&&(Tc.fog=new Qt(yc.fog.color,yc.fog.density)));break;case'PerspectiveCamera':Tc=new Tt(yc.fov,yc.aspect,yc.near,yc.far),void 0!==yc.focus&&(Tc.focus=yc.focus),void 0!==yc.zoom&&(Tc.zoom=yc.zoom),void 0!==yc.filmGauge&&(Tc.filmGauge=yc.filmGauge),void 0!==yc.filmOffset&&(Tc.filmOffset=yc.filmOffset),void 0!==yc.view&&(Tc.view=Object.assign({},yc.view));break;case'OrthographicCamera':Tc=new Mt(yc.left,yc.right,yc.top,yc.bottom,yc.near,yc.far);break;case'AmbientLight':Tc=new Sa(yc.color,yc.intensity);break;case'DirectionalLight':Tc=new Ma(yc.color,yc.intensity);break;case'PointLight':Tc=new Ea(yc.color,yc.intensity,yc.distance,yc.decay);break;case'SpotLight':Tc=new ba(yc.color,yc.intensity,yc.distance,yc.angle,yc.penumbra,yc.decay);break;case'HemisphereLight':Tc=new xa(yc.color,yc.groundColor,yc.intensity);break;case'Mesh':var Mc=_c(yc.geometry),Sc=Ec(yc.material);Tc=Mc.bones&&0<Mc.bones.length?new sr(Mc,Sc):new ht(Mc,Sc);break;case'LOD':Tc=new or;break;case'Line':Tc=new dr(_c(yc.geometry),Ec(yc.material),yc.mode);break;case'LineSegments':Tc=new pr(_c(yc.geometry),Ec(yc.material));break;case'PointCloud':case'Points':Tc=new ur(_c(yc.geometry),Ec(yc.material));break;case'Sprite':Tc=new ar(Ec(yc.material));break;case'Group':Tc=new mr;break;case'SkinnedMesh':default:Tc=new Ze;}if(Tc.uuid=yc.uuid,void 0!==yc.name&&(Tc.name=yc.name),void 0===yc.matrix?(void 0!==yc.position&&Tc.position.fromArray(yc.position),void 0!==yc.rotation&&Tc.rotation.fromArray(yc.rotation),void 0!==yc.quaternion&&Tc.quaternion.fromArray(yc.quaternion),void 0!==yc.scale&&Tc.scale.fromArray(yc.scale)):(gc.fromArray(yc.matrix),gc.decompose(Tc.position,Tc.quaternion,Tc.scale)),void 0!==yc.castShadow&&(Tc.castShadow=yc.castShadow),void 0!==yc.receiveShadow&&(Tc.receiveShadow=yc.receiveShadow),yc.shadow&&(void 0!==yc.shadow.bias&&(Tc.shadow.bias=yc.shadow.bias),void 0!==yc.shadow.radius&&(Tc.shadow.radius=yc.shadow.radius),void 0!==yc.shadow.mapSize&&Tc.shadow.mapSize.fromArray(yc.shadow.mapSize),void 0!==yc.shadow.camera&&(Tc.shadow.camera=this.parseObject(yc.shadow.camera))),void 0!==yc.visible&&(Tc.visible=yc.visible),void 0!==yc.userData&&(Tc.userData=yc.userData),void 0!==yc.children)for(var Lc in yc.children)Tc.add(this.parseObject(yc.children[Lc],xc,vc));if('LOD'===yc.type)for(var wc=yc.levels,Ac=0;Ac<wc.length;Ac++){var Rc=wc[Ac],Lc=Tc.getObjectByProperty('uuid',Rc.object);void 0!==Lc&&Tc.addLevel(Lc,Rc.distance)}return Tc}}()}),ao.prototype={constructor:ao,getPoint:function(){return null},getPointAt:function(gc){var hc=this.getUtoTmapping(gc);return this.getPoint(hc)},getPoints:function(gc){isNaN(gc)&&(gc=5);for(var hc=[],yc=0;yc<=gc;yc++)hc.push(this.getPoint(yc/gc));return hc},getSpacedPoints:function(gc){isNaN(gc)&&(gc=5);for(var hc=[],yc=0;yc<=gc;yc++)hc.push(this.getPointAt(yc/gc));return hc},getLength:function(){var gc=this.getLengths();return gc[gc.length-1]},getLengths:function(gc){if(isNaN(gc)&&(gc=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===gc+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var hc=[],xc=this.getPoint(0),_c=0,yc,vc;for(hc.push(0),vc=1;vc<=gc;vc++)yc=this.getPoint(vc/gc),_c+=yc.distanceTo(xc),hc.push(_c),xc=yc;return this.cacheArcLengths=hc,hc},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(gc,hc){var yc=this.getLengths(),xc=0,vc=yc.length,_c;_c=hc?hc:gc*yc[vc-1];for(var Ec=0,Tc=vc-1,Mc;Ec<=Tc;)if(xc=_Mathfloor(Ec+(Tc-Ec)/2),Mc=yc[xc]-_c,0>Mc)Ec=xc+1;else if(0<Mc)Tc=xc-1;else{Tc=xc;break}if(xc=Tc,yc[xc]===_c){var Sc=xc/(vc-1);return Sc}var Lc=yc[xc],wc=yc[xc+1],Rc=(_c-Lc)/(wc-Lc),Sc=(xc+Rc)/(vc-1);return Sc},getTangent:function(gc){var hc=1e-4,yc=gc-hc,xc=gc+hc;0>yc&&(yc=0),1<xc&&(xc=1);var vc=this.getPoint(yc),_c=this.getPoint(xc),Ec=_c.clone().sub(vc);return Ec.normalize()},getTangentAt:function(gc){var hc=this.getUtoTmapping(gc);return this.getTangent(hc)},computeFrenetFrames:function(gc,hc){var yc=new O,xc=[],vc=[],_c=[],Ec=new O,Tc=new G,Mc,Sc,Lc;for(Mc=0;Mc<=gc;Mc++)Sc=Mc/gc,xc[Mc]=this.getTangentAt(Sc),xc[Mc].normalize();vc[0]=new O,_c[0]=new O;var wc=Number.MAX_VALUE,Ac=_Mathabs(xc[0].x),Rc=_Mathabs(xc[0].y),Pc=_Mathabs(xc[0].z);for(Ac<=wc&&(wc=Ac,yc.set(1,0,0)),Rc<=wc&&(wc=Rc,yc.set(0,1,0)),Pc<=wc&&yc.set(0,0,1),Ec.crossVectors(xc[0],yc).normalize(),vc[0].crossVectors(xc[0],Ec),_c[0].crossVectors(xc[0],vc[0]),Mc=1;Mc<=gc;Mc++)vc[Mc]=vc[Mc-1].clone(),_c[Mc]=_c[Mc-1].clone(),Ec.crossVectors(xc[Mc-1],xc[Mc]),Ec.length()>_NumberEPSILON&&(Ec.normalize(),Lc=_Mathacos(xl.clamp(xc[Mc-1].dot(xc[Mc]),-1,1)),vc[Mc].applyMatrix4(Tc.makeRotationAxis(Ec,Lc))),_c[Mc].crossVectors(xc[Mc],vc[Mc]);if(!0===hc)for(Lc=_Mathacos(xl.clamp(vc[0].dot(vc[gc]),-1,1)),Lc/=gc,0<xc[0].dot(Ec.crossVectors(vc[0],vc[gc]))&&(Lc=-Lc),Mc=1;Mc<=gc;Mc++)vc[Mc].applyMatrix4(Tc.makeRotationAxis(xc[Mc],Lc*Mc)),_c[Mc].crossVectors(xc[Mc],vc[Mc]);return{tangents:xc,normals:vc,binormals:_c}}},oo.prototype=Object.create(ao.prototype),oo.prototype.constructor=oo,oo.prototype.isLineCurve=!0,oo.prototype.getPoint=function(gc){if(1===gc)return this.v2.clone();var hc=this.v2.clone().sub(this.v1);return hc.multiplyScalar(gc).add(this.v1),hc},oo.prototype.getPointAt=function(gc){return this.getPoint(gc)},oo.prototype.getTangent=function(){var hc=this.v2.clone().sub(this.v1);return hc.normalize()},io.prototype=Object.assign(Object.create(ao.prototype),{constructor:io,add:function(gc){this.curves.push(gc)},closePath:function(){var gc=this.curves[0].getPoint(0),hc=this.curves[this.curves.length-1].getPoint(1);gc.equals(hc)||this.curves.push(new oo(hc,gc))},getPoint:function(gc){for(var hc=gc*this.getLength(),yc=this.getCurveLengths(),xc=0;xc<yc.length;){if(yc[xc]>=hc){var vc=yc[xc]-hc,_c=this.curves[xc],Ec=_c.getLength(),Tc=0===Ec?0:1-vc/Ec;return _c.getPointAt(Tc)}xc++}return null},getLength:function(){var gc=this.getCurveLengths();return gc[gc.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var gc=[],hc=0,yc=0,xc=this.curves.length;yc<xc;yc++)hc+=this.curves[yc].getLength(),gc.push(hc);return this.cacheLengths=gc,gc},getSpacedPoints:function(gc){isNaN(gc)&&(gc=40);for(var hc=[],yc=0;yc<=gc;yc++)hc.push(this.getPoint(yc/gc));return this.autoClose&&hc.push(hc[0]),hc},getPoints:function(gc){gc=gc||12;for(var hc=[],xc=0,vc=this.curves,yc;xc<vc.length;xc++)for(var _c=vc[xc],Ec=_c&&_c.isEllipseCurve?2*gc:_c&&_c.isLineCurve?1:_c&&_c.isSplineCurve?gc*_c.points.length:gc,Tc=_c.getPoints(Ec),Mc=0,Sc;Mc<Tc.length;Mc++)Sc=Tc[Mc],yc&&yc.equals(Sc)||(hc.push(Sc),yc=Sc);return this.autoClose&&1<hc.length&&!hc[hc.length-1].equals(hc[0])&&hc.push(hc[0]),hc},createPointsGeometry:function(gc){var hc=this.getPoints(gc);return this.createGeometry(hc)},createSpacedPointsGeometry:function(gc){var hc=this.getSpacedPoints(gc);return this.createGeometry(hc)},createGeometry:function(gc){for(var hc=new ft,yc=0,xc=gc.length,vc;yc<xc;yc++)vc=gc[yc],hc.vertices.push(new O(vc.x,vc.y,vc.z||0));return hc}}),no.prototype=Object.create(ao.prototype),no.prototype.constructor=no,no.prototype.isEllipseCurve=!0,no.prototype.getPoint=function(gc){for(var hc=2*_MathPI,yc=this.aEndAngle-this.aStartAngle,xc=_Mathabs(yc)<_NumberEPSILON;0>yc;)yc+=hc;for(;yc>hc;)yc-=hc;yc<_NumberEPSILON&&(xc?yc=0:yc=hc),!0!==this.aClockwise||xc||(yc==hc?yc=-hc:yc-=hc);var vc=this.aStartAngle+gc*yc,_c=this.aX+this.xRadius*_Mathcos(vc),Ec=this.aY+this.yRadius*_Mathsin(vc);if(0!==this.aRotation){var Tc=_Mathcos(this.aRotation),Mc=_Mathsin(this.aRotation),Sc=_c-this.aX,Lc=Ec-this.aY;_c=Sc*Tc-Lc*Mc+this.aX,Ec=Sc*Mc+Lc*Tc+this.aY}return new R(_c,Ec)},so.prototype=Object.create(ao.prototype),so.prototype.constructor=so,so.prototype.isSplineCurve=!0,so.prototype.getPoint=function(gc){var hc=this.points,yc=(hc.length-1)*gc,xc=_Mathfloor(yc),vc=yc-xc,_c=hc[0===xc?xc:xc-1],Ec=hc[xc],Tc=hc[xc>hc.length-2?hc.length-1:xc+1],Mc=hc[xc>hc.length-3?hc.length-1:xc+2];return new R(ja(vc,_c.x,Ec.x,Tc.x,Mc.x),ja(vc,_c.y,Ec.y,Tc.y,Mc.y))},lo.prototype=Object.create(ao.prototype),lo.prototype.constructor=lo,lo.prototype.getPoint=function(gc){var hc=this.v0,yc=this.v1,xc=this.v2,vc=this.v3;return new R(ro(gc,hc.x,yc.x,xc.x,vc.x),ro(gc,hc.y,yc.y,xc.y,vc.y))},po.prototype=Object.create(ao.prototype),po.prototype.constructor=po,po.prototype.getPoint=function(gc){var hc=this.v0,yc=this.v1,xc=this.v2;return new R(Ka(gc,hc.x,yc.x,xc.x),Ka(gc,hc.y,yc.y,xc.y))};var ec=Object.assign(Object.create(io.prototype),{fromPoints:function(gc){this.moveTo(gc[0].x,gc[0].y);for(var hc=1,yc=gc.length;hc<yc;hc++)this.lineTo(gc[hc].x,gc[hc].y)},moveTo:function(gc,hc){this.currentPoint.set(gc,hc)},lineTo:function(gc,hc){var yc=new oo(this.currentPoint.clone(),new R(gc,hc));this.curves.push(yc),this.currentPoint.set(gc,hc)},quadraticCurveTo:function(gc,hc,yc,xc){var vc=new po(this.currentPoint.clone(),new R(gc,hc),new R(yc,xc));this.curves.push(vc),this.currentPoint.set(yc,xc)},bezierCurveTo:function(gc,hc,yc,xc,vc,_c){var Ec=new lo(this.currentPoint.clone(),new R(gc,hc),new R(yc,xc),new R(vc,_c));this.curves.push(Ec),this.currentPoint.set(vc,_c)},splineThru:function(gc){var hc=[this.currentPoint.clone()].concat(gc),yc=new so(hc);this.curves.push(yc),this.currentPoint.copy(gc[gc.length-1])},arc:function(gc,hc,yc,xc,vc,_c){var Ec=this.currentPoint.x,Tc=this.currentPoint.y;this.absarc(gc+Ec,hc+Tc,yc,xc,vc,_c)},absarc:function(gc,hc,yc,xc,vc,_c){this.absellipse(gc,hc,yc,yc,xc,vc,_c)},ellipse:function(gc,hc,yc,xc,vc,_c,Ec,Tc){var Mc=this.currentPoint.x,Sc=this.currentPoint.y;this.absellipse(gc+Mc,hc+Sc,yc,xc,vc,_c,Ec,Tc)},absellipse:function(gc,hc,yc,xc,vc,_c,Ec,Tc){var Mc=new no(gc,hc,yc,xc,vc,_c,Ec,Tc);if(0<this.curves.length){var Sc=Mc.getPoint(0);Sc.equals(this.currentPoint)||this.lineTo(Sc.x,Sc.y)}this.curves.push(Mc);var Lc=Mc.getPoint(1);this.currentPoint.copy(Lc)}});co.prototype=ec,ec.constructor=co,uo.prototype=Object.assign(Object.create(ec),{constructor:uo,getPointsHoles:function(gc){for(var hc=[],yc=0,xc=this.holes.length;yc<xc;yc++)hc[yc]=this.holes[yc].getPoints(gc);return hc},extractAllPoints:function(gc){return{shape:this.getPoints(gc),holes:this.getPointsHoles(gc)}},extractPoints:function(gc){return this.extractAllPoints(gc)}}),mo.prototype={moveTo:function(gc,hc){this.currentPath=new co,this.subPaths.push(this.currentPath),this.currentPath.moveTo(gc,hc)},lineTo:function(gc,hc){this.currentPath.lineTo(gc,hc)},quadraticCurveTo:function(gc,hc,yc,xc){this.currentPath.quadraticCurveTo(gc,hc,yc,xc)},bezierCurveTo:function(gc,hc,yc,xc,vc,_c){this.currentPath.bezierCurveTo(gc,hc,yc,xc,vc,_c)},splineThru:function(gc){this.currentPath.splineThru(gc)},toShapes:function(gc,hc){function yc(Yc){for(var qc=[],Zc=0,Kc=Yc.length;Zc<Kc;Zc++){var Jc=Yc[Zc],Qc=new uo;Qc.curves=Jc.curves,qc.push(Qc)}return qc}function xc(Yc,qc){for(var Zc=qc.length,Kc=!1,Jc=Zc-1,Qc=0;Qc<Zc;Jc=Qc++){var $c=qc[Jc],eu=qc[Qc],tu=eu.x-$c.x,ru=eu.y-$c.y;if(_Mathabs(ru)>_NumberEPSILON){if(0>ru&&($c=qc[Qc],tu=-tu,eu=qc[Jc],ru=-ru),Yc.y<$c.y||Yc.y>eu.y)continue;if(Yc.y!==$c.y){var au=ru*(Yc.x-$c.x)-tu*(Yc.y-$c.y);if(0==au)return!0;if(0>au)continue;Kc=!Kc}else if(Yc.x===$c.x)return!0}else{if(Yc.y!==$c.y)continue;if(eu.x<=Yc.x&&Yc.x<=$c.x||$c.x<=Yc.x&&Yc.x<=eu.x)return!0}}return Kc}var vc=Yp.isClockWise,_c=this.subPaths;if(0===_c.length)return[];if(!0===hc)return yc(_c);var Sc=[],Ec,Tc,Mc;if(1===_c.length)return Tc=_c[0],Mc=new uo,Mc.curves=Tc.curves,Sc.push(Mc),Sc;var Lc=!vc(_c[0].getPoints());Lc=gc?!Lc:Lc;var wc=[],Ac=[],Rc=[],Pc=0,Cc;Ac[Pc]=void 0,Rc[Pc]=[];for(var Ic=0,Uc=_c.length;Ic<Uc;Ic++)Tc=_c[Ic],Cc=Tc.getPoints(),Ec=vc(Cc),Ec=gc?!Ec:Ec,Ec?(!Lc&&Ac[Pc]&&Pc++,Ac[Pc]={s:new uo,p:Cc},Ac[Pc].s.curves=Tc.curves,Lc&&Pc++,Rc[Pc]=[]):Rc[Pc].push({h:Tc,p:Cc[0]});if(!Ac[0])return yc(_c);if(1<Ac.length){for(var Dc=!1,zc=[],Nc=0,Bc=Ac.length;Nc<Bc;Nc++)wc[Nc]=[];for(var Nc=0,Bc=Ac.length,Fc;Nc<Bc;Nc++){Fc=Rc[Nc];for(var Oc=0;Oc<Fc.length;Oc++){for(var Gc=Fc[Oc],Hc=!0,Vc=0;Vc<Ac.length;Vc++)xc(Gc.p,Ac[Vc].p)&&(Nc!==Vc&&zc.push({froms:Nc,tos:Vc,hole:Oc}),Hc?(Hc=!1,wc[Vc].push(Gc)):Dc=!0);Hc&&wc[Nc].push(Gc)}}0<zc.length&&!Dc&&(Rc=wc)}for(var Ic=0,Wc=Ac.length,kc;Ic<Wc;Ic++){Mc=Ac[Ic].s,Sc.push(Mc),kc=Rc[Ic];for(var jc=0,Xc=kc.length;jc<Xc;jc++)Mc.holes.push(kc[jc].h)}return Sc}},Object.assign(fo.prototype,{isFont:!0,generateShapes:function(gc,hc,yc){function xc(Lc){for(var wc=(Lc+'').split(''),Ac=hc/_c.resolution,Rc=(_c.boundingBox.yMax-_c.boundingBox.yMin+_c.underlineThickness)*Ac,Pc=0,Cc=0,Ic=[],Uc=0,Dc;Uc<wc.length;Uc++)if(Dc=wc[Uc],'\n'===Dc)Pc=0,Cc-=Rc;else{var zc=vc(Dc,Ac,Pc,Cc);Pc+=zc.offsetX,Ic.push(zc.path)}return Ic}function vc(Lc,wc,Ac,Rc){var Pc=_c.glyphs[Lc]||_c.glyphs['?'];if(Pc){var Cc=new mo,Ic=[],Uc,Dc,zc,Nc,Bc,Fc,Oc,Gc,Hc,Vc,kc;if(Pc.o)for(var Wc=Pc._cachedOutline||(Pc._cachedOutline=Pc.o.split(' ')),jc=0,Xc=Wc.length,Yc;jc<Xc;)switch(Yc=Wc[jc++],Yc){case'm':Uc=Wc[jc++]*wc+Ac,Dc=Wc[jc++]*wc+Rc,Cc.moveTo(Uc,Dc);break;case'l':Uc=Wc[jc++]*wc+Ac,Dc=Wc[jc++]*wc+Rc,Cc.lineTo(Uc,Dc);break;case'q':if(zc=Wc[jc++]*wc+Ac,Nc=Wc[jc++]*wc+Rc,Oc=Wc[jc++]*wc+Ac,Gc=Wc[jc++]*wc+Rc,Cc.quadraticCurveTo(Oc,Gc,zc,Nc),kc=Ic[Ic.length-1],kc){Bc=kc.x,Fc=kc.y;for(var qc=1,Zc;qc<=yc;qc++)Zc=qc/yc,Ka(Zc,Bc,Oc,zc),Ka(Zc,Fc,Gc,Nc)}break;case'b':if(zc=Wc[jc++]*wc+Ac,Nc=Wc[jc++]*wc+Rc,Oc=Wc[jc++]*wc+Ac,Gc=Wc[jc++]*wc+Rc,Hc=Wc[jc++]*wc+Ac,Vc=Wc[jc++]*wc+Rc,Cc.bezierCurveTo(Oc,Gc,Hc,Vc,zc,Nc),kc=Ic[Ic.length-1],kc){Bc=kc.x,Fc=kc.y;for(var qc=1,Zc;qc<=yc;qc++)Zc=qc/yc,ro(Zc,Bc,Oc,Hc,zc),ro(Zc,Fc,Gc,Vc,Nc)}}return{offsetX:Pc.ha*wc,path:Cc}}}hc===void 0&&(hc=100),yc===void 0&&(yc=4);for(var _c=this.data,Ec=xc(gc),Tc=[],Mc=0,Sc=Ec.length;Mc<Sc;Mc++)Array.prototype.push.apply(Tc,Ec[Mc].toShapes());return Tc}}),Object.assign(go.prototype,{load:function(gc,hc,yc,xc){var vc=this,_c=new ca(this.manager);_c.load(gc,function(Ec){var Tc;try{Tc=JSON.parse(Ec)}catch(Sc){void 0,Tc=JSON.parse(Ec.substring(65,Ec.length-2))}var Mc=vc.parse(Tc);hc&&hc(Mc)},yc,xc)},parse:function(gc){return new fo(gc)}});var tc,rc={getContext:function(){return void 0==tc&&(tc=new(window.AudioContext||window.webkitAudioContext)),tc},setContext:function(gc){tc=gc}};Object.assign(yo.prototype,{load:function(gc,hc,yc,xc){var vc=new ca(this.manager);vc.setResponseType('arraybuffer'),vc.load(gc,function(_c){var Ec=rc.getContext();Ec.decodeAudioData(_c,function(Tc){hc(Tc)})},yc,xc)}}),xo.prototype=Object.assign(Object.create(ya.prototype),{constructor:xo,isRectAreaLight:!0,copy:function(gc){return ya.prototype.copy.call(this,gc),this.width=gc.width,this.height=gc.height,this}}),Object.assign(vo.prototype,{update:function(){var gc,hc,yc,xc,vc,_c,Ec,Tc=new G,Mc=new G;return function(Lc){var wc=gc!==this||hc!==Lc.focus||yc!==Lc.fov||xc!==Lc.aspect*this.aspect||vc!==Lc.near||_c!==Lc.far||Ec!==Lc.zoom;if(wc){gc=this,hc=Lc.focus,yc=Lc.fov,xc=Lc.aspect*this.aspect,vc=Lc.near,_c=Lc.far,Ec=Lc.zoom;var Ac=Lc.projectionMatrix.clone(),Rc=this.eyeSep/2,Pc=Rc*vc/hc,Cc=vc*_Mathtan(0.5*(xl.DEG2RAD*yc))/Ec,Ic,Uc;Mc.elements[12]=-Rc,Tc.elements[12]=Rc,Ic=-Cc*xc+Pc,Uc=Cc*xc+Pc,Ac.elements[0]=2*vc/(Uc-Ic),Ac.elements[8]=(Uc+Ic)/(Uc-Ic),this.cameraL.projectionMatrix.copy(Ac),Ic=-Cc*xc-Pc,Uc=Cc*xc-Pc,Ac.elements[0]=2*vc/(Uc-Ic),Ac.elements[8]=(Uc+Ic)/(Uc-Ic),this.cameraR.projectionMatrix.copy(Ac)}this.cameraL.matrixWorld.copy(Lc.matrixWorld).multiply(Mc),this.cameraR.matrixWorld.copy(Lc.matrixWorld).multiply(Tc)}}()}),_o.prototype=Object.create(Ze.prototype),_o.prototype.constructor=_o,bo.prototype=Object.assign(Object.create(Ze.prototype),{constructor:bo,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(gc){null===this.filter?this.gain.disconnect(this.context.destination):(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)),this.filter=gc,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(gc){this.gain.gain.value=gc},updateMatrixWorld:function(){var gc=new O,hc=new F,yc=new O,xc=new O;return function(_c){Ze.prototype.updateMatrixWorld.call(this,_c);var Ec=this.context.listener,Tc=this.up;this.matrixWorld.decompose(gc,hc,yc),xc.set(0,0,-1).applyQuaternion(hc),Ec.positionX?(Ec.positionX.setValueAtTime(gc.x,this.context.currentTime),Ec.positionY.setValueAtTime(gc.y,this.context.currentTime),Ec.positionZ.setValueAtTime(gc.z,this.context.currentTime),Ec.forwardX.setValueAtTime(xc.x,this.context.currentTime),Ec.forwardY.setValueAtTime(xc.y,this.context.currentTime),Ec.forwardZ.setValueAtTime(xc.z,this.context.currentTime),Ec.upX.setValueAtTime(Tc.x,this.context.currentTime),Ec.upY.setValueAtTime(Tc.y,this.context.currentTime),Ec.upZ.setValueAtTime(Tc.z,this.context.currentTime)):(Ec.setPosition(gc.x,gc.y,gc.z),Ec.setOrientation(xc.x,xc.y,xc.z,Tc.x,Tc.y,Tc.z))}}()}),Eo.prototype=Object.assign(Object.create(Ze.prototype),{constructor:Eo,getOutput:function(){return this.gain},setNodeSource:function(gc){return this.hasPlaybackControl=!1,this.sourceType='audioNode',this.source=gc,this.connect(),this},setBuffer:function(gc){return this.buffer=gc,this.sourceType='buffer',this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying&&!1!==this.hasPlaybackControl){var gc=this.context.createBufferSource();return gc.buffer=this.buffer,gc.loop=this.loop,gc.onended=this.onEnded.bind(this),gc.playbackRate.setValueAtTime(this.playbackRate,this.startTime),gc.start(0,this.startTime),this.isPlaying=!0,this.source=gc,this.connect()}},pause:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var gc=1,hc=this.filters.length;gc<hc;gc++)this.filters[gc-1].connect(this.filters[gc]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var gc=1,hc=this.filters.length;gc<hc;gc++)this.filters[gc-1].disconnect(this.filters[gc]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(gc){return gc||(gc=[]),!0===this.isPlaying?(this.disconnect(),this.filters=gc,this.connect()):this.filters=gc,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(gc){return this.setFilters(gc?[gc]:[])},setPlaybackRate:function(gc){if(!1!==this.hasPlaybackControl)return this.playbackRate=gc,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1!==this.hasPlaybackControl&&this.loop},setLoop:function(gc){if(!1!==this.hasPlaybackControl)return this.loop=gc,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(gc){return this.gain.gain.value=gc,this}}),To.prototype=Object.assign(Object.create(Eo.prototype),{constructor:To,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(gc){this.panner.refDistance=gc},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(gc){this.panner.rolloffFactor=gc},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(gc){this.panner.distanceModel=gc},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(gc){this.panner.maxDistance=gc},updateMatrixWorld:function(){var gc=new O;return function(yc){Ze.prototype.updateMatrixWorld.call(this,yc),gc.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(gc.x,gc.y,gc.z)}}()}),Object.assign(Mo.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var gc=0,hc=this.getFrequencyData(),yc=0;yc<hc.length;yc++)gc+=hc[yc];return gc/hc.length}}),So.prototype={constructor:So,accumulate:function(gc,hc){var yc=this.buffer,xc=this.valueSize,vc=gc*xc+xc,_c=this.cumulativeWeight;if(0===_c){for(var Ec=0;Ec!==xc;++Ec)yc[vc+Ec]=yc[Ec];_c=hc}else{_c+=hc;var Tc=hc/_c;this._mixBufferRegion(yc,vc,0,Tc,xc)}this.cumulativeWeight=_c},apply:function(gc){var hc=this.valueSize,yc=this.buffer,xc=gc*hc+hc,vc=this.cumulativeWeight,_c=this.binding;if(this.cumulativeWeight=0,1>vc){this._mixBufferRegion(yc,xc,3*hc,1-vc,hc)}for(var Tc=hc;Tc!==hc+hc;++Tc)if(yc[Tc]!==yc[Tc+hc]){_c.setValue(yc,xc);break}},saveOriginalState:function(){var gc=this.binding,hc=this.buffer,yc=this.valueSize,xc=3*yc;gc.getValue(hc,xc);for(var vc=yc;vc!==xc;++vc)hc[vc]=hc[xc+vc%yc];this.cumulativeWeight=0},restoreOriginalState:function(){var gc=3*this.valueSize;this.binding.setValue(this.buffer,gc)},_select:function(gc,hc,yc,xc,vc){if(0.5<=xc)for(var _c=0;_c!==vc;++_c)gc[hc+_c]=gc[yc+_c]},_slerp:function(gc,hc,yc,xc){F.slerpFlat(gc,hc,gc,hc,gc,yc,xc)},_lerp:function(gc,hc,yc,xc,vc){for(var Ec=0,Tc;Ec!==vc;++Ec)Tc=hc+Ec,gc[Tc]=gc[Tc]*(1-xc)+gc[yc+Ec]*xc}},Lo.prototype={constructor:Lo,getValue:function(hc,yc){this.bind(),this.getValue(hc,yc)},setValue:function(hc,yc){this.bind(),this.setValue(hc,yc)},bind:function(){var gc=this.node,hc=this.parsedPath,yc=hc.objectName,xc=hc.propertyName,vc=hc.propertyIndex;if(gc||(gc=Lo.findNode(this.rootNode,hc.nodeName)||this.rootNode,this.node=gc),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!!gc){if(yc){var _c=hc.objectIndex;switch(yc){case'materials':if(!gc.material)return;if(!gc.material.materials)return;gc=gc.material.materials;break;case'bones':if(!gc.skeleton)return;gc=gc.skeleton.bones;for(var Ec=0;Ec<gc.length;Ec++)if(gc[Ec].name===_c){_c=Ec;break}break;default:if(void 0===gc[yc])return;gc=gc[yc];}if(void 0!==_c){if(void 0===gc[_c])return;gc=gc[_c]}}var Tc=gc[xc];if(void 0===Tc){hc.nodeName;return}var Sc=this.Versioning.None;void 0===gc.needsUpdate?void 0!==gc.matrixWorldNeedsUpdate&&(Sc=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=gc):(Sc=this.Versioning.NeedsUpdate,this.targetObject=gc);var Lc=this.BindingType.Direct;if(void 0!==vc){if('morphTargetInfluences'===xc){if(!gc.geometry)return;if(!gc.geometry.morphTargets)return;for(var Ec=0;Ec<this.node.geometry.morphTargets.length;Ec++)if(gc.geometry.morphTargets[Ec].name===vc){vc=Ec;break}}Lc=this.BindingType.ArrayElement,this.resolvedProperty=Tc,this.propertyIndex=vc}else void 0!==Tc.fromArray&&void 0!==Tc.toArray?(Lc=this.BindingType.HasFromToArray,this.resolvedProperty=Tc):void 0===Tc.length?this.propertyName=xc:(Lc=this.BindingType.EntireArray,this.resolvedProperty=Tc);this.getValue=this.GetterByBindingType[Lc],this.setValue=this.SetterByBindingTypeAndVersioning[Lc][Sc]}},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(Lo.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:Lo.prototype.getValue,_setValue_unbound:Lo.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(hc,yc){hc[yc]=this.node[this.propertyName]},function(hc,yc){for(var xc=this.resolvedProperty,vc=0,_c=xc.length;vc!==_c;++vc)hc[yc++]=xc[vc]},function(hc,yc){hc[yc]=this.resolvedProperty[this.propertyIndex]},function(hc,yc){this.resolvedProperty.toArray(hc,yc)}],SetterByBindingTypeAndVersioning:[[function(hc,yc){this.node[this.propertyName]=hc[yc]},function(hc,yc){this.node[this.propertyName]=hc[yc],this.targetObject.needsUpdate=!0},function(hc,yc){this.node[this.propertyName]=hc[yc],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(hc,yc){for(var xc=this.resolvedProperty,vc=0,_c=xc.length;vc!==_c;++vc)xc[vc]=hc[yc++]},function(hc,yc){for(var xc=this.resolvedProperty,vc=0,_c=xc.length;vc!==_c;++vc)xc[vc]=hc[yc++];this.targetObject.needsUpdate=!0},function(hc,yc){for(var xc=this.resolvedProperty,vc=0,_c=xc.length;vc!==_c;++vc)xc[vc]=hc[yc++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(hc,yc){this.resolvedProperty[this.propertyIndex]=hc[yc]},function(hc,yc){this.resolvedProperty[this.propertyIndex]=hc[yc],this.targetObject.needsUpdate=!0},function(hc,yc){this.resolvedProperty[this.propertyIndex]=hc[yc],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(hc,yc){this.resolvedProperty.fromArray(hc,yc)},function(hc,yc){this.resolvedProperty.fromArray(hc,yc),this.targetObject.needsUpdate=!0},function(hc,yc){this.resolvedProperty.fromArray(hc,yc),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),Lo.Composite=function(gc,hc,yc){var xc=yc||Lo.parseTrackName(hc);this._targetGroup=gc,this._bindings=gc.subscribe_(hc,xc)},Lo.Composite.prototype={constructor:Lo.Composite,getValue:function(gc,hc){this.bind();var yc=this._targetGroup.nCachedObjects_,xc=this._bindings[yc];xc!==void 0&&xc.getValue(gc,hc)},setValue:function(gc,hc){for(var yc=this._bindings,xc=this._targetGroup.nCachedObjects_,vc=yc.length;xc!==vc;++xc)yc[xc].setValue(gc,hc)},bind:function(){for(var gc=this._bindings,hc=this._targetGroup.nCachedObjects_,yc=gc.length;hc!==yc;++hc)gc[hc].bind()},unbind:function(){for(var gc=this._bindings,hc=this._targetGroup.nCachedObjects_,yc=gc.length;hc!==yc;++hc)gc[hc].unbind()}},Lo.create=function(gc,hc,yc){return gc&&gc.isAnimationObjectGroup?new Lo.Composite(gc,hc,yc):new Lo(gc,hc,yc)},Lo.parseTrackName=function(gc){var hc=/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/,yc=hc.exec(gc);if(!yc)throw new Error('cannot parse trackName at all: '+gc);var xc={nodeName:yc[2],objectName:yc[3],objectIndex:yc[4],propertyName:yc[5],propertyIndex:yc[6]};if(null===xc.propertyName||0===xc.propertyName.length)throw new Error('can not parse propertyName from trackName: '+gc);return xc},Lo.findNode=function(gc,hc){if(!hc||''===hc||'root'===hc||'.'===hc||-1===hc||hc===gc.name||hc===gc.uuid)return gc;if(gc.skeleton){var yc=function(Ec){for(var Tc=0,Mc;Tc<Ec.bones.length;Tc++)if(Mc=Ec.bones[Tc],Mc.name===hc)return Mc;return null},xc=yc(gc.skeleton);if(xc)return xc}if(gc.children){var vc=function(Ec){for(var Tc=0,Mc;Tc<Ec.length;Tc++){if(Mc=Ec[Tc],Mc.name===hc||Mc.uuid===hc)return Mc;var Sc=vc(Mc.children);if(Sc)return Sc}return null},_c=vc(gc.children);if(_c)return _c}return null},wo.prototype={constructor:wo,isAnimationObjectGroup:!0,add:function(){for(var hc=this._objects,yc=hc.length,xc=this.nCachedObjects_,vc=this._indicesByUUID,_c=this._paths,Ec=this._parsedPaths,Tc=this._bindings,Mc=Tc.length,Sc=0,Lc=arguments.length;Sc!==Lc;++Sc){var wc=arguments[Sc],Ac=wc.uuid,Rc=vc[Ac],Pc=void 0;if(Rc===void 0){Rc=yc++,vc[Ac]=Rc,hc.push(wc);for(var Cc=0,Ic=Mc;Cc!==Ic;++Cc)Tc[Cc].push(new Lo(wc,_c[Cc],Ec[Cc]))}else if(Rc<xc){Pc=hc[Rc];var Uc=--xc,Dc=hc[Uc];vc[Dc.uuid]=Rc,hc[Rc]=Dc,vc[Ac]=Uc,hc[Uc]=wc;for(var Cc=0,Ic=Mc;Cc!==Ic;++Cc){var zc=Tc[Cc],Nc=zc[Uc],Bc=zc[Rc];zc[Rc]=Nc,Bc===void 0&&(Bc=new Lo(wc,_c[Cc],Ec[Cc])),zc[Uc]=Bc}}else if(hc[Rc]!==Pc);}this.nCachedObjects_=xc},remove:function(){for(var hc=this._objects,yc=this.nCachedObjects_,xc=this._indicesByUUID,vc=this._bindings,_c=vc.length,Ec=0,Tc=arguments.length;Ec!==Tc;++Ec){var Mc=arguments[Ec],Sc=Mc.uuid,Lc=xc[Sc];if(Lc!==void 0&&Lc>=yc){var wc=yc++,Ac=hc[wc];xc[Ac.uuid]=Lc,hc[Lc]=Ac,xc[Sc]=wc,hc[wc]=Mc;for(var Rc=0;Rc!==_c;++Rc){var Cc=vc[Rc],Ic=Cc[wc],Uc=Cc[Lc];Cc[Lc]=Ic,Cc[wc]=Uc}}}this.nCachedObjects_=yc},uncache:function(){for(var hc=this._objects,yc=hc.length,xc=this.nCachedObjects_,vc=this._indicesByUUID,_c=this._bindings,Ec=_c.length,Tc=0,Mc=arguments.length;Tc!==Mc;++Tc){var Sc=arguments[Tc],Lc=Sc.uuid,wc=vc[Lc];if(void 0!==wc)if(delete vc[Lc],wc<xc){var Ac=--xc,Rc=hc[Ac],Pc=--yc,Cc=hc[Pc];vc[Rc.uuid]=wc,hc[wc]=Rc,vc[Cc.uuid]=Ac,hc[Ac]=Cc,hc.pop();for(var Ic=0,Uc=Ec;Ic!==Uc;++Ic){var Dc=_c[Ic],zc=Dc[Ac],Nc=Dc[Pc];Dc[wc]=zc,Dc[Ac]=Nc,Dc.pop()}}else{var Pc=--yc,Cc=hc[Pc];vc[Cc.uuid]=wc,hc[wc]=Cc,hc.pop();for(var Ic=0,Uc=Ec,Dc;Ic!==Uc;++Ic)Dc=_c[Ic],Dc[wc]=Dc[Pc],Dc.pop()}}this.nCachedObjects_=xc},subscribe_:function(gc,hc){var yc=this._bindingsIndicesByPath,xc=yc[gc],vc=this._bindings;if(xc!==void 0)return vc[xc];var _c=this._paths,Ec=this._parsedPaths,Tc=this._objects,Mc=Tc.length,Sc=this.nCachedObjects_,Lc=Array(Mc);xc=vc.length,yc[gc]=xc,_c.push(gc),Ec.push(hc),vc.push(Lc);for(var wc=Sc,Ac=Tc.length,Rc;wc!==Ac;++wc)Rc=Tc[wc],Lc[wc]=new Lo(Rc,gc,hc);return Lc},unsubscribe_:function(gc){var hc=this._bindingsIndicesByPath,yc=hc[gc];if(yc!==void 0){var xc=this._paths,vc=this._parsedPaths,_c=this._bindings,Ec=_c.length-1,Tc=_c[Ec],Mc=gc[Ec];hc[Mc]=yc,_c[yc]=Tc,_c.pop(),vc[yc]=vc[Ec],vc.pop(),xc[yc]=xc[Ec],xc.pop()}}},Ao.prototype={constructor:Ao,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(gc){return this._startTime=gc,this},setLoop:function(gc,hc){return this.loop=gc,this.repetitions=hc,this},setEffectiveWeight:function(gc){return this.weight=gc,this._effectiveWeight=this.enabled?gc:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(gc){return this._scheduleFading(gc,0,1)},fadeOut:function(gc){return this._scheduleFading(gc,1,0)},crossFadeFrom:function(gc,hc,yc){if(gc.fadeOut(hc),this.fadeIn(hc),yc){var xc=this._clip.duration,vc=gc._clip.duration;gc.warp(1,vc/xc,hc),this.warp(xc/vc,1,hc)}return this},crossFadeTo:function(gc,hc,yc){return gc.crossFadeFrom(this,hc,yc)},stopFading:function(){var gc=this._weightInterpolant;return null!==gc&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(gc)),this},setEffectiveTimeScale:function(gc){return this.timeScale=gc,this._effectiveTimeScale=this.paused?0:gc,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(gc){return this.timeScale=this._clip.duration/gc,this.stopWarping()},syncWith:function(gc){return this.time=gc.time,this.timeScale=gc.timeScale,this.stopWarping()},halt:function(gc){return this.warp(this._effectiveTimeScale,0,gc)},warp:function(gc,hc,yc){var xc=this._mixer,vc=xc.time,_c=this._timeScaleInterpolant,Ec=this.timeScale;null===_c&&(_c=xc._lendControlInterpolant(),this._timeScaleInterpolant=_c);var Tc=_c.parameterPositions,Mc=_c.sampleValues;return Tc[0]=vc,Tc[1]=vc+yc,Mc[0]=gc/Ec,Mc[1]=hc/Ec,this},stopWarping:function(){var gc=this._timeScaleInterpolant;return null!==gc&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(gc)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(gc,hc,yc,xc){var vc=this._startTime;if(null!==vc){var _c=(gc-vc)*yc;if(0>_c||0===yc)return;this._startTime=null,hc=yc*_c}hc*=this._updateTimeScale(gc);var Ec=this._updateTime(hc),Tc=this._updateWeight(gc);if(0<Tc)for(var Mc=this._interpolants,Sc=this._propertyBindings,Lc=0,wc=Mc.length;Lc!==wc;++Lc)Mc[Lc].evaluate(Ec),Sc[Lc].accumulate(xc,Tc)},_updateWeight:function(gc){var hc=0;if(this.enabled){hc=this.weight;var yc=this._weightInterpolant;if(null!==yc){var xc=yc.evaluate(gc)[0];hc*=xc,gc>yc.parameterPositions[1]&&(this.stopFading(),0===xc&&(this.enabled=!1))}}return this._effectiveWeight=hc,hc},_updateTimeScale:function(gc){var hc=0;if(!this.paused){hc=this.timeScale;var yc=this._timeScaleInterpolant;if(null!==yc){var xc=yc.evaluate(gc)[0];hc*=xc,gc>yc.parameterPositions[1]&&(this.stopWarping(),0===hc?this.paused=!0:this.timeScale=hc)}}return this._effectiveTimeScale=hc,hc},_updateTime:function(gc){var hc=this.time+gc;if(0===gc)return hc;var yc=this._clip.duration,xc=this.loop,vc=this._loopCount;if(xc===Gs){-1===vc&&(this._loopCount=0,this._setEndings(!0,!0,!1));handle_stop:{if(hc>=yc)hc=yc;else if(0>hc)hc=0;else break handle_stop;this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:'finished',action:this,direction:0>gc?-1:1})}}else{var _c=xc===Vs;if(-1===vc&&(0<=gc?(vc=0,this._setEndings(!0,0===this.repetitions,_c)):this._setEndings(0===this.repetitions,!0,_c)),hc>=yc||0>hc){var Ec=_Mathfloor(hc/yc);hc-=yc*Ec,vc+=_Mathabs(Ec);var Tc=this.repetitions-vc;if(0>Tc)this.clampWhenFinished?this.paused=!0:this.enabled=!1,hc=0<gc?yc:0,this._mixer.dispatchEvent({type:'finished',action:this,direction:0<gc?1:-1});else{if(0==Tc){var Mc=0>gc;this._setEndings(Mc,!Mc,_c)}else this._setEndings(!1,!1,_c);this._loopCount=vc,this._mixer.dispatchEvent({type:'loop',action:this,loopDelta:Ec})}}if(_c&&1==(1&vc))return this.time=hc,yc-hc}return this.time=hc,hc},_setEndings:function(gc,hc,yc){var xc=this._interpolantSettings;yc?(xc.endingStart=Ys,xc.endingEnd=Ys):(xc.endingStart=gc?this.zeroSlopeAtStart?Ys:Xs:qs,xc.endingEnd=hc?this.zeroSlopeAtEnd?Ys:Xs:qs)},_scheduleFading:function(gc,hc,yc){var xc=this._mixer,vc=xc.time,_c=this._weightInterpolant;null===_c&&(_c=xc._lendControlInterpolant(),this._weightInterpolant=_c);var Ec=_c.parameterPositions,Tc=_c.sampleValues;return Ec[0]=vc,Tc[0]=hc,Ec[1]=vc+gc,Tc[1]=yc,this}},Ro.prototype={constructor:Ro,clipAction:function(gc,hc){var yc=hc||this._root,xc=yc.uuid,vc='string'==typeof gc?Oa.findByName(yc,gc):gc,_c=null===vc?gc:vc.uuid,Ec=this._actionsByClip[_c],Tc=null;if(void 0!==Ec){var Mc=Ec.actionByRoot[xc];if(void 0!==Mc)return Mc;Tc=Ec.knownActions[0],null===vc&&(vc=Tc._clip)}if(null===vc)return null;var Sc=new Ao(this,vc,hc);return this._bindAction(Sc,Tc),this._addInactiveAction(Sc,_c,xc),Sc},existingAction:function(gc,hc){var yc=hc||this._root,xc=yc.uuid,vc='string'==typeof gc?Oa.findByName(yc,gc):gc,_c=vc?vc.uuid:gc,Ec=this._actionsByClip[_c];return void 0===Ec?null:Ec.actionByRoot[xc]||null},stopAllAction:function(){var gc=this._actions,hc=this._nActiveActions,yc=this._bindings,xc=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var vc=0;vc!==hc;++vc)gc[vc].reset();for(var vc=0;vc!==xc;++vc)yc[vc].useCount=0;return this},update:function(gc){gc*=this.timeScale;for(var hc=this._actions,yc=this._nActiveActions,xc=this.time+=gc,vc=_Mathsign(gc),_c=this._accuIndex^=1,Ec=0,Tc;Ec!==yc;++Ec)Tc=hc[Ec],Tc.enabled&&Tc._update(xc,gc,vc,_c);for(var Mc=this._bindings,Sc=this._nActiveBindings,Ec=0;Ec!==Sc;++Ec)Mc[Ec].apply(_c);return this},getRoot:function(){return this._root},uncacheClip:function(gc){var hc=this._actions,yc=gc.uuid,xc=this._actionsByClip,vc=xc[yc];if(vc!==void 0){for(var _c=vc.knownActions,Ec=0,Tc=_c.length,Mc;Ec!==Tc;++Ec){Mc=_c[Ec],this._deactivateAction(Mc);var Sc=Mc._cacheIndex,Lc=hc[hc.length-1];Mc._cacheIndex=null,Mc._byClipCacheIndex=null,Lc._cacheIndex=Sc,hc[Sc]=Lc,hc.pop(),this._removeInactiveBindingsForAction(Mc)}delete xc[yc]}},uncacheRoot:function(gc){var hc=gc.uuid,yc=this._actionsByClip;for(var xc in yc){var vc=yc[xc].actionByRoot,_c=vc[hc];_c!==void 0&&(this._deactivateAction(_c),this._removeInactiveAction(_c))}var Ec=this._bindingsByRootAndName,Tc=Ec[hc];if(Tc!==void 0)for(var Mc in Tc){var Sc=Tc[Mc];Sc.restoreOriginalState(),this._removeInactiveBinding(Sc)}},uncacheAction:function(gc,hc){var yc=this.existingAction(gc,hc);null!==yc&&(this._deactivateAction(yc),this._removeInactiveAction(yc))}},Object.assign(Ro.prototype,{_bindAction:function(gc,hc){var yc=gc._localRoot||this._root,xc=gc._clip.tracks,vc=xc.length,_c=gc._propertyBindings,Ec=gc._interpolants,Tc=yc.uuid,Mc=this._bindingsByRootAndName,Sc=Mc[Tc];Sc===void 0&&(Sc={},Mc[Tc]=Sc);for(var Lc=0;Lc!==vc;++Lc){var wc=xc[Lc],Ac=wc.name,Rc=Sc[Ac];if(void 0!==Rc)_c[Lc]=Rc;else{if(Rc=_c[Lc],void 0!==Rc){null===Rc._cacheIndex&&(++Rc.referenceCount,this._addInactiveBinding(Rc,Tc,Ac));continue}var Pc=hc&&hc._propertyBindings[Lc].binding.parsedPath;Rc=new So(Lo.create(yc,Ac,Pc),wc.ValueTypeName,wc.getValueSize()),++Rc.referenceCount,this._addInactiveBinding(Rc,Tc,Ac),_c[Lc]=Rc}Ec[Lc].resultBuffer=Rc.buffer}},_activateAction:function(gc){if(!this._isActiveAction(gc)){if(null===gc._cacheIndex){var hc=(gc._localRoot||this._root).uuid,yc=gc._clip.uuid,xc=this._actionsByClip[yc];this._bindAction(gc,xc&&xc.knownActions[0]),this._addInactiveAction(gc,yc,hc)}for(var vc=gc._propertyBindings,_c=0,Ec=vc.length,Tc;_c!==Ec;++_c)Tc=vc[_c],0==Tc.useCount++&&(this._lendBinding(Tc),Tc.saveOriginalState());this._lendAction(gc)}},_deactivateAction:function(gc){if(this._isActiveAction(gc)){for(var hc=gc._propertyBindings,yc=0,xc=hc.length,vc;yc!==xc;++yc)vc=hc[yc],0==--vc.useCount&&(vc.restoreOriginalState(),this._takeBackBinding(vc));this._takeBackAction(gc)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var gc=this;this.stats={actions:{get total(){return gc._actions.length},get inUse(){return gc._nActiveActions}},bindings:{get total(){return gc._bindings.length},get inUse(){return gc._nActiveBindings}},controlInterpolants:{get total(){return gc._controlInterpolants.length},get inUse(){return gc._nActiveControlInterpolants}}}},_isActiveAction:function(gc){var hc=gc._cacheIndex;return null!==hc&&hc<this._nActiveActions},_addInactiveAction:function(gc,hc,yc){var xc=this._actions,vc=this._actionsByClip,_c=vc[hc];if(_c===void 0)_c={knownActions:[gc],actionByRoot:{}},gc._byClipCacheIndex=0,vc[hc]=_c;else{var Ec=_c.knownActions;gc._byClipCacheIndex=Ec.length,Ec.push(gc)}gc._cacheIndex=xc.length,xc.push(gc),_c.actionByRoot[yc]=gc},_removeInactiveAction:function(gc){var hc=this._actions,yc=hc[hc.length-1],xc=gc._cacheIndex;yc._cacheIndex=xc,hc[xc]=yc,hc.pop(),gc._cacheIndex=null;var vc=gc._clip.uuid,_c=this._actionsByClip,Ec=_c[vc],Tc=Ec.knownActions,Mc=Tc[Tc.length-1],Sc=gc._byClipCacheIndex;Mc._byClipCacheIndex=Sc,Tc[Sc]=Mc,Tc.pop(),gc._byClipCacheIndex=null;var Lc=Ec.actionByRoot,wc=(hc._localRoot||this._root).uuid;delete Lc[wc],0===Tc.length&&delete _c[vc],this._removeInactiveBindingsForAction(gc)},_removeInactiveBindingsForAction:function(gc){for(var hc=gc._propertyBindings,yc=0,xc=hc.length,vc;yc!==xc;++yc)vc=hc[yc],0==--vc.referenceCount&&this._removeInactiveBinding(vc)},_lendAction:function(gc){var hc=this._actions,yc=gc._cacheIndex,xc=this._nActiveActions++,vc=hc[xc];gc._cacheIndex=xc,hc[xc]=gc,vc._cacheIndex=yc,hc[yc]=vc},_takeBackAction:function(gc){var hc=this._actions,yc=gc._cacheIndex,xc=--this._nActiveActions,vc=hc[xc];gc._cacheIndex=xc,hc[xc]=gc,vc._cacheIndex=yc,hc[yc]=vc},_addInactiveBinding:function(gc,hc,yc){var xc=this._bindingsByRootAndName,vc=xc[hc],_c=this._bindings;vc===void 0&&(vc={},xc[hc]=vc),vc[yc]=gc,gc._cacheIndex=_c.length,_c.push(gc)},_removeInactiveBinding:function(gc){var hc=this._bindings,yc=gc.binding,xc=yc.rootNode.uuid,vc=yc.path,_c=this._bindingsByRootAndName,Ec=_c[xc],Tc=hc[hc.length-1],Mc=gc._cacheIndex;Tc._cacheIndex=Mc,hc[Mc]=Tc,hc.pop(),delete Ec[vc];remove_empty_map:{for(var Sc in Ec)break remove_empty_map;delete _c[xc]}},_lendBinding:function(gc){var hc=this._bindings,yc=gc._cacheIndex,xc=this._nActiveBindings++,vc=hc[xc];gc._cacheIndex=xc,hc[xc]=gc,vc._cacheIndex=yc,hc[yc]=vc},_takeBackBinding:function(gc){var hc=this._bindings,yc=gc._cacheIndex,xc=--this._nActiveBindings,vc=hc[xc];gc._cacheIndex=xc,hc[xc]=gc,vc._cacheIndex=yc,hc[yc]=vc},_lendControlInterpolant:function(){var gc=this._controlInterpolants,hc=this._nActiveControlInterpolants++,yc=gc[hc];return void 0===yc&&(yc=new Aa(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),yc.__cacheIndex=hc,gc[hc]=yc),yc},_takeBackControlInterpolant:function(gc){var hc=this._controlInterpolants,yc=gc.__cacheIndex,xc=--this._nActiveControlInterpolants,vc=hc[xc];gc.__cacheIndex=xc,hc[xc]=gc,vc.__cacheIndex=yc,hc[yc]=vc},_controlInterpolantsResultBuffer:new Float32Array(1)}),Object.assign(Ro.prototype,A.prototype),Po.prototype.clone=function(){return new Po(this.value.clone===void 0?this.value:this.value.clone())},Co.prototype=Object.create(gt.prototype),Co.prototype.constructor=Co,Co.prototype.isInstancedBufferGeometry=!0,Co.prototype.addGroup=function(gc,hc,yc){this.groups.push({start:gc,count:hc,materialIndex:yc})},Co.prototype.copy=function(gc){var hc=gc.index;null!==hc&&this.setIndex(hc.clone());var yc=gc.attributes;for(var xc in yc){var vc=yc[xc];this.addAttribute(xc,vc.clone())}for(var _c=gc.groups,Ec=0,Tc=_c.length,Mc;Ec<Tc;Ec++)Mc=_c[Ec],this.addGroup(Mc.start,Mc.count,Mc.materialIndex);return this},Io.prototype={constructor:Io,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(gc,hc){return this.data.array[gc*this.data.stride+this.offset]=hc,this},setY:function(gc,hc){return this.data.array[gc*this.data.stride+this.offset+1]=hc,this},setZ:function(gc,hc){return this.data.array[gc*this.data.stride+this.offset+2]=hc,this},setW:function(gc,hc){return this.data.array[gc*this.data.stride+this.offset+3]=hc,this},getX:function(gc){return this.data.array[gc*this.data.stride+this.offset]},getY:function(gc){return this.data.array[gc*this.data.stride+this.offset+1]},getZ:function(gc){return this.data.array[gc*this.data.stride+this.offset+2]},getW:function(gc){return this.data.array[gc*this.data.stride+this.offset+3]},setXY:function(gc,hc,yc){return gc=gc*this.data.stride+this.offset,this.data.array[gc+0]=hc,this.data.array[gc+1]=yc,this},setXYZ:function(gc,hc,yc,xc){return gc=gc*this.data.stride+this.offset,this.data.array[gc+0]=hc,this.data.array[gc+1]=yc,this.data.array[gc+2]=xc,this},setXYZW:function(gc,hc,yc,xc,vc){return gc=gc*this.data.stride+this.offset,this.data.array[gc+0]=hc,this.data.array[gc+1]=yc,this.data.array[gc+2]=xc,this.data.array[gc+3]=vc,this}},Uo.prototype={constructor:Uo,isInterleavedBuffer:!0,set needsUpdate(gc){!0===gc&&this.version++},setArray:function(gc){if(Array.isArray(gc))throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');this.count=gc===void 0?0:gc.length/this.stride,this.array=gc},setDynamic:function(gc){return this.dynamic=gc,this},copy:function(gc){return this.array=new gc.array.constructor(gc.array),this.count=gc.count,this.stride=gc.stride,this.dynamic=gc.dynamic,this},copyAt:function(gc,hc,yc){gc*=this.stride,yc*=hc.stride;for(var xc=0,vc=this.stride;xc<vc;xc++)this.array[gc+xc]=hc.array[yc+xc];return this},set:function(gc,hc){return void 0===hc&&(hc=0),this.array.set(gc,hc),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(gc){return this.onUploadCallback=gc,this}},Do.prototype=Object.create(Uo.prototype),Do.prototype.constructor=Do,Do.prototype.isInstancedInterleavedBuffer=!0,Do.prototype.copy=function(gc){return Uo.prototype.copy.call(this,gc),this.meshPerAttribute=gc.meshPerAttribute,this},zo.prototype=Object.create(et.prototype),zo.prototype.constructor=zo,zo.prototype.isInstancedBufferAttribute=!0,zo.prototype.copy=function(gc){return et.prototype.copy.call(this,gc),this.meshPerAttribute=gc.meshPerAttribute,this},No.prototype={constructor:No,linePrecision:1,set:function(gc,hc){this.ray.set(gc,hc)},setFromCamera:function(gc,hc){hc&&hc.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(hc.matrixWorld),this.ray.direction.set(gc.x,gc.y,0.5).unproject(hc).sub(this.ray.origin).normalize()):hc&&hc.isOrthographicCamera?(this.ray.origin.set(gc.x,gc.y,(hc.near+hc.far)/(hc.near-hc.far)).unproject(hc),this.ray.direction.set(0,0,-1).transformDirection(hc.matrixWorld)):void 0},intersectObject:function(gc,hc){var yc=[];return Fo(gc,this,yc,hc),yc.sort(Bo),yc},intersectObjects:function(gc,hc){var yc=[];if(!1===Array.isArray(gc))return yc;for(var xc=0,vc=gc.length;xc<vc;xc++)Fo(gc[xc],this,yc,hc);return yc.sort(Bo),yc}},Oo.prototype={constructor:Oo,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var gc=0;if(this.autoStart&&!this.running&&this.start(),this.running){var hc=(performance||Date).now();gc=(hc-this.oldTime)/1e3,this.oldTime=hc,this.elapsedTime+=gc}return gc}},Go.prototype={constructor:Go,set:function(gc,hc,yc){return this.radius=gc,this.phi=hc,this.theta=yc,this},clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.radius=gc.radius,this.phi=gc.phi,this.theta=gc.theta,this},makeSafe:function(){var gc=1e-6;return this.phi=_Mathmax(gc,_Mathmin(_MathPI-gc,this.phi)),this},setFromVector3:function(gc){return this.radius=gc.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=_Mathatan(gc.x,gc.z),this.phi=_Mathacos(xl.clamp(gc.y/this.radius,-1,1))),this}},Ho.prototype={constructor:Ho,set:function(gc,hc,yc){return this.radius=gc,this.theta=hc,this.y=yc,this},clone:function(){return new this.constructor().copy(this)},copy:function(gc){return this.radius=gc.radius,this.theta=gc.theta,this.y=gc.y,this},setFromVector3:function(gc){return this.radius=_Mathsqrt(gc.x*gc.x+gc.z*gc.z),this.theta=_Mathatan(gc.x,gc.z),this.y=gc.y,this}},Vo.prototype=Object.create(ht.prototype),Vo.prototype.constructor=Vo,Vo.prototype.createAnimation=function(gc,hc,yc,xc){var vc={start:hc,end:yc,length:yc-hc+1,fps:xc,duration:(yc-hc)/xc,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[gc]=vc,this.animationsList.push(vc)},Vo.prototype.autoCreateAnimations=function(gc){for(var hc=/([a-z]+)_?(\d+)/i,xc={},vc=this.geometry,_c=0,Ec=vc.morphTargets.length,yc;_c<Ec;_c++){var Tc=vc.morphTargets[_c],Mc=Tc.name.match(hc);if(Mc&&1<Mc.length){var Sc=Mc[1];xc[Sc]||(xc[Sc]={start:Infinity,end:-Infinity});var Lc=xc[Sc];_c<Lc.start&&(Lc.start=_c),_c>Lc.end&&(Lc.end=_c),yc||(yc=Sc)}}for(var Sc in xc){var Lc=xc[Sc];this.createAnimation(Sc,Lc.start,Lc.end,gc)}this.firstAnimation=yc},Vo.prototype.setAnimationDirectionForward=function(gc){var hc=this.animationsMap[gc];hc&&(hc.direction=1,hc.directionBackwards=!1)},Vo.prototype.setAnimationDirectionBackward=function(gc){var hc=this.animationsMap[gc];hc&&(hc.direction=-1,hc.directionBackwards=!0)},Vo.prototype.setAnimationFPS=function(gc,hc){var yc=this.animationsMap[gc];yc&&(yc.fps=hc,yc.duration=(yc.end-yc.start)/yc.fps)},Vo.prototype.setAnimationDuration=function(gc,hc){var yc=this.animationsMap[gc];yc&&(yc.duration=hc,yc.fps=(yc.end-yc.start)/yc.duration)},Vo.prototype.setAnimationWeight=function(gc,hc){var yc=this.animationsMap[gc];yc&&(yc.weight=hc)},Vo.prototype.setAnimationTime=function(gc,hc){var yc=this.animationsMap[gc];yc&&(yc.time=hc)},Vo.prototype.getAnimationTime=function(gc){var hc=0,yc=this.animationsMap[gc];return yc&&(hc=yc.time),hc},Vo.prototype.getAnimationDuration=function(gc){var hc=-1,yc=this.animationsMap[gc];return yc&&(hc=yc.duration),hc},Vo.prototype.playAnimation=function(gc){var hc=this.animationsMap[gc];hc?(hc.time=0,hc.active=!0):void 0},Vo.prototype.stopAnimation=function(gc){var hc=this.animationsMap[gc];hc&&(hc.active=!1)},Vo.prototype.update=function(gc){for(var hc=0,yc=this.animationsList.length,xc;hc<yc;hc++)if(xc=this.animationsList[hc],xc.active){var vc=xc.duration/xc.length;xc.time+=xc.direction*gc,xc.mirroredLoop?(xc.time>xc.duration||0>xc.time)&&(xc.direction*=-1,xc.time>xc.duration&&(xc.time=xc.duration,xc.directionBackwards=!0),0>xc.time&&(xc.time=0,xc.directionBackwards=!1)):(xc.time%=xc.duration,0>xc.time&&(xc.time+=xc.duration));var _c=xc.start+xl.clamp(_Mathfloor(xc.time/vc),0,xc.length-1),Ec=xc.weight;_c!==xc.currentFrame&&(this.morphTargetInfluences[xc.lastFrame]=0,this.morphTargetInfluences[xc.currentFrame]=1*Ec,this.morphTargetInfluences[_c]=0,xc.lastFrame=xc.currentFrame,xc.currentFrame=_c);var Tc=xc.time%vc/vc;xc.directionBackwards&&(Tc=1-Tc),xc.currentFrame===xc.lastFrame?this.morphTargetInfluences[xc.currentFrame]=Ec:(this.morphTargetInfluences[xc.currentFrame]=Tc*Ec,this.morphTargetInfluences[xc.lastFrame]=(1-Tc)*Ec)}},ko.prototype=Object.create(Ze.prototype),ko.prototype.constructor=ko,ko.prototype.isImmediateRenderObject=!0,Wo.prototype=Object.create(pr.prototype),Wo.prototype.constructor=Wo,Wo.prototype.update=function(){var gc=new O,hc=new O,yc=new Ve;return function(){var vc=['a','b','c'];this.object.updateMatrixWorld(!0),yc.getNormalMatrix(this.object.matrixWorld);var _c=this.object.matrixWorld,Ec=this.geometry.attributes.position,Tc=this.object.geometry;if(Tc&&Tc.isGeometry)for(var Mc=Tc.vertices,Sc=Tc.faces,Lc=0,wc=0,Ac=Sc.length,Rc;wc<Ac;wc++){Rc=Sc[wc];for(var Pc=0,Cc=Rc.vertexNormals.length;Pc<Cc;Pc++){var Ic=Mc[Rc[vc[Pc]]],Uc=Rc.vertexNormals[Pc];gc.copy(Ic).applyMatrix4(_c),hc.copy(Uc).applyMatrix3(yc).normalize().multiplyScalar(this.size).add(gc),Ec.setXYZ(Lc,gc.x,gc.y,gc.z),++Lc,Ec.setXYZ(Lc,hc.x,hc.y,hc.z),++Lc}}else if(Tc&&Tc.isBufferGeometry)for(var Dc=Tc.attributes.position,zc=Tc.attributes.normal,Lc=0,Pc=0,Cc=Dc.count;Pc<Cc;Pc++)gc.set(Dc.getX(Pc),Dc.getY(Pc),Dc.getZ(Pc)).applyMatrix4(_c),hc.set(zc.getX(Pc),zc.getY(Pc),zc.getZ(Pc)),hc.applyMatrix3(yc).normalize().multiplyScalar(this.size).add(gc),Ec.setXYZ(Lc,gc.x,gc.y,gc.z),++Lc,Ec.setXYZ(Lc,hc.x,hc.y,hc.z),++Lc;return Ec.needsUpdate=!0,this}}(),jo.prototype=Object.create(Ze.prototype),jo.prototype.constructor=jo,jo.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},jo.prototype.update=function(){var gc=new O,hc=new O;return function(){var xc=this.light.distance?this.light.distance:1e3,vc=xc*_Mathtan(this.light.angle);this.cone.scale.set(vc,vc,xc),gc.setFromMatrixPosition(this.light.matrixWorld),hc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hc.sub(gc)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),Xo.prototype=Object.create(pr.prototype),Xo.prototype.constructor=Xo,Xo.prototype.getBoneList=function(gc){var hc=[];gc&&gc.isBone&&hc.push(gc);for(var yc=0;yc<gc.children.length;yc++)hc.push.apply(hc,this.getBoneList(gc.children[yc]));return hc},Xo.prototype.update=function(){var gc=new O,hc=new G,yc=new G;return function(){var vc=this.geometry,_c=vc.getAttribute('position');yc.getInverse(this.root.matrixWorld);for(var Ec=0,Tc=0,Mc;Ec<this.bones.length;Ec++)Mc=this.bones[Ec],Mc.parent&&Mc.parent.isBone&&(hc.multiplyMatrices(yc,Mc.matrixWorld),gc.setFromMatrixPosition(hc),_c.setXYZ(Tc,gc.x,gc.y,gc.z),hc.multiplyMatrices(yc,Mc.parent.matrixWorld),gc.setFromMatrixPosition(hc),_c.setXYZ(Tc+1,gc.x,gc.y,gc.z),Tc+=2);vc.getAttribute('position').needsUpdate=!0}}(),Yo.prototype=Object.create(ht.prototype),Yo.prototype.constructor=Yo,Yo.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Yo.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},qo.prototype=Object.create(Ze.prototype),qo.prototype.constructor=qo,qo.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose(),this.children[1].geometry.dispose(),this.children[1].material.dispose()},qo.prototype.update=function(){var gc=new O,hc=new O;return function(){var xc=this.children[0],vc=this.children[1];if(this.light.target){gc.setFromMatrixPosition(this.light.matrixWorld),hc.setFromMatrixPosition(this.light.target.matrixWorld);var _c=hc.clone().sub(gc);xc.lookAt(_c),vc.lookAt(_c)}xc.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),vc.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var Ec=0.5*this.light.width,Tc=0.5*this.light.height,Mc=xc.geometry.getAttribute('position'),Sc=Mc.array;Sc[0]=Ec,Sc[1]=-Tc,Sc[2]=0,Sc[3]=Ec,Sc[4]=Tc,Sc[5]=0,Sc[6]=-Ec,Sc[7]=Tc,Sc[8]=0,Sc[9]=-Ec,Sc[10]=Tc,Sc[11]=0,Sc[12]=-Ec,Sc[13]=-Tc,Sc[14]=0,Sc[15]=Ec,Sc[16]=-Tc,Sc[17]=0,Mc.needsUpdate=!0}}(),Zo.prototype=Object.create(Ze.prototype),Zo.prototype.constructor=Zo,Zo.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Zo.prototype.update=function(){var gc=new O,hc=new Ie,yc=new Ie;return function(){var vc=this.children[0],_c=vc.geometry.getAttribute('color');hc.copy(this.light.color).multiplyScalar(this.light.intensity),yc.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var Ec=0,Tc=_c.count,Mc;Ec<Tc;Ec++)Mc=Ec<Tc/2?hc:yc,_c.setXYZ(Ec,Mc.r,Mc.g,Mc.b);vc.lookAt(gc.setFromMatrixPosition(this.light.matrixWorld).negate()),_c.needsUpdate=!0}}(),Ko.prototype=Object.create(pr.prototype),Ko.prototype.constructor=Ko,Jo.prototype=Object.create(pr.prototype),Jo.prototype.constructor=Jo,Qo.prototype=Object.create(pr.prototype),Qo.prototype.constructor=Qo,Qo.prototype.update=function(){var gc=new O,hc=new O,yc=new Ve;return function(){this.object.updateMatrixWorld(!0),yc.getNormalMatrix(this.object.matrixWorld);for(var vc=this.object.matrixWorld,_c=this.geometry.attributes.position,Ec=this.object.geometry,Tc=Ec.vertices,Mc=Ec.faces,Sc=0,Lc=0,wc=Mc.length;Lc<wc;Lc++){var Ac=Mc[Lc],Rc=Ac.normal;gc.copy(Tc[Ac.a]).add(Tc[Ac.b]).add(Tc[Ac.c]).divideScalar(3).applyMatrix4(vc),hc.copy(Rc).applyMatrix3(yc).normalize().multiplyScalar(this.size).add(gc),_c.setXYZ(Sc,gc.x,gc.y,gc.z),++Sc,_c.setXYZ(Sc,hc.x,hc.y,hc.z),++Sc}return _c.needsUpdate=!0,this}}(),$o.prototype=Object.create(Ze.prototype),$o.prototype.constructor=$o,$o.prototype.dispose=function(){var gc=this.children[0],hc=this.children[1];gc.geometry.dispose(),gc.material.dispose(),hc.geometry.dispose(),hc.material.dispose()},$o.prototype.update=function(){var gc=new O,hc=new O,yc=new O;return function(){gc.setFromMatrixPosition(this.light.matrixWorld),hc.setFromMatrixPosition(this.light.target.matrixWorld),yc.subVectors(hc,gc);var vc=this.children[0],_c=this.children[1];vc.lookAt(yc),vc.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),_c.lookAt(yc),_c.scale.z=yc.length()}}(),ei.prototype=Object.create(pr.prototype),ei.prototype.constructor=ei,ei.prototype.update=function(){function gc(_c,Ec,Tc,Mc){xc.set(Ec,Tc,Mc).unproject(vc);var Sc=yc[_c];if(Sc!==void 0)for(var Lc=hc.getAttribute('position'),wc=0,Ac=Sc.length;wc<Ac;wc++)Lc.setXYZ(Sc[wc],xc.x,xc.y,xc.z)}var hc,yc,xc=new O,vc=new Et;return function(){hc=this.geometry,yc=this.pointMap;var Ec=1,Tc=1;vc.projectionMatrix.copy(this.camera.projectionMatrix),gc('c',0,0,-1),gc('t',0,0,1),gc('n1',-Ec,-Tc,-1),gc('n2',Ec,-Tc,-1),gc('n3',-Ec,Tc,-1),gc('n4',Ec,Tc,-1),gc('f1',-Ec,-Tc,1),gc('f2',Ec,-Tc,1),gc('f3',-Ec,Tc,1),gc('f4',Ec,Tc,1),gc('u1',0.7*Ec,1.1*Tc,-1),gc('u2',0.7*-Ec,1.1*Tc,-1),gc('u3',0,2*Tc,-1),gc('cf1',-Ec,0,1),gc('cf2',Ec,0,1),gc('cf3',0,-Tc,1),gc('cf4',0,Tc,1),gc('cn1',-Ec,0,-1),gc('cn2',Ec,0,-1),gc('cn3',0,-Tc,-1),gc('cn4',0,Tc,-1),hc.getAttribute('position').needsUpdate=!0}}(),ti.prototype=Object.create(pr.prototype),ti.prototype.constructor=ti,ti.prototype.update=function(){var gc=new Ge;return function(yc){if(yc&&yc.isBox3?gc.copy(yc):gc.setFromObject(yc),!gc.isEmpty()){var xc=gc.min,vc=gc.max,_c=this.geometry.attributes.position,Ec=_c.array;Ec[0]=vc.x,Ec[1]=vc.y,Ec[2]=vc.z,Ec[3]=xc.x,Ec[4]=vc.y,Ec[5]=vc.z,Ec[6]=xc.x,Ec[7]=xc.y,Ec[8]=vc.z,Ec[9]=vc.x,Ec[10]=xc.y,Ec[11]=vc.z,Ec[12]=vc.x,Ec[13]=vc.y,Ec[14]=xc.z,Ec[15]=xc.x,Ec[16]=vc.y,Ec[17]=xc.z,Ec[18]=xc.x,Ec[19]=xc.y,Ec[20]=xc.z,Ec[21]=vc.x,Ec[22]=xc.y,Ec[23]=xc.z,_c.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}();var oc,ic;ri.prototype=Object.create(Ze.prototype),ri.prototype.constructor=ri,ri.prototype.setDirection=function(){var gc=new O,hc;return function(xc){0.99999<xc.y?this.quaternion.set(0,0,0,1):-0.99999>xc.y?this.quaternion.set(1,0,0,0):(gc.set(xc.z,0,-xc.x).normalize(),hc=_Mathacos(xc.y),this.quaternion.setFromAxisAngle(gc,hc))}}(),ri.prototype.setLength=function(gc,hc,yc){hc===void 0&&(hc=0.2*gc),yc===void 0&&(yc=0.2*hc),this.line.scale.set(1,_Mathmax(0,gc-hc),1),this.line.updateMatrix(),this.cone.scale.set(yc,hc,yc),this.cone.position.y=gc,this.cone.updateMatrix()},ri.prototype.setColor=function(gc){this.line.material.color.copy(gc),this.cone.material.color.copy(gc)},ai.prototype=Object.create(pr.prototype),ai.prototype.constructor=ai;var nc=new O,sc=new oi,lc=new oi,dc=new oi;ii.prototype=Object.create(ao.prototype),ii.prototype.constructor=ii,ii.prototype.getPoint=function(gc){var hc=this.points,yc=hc.length;var xc=(yc-(this.closed?0:1))*gc,vc=_Mathfloor(xc),_c=xc-vc;this.closed?vc+=0<vc?0:(_Mathfloor(_Mathabs(vc)/hc.length)+1)*hc.length:0==_c&&vc===yc-1&&(vc=yc-2,_c=1);var Ec,Tc,Mc,Sc;if(this.closed||0<vc?Ec=hc[(vc-1)%yc]:(nc.subVectors(hc[0],hc[1]).add(hc[0]),Ec=nc),Tc=hc[vc%yc],Mc=hc[(vc+1)%yc],this.closed||vc+2<yc?Sc=hc[(vc+2)%yc]:(nc.subVectors(hc[yc-1],hc[yc-2]).add(hc[yc-1]),Sc=nc),void 0===this.type||'centripetal'===this.type||'chordal'===this.type){var Lc='chordal'===this.type?0.5:0.25,wc=_Mathpow(Ec.distanceToSquared(Tc),Lc),Ac=_Mathpow(Tc.distanceToSquared(Mc),Lc),Rc=_Mathpow(Mc.distanceToSquared(Sc),Lc);1e-4>Ac&&(Ac=1),1e-4>wc&&(wc=Ac),1e-4>Rc&&(Rc=Ac),sc.initNonuniformCatmullRom(Ec.x,Tc.x,Mc.x,Sc.x,wc,Ac,Rc),lc.initNonuniformCatmullRom(Ec.y,Tc.y,Mc.y,Sc.y,wc,Ac,Rc),dc.initNonuniformCatmullRom(Ec.z,Tc.z,Mc.z,Sc.z,wc,Ac,Rc)}else if('catmullrom'===this.type){var Pc=void 0===this.tension?0.5:this.tension;sc.initCatmullRom(Ec.x,Tc.x,Mc.x,Sc.x,Pc),lc.initCatmullRom(Ec.y,Tc.y,Mc.y,Sc.y,Pc),dc.initCatmullRom(Ec.z,Tc.z,Mc.z,Sc.z,Pc)}return new O(sc.calc(_c),lc.calc(_c),dc.calc(_c))},ni.prototype=Object.create(ao.prototype),ni.prototype.constructor=ni,ni.prototype.getPoint=function(gc){var hc=this.v0,yc=this.v1,xc=this.v2,vc=this.v3;return new O(ro(gc,hc.x,yc.x,xc.x,vc.x),ro(gc,hc.y,yc.y,xc.y,vc.y),ro(gc,hc.z,yc.z,xc.z,vc.z))},si.prototype=Object.create(ao.prototype),si.prototype.constructor=si,si.prototype.getPoint=function(gc){var hc=this.v0,yc=this.v1,xc=this.v2;return new O(Ka(gc,hc.x,yc.x,xc.x),Ka(gc,hc.y,yc.y,xc.y),Ka(gc,hc.z,yc.z,xc.z))},li.prototype=Object.create(ao.prototype),li.prototype.constructor=li,li.prototype.getPoint=function(gc){if(1===gc)return this.v2.clone();var hc=new O;return hc.subVectors(this.v2,this.v1),hc.multiplyScalar(gc),hc.add(this.v1),hc},di.prototype=Object.create(no.prototype),di.prototype.constructor=di;ao.create=function(gc,hc){return gc.prototype=Object.create(ao.prototype),gc.prototype.constructor=gc,gc.prototype.getPoint=hc,gc},Pi.prototype=Object.create(ii.prototype),Ci.prototype=Object.create(ii.prototype),Ii.prototype=Object.create(ii.prototype),Object.assign(Ii.prototype,{initFromArray:function(){},getControlPointsArray:function(){},reparametrizeByArcLength:function(){}}),Ko.prototype.setColors=function(){},Object.assign(De.prototype,{center:function(gc){return this.getCenter(gc)},empty:function(){return this.isEmpty()},isIntersectionBox:function(gc){return this.intersectsBox(gc)},size:function(gc){return this.getSize(gc)}}),Object.assign(Ge.prototype,{center:function(gc){return this.getCenter(gc)},empty:function(){return this.isEmpty()},isIntersectionBox:function(gc){return this.intersectsBox(gc)},isIntersectionSphere:function(gc){return this.intersectsSphere(gc)},size:function(gc){return this.getSize(gc)}}),Ke.prototype.center=function(gc){return this.getCenter(gc)},xl.random16=function(){return Math.random()},Object.assign(Ve.prototype,{flattenToArrayOffset:function(gc,hc){return this.toArray(gc,hc)},multiplyVector3:function(gc){return gc.applyMatrix3(this)},multiplyVector3Array:function(gc){return this.applyToVector3Array(gc)},applyToBuffer:function(gc){return this.applyToBufferAttribute(gc)},applyToVector3Array:function(){}}),Object.assign(G.prototype,{extractPosition:function(gc){return this.copyPosition(gc)},flattenToArrayOffset:function(gc,hc){return this.toArray(gc,hc)},getPosition:function(){var gc;return function(){return void 0==gc&&(gc=new O),gc.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(gc){return this.makeRotationFromQuaternion(gc)},multiplyVector3:function(gc){return gc.applyMatrix4(this)},multiplyVector4:function(gc){return gc.applyMatrix4(this)},multiplyVector3Array:function(gc){return this.applyToVector3Array(gc)},rotateAxis:function(gc){void 0,gc.transformDirection(this)},crossVector:function(gc){return gc.applyMatrix4(this)},translate:function(){},rotateX:function(){},rotateY:function(){},rotateZ:function(){},rotateByAxis:function(){},applyToBuffer:function(gc){return this.applyToBufferAttribute(gc)},applyToVector3Array:function(){},makeFrustum:function(gc,hc,yc,xc,vc,_c){return this.makePerspective(gc,hc,xc,yc,vc,_c)}}),ke.prototype.isIntersectionLine=function(gc){return this.intersectsLine(gc)},F.prototype.multiplyVector3=function(gc){return gc.applyQuaternion(this)},Object.assign(Xe.prototype,{isIntersectionBox:function(gc){return this.intersectsBox(gc)},isIntersectionPlane:function(gc){return this.intersectsPlane(gc)},isIntersectionSphere:function(gc){return this.intersectsSphere(gc)}}),Object.assign(uo.prototype,{extrude:function(gc){return new Br(this,gc)},makeGeometry:function(gc){return new jr(this,gc)}}),Object.assign(R.prototype,{fromAttribute:function(gc,hc,yc){return this.fromBufferAttribute(gc,hc,yc)}}),Object.assign(O.prototype,{setEulerFromRotationMatrix:function(){},setEulerFromQuaternion:function(){},getPositionFromMatrix:function(gc){return this.setFromMatrixPosition(gc)},getScaleFromMatrix:function(gc){return this.setFromMatrixScale(gc)},getColumnFromMatrix:function(gc,hc){return this.setFromMatrixColumn(hc,gc)},applyProjection:function(gc){return this.applyMatrix4(gc)},fromAttribute:function(gc,hc,yc){return this.fromBufferAttribute(gc,hc,yc)}}),Object.assign(I.prototype,{fromAttribute:function(gc,hc,yc){return this.fromBufferAttribute(gc,hc,yc)}}),ft.prototype.computeTangents=function(){},Object.assign(Ze.prototype,{getChildByName:function(gc){return this.getObjectByName(gc)},renderDepth:function(){},translate:function(gc,hc){return this.translateOnAxis(hc,gc)}}),Object.defineProperties(Ze.prototype,{eulerOrder:{get:function(){return this.rotation.order},set:function(gc){void 0,this.rotation.order=gc}},useQuaternion:{get:function(){},set:function(){}}}),Object.defineProperties(or.prototype,{objects:{get:function(){return this.levels}}}),Tt.prototype.setLens=function(gc,hc){void 0,hc!==void 0&&(this.filmGauge=hc),this.setFocalLength(gc)},Object.defineProperties(ya.prototype,{onlyShadow:{set:function(){}},shadowCameraFov:{set:function(gc){void 0,this.shadow.camera.fov=gc}},shadowCameraLeft:{set:function(gc){void 0,this.shadow.camera.left=gc}},shadowCameraRight:{set:function(gc){void 0,this.shadow.camera.right=gc}},shadowCameraTop:{set:function(gc){void 0,this.shadow.camera.top=gc}},shadowCameraBottom:{set:function(gc){void 0,this.shadow.camera.bottom=gc}},shadowCameraNear:{set:function(gc){void 0,this.shadow.camera.near=gc}},shadowCameraFar:{set:function(gc){void 0,this.shadow.camera.far=gc}},shadowCameraVisible:{set:function(){}},shadowBias:{set:function(gc){void 0,this.shadow.bias=gc}},shadowDarkness:{set:function(){}},shadowMapWidth:{set:function(gc){void 0,this.shadow.mapSize.width=gc}},shadowMapHeight:{set:function(gc){void 0,this.shadow.mapSize.height=gc}}}),Object.defineProperties(et.prototype,{length:{get:function(){return this.array.length}}}),Object.assign(gt.prototype,{addIndex:function(gc){void 0,this.setIndex(gc)},addDrawCall:function(gc,hc,yc){yc!==void 0&&void 0,void 0,this.addGroup(gc,hc)},clearDrawCalls:function(){void 0,this.clearGroups()},computeTangents:function(){},computeOffsets:function(){}}),Object.defineProperties(gt.prototype,{drawcalls:{get:function(){return this.groups}},offsets:{get:function(){return this.groups}}}),Object.defineProperties(Po.prototype,{dynamic:{set:function(){}},onUpdate:{value:function(){return this}}}),Object.defineProperties(Be.prototype,{wrapAround:{get:function(){},set:function(){}},wrapRGB:{get:function(){return new Ie}}}),Object.defineProperties(ia.prototype,{metal:{get:function(){return!1},set:function(){}}}),Object.defineProperties(Fe.prototype,{derivatives:{get:function(){return this.extensions.derivatives},set:function(gc){void 0,this.extensions.derivatives=gc}}}),Object.assign(Jt.prototype,{supportsFloatTextures:function(){return this.extensions.get('OES_texture_float')},supportsHalfFloatTextures:function(){return this.extensions.get('OES_texture_half_float')},supportsStandardDerivatives:function(){return this.extensions.get('OES_standard_derivatives')},supportsCompressedTextureS3TC:function(){return this.extensions.get('WEBGL_compressed_texture_s3tc')},supportsCompressedTexturePVRTC:function(){return this.extensions.get('WEBGL_compressed_texture_pvrtc')},supportsBlendMinMax:function(){return this.extensions.get('EXT_blend_minmax')},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){return this.extensions.get('ANGLE_instanced_arrays')},enableScissorTest:function(gc){void 0,this.setScissorTest(gc)},initMaterial:function(){},addPrePlugin:function(){},addPostPlugin:function(){},updateShadowMap:function(){}}),Object.defineProperties(Jt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(gc){void 0,this.shadowMap.enabled=gc}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(gc){void 0,this.shadowMap.type=gc}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(gc){void 0,this.shadowMap.cullFace=gc}}}),Object.defineProperties(je.prototype,{cullFace:{get:function(){return this.renderReverseSided?Wi:ki},set:function(gc){void 0,this.renderReverseSided=gc!==ki}}}),Object.defineProperties(U.prototype,{wrapS:{get:function(){return this.texture.wrapS},set:function(gc){void 0,this.texture.wrapS=gc}},wrapT:{get:function(){return this.texture.wrapT},set:function(gc){void 0,this.texture.wrapT=gc}},magFilter:{get:function(){return this.texture.magFilter},set:function(gc){void 0,this.texture.magFilter=gc}},minFilter:{get:function(){return this.texture.minFilter},set:function(gc){void 0,this.texture.minFilter=gc}},anisotropy:{get:function(){return this.texture.anisotropy},set:function(gc){void 0,this.texture.anisotropy=gc}},offset:{get:function(){return this.texture.offset},set:function(gc){void 0,this.texture.offset=gc}},repeat:{get:function(){return this.texture.repeat},set:function(gc){void 0,this.texture.repeat=gc}},format:{get:function(){return this.texture.format},set:function(gc){void 0,this.texture.format=gc}},type:{get:function(){return this.texture.type},set:function(gc){void 0,this.texture.type=gc}},generateMipmaps:{get:function(){return this.texture.generateMipmaps},set:function(gc){void 0,this.texture.generateMipmaps=gc}}}),Eo.prototype.load=function(gc){var hc=this,yc=new yo;return yc.load(gc,function(xc){hc.setBuffer(xc)}),this},Mo.prototype.getData=function(){return this.getFrequencyData()};L.WebGLRenderTargetCube=D,L.WebGLRenderTarget=U,L.WebGLRenderer=Jt,L.ShaderLib=Vp,L.UniformsLib=Hp,L.UniformsUtils=wl,L.ShaderChunk=Op,L.FogExp2=Qt,L.Fog=$t,L.Scene=er,L.LensFlare=tr,L.Sprite=ar,L.LOD=or,L.SkinnedMesh=sr,L.Skeleton=ir,L.Bone=nr,L.Mesh=ht,L.LineSegments=pr,L.Line=dr,L.Points=ur,L.Group=mr,L.VideoTexture=fr,L.DataTexture=Ue,L.CompressedTexture=gr,L.CubeTexture=H,L.CanvasTexture=hr,L.DepthTexture=yr,L.Texture=C,L.CompressedTextureLoader=ua,L.DataTextureLoader=ma,L.CubeTextureLoader=ga,L.TextureLoader=ha,L.ObjectLoader=Wa,L.MaterialLoader=Ga,L.BufferGeometryLoader=Ha,L.DefaultLoadingManager=Jp,L.LoadingManager=pa,L.JSONLoader=ka,L.ImageLoader=fa,L.FontLoader=go,L.FileLoader=ca,L.Loader=Va,L.Cache=Kp,L.AudioLoader=yo,L.SpotLightShadow=_a,L.SpotLight=ba,L.PointLight=Ea,L.RectAreaLight=xo,L.HemisphereLight=xa,L.DirectionalLightShadow=Ta,L.DirectionalLight=Ma,L.AmbientLight=Sa,L.LightShadow=va,L.Light=ya,L.StereoCamera=vo,L.PerspectiveCamera=Tt,L.OrthographicCamera=Mt,L.CubeCamera=_o,L.Camera=Et,L.AudioListener=bo,L.PositionalAudio=To,L.AudioContext=rc,L.AudioAnalyser=Mo,L.Audio=Eo,L.VectorKeyframeTrack=Ca,L.StringKeyframeTrack=za,L.QuaternionKeyframeTrack=Ua,L.NumberKeyframeTrack=Da,L.ColorKeyframeTrack=Ba,L.BooleanKeyframeTrack=Na,L.PropertyMixer=So,L.PropertyBinding=Lo,L.KeyframeTrack=Fa,L.AnimationUtils=Qp,L.AnimationObjectGroup=wo,L.AnimationMixer=Ro,L.AnimationClip=Oa,L.Uniform=Po,L.InstancedBufferGeometry=Co,L.BufferGeometry=gt,L.GeometryIdCount=mt,L.Geometry=ft,L.InterleavedBufferAttribute=Io,L.InstancedInterleavedBuffer=Do,L.InterleavedBuffer=Uo,L.InstancedBufferAttribute=zo,L.Face3=Qe,L.Object3D=Ze,L.Raycaster=No,L.Layers=qe,L.EventDispatcher=A,L.Clock=Oo,L.QuaternionLinearInterpolant=Ia,L.LinearInterpolant=Aa,L.DiscreteInterpolant=Ra,L.CubicInterpolant=wa,L.Interpolant=La,L.Triangle=Je,L.Math=xl,L.Spherical=Go,L.Cylindrical=Ho,L.Plane=ke,L.Frustum=We,L.Sphere=He,L.Ray=Xe,L.Matrix4=G,L.Matrix3=Ve,L.Box3=Ge,L.Box2=De,L.Line3=Ke,L.Euler=Ye,L.Vector4=I,L.Vector3=O,L.Vector2=R,L.Quaternion=F,L.Color=Ie,L.MorphBlendMesh=Vo,L.ImmediateRenderObject=ko,L.VertexNormalsHelper=Wo,L.SpotLightHelper=jo,L.SkeletonHelper=Xo,L.PointLightHelper=Yo,L.RectAreaLightHelper=qo,L.HemisphereLightHelper=Zo,L.GridHelper=Ko,L.PolarGridHelper=Jo,L.FaceNormalsHelper=Qo,L.DirectionalLightHelper=$o,L.CameraHelper=ei,L.BoxHelper=ti,L.ArrowHelper=ri,L.AxisHelper=ai,L.CatmullRomCurve3=ii,L.CubicBezierCurve3=ni,L.QuadraticBezierCurve3=si,L.LineCurve3=li,L.ArcCurve=di,L.EllipseCurve=no,L.SplineCurve=so,L.CubicBezierCurve=lo,L.QuadraticBezierCurve=po,L.LineCurve=oo,L.Shape=uo,L.Path=co,L.ShapePath=mo,L.Font=fo,L.CurvePath=io,L.Curve=ao,L.ShapeUtils=Yp,L.SceneUtils={createMultiMaterialObject:function(gc,hc){for(var yc=new mr,xc=0,vc=hc.length;xc<vc;xc++)yc.add(new ht(gc,hc[xc]));return yc},detach:function(gc,hc,yc){gc.applyMatrix(hc.matrixWorld),hc.remove(gc),yc.add(gc)},attach:function(gc,hc,yc){var xc=new G;xc.getInverse(yc.matrixWorld),gc.applyMatrix(xc),hc.remove(gc),yc.add(gc)}},L.WireframeGeometry=xr,L.ParametricGeometry=vr,L.ParametricBufferGeometry=_r,L.TetrahedronGeometry=Tr,L.TetrahedronBufferGeometry=Mr,L.OctahedronGeometry=Sr,L.OctahedronBufferGeometry=Lr,L.IcosahedronGeometry=wr,L.IcosahedronBufferGeometry=Ar,L.DodecahedronGeometry=Rr,L.DodecahedronBufferGeometry=Pr,L.PolyhedronGeometry=br,L.PolyhedronBufferGeometry=Er,L.TubeGeometry=Cr,L.TubeBufferGeometry=Ir,L.TorusKnotGeometry=Ur,L.TorusKnotBufferGeometry=Dr,L.TorusGeometry=zr,L.TorusBufferGeometry=Nr,L.TextGeometry=Fr,L.SphereGeometry=Or,L.SphereBufferGeometry=Gr,L.RingGeometry=Hr,L.RingBufferGeometry=Vr,L.PlaneGeometry=vt,L.PlaneBufferGeometry=bt,L.LatheGeometry=kr,L.LatheBufferGeometry=Wr,L.ShapeGeometry=jr,L.ShapeBufferGeometry=Xr,L.ExtrudeGeometry=Br,L.EdgesGeometry=Yr,L.ConeGeometry=Kr,L.ConeBufferGeometry=Jr,L.CylinderGeometry=qr,L.CylinderBufferGeometry=Zr,L.CircleGeometry=Qr,L.CircleBufferGeometry=$r,L.BoxGeometry=yt,L.BoxBufferGeometry=xt,L.ShadowMaterial=ea,L.SpriteMaterial=rr,L.RawShaderMaterial=ta,L.ShaderMaterial=Fe,L.PointsMaterial=cr,L.MultiMaterial=ra,L.MeshPhysicalMaterial=oa,L.MeshStandardMaterial=aa,L.MeshPhongMaterial=ia,L.MeshToonMaterial=na,L.MeshNormalMaterial=sa,L.MeshLambertMaterial=la,L.MeshDepthMaterial=Oe,L.MeshBasicMaterial=$e,L.LineDashedMaterial=da,L.LineBasicMaterial=lr,L.Material=Be,L.Float64BufferAttribute=dt,L.Float32BufferAttribute=lt,L.Uint32BufferAttribute=st,L.Int32BufferAttribute=nt,L.Uint16BufferAttribute=it,L.Int16BufferAttribute=ot,L.Uint8ClampedBufferAttribute=at,L.Uint8BufferAttribute=rt,L.Int8BufferAttribute=tt,L.BufferAttribute=et,L.REVISION='84',L.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},L.CullFaceNone=Vi,L.CullFaceBack=ki,L.CullFaceFront=Wi,L.CullFaceFrontBack=3,L.FrontFaceDirectionCW=Xi,L.FrontFaceDirectionCCW=1,L.BasicShadowMap=0,L.PCFShadowMap=Zi,L.PCFSoftShadowMap=Ki,L.FrontSide=Ji,L.BackSide=Qi,L.DoubleSide=$i,L.FlatShading=en,L.SmoothShading=tn,L.NoColors=rn,L.FaceColors=an,L.VertexColors=on,L.NoBlending=nn,L.NormalBlending=sn,L.AdditiveBlending=ln,L.SubtractiveBlending=dn,L.MultiplyBlending=pn,L.CustomBlending=cn,L.AddEquation=un,L.SubtractEquation=mn,L.ReverseSubtractEquation=gn,L.MinEquation=hn,L.MaxEquation=yn,L.ZeroFactor=xn,L.OneFactor=vn,L.SrcColorFactor=_n,L.OneMinusSrcColorFactor=bn,L.SrcAlphaFactor=En,L.OneMinusSrcAlphaFactor=Tn,L.DstAlphaFactor=Mn,L.OneMinusDstAlphaFactor=Sn,L.DstColorFactor=Ln,L.OneMinusDstColorFactor=wn,L.SrcAlphaSaturateFactor=An,L.NeverDepth=Rn,L.AlwaysDepth=Pn,L.LessDepth=Cn,L.LessEqualDepth=In,L.EqualDepth=Un,L.GreaterEqualDepth=Dn,L.GreaterDepth=zn,L.NotEqualDepth=Nn,L.MultiplyOperation=Bn,L.MixOperation=Fn,L.AddOperation=On,L.NoToneMapping=Gn,L.LinearToneMapping=Hn,L.ReinhardToneMapping=Vn,L.Uncharted2ToneMapping=kn,L.CineonToneMapping=Wn,L.UVMapping=jn,L.CubeReflectionMapping=Xn,L.CubeRefractionMapping=Yn,L.EquirectangularReflectionMapping=qn,L.EquirectangularRefractionMapping=Zn,L.SphericalReflectionMapping=Kn,L.CubeUVReflectionMapping=Jn,L.CubeUVRefractionMapping=Qn,L.RepeatWrapping=$n,L.ClampToEdgeWrapping=es,L.MirroredRepeatWrapping=ts,L.NearestFilter=as,L.NearestMipMapNearestFilter=os,L.NearestMipMapLinearFilter=is,L.LinearFilter=ns,L.LinearMipMapNearestFilter=ss,L.LinearMipMapLinearFilter=ls,L.UnsignedByteType=ds,L.ByteType=ps,L.ShortType=us,L.UnsignedShortType=ms,L.IntType=fs,L.UnsignedIntType=gs,L.FloatType=hs,L.HalfFloatType=ys,L.UnsignedShort4444Type=xs,L.UnsignedShort5551Type=vs,L.UnsignedShort565Type=_s,L.UnsignedInt248Type=Es,L.AlphaFormat=Ts,L.RGBFormat=Ms,L.RGBAFormat=Ss,L.LuminanceFormat=Ls,L.LuminanceAlphaFormat=ws,L.RGBEFormat=Ss,L.DepthFormat=Rs,L.DepthStencilFormat=Ps,L.RGB_S3TC_DXT1_Format=Cs,L.RGBA_S3TC_DXT1_Format=Is,L.RGBA_S3TC_DXT3_Format=Us,L.RGBA_S3TC_DXT5_Format=Ds,L.RGB_PVRTC_4BPPV1_Format=zs,L.RGB_PVRTC_2BPPV1_Format=Ns,L.RGBA_PVRTC_4BPPV1_Format=Bs,L.RGBA_PVRTC_2BPPV1_Format=Fs,L.RGB_ETC1_Format=Os,L.LoopOnce=Gs,L.LoopRepeat=Hs,L.LoopPingPong=Vs,L.InterpolateDiscrete=ks,L.InterpolateLinear=Ws,L.InterpolateSmooth=js,L.ZeroCurvatureEnding=Xs,L.ZeroSlopeEnding=Ys,L.WrapAroundEnding=qs,L.TrianglesDrawMode=Zs,L.TriangleStripDrawMode=Ks,L.TriangleFanDrawMode=Js,L.LinearEncoding=Qs,L.sRGBEncoding=$s,L.GammaEncoding=el,L.RGBEEncoding=rl,L.LogLuvEncoding=3003,L.RGBM7Encoding=nl,L.RGBM16Encoding=dl,L.RGBDEncoding=cl,L.BasicDepthPacking=ul,L.RGBADepthPacking=yl,L.CubeGeometry=yt,L.Face4=function(gc,hc,yc,xc,vc,_c,Ec){return new Qe(gc,hc,yc,vc,_c,Ec)},L.LineStrip=0,L.LinePieces=1,L.MeshFaceMaterial=function(gc){return new ra(gc)},L.PointCloud=function(gc,hc){return new ur(gc,hc)},L.Particle=function(gc){return new ar(gc)},L.ParticleSystem=function(gc,hc){return new ur(gc,hc)},L.PointCloudMaterial=function(gc){return new cr(gc)},L.ParticleBasicMaterial=function(gc){return new cr(gc)},L.ParticleSystemMaterial=function(gc){return new cr(gc)},L.Vertex=function(gc,hc,yc){return new O(gc,hc,yc)},L.DynamicBufferAttribute=function(gc,hc){return new et(gc,hc).setDynamic(!0)},L.Int8Attribute=function(gc,hc){return new tt(gc,hc)},L.Uint8Attribute=function(gc,hc){return new rt(gc,hc)},L.Uint8ClampedAttribute=function(gc,hc){return new at(gc,hc)},L.Int16Attribute=function(gc,hc){return new ot(gc,hc)},L.Uint16Attribute=function(gc,hc){return new it(gc,hc)},L.Int32Attribute=function(gc,hc){return new nt(gc,hc)},L.Uint32Attribute=function(gc,hc){return new st(gc,hc)},L.Float32Attribute=function(gc,hc){return new lt(gc,hc)},L.Float64Attribute=function(gc,hc){return new dt(gc,hc)},L.ClosedSplineCurve3=Pi,L.SplineCurve3=Ci,L.Spline=Ii,L.BoundingBoxHelper=function(gc,hc){return new ti(gc,hc)},L.EdgesHelper=function(gc,hc){return new pr(new Yr(gc.geometry),new lr({color:hc===void 0?16777215:hc}))},L.WireframeHelper=function(gc,hc){return new pr(new xr(gc.geometry),new lr({color:hc===void 0?16777215:hc}))},L.XHRLoader=function(gc){return new ca(gc)},L.BinaryTextureLoader=function(gc){return new ma(gc)},L.GeometryUtils={merge:function(gc,hc,yc){var xc;hc.isMesh&&(hc.matrixAutoUpdate&&hc.updateMatrix(),xc=hc.matrix,hc=hc.geometry),gc.merge(hc,xc,yc)},center:function(gc){return gc.center()}},L.ImageUtils={crossOrigin:void 0,loadTexture:function(gc,hc,yc,xc){var vc=new ha;vc.setCrossOrigin(this.crossOrigin);var _c=vc.load(gc,yc,void 0,xc);return hc&&(_c.mapping=hc),_c},loadTextureCube:function(gc,hc,yc,xc){var vc=new ga;vc.setCrossOrigin(this.crossOrigin);var _c=vc.load(gc,yc,void 0,xc);return hc&&(_c.mapping=hc),_c},loadCompressedTexture:function(){},loadCompressedTextureCube:function(){}},L.Projector=function(){void 0,this.projectVector=function(gc,hc){void 0,gc.project(hc)},this.unprojectVector=function(gc,hc){void 0,gc.unproject(hc)},this.pickingRay=function(){}},L.CanvasRenderer=function(){void 0,this.domElement=document.createElementNS('http://www.w3.org/1999/xhtml','canvas'),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},Object.defineProperty(L,'__esModule',{value:!0})})},function(E,M){'use strict';Object.defineProperty(M,'__esModule',{value:!0});M.BirdSimple={vertices:[[-3.5,0,0],[0,0,1],[3.5,0,0],[0,0,-1]],faces:[[0,1,3],[1,2,3]]}},function(E,M,S){'use strict';function A(D,F){if(!(D instanceof F))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(M,'__esModule',{value:!0});var R=function(){function D(F,O){for(var G=0,H;G<O.length;G++)H=O[G],H.enumerable=H.enumerable||!1,H.configurable=!0,'value'in H&&(H.writable=!0),Object.defineProperty(F,H.key,H)}return function(F,O,G){return O&&D(F.prototype,O),G&&D(F,G),F}}(),C=S(8),I=function(D){return D&&D.__esModule?D:{default:D}}(C),U=function(){function D(F,O){var G=2<arguments.length&&void 0!==arguments[2]&&arguments[2],H=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;A(this,D),this.grid=this.array3d(O),this.bounds=F,this.width=this.bounds.maxx-this.bounds.minx+1,this.height=this.bounds.maxy-this.bounds.miny+1,this.depth=this.bounds.maxz-this.bounds.minz+1,this.numcells=O,this.xcellsize=this.width/O,this.ycellsize=this.height/O,this.zcellsize=this.depth/O,this.prop=H,this.maxRadius=_Mathsqrt(this.width*this.width+this.height*this.height+this.depth*this.depth),this.boundsChecking=G,this.foundObjects=[]}return R(D,[{key:'add',value:function(O){var G=O;if(this.prop&&(G=O[this.prop]),!G.x||!G.y)throw Error('`item` type needs properties `x` and `y`');var H=this.wrap((G.x-this.mod(G.x,this.xcellsize))/this.xcellsize),V=this.wrap((G.y-this.mod(G.y,this.ycellsize))/this.ycellsize),W=this.wrap((G.z-this.mod(G.z,this.zcellsize))/this.zcellsize),X=this.grid[W][V][H]||[];X.includes(O)||X.push(O),this.grid[W][V][H]=X}},{key:'move',value:function(O,G,H,V,W,X,Y){var Z=(G-this.mod(G,this.xcellsize))/this.xcellsize,K=(H-this.mod(H,this.ycellsize))/this.ycellsize,J=(V-this.mod(V,this.zcellsize))/this.zcellsize,Q=(W-this.mod(W,this.xcellsize))/this.xcellsize,$=(X-this.mod(X,this.ycellsize))/this.ycellsize,ee=(Y-this.mod(Y,this.zcellsize))/this.zcellsize;if(Z!=Q||K!=$||J!=ee){this.boundsChecking&&(this.checkBounds(G,H,V),this.checkBounds(W,X,Y));var oe;oe=this.grid[J][K][Z],oe.splice(oe.indexOf(O),1),oe=this.grid[this.wrap(ee)][this.wrap($)][this.wrap(Q)],oe.push(O)}}},{key:'checkBounds',value:function(O,G,H){if(O<this.bounds.minx||O>this.bounds.maxx)throw Error(O+' out of bounds ['+this.bounds.minx+', '+this.bounds.maxx+']');if(G<this.bounds.miny||G>this.bounds.maxy)throw Error(G+' out of bounds ['+this.bounds.miny+','+this.bounds.maxy+']');if(H<this.bounds.minz||H>this.bounds.maxz)throw Error(G+' out of bounds ['+this.bounds.minz+','+this.bounds.maxz+']')}},{key:'mod',value:function(O,G){var H=O%G;return 0>H?H+G:H}},{key:'query',value:function(O,G){G>this.maxRadius&&(G=this.maxRadius);var H=O;this.prop&&(H=O[this.prop]);var V=G*G,W=(H.x-G-this.mod(H.x-G,this.xcellsize))/this.xcellsize,X=(H.y-G-this.mod(H.y-G,this.ycellsize))/this.ycellsize,Y=(H.z-G-this.mod(H.z-G,this.zcellsize))/this.zcellsize,Z=(H.x+G-this.mod(H.x+G,this.xcellsize))/this.xcellsize,K=(H.y+G-this.mod(H.y+G,this.ycellsize))/this.ycellsize,J=(H.z+G-this.mod(H.z+G,this.zcellsize))/this.zcellsize;0>W&&(W=0),Z>=this.numcells&&(Z=this.numcells-1),0>X&&(X=0),K>=this.numcells&&(K=this.numcells-1),0>Y&&(Y=0),J>=this.numcells&&(J=this.numcells-1);for(var Q=[],$=Y;$<=J;$++)for(var ee=X;ee<=K;ee++)for(var oe=W,ie;oe<=Z;oe++)if(ie=this.grid[$][ee][oe],ie)for(var ne=0,se;ne<ie.length;ne++)if(se=ie[ne],se!=O){var le=se;this.prop&&(le=se[this.prop]);var pe=this.distsq(le.x,le.y,le.z,H.x,H.y,H.z);pe<=V&&Q.push(se)}return Q}},{key:'querywrap',value:function(O,G,H){H>this.maxRadius&&(H=this.maxRadius);var V=H*H,W=(O-this.mod(O,this.xcellsize))/this.xcellsize,X=(G-this.mod(G,this.ycellsize))/this.ycellsize,Y=(O-H-this.mod(O-H,this.xcellsize))/this.xcellsize,Z=(G-H-this.mod(G-H,this.ycellsize))/this.ycellsize,K=(O+H-this.mod(O+H,this.xcellsize))/this.xcellsize,J=(G+H-this.mod(G+H,this.ycellsize))/this.ycellsize,Q=[];J-Z>=this.numcells&&(J=Z+this.numcells-1),K-Y>=this.numcells&&(K=Y+this.numcells-1);for(var $=Z;$<=J;$++)for(var ee=Y;ee<=K;ee++){var oe=this.wrap(ee),ie=this.wrap($),ne=this.grid[ie][oe];if(ne)for(var se=0;se<ne.length;se++){var le=ne[se],pe=le;this.prop&&(pe=le[this.prop]);var ue=this.distsq(pe.x,pe.y,O,G);ue<=V&&Q.push(le)}}return Q}},{key:'distsq',value:function(O,G,H,V,W,X){var Y=V-O,Z=W-G,K=X-H;return Y*Y+Z*Z+K*K}},{key:'wrap',value:function(O){return this.mod(O,this.numcells)}},{key:'array2d',value:function(O){for(var G=[],H=0;H<O;H++){G.push([]);for(var V=0;V<O;V++)G[H][V]=[]}return G}},{key:'array3d',value:function(O){for(var G=[],H=0;H<O;H++){G[H]=[];for(var V=0;V<O;V++){G[H][V]=[];for(var W=0;W<O;W++)G[H][V][W]=[]}}return G}},{key:'__array2d',value:function(O,G){for(var H=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,V=[],W=0,X;W<G;W++){X=[];for(var Y=0;Y<O;Y++)X[Y]=H;V.push(X)}return V}}]),D}();M.default=U},function(E,M,S){var L,A;(function(R,C){'use strict';L=C,A='function'==typeof L?L.call(M,S,M,E):L,!(A!==void 0&&(E.exports=A))})(this,function(){'use strict';function R(Y){return typeof console!=G&&(void 0===function(){}?void 0===function(){}?O:C(console,'log'):C(console,Y))}function C(Y,Z){var K=Y[Z];if('function'==typeof K.bind)return K.bind(Y);try{return Function.prototype.bind.call(K,Y)}catch(J){return function(){return Function.prototype.apply.apply(K,[Y,arguments])}}}function I(Y,Z,K){return function(){typeof console!=G&&(U.call(this,Z,K),this[Y].apply(this,arguments))}}function U(Y,Z){for(var K=0,J;K<H.length;K++)J=H[K],this[J]=K<Y?O:this.methodFactory(J,Y,Z)}function D(Y){return R(Y)||I.apply(this,arguments)}function F(Y,Z,K){function J(ne){var se=(H[ne]||'silent').toUpperCase();try{return void(window.localStorage[oe]=se)}catch(le){}try{window.document.cookie=encodeURIComponent(oe)+'='+se+';'}catch(le){}}function Q(){var ne;try{ne=window.localStorage[oe]}catch(pe){}if(typeof ne==G)try{var se=window.document.cookie,le=se.indexOf(encodeURIComponent(oe)+'=');le&&(ne=/^([^;]+)/.exec(se.slice(le))[1])}catch(pe){}return void 0===$.levels[ne]&&(ne=void 0),ne}var $=this,oe='loglevel',ee;Y&&(oe+=':'+Y),$.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},$.methodFactory=K||D,$.getLevel=function(){return ee},$.setLevel=function(ne,se){if('string'==typeof ne&&void 0!==$.levels[ne.toUpperCase()]&&(ne=$.levels[ne.toUpperCase()]),!('number'==typeof ne&&0<=ne&&ne<=$.levels.SILENT))throw'log.setLevel() called with invalid level: '+ne;else if(ee=ne,!1!==se&&J(ne),U.call($,ne,Y),typeof console==G&&ne<$.levels.SILENT)return'No console available for logging'},$.setDefaultLevel=function(ne){Q()||$.setLevel(ne,!1)},$.enableAll=function(ne){$.setLevel($.levels.TRACE,ne)},$.disableAll=function(ne){$.setLevel($.levels.SILENT,ne)};var ie=Q();null==ie&&(ie=null==Z?'WARN':Z),$.setLevel(ie,!1)}var O=function(){},G='undefined',H=['trace','debug','info','warn','error'],V=new F,W={};V.getLogger=function(Z){if('string'!=typeof Z||''===Z)throw new TypeError('You must supply a name when creating a logger.');var K=W[Z];return K||(K=W[Z]=new F(Z,V.getLevel(),V.methodFactory)),K};var X=typeof window==G?void 0:window.log;return V.noConflict=function(){return typeof window!=G&&window.log===V&&(window.log=X),V},V})},function(E,M,S){'use strict';function A(W,X){if(!(W instanceof X))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(M,'__esModule',{value:!0});var R=function(){function W(X,Y){for(var Z=0,K;Z<Y.length;Z++)K=Y[Z],K.enumerable=K.enumerable||!1,K.configurable=!0,'value'in K&&(K.writable=!0),Object.defineProperty(X,K.key,K)}return function(X,Y,Z){return Y&&W(X.prototype,Y),Z&&W(X,Z),X}}(),C=S(3),I=function(W){return W&&W.__esModule?W:{default:W}}(C),F=0.6,H=6,V=function(){function W(X,Y){A(this,W),this.bounds=Y;var Z=(128+_Mathfloor(127*Math.random())).toString(16);this.shade='0x'+Z+Z+Z,this.maxVelocity=H+Math.random()*H/2,this.maxSteer=0.1,this.velocity=new I.default(Math.random()*H-H/2,Math.random()*H-H/2,Math.random()*H-H/2),this.accelerate=new I.default,this.position=new I.default(Math.random()*this.bounds.maxx,Math.random()*this.bounds.maxy,Math.random()*this.bounds.maxz)}return R(W,[{key:'shader',value:function(){return this.shade}},{key:'mutate',value:function(Y){this.flock(Y.neighbours),this.interact(Y),this.fuzzy(),this.move()}},{key:'flock',value:function(Y){this.accelerate=this.accelerate.add(this.alignment(Y)).add(this.cohesion(Y)).add(this.separation(Y))}},{key:'interact',value:function(){}},{key:'fuzzy',value:function(){1e-3>Math.random()&&this.accelerate.tmul(this.maxVelocity)}},{key:'move',value:function(){this.bound(),this.velocity.tadd(this.accelerate);var Y=this.velocity.mag();Y>this.maxVelocity&&this.velocity.tdiv(Y/this.maxVelocity),this.position.tadd(this.velocity),this.bound2(),this.accelerate.tmul(0),this.dirty=!0}},{key:'bound',value:function(){var Y=10,Z=this.avoid(new I.default(this.bounds.minx,this.position.y,this.position.z)),K=this.avoid(new I.default(this.bounds.maxx,this.position.y,this.position.z)),J=this.avoid(new I.default(this.position.x,this.bounds.miny,this.position.z)),Q=this.avoid(new I.default(this.position.x,this.bounds.maxy,this.position.z)),$=this.avoid(new I.default(this.position.x,this.position.y,this.bounds.minz)),ee=this.avoid(new I.default(this.position.x,this.position.y,this.bounds.maxz));Z.tmul(Y),K.tmul(Y),J.tmul(Y),Q.tmul(Y),$.tmul(Y),ee.tmul(Y),this.accelerate.tadd(Z.add(K).add(J).add(Q).add($).add(ee))}},{key:'seek',value:function(Y){var Z=this.position.dist(Y);return Z>75?new I.default:Y.sub(this.position).norm().mul(0.1)}},{key:'avoid',value:function(Y){return this.position.sub(Y).mul(1/this.position.distsq(Y))}},{key:'flee',value:function(Y){if(!Y)return new I.default;var Z=this.position.dist(Y);if(Z>50)return new I.default;var K=this.position.sub(Y);return K.mul(0.4/Z)}},{key:'alignment',value:function(Y){var Z=new I.default;if(0==Y.length)return Z;var K=0,J=!0,Q=!1,$;try{for(var ee=Y[Symbol.iterator](),oe,ie;!(J=(oe=ee.next()).done);J=!0)ie=oe.value,Math.random()>F||(Z.tadd(ie.velocity),K++)}catch(se){Q=!0,$=se}finally{try{!J&&ee.return&&ee.return()}finally{if(Q)throw $}}if(0==K)return Z;Z.tdiv(K);var ne=Z.mag();return ne>this.maxSteer&&Z.tdiv(ne/this.maxSteer),Z}},{key:'cohesion',value:function(Y){var Z=new I.default;if(0==Y.length)return Z;var K=0,J=!0,Q=!1,$;try{for(var ee=Y[Symbol.iterator](),oe,ie;!(J=(oe=ee.next()).done);J=!0)ie=oe.value,Math.random()>F||(Z.tadd(ie.position),K++)}catch(le){Q=!0,$=le}finally{try{!J&&ee.return&&ee.return()}finally{if(Q)throw $}}if(0==K)return Z;Z.tdiv(K);var ne=Z.sub(this.position),se=ne.mag();return se>this.maxSteer&&ne.tdiv(se/this.maxSteer),ne}},{key:'separation',value:function(Y){var Z=new I.default;if(0==Y.length)return Z;var K=!0,J=!1,Q;try{for(var $=Y[Symbol.iterator](),ee,oe;!(K=(ee=$.next()).done);K=!0)if(oe=ee.value,!(Math.random()>F)){var ie=oe.position.dist(this.position);if(0!=ie){var ne=this.position.sub(oe.position);ne.tnorm(),ne.tdiv(ie),Z.tadd(ne)}}}catch(se){J=!0,Q=se}finally{try{!K&&$.return&&$.return()}finally{if(J)throw Q}}return Z}},{key:'bound2',value:function(){this.position.x=this.wrap(this.position.x,this.bounds.minx,this.bounds.maxx),this.position.y=this.wrap(this.position.y,this.bounds.miny,this.bounds.maxy),this.position.z=this.wrap(this.position.z,this.bounds.minz,this.bounds.maxz)}},{key:'wrap',value:function(Y,Z,K){var J=K-Z;return Y<Z?Y+J:Y>K?Y-J:Y}}]),W}();M.default=V}]);